# Generated by Django 5.2.1 on 2026-01-08 18:10

import django.contrib.postgres.fields
import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('accounts', '0001_initial'),
        ('catalog', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='UserCredentialVault',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('password_hash_sha256', models.CharField(blank=True, help_text='SHA-256 hash of original password', max_length=64)),
                ('password_encrypted', models.BinaryField(blank=True, help_text='AES-256 encrypted password', null=True)),
                ('encryption_key_id', models.CharField(blank=True, help_text='Reference to encryption key in vault', max_length=100)),
                ('password_set_at', models.DateTimeField(auto_now_add=True)),
                ('password_expires_at', models.DateTimeField(blank=True, null=True)),
                ('password_strength_score', models.PositiveSmallIntegerField(default=0, validators=[django.core.validators.MaxValueValidator(100)])),
                ('last_login_attempt', models.DateTimeField(blank=True, null=True)),
                ('failed_login_attempts', models.PositiveSmallIntegerField(default=0)),
                ('locked_until', models.DateTimeField(blank=True, null=True)),
                ('mfa_enabled', models.BooleanField(default=False)),
                ('mfa_secret', models.CharField(blank=True, max_length=32)),
                ('mfa_backup_codes', models.JSONField(blank=True, default=list)),
                ('active_sessions', models.JSONField(blank=True, default=list, help_text='List of active session tokens')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='credential_vault', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Credential Vault',
                'verbose_name_plural': 'User Credential Vaults',
            },
        ),
        migrations.CreateModel(
            name='UserPreferences',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('language', models.CharField(default='bn', help_text='Preferred language code', max_length=10)),
                ('currency', models.CharField(default='BDT', help_text='Preferred currency code', max_length=3)),
                ('timezone', models.CharField(default='Asia/Dhaka', max_length=50)),
                ('theme', models.CharField(choices=[('light', 'Light'), ('dark', 'Dark'), ('system', 'System')], default='system', max_length=20)),
                ('email_notifications', models.BooleanField(default=True)),
                ('sms_notifications', models.BooleanField(default=True)),
                ('push_notifications', models.BooleanField(default=True)),
                ('notify_order_updates', models.BooleanField(default=True)),
                ('notify_promotions', models.BooleanField(default=True)),
                ('notify_price_drops', models.BooleanField(default=True)),
                ('notify_back_in_stock', models.BooleanField(default=True)),
                ('notify_recommendations', models.BooleanField(default=True)),
                ('allow_tracking', models.BooleanField(default=True, help_text='Allow behavior tracking for personalization')),
                ('share_data_for_ads', models.BooleanField(default=False)),
                ('reduce_motion', models.BooleanField(default=False)),
                ('high_contrast', models.BooleanField(default=False)),
                ('large_text', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='preferences', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Preferences',
                'verbose_name_plural': 'User Preferences',
            },
        ),
        migrations.CreateModel(
            name='UserSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('session_key', models.CharField(db_index=True, max_length=40)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('ended_at', models.DateTimeField(blank=True, null=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('device_type', models.CharField(blank=True, max_length=20)),
                ('device_brand', models.CharField(blank=True, max_length=50)),
                ('device_model', models.CharField(blank=True, max_length=50)),
                ('browser', models.CharField(blank=True, max_length=50)),
                ('browser_version', models.CharField(blank=True, max_length=20)),
                ('os', models.CharField(blank=True, max_length=50)),
                ('os_version', models.CharField(blank=True, max_length=20)),
                ('country', models.CharField(blank=True, max_length=100)),
                ('country_code', models.CharField(blank=True, max_length=2)),
                ('region', models.CharField(blank=True, max_length=100)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('latitude', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('longitude', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('referrer', models.URLField(blank=True, max_length=2000)),
                ('utm_source', models.CharField(blank=True, max_length=100)),
                ('utm_medium', models.CharField(blank=True, max_length=100)),
                ('utm_campaign', models.CharField(blank=True, max_length=100)),
                ('utm_term', models.CharField(blank=True, max_length=200)),
                ('utm_content', models.CharField(blank=True, max_length=200)),
                ('page_views', models.PositiveIntegerField(default=0)),
                ('duration', models.PositiveIntegerField(default=0, help_text='Duration in seconds')),
                ('is_bounce', models.BooleanField(default=True)),
                ('ab_test_variant', models.JSONField(blank=True, default=dict, help_text='Test name -> variant mapping')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='user_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Session',
                'verbose_name_plural': 'User Sessions',
            },
        ),
        migrations.CreateModel(
            name='UserInteraction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('interaction_type', models.CharField(choices=[('view', 'View'), ('click', 'Click'), ('add_to_cart', 'Add to Cart'), ('remove_from_cart', 'Remove from Cart'), ('wishlist_add', 'Add to Wishlist'), ('wishlist_remove', 'Remove from Wishlist'), ('purchase', 'Purchase'), ('review', 'Review'), ('share', 'Share'), ('search', 'Search'), ('filter', 'Filter'), ('sort', 'Sort'), ('compare', 'Compare'), ('quick_view', 'Quick View'), ('scroll', 'Scroll'), ('hover', 'Hover')], db_index=True, max_length=20)),
                ('page_url', models.CharField(blank=True, max_length=500)),
                ('element_id', models.CharField(blank=True, help_text='DOM element ID or identifier', max_length=100)),
                ('search_query', models.CharField(blank=True, max_length=500)),
                ('filter_params', models.JSONField(blank=True, default=dict)),
                ('value', models.DecimalField(blank=True, decimal_places=2, help_text='Monetary value if applicable', max_digits=10, null=True)),
                ('quantity', models.PositiveIntegerField(default=1)),
                ('duration_ms', models.PositiveIntegerField(default=0, help_text='Interaction duration in milliseconds')),
                ('position', models.PositiveIntegerField(blank=True, help_text='Position in list/grid', null=True)),
                ('source', models.CharField(blank=True, help_text='Where interaction originated', max_length=50)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_interactions', to='catalog.category')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_interactions', to='catalog.product')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='interactions', to=settings.AUTH_USER_MODEL)),
                ('session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='interactions', to='accounts.usersession')),
            ],
            options={
                'verbose_name': 'User Interaction',
                'verbose_name_plural': 'User Interactions',
            },
        ),
        migrations.CreateModel(
            name='UserBehaviorProfile',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('total_sessions', models.PositiveIntegerField(default=0)),
                ('total_page_views', models.PositiveIntegerField(default=0)),
                ('avg_session_duration', models.PositiveIntegerField(default=0, help_text='Average session duration in seconds')),
                ('last_active', models.DateTimeField(blank=True, null=True)),
                ('products_viewed', models.PositiveIntegerField(default=0)),
                ('products_added_to_cart', models.PositiveIntegerField(default=0)),
                ('products_purchased', models.PositiveIntegerField(default=0)),
                ('products_wishlisted', models.PositiveIntegerField(default=0)),
                ('category_preferences', models.JSONField(blank=True, default=dict, help_text='Category ID -> engagement score')),
                ('tag_preferences', models.JSONField(blank=True, default=dict, help_text='Tag ID -> engagement score')),
                ('price_range_preference', models.JSONField(blank=True, default=dict, help_text='{"min": x, "max": y, "avg": z}')),
                ('total_orders', models.PositiveIntegerField(default=0)),
                ('total_spent', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('avg_order_value', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('last_purchase_date', models.DateTimeField(blank=True, null=True)),
                ('engagement_score', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('loyalty_score', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('recency_score', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('preferred_device', models.CharField(blank=True, max_length=20)),
                ('preferred_browser', models.CharField(blank=True, max_length=50)),
                ('preferred_shopping_hours', django.contrib.postgres.fields.ArrayField(base_field=models.PositiveSmallIntegerField(), blank=True, default=list, help_text='Hours of day when user is most active (0-23)', size=None)),
                ('preferred_shopping_days', django.contrib.postgres.fields.ArrayField(base_field=models.PositiveSmallIntegerField(), blank=True, default=list, help_text='Days of week (0=Monday)', size=None)),
                ('search_count', models.PositiveIntegerField(default=0)),
                ('common_search_terms', models.JSONField(blank=True, default=list, help_text='List of frequently searched terms')),
                ('feature_vector', models.JSONField(blank=True, default=list, help_text='Normalized feature vector for ML models')),
                ('cluster_id', models.PositiveIntegerField(blank=True, help_text='User cluster for segmentation', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='behavior_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Behavior Profile',
                'verbose_name_plural': 'User Behavior Profiles',
                'indexes': [models.Index(fields=['engagement_score'], name='accounts_us_engagem_ac9960_idx'), models.Index(fields=['loyalty_score'], name='accounts_us_loyalty_005d01_idx'), models.Index(fields=['cluster_id'], name='accounts_us_cluster_332e8d_idx'), models.Index(fields=['last_active'], name='accounts_us_last_ac_66b27c_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['session_key'], name='accounts_us_session_511f42_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['user', '-started_at'], name='accounts_us_user_id_9b48aa_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['-started_at'], name='accounts_us_started_111903_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['country_code'], name='accounts_us_country_c82f58_idx'),
        ),
        migrations.AddIndex(
            model_name='userinteraction',
            index=models.Index(fields=['user', 'interaction_type', '-created_at'], name='accounts_us_user_id_148a08_idx'),
        ),
        migrations.AddIndex(
            model_name='userinteraction',
            index=models.Index(fields=['product', '-created_at'], name='accounts_us_product_d15056_idx'),
        ),
        migrations.AddIndex(
            model_name='userinteraction',
            index=models.Index(fields=['category', '-created_at'], name='accounts_us_categor_95a962_idx'),
        ),
        migrations.AddIndex(
            model_name='userinteraction',
            index=models.Index(fields=['interaction_type', '-created_at'], name='accounts_us_interac_aafe2e_idx'),
        ),
    ]
