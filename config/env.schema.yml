version: 1

targets:
  - name: backend_local
    type: dotenv
    path: .env
  - name: frontend_local
    type: dotenv
    path: frontend/.env.local
  - name: render_backend
    type: render_yaml
    path: render.yaml
    service: Bunoraa
  - name: render_frontend
    type: render_yaml
    path: render.yaml
    service: Bunoraa-Frontend
  - name: render_worker
    type: render_yaml
    path: render-worker.yaml
    service: Bunoraa-Celery-Worker
  - name: warmup_cron
    type: render_yaml
    path: render.yaml
    service: Bunoraa-Warmup
  - name: backend_prod_external
    type: dotenv
    path: ${BUNORAA_BACKEND_ENV_PATH}
    optional: true

vars:
  # Frontend (public)
  - key: NEXT_PUBLIC_API_BASE_URL
    scope: frontend
    values:
      development: /api/v1
      production: /api/v1
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_INTERNAL_API_BASE_URL
    scope: frontend
    values:
      development: http://localhost:8000/api/v1/
      production: https://api.bunoraa.com/api/v1/
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_PUBLIC_MEDIA_BASE_URL
    scope: frontend
    values:
      development: /media
      production: https://media.bunoraa.com
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_PUBLIC_SITE_URL
    scope: frontend
    values:
      development: http://localhost:3000
      production: https://bunoraa.com
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_PUBLIC_WS_BASE_URL
    scope: frontend
    values:
      development: ws://localhost:8000
      production: wss://api.bunoraa.com
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_PUBLIC_WS_ENABLED
    scope: frontend
    values:
      development: "false"
      production: "true"
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_DISABLE_PRERENDER
    scope: frontend
    values:
      development: "true"
      production: "true"
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_DISABLE_BUILD_PRERENDER
    scope: frontend
    values:
      development: "false"
      production: "true"
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_IMAGE_UNOPTIMIZED
    scope: frontend
    values:
      development: "true"
      production: "true"
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_API_PROXY_TARGET
    scope: frontend
    values:
      development: http://localhost:8000
      production: https://api.bunoraa.com
    targets: [backend_local, frontend_local, render_frontend]
  - key: NEXT_FRONTEND_ORIGIN
    scope: frontend
    values:
      development: http://localhost:3000
      production: https://bunoraa.com
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: NODE_OPTIONS
    scope: frontend
    values:
      production: "--max-old-space-size=256"
    targets: [render_frontend]
  - key: NODE_ENV
    scope: frontend
    values:
      production: production
    targets: [render_frontend]

  # Core / Django
  - key: ENVIRONMENT
    scope: backend
    required: true
    values:
      development: development
      production: production
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: DEBUG
    scope: backend
    values:
      development: "True"
      production: "False"
    targets: [backend_local, render_worker, backend_prod_external]
  - key: SECRET_KEY
    scope: backend
    required: true
    secret: true
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: DJANGO_SETTINGS_MODULE
    scope: backend
    values:
      development: core.settings.s3
      production: core.settings.production
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: ALLOWED_HOSTS
    scope: backend
    values:
      development: localhost,127.0.0.1,www.bunoraa.com,bunoraa.com,bunoraa.onrender.com
      production: bunoraa.com,www.bunoraa.com,api.bunoraa.com,bunoraa.onrender.com
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: SITE_URL
    scope: backend
    values:
      development: https://bunoraa.com
      production: https://bunoraa.com
    targets: [backend_local, backend_prod_external]
  - key: CORS_ALLOWED_ORIGINS
    scope: security
    values:
      development: http://localhost:3000,http://localhost:8000,https://bunoraa.com,https://www.bunoraa.com,https://api.bunoraa.com,https://media.bunoraa.com,https://bunoraa-pl26.onrender.com,https://bunoraa-django.onrender.com
      production: https://bunoraa.com,https://www.bunoraa.com,https://api.bunoraa.com,https://media.bunoraa.com
    targets: [backend_local, backend_prod_external]
  - key: CSRF_TRUSTED_ORIGINS
    scope: security
    values:
      development: http://localhost:8000,http://127.0.0.1:8000,https://bunoraa.com,https://www.bunoraa.com,https://bunoraa.onrender.com
      production: https://bunoraa.com,https://www.bunoraa.com
    targets: [backend_local, backend_prod_external]
  - key: SESSION_COOKIE_SECURE
    scope: security
    values:
      development: "False"
      production: "True"
    targets: [backend_local, backend_prod_external]
  - key: CSRF_COOKIE_SECURE
    scope: security
    values:
      development: "False"
      production: "True"
    targets: [backend_local, backend_prod_external]
  - key: SECURE_SSL_REDIRECT
    scope: security
    values:
      development: "False"
      production: "True"
    targets: [backend_local, backend_prod_external]
  - key: PRERENDER_ENABLED
    scope: backend
    values:
      development: "False"
      production: "False"
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: ML_ENABLED
    scope: backend
    values:
      development: "False"
      production: "False"
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: ENV_REGISTRY_AUTOSEED
    scope: backend
    value_type: bool
    values:
      development: true
      production: true
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: ENV_REGISTRY_AUTOSYNC_RUNTIME
    scope: backend
    value_type: bool
    values:
      development: true
      production: true
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: ENV_REGISTRY_AUTOEXPORT
    scope: backend
    value_type: bool
    values:
      development: false
      production: false
    targets: [backend_local, render_backend, render_worker, backend_prod_external]

  # Database
  - key: DB_NAME
    scope: database
    targets: [backend_local]
  - key: DB_USER
    scope: database
    targets: [backend_local]
  - key: DB_PASSWORD
    scope: database
    secret: true
    targets: [backend_local]
  - key: DB_HOST
    scope: database
    targets: [backend_local]
  - key: DB_PORT
    scope: database
    targets: [backend_local]
  - key: DATABASE_URL
    scope: database
    required: true
    secret: true
    targets:
      backend_local: {}
      backend_prod_external: {}
      render_backend:
        fromDatabase:
          name: bunoraa_db
          property: connectionString
      render_worker:
        fromDatabase:
          name: bunoraa_db
          property: connectionString

  # Redis / Celery / Channels
  - key: REDIS_URL
    scope: redis
    secret: true
    targets:
      backend_local: {}
      backend_prod_external: {}
      render_backend:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
      render_worker:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
  - key: CHANNEL_LAYERS_REDIS_URL
    scope: redis
    secret: true
    targets:
      backend_local: {}
      backend_prod_external: {}
      render_backend:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
      render_worker:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
  - key: CELERY_BROKER_URL
    scope: redis
    secret: true
    targets:
      backend_local: {}
      backend_prod_external: {}
      render_backend:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
      render_worker:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
  - key: CELERY_RESULT_BACKEND
    scope: redis
    secret: true
    targets:
      backend_local: {}
      backend_prod_external: {}
      render_backend:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
      render_worker:
        fromService:
          type: redis
          name: bunoraa-redis
          property: connectionString
  - key: ML_REDIS_URL
    scope: redis
    secret: true
    targets: [backend_local, backend_prod_external]

  # Email
  - key: EMAIL_BACKEND
    scope: email
    targets: [backend_local, backend_prod_external]
  - key: EMAIL_HOST
    scope: email
    targets: [backend_local, render_backend, backend_prod_external]
  - key: EMAIL_PORT
    scope: email
    targets: [backend_local, render_backend, backend_prod_external]
  - key: EMAIL_USE_TLS
    scope: email
    targets: [backend_local, render_backend, backend_prod_external]
  - key: EMAIL_HOST_USER
    scope: email
    targets: [backend_local, render_backend, backend_prod_external]
  - key: EMAIL_HOST_PASSWORD
    scope: email
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: SENDGRID_API_KEY
    scope: email
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: DEFAULT_FROM_EMAIL
    scope: email
    targets: [backend_local, render_backend, backend_prod_external]

  # Storage (S3/R2)
  - key: USE_S3
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_ACCESS_KEY_ID
    scope: storage
    secret: true
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_SECRET_ACCESS_KEY
    scope: storage
    secret: true
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_STORAGE_BUCKET_NAME
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_S3_REGION_NAME
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_S3_ENDPOINT_URL
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_S3_CUSTOM_DOMAIN
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_DEFAULT_ACL
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: AWS_S3_CACHE_CONTROL
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: MEDIA_URL
    scope: storage
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: R2_ACCOUNT_ID
    scope: storage
    targets: [backend_local, backend_prod_external]
  - key: R2_BUCKET_NAME
    scope: storage
    targets: [backend_local, backend_prod_external]
  - key: R2_CUSTOM_DOMAIN
    scope: storage
    targets: [backend_local, backend_prod_external]
  - key: R2_BACKUP_BUCKET
    scope: storage
    targets: [backend_local, backend_prod_external]

  # OAuth / Social
  - key: GOOGLE_CLIENT_ID
    scope: auth
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GOOGLE_CLIENT_SECRET
    scope: auth
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GOOGLE_REDIRECT_URI
    scope: auth
    targets: [backend_local, render_backend, backend_prod_external]
  - key: SOCIAL_AUTH_LOGIN_REDIRECT_URL
    scope: auth
    values:
      development: /account/oauth/callback/
      production: /account/oauth/callback/
    targets: [backend_local, render_backend, render_worker, backend_prod_external]
  - key: SOCIAL_AUTH_REDIRECT_IS_HTTPS
    scope: auth
    values:
      development: "False"
      production: "True"
    targets: [backend_local, render_backend, render_worker, backend_prod_external]

  # Monitoring
  - key: SENTRY_DSN
    scope: monitoring
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]

  # Payments
  - key: STRIPE_PUBLIC_KEY
    scope: payments
    targets: [backend_local, backend_prod_external]
  - key: STRIPE_SECRET_KEY
    scope: payments
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: STRIPE_WEBHOOK_SECRET
    scope: payments
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: SSLCOMMERZ_STORE_ID
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: SSLCOMMERZ_STORE_PASSWORD
    scope: payments
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: SSLCOMMERZ_IS_SANDBOX
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: BKASH_APP_KEY
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: BKASH_APP_SECRET
    scope: payments
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: BKASH_USERNAME
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: BKASH_PASSWORD
    scope: payments
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: BKASH_IS_SANDBOX
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: NAGAD_MERCHANT_ID
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: NAGAD_PUBLIC_KEY
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]
  - key: NAGAD_PRIVATE_KEY
    scope: payments
    secret: true
    targets: [backend_local, render_backend, backend_prod_external]
  - key: NAGAD_IS_SANDBOX
    scope: payments
    targets: [backend_local, render_backend, backend_prod_external]

  # SMS / SEO / APIs
  - key: SMS_PROVIDER
    scope: sms
    targets: [backend_local, backend_prod_external]
  - key: SERPAPI_KEY
    scope: seo
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: GSC_SERVICE_ACCOUNT_FILE
    scope: seo
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: GOOGLE_APPLICATION_CREDENTIALS
    scope: seo
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: GSC_SITE_URL
    scope: seo
    targets: [backend_local, backend_prod_external]

  # Exchange rates / AI
  - key: EXCHANGERATE_API_KEY
    scope: integrations
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: EXCHANGERATESAPI_KEY
    scope: integrations
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: OPENEXCHANGE_RATES_API_KEY
    scope: integrations
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: FIXER_API_KEY
    scope: integrations
    secret: true
    targets: [backend_local, backend_prod_external]
  - key: OPENAI_API_KEY
    scope: integrations
    secret: true
    targets: [backend_local, backend_prod_external]

  # Gunicorn
  - key: GUNICORN_WORKERS
    scope: gunicorn
    values:
      development: "1"
      production: "1"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_THREADS
    scope: gunicorn
    values:
      development: "1"
      production: "1"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_WORKER_CLASS
    scope: gunicorn
    values:
      development: gthread
      production: gthread
    targets: [backend_local, backend_prod_external]
  - key: GUNICORN_TIMEOUT
    scope: gunicorn
    values:
      development: "45"
      production: "45"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_GRACEFUL_TIMEOUT
    scope: gunicorn
    values:
      development: "20"
      production: "20"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_KEEPALIVE
    scope: gunicorn
    values:
      development: "5"
      production: "5"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_MAX_REQUESTS
    scope: gunicorn
    values:
      development: "200"
      production: "200"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_MAX_REQUESTS_JITTER
    scope: gunicorn
    values:
      development: "50"
      production: "50"
    targets: [backend_local, render_backend, backend_prod_external]
  - key: GUNICORN_LOG_LEVEL
    scope: gunicorn
    values:
      production: warning
    targets: [render_backend]

  # Warmup cron
  - key: WARMUP_URLS
    scope: warmup
    values:
      production: https://api.bunoraa.com/healthz,https://bunoraa.com/file.svg
    targets: [warmup_cron]
  - key: WARMUP_TIMEOUT
    scope: warmup
    values:
      production: "10"
    targets: [warmup_cron]
