{
  "version": 3,
  "sources": ["components/utils.js", "components/BaseComponent.js", "components/Alert.js", "components/AlertDialog.js", "components/Avatar.js", "components/Badge.js", "components/Button.js", "components/ButtonGroup.js", "components/Breadcrumb.js", "components/Card.js", "components/Carousel.js", "components/Chart.js", "components/Checkbox.js", "components/Collapsible.js", "components/Command.js", "components/Combobox.js", "components/ContextMenu.js", "components/DatePicker.js", "components/Dialog.js", "components/DropdownMenu.js", "components/Drawer.js", "components/Empty.js", "components/Form.js", "components/HoverCard.js", "components/Input.js", "components/InputGroup.js", "components/InputOTP.js", "components/Item.js", "components/Label.js", "components/Kbd.js", "components/NativeSelect.js", "components/Tooltip.js", "components/Toggle.js", "components/ToggleGroup.js", "components/Toast.js", "utils/lazyHydrate.js", "pages/account.js", "pages/cart.js", "pages/category.js", "pages/checkout.js", "pages/contact.js", "pages/faq.js", "components/CategoryCard.js", "pages/home.js", "pages/orders.js", "pages/preorders.js", "pages/product.js", "pages/search.js", "pages/wishlist.js", "app.js"],
  "sourcesContent": ["/**\n * Utilities and helpers for UI components\n */\n\n// CSS utilities for Tailwind classes\nconst css = {\n  // Layout\n  flex: 'flex',\n  inlineFlex: 'inline-flex',\n  block: 'block',\n  inlineBlock: 'inline-block',\n  hidden: 'hidden',\n  grid: 'grid',\n  \n  // Positioning\n  absolute: 'absolute',\n  relative: 'relative',\n  fixed: 'fixed',\n  sticky: 'sticky',\n  \n  // Sizing\n  w: (val) => `w-${val}`,\n  h: (val) => `h-${val}`,\n  wFull: 'w-full',\n  hFull: 'h-full',\n  \n  // Spacing\n  p: (val) => `p-${val}`,\n  m: (val) => `m-${val}`,\n  gap: (val) => `gap-${val}`,\n  \n  // Colors\n  textBlack: 'text-black',\n  textWhite: 'text-white',\n  textGray: (shade = '600') => `text-gray-${shade}`,\n  bgWhite: 'bg-white',\n  bgGray: (shade = '100') => `bg-gray-${shade}`,\n  bgPrimary: 'bg-blue-600',\n  \n  // Borders\n  border: 'border',\n  borderGray: 'border-gray-200',\n  rounded: 'rounded',\n  roundedLg: 'rounded-lg',\n  \n  // Shadows and effects\n  shadow: 'shadow',\n  shadowLg: 'shadow-lg',\n  \n  // Opacity\n  opacity50: 'opacity-50',\n  \n  // Transform\n  scale: (val) => `scale-${val}`,\n  \n  // Transitions\n  transition: 'transition',\n  duration200: 'duration-200',\n  easeOut: 'ease-out',\n};\n\n/**\n * Merge class names intelligently\n */\nfunction clsx(...classes) {\n  return classes\n    .flat()\n    .filter(c => c && typeof c === 'string')\n    .join(' ');\n}\n\n/**\n * Create element with classes\n */\nfunction createElement(tag = 'div', { id = '', className = '', attrs = {}, html = '', text = '' } = {}) {\n  const el = document.createElement(tag);\n  \n  if (id) el.id = id;\n  if (className) el.className = className;\n  if (text) el.textContent = text;\n  if (html) el.innerHTML = html;\n  \n  Object.entries(attrs).forEach(([key, value]) => {\n    if (value === true) {\n      el.setAttribute(key, '');\n    } else if (value !== false && value !== null) {\n      el.setAttribute(key, value);\n    }\n  });\n  \n  return el;\n}\n\n/**\n * Add event listeners with automatic cleanup\n */\nfunction addListener(el, event, handler, options = {}) {\n  if (!el) return;\n  el.addEventListener(event, handler, options);\n  \n  return () => el.removeEventListener(event, handler, options);\n}\n\n/**\n * Debounce function\n */\nfunction debounce(func, wait = 300) {\n  let timeout;\n  return function(...args) {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func.apply(this, args), wait);\n  };\n}\n\n/**\n * Throttle function\n */\nfunction throttle(func, limit = 300) {\n  let inThrottle;\n  return function(...args) {\n    if (!inThrottle) {\n      func.apply(this, args);\n      inThrottle = true;\n      setTimeout(() => inThrottle = false, limit);\n    }\n  };\n}\n\n/**\n * Get computed style value\n */\nfunction getComputedValue(el, property) {\n  return window.getComputedStyle(el).getPropertyValue(property);\n}\n\n/**\n * Toggle attribute on element\n */\nfunction toggleAttr(el, attr, value = '') {\n  if (el.hasAttribute(attr)) {\n    el.removeAttribute(attr);\n  } else {\n    el.setAttribute(attr, value);\n  }\n}\n\n/**\n * Focus trap utility\n */\nfunction createFocusTrap(container) {\n  const focusableElements = container.querySelectorAll(\n    'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n  );\n  \n  const firstElement = focusableElements[0];\n  const lastElement = focusableElements[focusableElements.length - 1];\n  \n  return {\n    init() {\n      container.addEventListener('keydown', (e) => {\n        if (e.key !== 'Tab') return;\n        \n        if (e.shiftKey) {\n          if (document.activeElement === firstElement) {\n            e.preventDefault();\n            lastElement.focus();\n          }\n        } else {\n          if (document.activeElement === lastElement) {\n            e.preventDefault();\n            firstElement.focus();\n          }\n        }\n      });\n    },\n    destroy() {\n      // Cleanup if needed\n    }\n  };\n}\n\n/**\n * Keyboard event utilities\n */\nconst keyboard = {\n  isEnter: (e) => e.key === 'Enter',\n  isEscape: (e) => e.key === 'Escape',\n  isArrowUp: (e) => e.key === 'ArrowUp',\n  isArrowDown: (e) => e.key === 'ArrowDown',\n  isArrowLeft: (e) => e.key === 'ArrowLeft',\n  isArrowRight: (e) => e.key === 'ArrowRight',\n  isSpace: (e) => e.key === ' ',\n  isTab: (e) => e.key === 'Tab',\n};\n\n/**\n * Animation utilities\n */\nfunction animate(el, keyframes, options = {}) {\n  return el.animate(keyframes, {\n    duration: 300,\n    easing: 'ease-out',\n    fill: 'forwards',\n    ...options\n  });\n}\n\n/**\n * Storage utilities\n */\nconst storage = {\n  set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),\n  get: (key) => {\n    try {\n      return JSON.parse(localStorage.getItem(key));\n    } catch {\n      return null;\n    }\n  },\n  remove: (key) => localStorage.removeItem(key),\n  clear: () => localStorage.clear(),\n};\n\n/**\n * UUID generator\n */\nfunction generateId() {\n  return 'id-' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);\n}\n\n/**\n * Check if element is in viewport\n */\nfunction isInViewport(el) {\n  const rect = el.getBoundingClientRect();\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  );\n}\n\n/**\n * Create modal backdrop\n */\nfunction createBackdrop(className = '') {\n  const backdrop = createElement('div', {\n    className: clsx(\n      'fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-200',\n      className\n    ),\n    attrs: { 'data-backdrop': 'true' }\n  });\n  return backdrop;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text) {\n  const map = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n/**\n * Format currency\n */\nfunction formatCurrency(amount, currency = null, locale = navigator.language) {\n  // If currency string code provided, use Intl\n  if (typeof currency === 'string' && currency.length === 3) {\n    try {\n      return new Intl.NumberFormat(locale, { style: 'currency', currency }).format(Number(amount));\n    } catch (e) {\n      return Number(amount).toFixed(2);\n    }\n  }\n\n  // If no currency provided, use global window configuration\n  if (!currency && typeof window !== 'undefined' && window.BUNORAA_CURRENCY) {\n    currency = window.BUNORAA_CURRENCY;\n  }\n\n  if (!currency) return String(amount);\n\n  const symbol = currency.symbol || '';\n  const decimals = typeof currency.decimal_places === 'number' ? currency.decimal_places : 2;\n  const thousand = currency.thousand_separator || ',';\n  const dec_sep = currency.decimal_separator || '.';\n  const symbol_pos = currency.symbol_position || 'before';\n\n  const num = Number(amount);\n  if (Number.isNaN(num)) return String(amount);\n\n  const fixed = num.toFixed(decimals);\n  const parts = fixed.split('.');\n  let intPart = parts[0];\n  const decPart = parts[1] || '';\n\n  intPart = intPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, thousand);\n  const formattedNumber = decimals > 0 ? intPart + dec_sep + decPart : intPart;\n\n  return symbol_pos === 'before' ? (symbol + formattedNumber) : (formattedNumber + ' ' + symbol);\n}\n\n/**\n * Format date\n */\nfunction formatDate(date, format = 'short') {\n  const options = {\n    short: { year: 'numeric', month: 'short', day: 'numeric' },\n    long: { year: 'numeric', month: 'long', day: 'numeric' },\n    time: { hour: '2-digit', minute: '2-digit' }\n  };\n  return new Date(date).toLocaleDateString('en-US', options[format] || options.short);\n}\n\nexport {\n  css,\n  clsx,\n  createElement,\n  addListener,\n  debounce,\n  throttle,\n  getComputedValue,\n  toggleAttr,\n  createFocusTrap,\n  keyboard,\n  animate,\n  storage,\n  generateId,\n  isInViewport,\n  createBackdrop,\n  escapeHtml,\n  formatCurrency,\n  formatDate\n};\n", "/**\n * Base Component Class\n * Provides common functionality for all UI components\n */\n\nimport { clsx, createElement, addListener, generateId } from './utils.js';\n\nexport class BaseComponent {\n  constructor(options = {}) {\n    this.id = options.id || generateId();\n    this.element = null;\n    this.listeners = [];\n    this.isInitialized = false;\n    this.config = options;\n  }\n\n  /**\n   * Create the component element\n   */\n  create(tag = 'div', { className = '', attrs = {}, html = '' } = {}) {\n    this.element = createElement(tag, {\n      id: this.id,\n      className,\n      attrs,\n      html\n    });\n    return this.element;\n  }\n\n  /**\n   * Mount component to DOM\n   */\n  mount(selector) {\n    if (!this.element) {\n      return false;\n    }\n\n    const target = typeof selector === 'string' \n      ? document.querySelector(selector) \n      : selector;\n\n    if (!target) {\n      return false;\n    }\n\n    target.appendChild(this.element);\n    this.isInitialized = true;\n    return true;\n  }\n\n  /**\n   * Add event listener with cleanup\n   */\n  on(event, handler, options = {}) {\n    if (!this.element) return;\n    \n    const cleanup = addListener(this.element, event, handler, options);\n    this.listeners.push(cleanup);\n    return cleanup;\n  }\n\n  /**\n   * Add delegated event listener\n   */\n  delegate(selector, event, handler) {\n    if (!this.element) return;\n\n    const listener = (e) => {\n      const target = e.target.closest(selector);\n      if (target) handler.call(target, e);\n    };\n\n    this.element.addEventListener(event, listener);\n    this.listeners.push(() => this.element.removeEventListener(event, listener));\n  }\n\n  /**\n   * Add class to element\n   */\n  addClass(...classes) {\n    if (this.element) {\n      this.element.classList.add(...classes);\n    }\n  }\n\n  /**\n   * Remove class from element\n   */\n  removeClass(...classes) {\n    if (this.element) {\n      this.element.classList.remove(...classes);\n    }\n  }\n\n  /**\n   * Toggle class on element\n   */\n  toggleClass(className, force) {\n    if (this.element) {\n      this.element.classList.toggle(className, force);\n    }\n  }\n\n  /**\n   * Check if element has class\n   */\n  hasClass(className) {\n    return this.element?.classList.contains(className) ?? false;\n  }\n\n  /**\n   * Set attribute\n   */\n  attr(name, value) {\n    if (!this.element) return;\n    \n    if (value === undefined) {\n      return this.element.getAttribute(name);\n    }\n    \n    if (value === null || value === false) {\n      this.element.removeAttribute(name);\n    } else if (value === true) {\n      this.element.setAttribute(name, '');\n    } else {\n      this.element.setAttribute(name, value);\n    }\n  }\n\n  /**\n   * Set multiple attributes\n   */\n  attrs(attributes) {\n    Object.entries(attributes).forEach(([key, value]) => {\n      this.attr(key, value);\n    });\n  }\n\n  /**\n   * Set text content\n   */\n  text(content) {\n    if (this.element) {\n      this.element.textContent = content;\n    }\n  }\n\n  /**\n   * Set HTML content\n   */\n  html(content) {\n    if (this.element) {\n      this.element.innerHTML = content;\n    }\n  }\n\n  /**\n   * Append child element\n   */\n  append(element) {\n    if (this.element && element) {\n      this.element.appendChild(element instanceof BaseComponent ? element.element : element);\n    }\n  }\n\n  /**\n   * Prepend child element\n   */\n  prepend(element) {\n    if (this.element && element) {\n      this.element.prepend(element instanceof BaseComponent ? element.element : element);\n    }\n  }\n\n  /**\n   * Show element\n   */\n  show() {\n    if (this.element) {\n      this.element.style.display = '';\n      this.element.removeAttribute('hidden');\n    }\n  }\n\n  /**\n   * Hide element\n   */\n  hide() {\n    if (this.element) {\n      this.element.style.display = 'none';\n    }\n  }\n\n  /**\n   * Toggle visibility\n   */\n  toggle(force) {\n    if (this.element) {\n      if (force === undefined) {\n        force = this.element.style.display === 'none';\n      }\n      force ? this.show() : this.hide();\n    }\n  }\n\n  /**\n   * Get computed style\n   */\n  getStyle(property) {\n    if (!this.element) return null;\n    return window.getComputedStyle(this.element).getPropertyValue(property);\n  }\n\n  /**\n   * Set style\n   */\n  setStyle(property, value) {\n    if (this.element) {\n      this.element.style[property] = value;\n    }\n  }\n\n  /**\n   * Set multiple styles\n   */\n  setStyles(styles) {\n    Object.entries(styles).forEach(([key, value]) => {\n      this.setStyle(key, value);\n    });\n  }\n\n  /**\n   * Focus element\n   * By default prevents scrolling the page when focusing (avoid jumping to focused element on load).\n   * Pass an options object to control behavior (e.g., { preventScroll: false }).\n   */\n  focus(options) {\n    if (!this.element) return;\n\n    try {\n      if (typeof options === 'undefined') {\n        // default: avoid changing scroll position when focusing\n        this.element.focus({ preventScroll: true });\n      } else {\n        this.element.focus(options);\n      }\n    } catch (err) {\n      // Fallback for older browsers that don't support focus options\n      try { this.element.focus(); } catch (e) { /* ignore */ }\n    }\n  }\n\n  /**\n   * Blur element\n   */\n  blur() {\n    if (this.element) {\n      this.element.blur();\n    }\n  }\n\n  /**\n   * Get position relative to viewport\n   */\n  getPosition() {\n    if (!this.element) return null;\n    return this.element.getBoundingClientRect();\n  }\n\n  /**\n   * Destroy component and cleanup\n   */\n  destroy() {\n    // Remove all event listeners\n    this.listeners.forEach(cleanup => cleanup?.());\n    this.listeners = [];\n\n    // Remove element from DOM\n    if (this.element?.parentNode) {\n      this.element.parentNode.removeChild(this.element);\n    }\n\n    this.element = null;\n    this.isInitialized = false;\n  }\n\n  /**\n   * Initialize component (override in subclasses)\n   */\n  init() {\n    if (this.element && !this.isInitialized) {\n      this.isInitialized = true;\n    }\n  }\n\n  /**\n   * Render component (override in subclasses)\n   */\n  render() {\n    return this.element;\n  }\n}\n", "/**\n * Alert Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Alert extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.title = options.title || '';\n    this.message = options.message || '';\n    this.type = options.type || 'default'; // default, success, warning, error, info\n    this.icon = options.icon || null;\n    this.closeable = options.closeable || false;\n    this.className = options.className || '';\n  }\n\n  create() {\n    const typeConfig = {\n      default: {\n        bg: 'bg-blue-50',\n        border: 'border-blue-200',\n        title: 'text-blue-900',\n        message: 'text-blue-800',\n        icon: '\u24D8'\n      },\n      success: {\n        bg: 'bg-green-50',\n        border: 'border-green-200',\n        title: 'text-green-900',\n        message: 'text-green-800',\n        icon: '\u2713'\n      },\n      warning: {\n        bg: 'bg-yellow-50',\n        border: 'border-yellow-200',\n        title: 'text-yellow-900',\n        message: 'text-yellow-800',\n        icon: '\u26A0'\n      },\n      error: {\n        bg: 'bg-red-50',\n        border: 'border-red-200',\n        title: 'text-red-900',\n        message: 'text-red-800',\n        icon: '\u2715'\n      },\n      info: {\n        bg: 'bg-cyan-50',\n        border: 'border-cyan-200',\n        title: 'text-cyan-900',\n        message: 'text-cyan-800',\n        icon: '\u2139'\n      }\n    };\n\n    const config = typeConfig[this.type] || typeConfig.default;\n    const baseClasses = 'p-4 rounded-lg border-2';\n\n    const alertElement = super.create('div', {\n      className: clsx(baseClasses, config.bg, config.border, this.className),\n      attrs: { role: 'alert' }\n    });\n\n    let html = '';\n    \n    // Icon and title\n    if (this.title || this.icon) {\n      html += `<div class=\"flex items-center gap-3 mb-2\">`;\n      if (this.icon || true) {\n        html += `<span class=\"text-xl font-bold ${config.title}\">${this.icon || config.icon}</span>`;\n      }\n      if (this.title) {\n        html += `<h4 class=\"font-semibold ${config.title}\">${this.title}</h4>`;\n      }\n      html += `</div>`;\n    }\n\n    // Message\n    if (this.message) {\n      html += `<p class=\"${config.message}\">${this.message}</p>`;\n    }\n\n    // Close button\n    if (this.closeable) {\n      html += `<button class=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600\" aria-label=\"Close alert\">\u00D7</button>`;\n    }\n\n    alertElement.innerHTML = html;\n\n    if (this.closeable) {\n      const closeBtn = alertElement.querySelector('button');\n      closeBtn?.addEventListener('click', () => {\n        this.destroy();\n      });\n    }\n\n    return alertElement;\n  }\n\n  setMessage(message) {\n    this.message = message;\n    if (this.element) {\n      const msgEl = this.element.querySelector('p');\n      if (msgEl) {\n        msgEl.textContent = message;\n      }\n    }\n  }\n}\n", "/**\r\n * Alert Dialog Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createBackdrop, createFocusTrap } from './utils.js';\r\n\r\nexport class AlertDialog extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.title = options.title || '';\r\n    this.message = options.message || '';\r\n    this.confirmText = options.confirmText || 'Confirm';\r\n    this.cancelText = options.cancelText || 'Cancel';\r\n    this.type = options.type || 'warning'; // warning, danger, info\r\n    this.onConfirm = options.onConfirm || null;\r\n    this.onCancel = options.onCancel || null;\r\n    this.open = options.open || false;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: clsx(\r\n        'fixed inset-0 z-50 flex items-center justify-center',\r\n        this.open ? '' : 'hidden'\r\n      ),\r\n      attrs: {\r\n        role: 'alertdialog',\r\n        'aria-modal': 'true',\r\n        'aria-labelledby': `${this.id}-title`,\r\n        'aria-describedby': `${this.id}-message`\r\n      }\r\n    });\r\n\r\n    // Backdrop\r\n    const backdrop = createBackdrop();\r\n    containerElement.appendChild(backdrop);\r\n\r\n    // Dialog content\r\n    const dialogElement = document.createElement('div');\r\n    dialogElement.className = 'bg-white rounded-lg shadow-lg relative z-50 w-full max-w-md mx-4';\r\n\r\n    // Header\r\n    const header = document.createElement('div');\r\n    header.className = 'px-6 py-4 border-b border-gray-200';\r\n\r\n    const title = document.createElement('h2');\r\n    title.id = `${this.id}-title`;\r\n    title.className = 'text-lg font-semibold text-gray-900';\r\n    title.textContent = this.title;\r\n    header.appendChild(title);\r\n\r\n    dialogElement.appendChild(header);\r\n\r\n    // Message\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.id = `${this.id}-message`;\r\n    messageDiv.className = 'px-6 py-4 text-gray-700';\r\n    messageDiv.textContent = this.message;\r\n    dialogElement.appendChild(messageDiv);\r\n\r\n    // Footer with buttons\r\n    const footer = document.createElement('div');\r\n    footer.className = 'px-6 py-4 bg-gray-50 border-t border-gray-200 flex gap-3 justify-end rounded-b-lg';\r\n\r\n    const cancelBtn = document.createElement('button');\r\n    cancelBtn.className = 'px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition-colors duration-200';\r\n    cancelBtn.textContent = this.cancelText;\r\n    cancelBtn.addEventListener('click', () => this.handleCancel());\r\n    footer.appendChild(cancelBtn);\r\n\r\n    const confirmBtn = document.createElement('button');\r\n    const confirmBtnClasses = this.type === 'danger'\r\n      ? 'bg-red-600 text-white hover:bg-red-700'\r\n      : 'bg-blue-600 text-white hover:bg-blue-700';\r\n    confirmBtn.className = clsx('px-4 py-2 rounded-md transition-colors duration-200', confirmBtnClasses);\r\n    confirmBtn.textContent = this.confirmText;\r\n    confirmBtn.addEventListener('click', () => this.handleConfirm());\r\n    footer.appendChild(confirmBtn);\r\n\r\n    dialogElement.appendChild(footer);\r\n    containerElement.appendChild(dialogElement);\r\n\r\n    this.focusTrap = createFocusTrap(dialogElement);\r\n    return containerElement;\r\n  }\r\n\r\n  open() {\r\n    if (!this.element) this.create();\r\n    \r\n    this.open = true;\r\n    this.element.classList.remove('hidden');\r\n    this.focusTrap.init();\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  close() {\r\n    this.open = false;\r\n    this.element?.classList.add('hidden');\r\n    document.body.style.overflow = '';\r\n  }\r\n\r\n  handleConfirm() {\r\n    if (this.onConfirm) {\r\n      this.onConfirm();\r\n    }\r\n    this.close();\r\n  }\r\n\r\n  handleCancel() {\r\n    if (this.onCancel) {\r\n      this.onCancel();\r\n    }\r\n    this.close();\r\n  }\r\n}\r\n", "/**\n * Avatar Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Avatar extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.src = options.src || '';\n    this.alt = options.alt || '';\n    this.initials = options.initials || '';\n    this.size = options.size || 'md'; // xs, sm, md, lg, xl\n    this.className = options.className || '';\n    this.fallbackBg = options.fallbackBg || 'bg-blue-600';\n  }\n\n  create() {\n    const sizeClasses = {\n      xs: 'w-6 h-6 text-xs',\n      sm: 'w-8 h-8 text-sm',\n      md: 'w-10 h-10 text-base',\n      lg: 'w-12 h-12 text-lg',\n      xl: 'w-16 h-16 text-xl'\n    };\n\n    const baseClasses = 'rounded-full overflow-hidden flex items-center justify-center flex-shrink-0 font-semibold';\n\n    if (this.src) {\n      const avatarElement = super.create('img', {\n        className: clsx(baseClasses, sizeClasses[this.size], this.className),\n        attrs: {\n          src: this.src,\n          alt: this.alt,\n          role: 'img'\n        }\n      });\n      return avatarElement;\n    } else if (this.initials) {\n      const avatarElement = super.create('div', {\n        className: clsx(\n          baseClasses,\n          sizeClasses[this.size],\n          'text-white',\n          this.fallbackBg,\n          this.className\n        ),\n        text: this.initials.toUpperCase()\n      });\n      return avatarElement;\n    } else {\n      const avatarElement = super.create('div', {\n        className: clsx(baseClasses, sizeClasses[this.size], 'bg-gray-300', this.className),\n        html: '<svg class=\"w-full h-full text-gray-500\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z\"/></svg>'\n      });\n      return avatarElement;\n    }\n  }\n\n  setSrc(src, alt = '') {\n    this.src = src;\n    this.alt = alt;\n    if (this.element && this.element.tagName === 'IMG') {\n      this.element.src = src;\n      this.element.alt = alt;\n    }\n  }\n\n  setInitials(initials, bgColor = '') {\n    this.initials = initials;\n    if (bgColor) this.fallbackBg = bgColor;\n    if (this.element) {\n      this.element.textContent = initials.toUpperCase();\n      if (bgColor && this.element.className.includes('bg-')) {\n        const bgClass = this.element.className.match(/bg-\\S+/)[0];\n        this.element.classList.remove(bgClass);\n        this.element.classList.add(bgColor);\n      }\n    }\n  }\n}\n", "/**\n * Badge Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Badge extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || 'Badge';\n    this.variant = options.variant || 'default'; // default, primary, success, warning, destructive, outline\n    this.size = options.size || 'md'; // sm, md, lg\n    this.className = options.className || '';\n  }\n\n  create() {\n    const baseClasses = 'inline-flex items-center rounded font-semibold whitespace-nowrap';\n    \n    const variantClasses = {\n      default: 'bg-gray-100 text-gray-800',\n      primary: 'bg-blue-100 text-blue-800',\n      success: 'bg-green-100 text-green-800',\n      warning: 'bg-yellow-100 text-yellow-800',\n      destructive: 'bg-red-100 text-red-800',\n      outline: 'border border-gray-300 text-gray-700'\n    };\n\n    const sizeClasses = {\n      sm: 'px-2 py-1 text-xs',\n      md: 'px-3 py-1 text-sm',\n      lg: 'px-4 py-2 text-base'\n    };\n\n    const badgeElement = super.create('span', {\n      className: clsx(\n        baseClasses,\n        variantClasses[this.variant],\n        sizeClasses[this.size],\n        this.className\n      )\n    });\n\n    badgeElement.textContent = this.label;\n    return badgeElement;\n  }\n\n  setLabel(label) {\n    this.label = label;\n    if (this.element) {\n      this.element.textContent = label;\n    }\n  }\n}\n", "/**\n * Button Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Button extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || 'Button';\n    this.variant = options.variant || 'default'; // default, primary, secondary, destructive, outline, ghost\n    this.size = options.size || 'md'; // sm, md, lg\n    this.disabled = options.disabled || false;\n    this.onClick = options.onClick || null;\n    this.className = options.className || '';\n  }\n\n  create() {\n    const baseClasses = 'px-4 py-2 font-medium rounded transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2';\n    \n    const variantClasses = {\n      default: 'bg-gray-200 text-gray-900 hover:bg-gray-300',\n      primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',\n      secondary: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500',\n      destructive: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',\n      outline: 'border-2 border-gray-300 text-gray-900 hover:bg-gray-50',\n      ghost: 'text-gray-900 hover:bg-gray-100'\n    };\n\n    const sizeClasses = {\n      sm: 'px-2 py-1 text-sm',\n      md: 'px-4 py-2 text-base',\n      lg: 'px-6 py-3 text-lg'\n    };\n\n    const buttonElement = super.create('button', {\n      className: clsx(\n        baseClasses,\n        variantClasses[this.variant],\n        sizeClasses[this.size],\n        this.className\n      ),\n      attrs: { disabled: this.disabled }\n    });\n\n    buttonElement.textContent = this.label;\n\n    if (this.onClick) {\n      this.on('click', this.onClick);\n    }\n\n    return buttonElement;\n  }\n\n  setLabel(label) {\n    this.label = label;\n    if (this.element) {\n      this.element.textContent = label;\n    }\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.attr('disabled', disabled ? '' : null);\n  }\n\n  setLoading(loading) {\n    this.setDisabled(loading);\n    if (loading) {\n      this.html('<span class=\"flex items-center gap-2\"><span class=\"inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin\"></span>Loading...</span>');\n    } else {\n      this.text(this.label);\n    }\n  }\n}\n", "/**\n * Button Group Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class ButtonGroup extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.buttons = options.buttons || []; // Array of button objects\n    this.orientation = options.orientation || 'horizontal'; // horizontal, vertical\n    this.size = options.size || 'md';\n    this.className = options.className || '';\n  }\n\n  create() {\n    const orientationClass = this.orientation === 'vertical' ? 'flex-col' : 'flex-row';\n    const baseClasses = 'inline-flex border border-gray-300 rounded-md overflow-hidden';\n\n    const groupElement = super.create('div', {\n      className: clsx('flex', orientationClass, baseClasses, this.className),\n      attrs: { role: 'group' }\n    });\n\n    this.buttons.forEach((btnConfig, index) => {\n      const btn = document.createElement('button');\n      btn.textContent = btnConfig.label || 'Button';\n      btn.className = clsx(\n        'px-4 py-2 font-medium text-gray-700 hover:bg-gray-50 transition-colors duration-200',\n        index > 0 ? (this.orientation === 'vertical' ? 'border-t border-gray-300' : 'border-l border-gray-300') : '',\n        btnConfig.disabled ? 'opacity-50 cursor-not-allowed' : ''\n      );\n      btn.disabled = btnConfig.disabled || false;\n\n      if (btnConfig.onClick) {\n        btn.addEventListener('click', btnConfig.onClick);\n      }\n\n      groupElement.appendChild(btn);\n    });\n\n    return groupElement;\n  }\n\n  addButton(label, onClick) {\n    if (this.element) {\n      const btn = document.createElement('button');\n      btn.textContent = label;\n      btn.className = clsx(\n        'px-4 py-2 font-medium text-gray-700 hover:bg-gray-50 transition-colors duration-200 border-l border-gray-300'\n      );\n      if (onClick) {\n        btn.addEventListener('click', onClick);\n      }\n      this.element.appendChild(btn);\n    }\n  }\n}\n", "/**\r\n * Breadcrumb Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createElement } from './utils.js';\r\n\r\nexport class Breadcrumb extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.items = options.items || []; // Array of {label, href}\r\n    this.className = options.className || '';\r\n  }\r\n\r\n  create() {\r\n    const baseClasses = 'flex items-center gap-2';\r\n\r\n    const breadcrumbElement = super.create('nav', {\r\n      className: clsx(baseClasses, this.className),\r\n      attrs: { 'aria-label': 'Breadcrumb' }\r\n    });\r\n\r\n    this.items.forEach((item, index) => {\r\n      if (index > 0) {\r\n        const separator = createElement('span', {\r\n          className: 'text-gray-400 mx-1',\r\n          text: '/'\r\n        });\r\n        breadcrumbElement.appendChild(separator);\r\n      }\r\n\r\n      if (index === this.items.length - 1) {\r\n        const span = createElement('span', {\r\n          className: 'text-gray-700 font-medium',\r\n          text: item.label,\r\n          attrs: { 'aria-current': 'page' }\r\n        });\r\n        breadcrumbElement.appendChild(span);\r\n      } else {\r\n        const link = createElement('a', {\r\n          className: 'text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200',\r\n          text: item.label,\r\n          attrs: { href: item.href || '#' }\r\n        });\r\n        breadcrumbElement.appendChild(link);\r\n      }\r\n    });\r\n\r\n    return breadcrumbElement;\r\n  }\r\n\r\n  addItem(label, href = '#') {\r\n    if (this.element) {\r\n      if (this.element.children.length > 0) {\r\n        const separator = createElement('span', {\r\n          className: 'text-gray-400 mx-1',\r\n          text: '/'\r\n        });\r\n        this.element.appendChild(separator);\r\n      }\r\n\r\n      const link = createElement('a', {\r\n        className: 'text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200',\r\n        text: label,\r\n        attrs: { href }\r\n      });\r\n      this.element.appendChild(link);\r\n      this.items.push({ label, href });\r\n    }\r\n  }\r\n}\r\n", "/**\n * Card Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Card extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.title = options.title || '';\n    this.subtitle = options.subtitle || '';\n    this.content = options.content || '';\n    this.footer = options.footer || '';\n    this.className = options.className || '';\n    this.hoverable = options.hoverable !== false;\n  }\n\n  create() {\n    const baseClasses = 'bg-white rounded-lg border border-gray-200 overflow-hidden';\n    const hoverClass = this.hoverable ? 'hover:shadow-lg transition-shadow duration-300' : '';\n\n    const cardElement = super.create('div', {\n      className: clsx(baseClasses, hoverClass, this.className)\n    });\n\n    // Header\n    if (this.title) {\n      const headerElement = createElement('div', {\n        className: 'px-6 py-4 border-b border-gray-200 bg-gray-50'\n      });\n\n      let html = `<h3 class=\"text-lg font-semibold text-gray-900\">${this.title}</h3>`;\n      if (this.subtitle) {\n        html += `<p class=\"text-sm text-gray-600 mt-1\">${this.subtitle}</p>`;\n      }\n\n      headerElement.innerHTML = html;\n      cardElement.appendChild(headerElement);\n    }\n\n    // Content\n    if (this.content) {\n      const contentElement = createElement('div', {\n        className: 'px-6 py-4',\n        html: this.content\n      });\n      cardElement.appendChild(contentElement);\n    }\n\n    // Footer\n    if (this.footer) {\n      const footerElement = createElement('div', {\n        className: 'px-6 py-4 border-t border-gray-200 bg-gray-50',\n        html: this.footer\n      });\n      cardElement.appendChild(footerElement);\n    }\n\n    return cardElement;\n  }\n\n  setContent(content) {\n    this.content = content;\n    if (this.element) {\n      const contentDiv = this.element.querySelector('.px-6.py-4:not(.border-b):not(.border-t)');\n      if (contentDiv) {\n        contentDiv.innerHTML = content;\n      }\n    }\n  }\n\n  addContent(element) {\n    if (this.element) {\n      const contentDiv = this.element.querySelector('.px-6.py-4:not(.border-b):not(.border-t)');\n      if (contentDiv) {\n        contentDiv.appendChild(element instanceof BaseComponent ? element.element : element);\n      }\n    }\n  }\n}\n", "/**\n * Carousel Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Carousel extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.items = options.items || []; // Array of {src, alt, title}\n    this.autoplay = options.autoplay || true;\n    this.interval = options.interval || 5000;\n    this.className = options.className || '';\n    this.currentIndex = 0;\n    this.autoplayTimer = null;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: clsx('relative w-full bg-black rounded-lg overflow-hidden', this.className)\n    });\n\n    // Slides\n    const slidesElement = createElement('div', {\n      className: 'relative w-full h-96 overflow-hidden'\n    });\n\n    this.items.forEach((item, index) => {\n      const slide = createElement('div', {\n        className: clsx(\n          'absolute inset-0 transition-opacity duration-500',\n          index === this.currentIndex ? 'opacity-100' : 'opacity-0'\n        )\n      });\n\n      const img = document.createElement('img');\n      img.src = item.src;\n      img.alt = item.alt || '';\n      img.className = 'w-full h-full object-cover';\n\n      slide.appendChild(img);\n\n      if (item.title) {\n        const titleElement = createElement('div', {\n          className: 'absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4',\n          html: `<p class=\"text-white font-semibold\">${item.title}</p>`\n        });\n        slide.appendChild(titleElement);\n      }\n\n      slidesElement.appendChild(slide);\n    });\n\n    containerElement.appendChild(slidesElement);\n\n    // Navigation buttons\n    const prevBtn = createElement('button', {\n      className: 'absolute left-4 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all',\n      html: '\u276E'\n    });\n\n    prevBtn.addEventListener('click', () => {\n      this.previous();\n    });\n\n    const nextBtn = createElement('button', {\n      className: 'absolute right-4 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition-all',\n      html: '\u276F'\n    });\n\n    nextBtn.addEventListener('click', () => {\n      this.next();\n    });\n\n    containerElement.appendChild(prevBtn);\n    containerElement.appendChild(nextBtn);\n\n    // Dots\n    const dotsElement = createElement('div', {\n      className: 'absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-10'\n    });\n\n    this.items.forEach((_, index) => {\n      const dot = createElement('button', {\n        className: clsx(\n          'w-2 h-2 rounded-full transition-all',\n          index === this.currentIndex ? 'bg-white w-8' : 'bg-gray-500'\n        ),\n        attrs: { 'data-index': index }\n      });\n\n      dot.addEventListener('click', () => {\n        this.goTo(index);\n      });\n\n      dotsElement.appendChild(dot);\n    });\n\n    containerElement.appendChild(dotsElement);\n\n    this.slidesElement = slidesElement;\n    this.dotsElement = dotsElement;\n\n    if (this.autoplay) {\n      this.startAutoplay();\n    }\n\n    return containerElement;\n  }\n\n  next() {\n    this.currentIndex = (this.currentIndex + 1) % this.items.length;\n    this.updateSlides();\n  }\n\n  previous() {\n    this.currentIndex = (this.currentIndex - 1 + this.items.length) % this.items.length;\n    this.updateSlides();\n  }\n\n  goTo(index) {\n    this.currentIndex = index;\n    this.updateSlides();\n    if (this.autoplay) {\n      this.resetAutoplay();\n    }\n  }\n\n  updateSlides() {\n    const slides = this.slidesElement.querySelectorAll('div');\n    const dots = this.dotsElement.querySelectorAll('button');\n\n    slides.forEach((slide, index) => {\n      slide.className = clsx(\n        'absolute inset-0 transition-opacity duration-500',\n        index === this.currentIndex ? 'opacity-100' : 'opacity-0'\n      );\n    });\n\n    dots.forEach((dot, index) => {\n      dot.className = clsx(\n        'w-2 h-2 rounded-full transition-all',\n        index === this.currentIndex ? 'bg-white w-8' : 'bg-gray-500'\n      );\n    });\n  }\n\n  startAutoplay() {\n    this.autoplayTimer = setInterval(() => {\n      this.next();\n    }, this.interval);\n  }\n\n  stopAutoplay() {\n    if (this.autoplayTimer) {\n      clearInterval(this.autoplayTimer);\n    }\n  }\n\n  resetAutoplay() {\n    this.stopAutoplay();\n    if (this.autoplay) {\n      this.startAutoplay();\n    }\n  }\n\n  destroy() {\n    this.stopAutoplay();\n    super.destroy();\n  }\n}\n", "/**\n * Chart Component (Simple bar/line chart)\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Chart extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.type = options.type || 'bar'; // bar, line\n    this.data = options.data || []; // Array of {label, value}\n    this.title = options.title || '';\n    this.height = options.height || '300px';\n    this.className = options.className || '';\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: clsx('bg-white rounded-lg border border-gray-200 p-4', this.className)\n    });\n\n    // Title\n    if (this.title) {\n      const titleElement = createElement('h3', {\n        className: 'text-lg font-semibold text-gray-900 mb-4',\n        text: this.title\n      });\n      containerElement.appendChild(titleElement);\n    }\n\n    // Canvas or SVG\n    const svgElement = this.createSVG();\n    containerElement.appendChild(svgElement);\n\n    return containerElement;\n  }\n\n  createSVG() {\n    const maxValue = Math.max(...this.data.map(d => d.value));\n    const width = 400;\n    const height = 200;\n    const padding = 40;\n\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n    svg.setAttribute('class', 'w-full');\n\n    if (this.type === 'bar') {\n      const barWidth = (width - padding * 2) / this.data.length;\n\n      this.data.forEach((d, i) => {\n        const barHeight = (d.value / maxValue) * (height - padding * 2);\n        const x = padding + i * barWidth + barWidth * 0.25;\n        const y = height - padding - barHeight;\n\n        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n        rect.setAttribute('x', x);\n        rect.setAttribute('y', y);\n        rect.setAttribute('width', barWidth * 0.5);\n        rect.setAttribute('height', barHeight);\n        rect.setAttribute('fill', '#3b82f6');\n        rect.setAttribute('class', 'hover:fill-blue-700 transition-colors');\n\n        svg.appendChild(rect);\n\n        // Label\n        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n        text.setAttribute('x', x + barWidth * 0.25);\n        text.setAttribute('y', height - 10);\n        text.setAttribute('text-anchor', 'middle');\n        text.setAttribute('font-size', '12');\n        text.setAttribute('fill', '#6b7280');\n        text.textContent = d.label;\n        svg.appendChild(text);\n      });\n    }\n\n    return svg;\n  }\n\n  setData(data) {\n    this.data = data;\n    if (this.element && this.element.parentNode) {\n      const newElement = this.create();\n      this.element.parentNode.replaceChild(newElement, this.element);\n      this.element = newElement;\n    }\n  }\n}\n", "/**\n * Checkbox Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Checkbox extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || '';\n    this.checked = options.checked || false;\n    this.disabled = options.disabled || false;\n    this.required = options.required || false;\n    this.name = options.name || '';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n  }\n\n  create() {\n    const baseClasses = 'flex items-center gap-2';\n\n    const containerElement = super.create('div', {\n      className: clsx(baseClasses, this.className)\n    });\n\n    const checkboxClasses = 'w-5 h-5 border-2 border-gray-300 rounded cursor-pointer transition-colors duration-200 checked:bg-blue-600 checked:border-blue-600 disabled:opacity-50 disabled:cursor-not-allowed';\n\n    const inputElement = document.createElement('input');\n    inputElement.type = 'checkbox';\n    inputElement.className = checkboxClasses;\n    inputElement.checked = this.checked;\n    inputElement.disabled = this.disabled;\n    inputElement.required = this.required;\n    if (this.name) inputElement.name = this.name;\n\n    containerElement.appendChild(inputElement);\n\n    if (this.label) {\n      const labelElement = document.createElement('label');\n      labelElement.className = 'cursor-pointer select-none';\n      labelElement.textContent = this.label;\n      containerElement.appendChild(labelElement);\n\n      labelElement.addEventListener('click', () => {\n        inputElement.click();\n      });\n    }\n\n    if (this.onChange) {\n      inputElement.addEventListener('change', this.onChange);\n    }\n\n    this.inputElement = inputElement;\n    return containerElement;\n  }\n\n  isChecked() {\n    return this.inputElement?.checked || false;\n  }\n\n  setChecked(checked) {\n    this.checked = checked;\n    if (this.inputElement) {\n      this.inputElement.checked = checked;\n    }\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    if (this.inputElement) {\n      this.inputElement.disabled = disabled;\n    }\n  }\n\n  toggle() {\n    this.setChecked(!this.isChecked());\n  }\n}\n", "/**\r\n * Collapsible Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createElement } from './utils.js';\r\n\r\nexport class Collapsible extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.title = options.title || '';\r\n    this.content = options.content || '';\r\n    this.open = options.open || false;\r\n    this.className = options.className || '';\r\n    this.onChange = options.onChange || null;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: clsx('border border-gray-200 rounded-lg overflow-hidden', this.className)\r\n    });\r\n\r\n    // Header/Trigger\r\n    const triggerElement = createElement('button', {\r\n      className: clsx(\r\n        'w-full px-4 py-3 flex items-center justify-between',\r\n        'hover:bg-gray-50 transition-colors duration-200 text-left'\r\n      ),\r\n      attrs: { 'aria-expanded': this.open }\r\n    });\r\n\r\n    const titleSpan = createElement('span', {\r\n      className: 'font-semibold text-gray-900',\r\n      text: this.title\r\n    });\r\n\r\n    const chevron = createElement('span', {\r\n      className: clsx(\r\n        'w-5 h-5 transition-transform duration-300',\r\n        this.open ? 'rotate-180' : ''\r\n      ),\r\n      html: '\u25BC'\r\n    });\r\n\r\n    triggerElement.appendChild(titleSpan);\r\n    triggerElement.appendChild(chevron);\r\n\r\n    triggerElement.addEventListener('click', () => {\r\n      this.toggle();\r\n    });\r\n\r\n    containerElement.appendChild(triggerElement);\r\n\r\n    // Content\r\n    const contentElement = createElement('div', {\r\n      className: clsx(\r\n        'overflow-hidden transition-all duration-300',\r\n        this.open ? 'max-h-96' : 'max-h-0',\r\n        'border-t border-gray-200'\r\n      )\r\n    });\r\n\r\n    const innerContent = createElement('div', {\r\n      className: 'px-4 py-3',\r\n      html: this.content\r\n    });\r\n\r\n    contentElement.appendChild(innerContent);\r\n    containerElement.appendChild(contentElement);\r\n\r\n    this.triggerElement = triggerElement;\r\n    this.contentElement = contentElement;\r\n    this.chevron = chevron;\r\n\r\n    return containerElement;\r\n  }\r\n\r\n  toggle() {\r\n    this.open = !this.open;\r\n    this.updateUI();\r\n    if (this.onChange) {\r\n      this.onChange(this.open);\r\n    }\r\n  }\r\n\r\n  open() {\r\n    if (!this.open) {\r\n      this.open = true;\r\n      this.updateUI();\r\n      if (this.onChange) {\r\n        this.onChange(true);\r\n      }\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this.open) {\r\n      this.open = false;\r\n      this.updateUI();\r\n      if (this.onChange) {\r\n        this.onChange(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateUI() {\r\n    this.triggerElement.setAttribute('aria-expanded', this.open);\r\n    this.contentElement.className = clsx(\r\n      'overflow-hidden transition-all duration-300',\r\n      this.open ? 'max-h-96' : 'max-h-0',\r\n      'border-t border-gray-200'\r\n    );\r\n    this.chevron.className = clsx(\r\n      'w-5 h-5 transition-transform duration-300',\r\n      this.open ? 'rotate-180' : ''\r\n    );\r\n  }\r\n\r\n  setContent(content) {\r\n    this.content = content;\r\n    if (this.contentElement) {\r\n      const inner = this.contentElement.querySelector('div');\r\n      if (inner) {\r\n        inner.innerHTML = content;\r\n      }\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Command Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createElement } from './utils.js';\r\n\r\nexport class Command extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.commands = options.commands || []; // {label, action, shortcut, category}\r\n    this.placeholder = options.placeholder || 'Type a command...';\r\n    this.className = options.className || '';\r\n    this.open = false;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: clsx(\r\n        'fixed inset-0 z-50 hidden flex items-start justify-center pt-20',\r\n        this.open ? 'flex' : ''\r\n      )\r\n    });\r\n\r\n    // Backdrop\r\n    const backdrop = createElement('div', {\r\n      className: 'absolute inset-0 bg-black bg-opacity-50'\r\n    });\r\n    containerElement.appendChild(backdrop);\r\n\r\n    backdrop.addEventListener('click', () => this.close());\r\n\r\n    // Command palette\r\n    const paletteElement = createElement('div', {\r\n      className: 'relative w-full max-w-md bg-white rounded-lg shadow-lg z-50'\r\n    });\r\n\r\n    // Input\r\n    const inputElement = document.createElement('input');\r\n    inputElement.type = 'text';\r\n    inputElement.placeholder = this.placeholder;\r\n    inputElement.className = 'w-full px-4 py-3 border-b border-gray-200 focus:outline-none';\r\n    inputElement.autofocus = true;\r\n\r\n    paletteElement.appendChild(inputElement);\r\n\r\n    // Results\r\n    const resultsElement = createElement('div', {\r\n      className: 'max-h-96 overflow-y-auto'\r\n    });\r\n\r\n    const renderResults = (query = '') => {\r\n      resultsElement.innerHTML = '';\r\n\r\n      const filtered = query\r\n        ? this.commands.filter(cmd =>\r\n            cmd.label.toLowerCase().includes(query.toLowerCase())\r\n          )\r\n        : this.commands;\r\n\r\n      if (filtered.length === 0) {\r\n        const noResults = createElement('div', {\r\n          className: 'px-4 py-3 text-sm text-gray-500',\r\n          text: 'No commands found'\r\n        });\r\n        resultsElement.appendChild(noResults);\r\n        return;\r\n      }\r\n\r\n      let currentCategory = '';\r\n\r\n      filtered.forEach(cmd => {\r\n        if (cmd.category && cmd.category !== currentCategory) {\r\n          currentCategory = cmd.category;\r\n          const categoryHeader = createElement('div', {\r\n            className: 'px-4 py-2 text-xs font-semibold text-gray-600 bg-gray-50 uppercase',\r\n            text: currentCategory\r\n          });\r\n          resultsElement.appendChild(categoryHeader);\r\n        }\r\n\r\n        const cmdElement = createElement('div', {\r\n          className: clsx(\r\n            'px-4 py-2 cursor-pointer hover:bg-blue-50 transition-colors flex items-center justify-between group'\r\n          )\r\n        });\r\n\r\n        const label = createElement('span', {\r\n          text: cmd.label,\r\n          className: 'text-sm text-gray-900'\r\n        });\r\n        cmdElement.appendChild(label);\r\n\r\n        if (cmd.shortcut) {\r\n          const shortcut = createElement('span', {\r\n            className: 'text-xs text-gray-500 group-hover:text-gray-700',\r\n            text: cmd.shortcut\r\n          });\r\n          cmdElement.appendChild(shortcut);\r\n        }\r\n\r\n        cmdElement.addEventListener('click', () => {\r\n          if (cmd.action) {\r\n            cmd.action();\r\n          }\r\n          this.close();\r\n        });\r\n\r\n        resultsElement.appendChild(cmdElement);\r\n      });\r\n    };\r\n\r\n    inputElement.addEventListener('input', (e) => {\r\n      renderResults(e.target.value);\r\n    });\r\n\r\n    paletteElement.appendChild(resultsElement);\r\n    containerElement.appendChild(paletteElement);\r\n\r\n    inputElement.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape') {\r\n        this.close();\r\n      }\r\n    });\r\n\r\n    renderResults();\r\n    this.containerElement = containerElement;\r\n\r\n    return containerElement;\r\n  }\r\n\r\n  open() {\r\n    if (!this.element) this.create();\r\n    this.open = true;\r\n    this.element.classList.remove('hidden');\r\n    this.element.classList.add('flex');\r\n  }\r\n\r\n  close() {\r\n    this.open = false;\r\n    this.element?.classList.remove('flex');\r\n    this.element?.classList.add('hidden');\r\n  }\r\n\r\n  toggle() {\r\n    this.open ? this.close() : this.open();\r\n  }\r\n}\r\n", "/**\n * Combobox Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Combobox extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.items = options.items || [];\n    this.value = options.value || '';\n    this.placeholder = options.placeholder || 'Search...';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n    this.open = false;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: 'relative w-full'\n    });\n\n    // Input\n    const inputElement = document.createElement('input');\n    inputElement.type = 'text';\n    inputElement.placeholder = this.placeholder;\n    inputElement.value = this.value;\n    inputElement.className = clsx(\n      'w-full px-3 py-2 border border-gray-300 rounded-md',\n      'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent'\n    );\n\n    // Dropdown list\n    const listElement = createElement('div', {\n      className: clsx(\n        'absolute hidden top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50',\n        'max-h-64 overflow-y-auto'\n      )\n    });\n\n    const renderList = (query = '') => {\n      listElement.innerHTML = '';\n      const filtered = this.items.filter(item =>\n        item.label.toLowerCase().includes(query.toLowerCase())\n      );\n\n      if (filtered.length === 0) {\n        const noResults = createElement('div', {\n          className: 'px-3 py-2 text-gray-500',\n          text: 'No results found'\n        });\n        listElement.appendChild(noResults);\n        return;\n      }\n\n      filtered.forEach(item => {\n        const option = createElement('div', {\n          className: clsx(\n            'px-3 py-2 cursor-pointer hover:bg-blue-50 transition-colors',\n            item.value === this.value ? 'bg-blue-100' : ''\n          ),\n          text: item.label,\n          attrs: { 'data-value': item.value }\n        });\n\n        option.addEventListener('click', () => {\n          this.value = item.value;\n          inputElement.value = item.label;\n          listElement.classList.add('hidden');\n          if (this.onChange) {\n            this.onChange(this.value, item);\n          }\n        });\n\n        listElement.appendChild(option);\n      });\n    };\n\n    inputElement.addEventListener('input', (e) => {\n      renderList(e.target.value);\n      listElement.classList.remove('hidden');\n    });\n\n    inputElement.addEventListener('focus', () => {\n      renderList(inputElement.value);\n      listElement.classList.remove('hidden');\n    });\n\n    inputElement.addEventListener('blur', () => {\n      setTimeout(() => {\n        listElement.classList.add('hidden');\n      }, 150);\n    });\n\n    containerElement.appendChild(inputElement);\n    containerElement.appendChild(listElement);\n\n    document.addEventListener('click', (e) => {\n      if (!containerElement.contains(e.target)) {\n        listElement.classList.add('hidden');\n      }\n    });\n\n    this.inputElement = inputElement;\n    this.listElement = listElement;\n    renderList();\n\n    return containerElement;\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  setValue(value) {\n    this.value = value;\n    const item = this.items.find(i => i.value === value);\n    if (item && this.inputElement) {\n      this.inputElement.value = item.label;\n    }\n  }\n}\n", "/**\n * Context Menu Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class ContextMenu extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.items = options.items || []; // Array of {label, onClick, icon, disabled}\n    this.className = options.className || '';\n    this.visible = false;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: 'relative inline-block w-full'\n    });\n\n    // Menu content\n    const menuElement = document.createElement('div');\n    menuElement.className = clsx(\n      'absolute hidden bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50 min-w-max',\n      this.className\n    );\n\n    this.items.forEach((item) => {\n      const itemElement = createElement('button', {\n        className: clsx(\n          'w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center gap-2',\n          item.disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'\n        ),\n        attrs: {\n          disabled: item.disabled ? '' : null,\n          'data-action': item.label\n        }\n      });\n\n      if (item.icon) {\n        const iconSpan = document.createElement('span');\n        iconSpan.innerHTML = item.icon;\n        itemElement.appendChild(iconSpan);\n      }\n\n      const labelSpan = document.createElement('span');\n      labelSpan.textContent = item.label;\n      itemElement.appendChild(labelSpan);\n\n      itemElement.addEventListener('click', () => {\n        if (!item.disabled && item.onClick) {\n          item.onClick();\n        }\n        this.hide();\n      });\n\n      menuElement.appendChild(itemElement);\n    });\n\n    containerElement.appendChild(menuElement);\n\n    // Show on right click\n    containerElement.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      this.showAt(e.clientX, e.clientY, menuElement);\n    });\n\n    // Hide on outside click\n    document.addEventListener('click', () => {\n      if (this.visible) {\n        this.hide();\n      }\n    });\n\n    this.menuElement = menuElement;\n    return containerElement;\n  }\n\n  showAt(x, y, menuElement) {\n    if (!menuElement) return;\n\n    this.visible = true;\n    menuElement.classList.remove('hidden');\n    menuElement.style.position = 'fixed';\n    menuElement.style.left = x + 'px';\n    menuElement.style.top = y + 'px';\n  }\n\n  hide() {\n    this.visible = false;\n    if (this.menuElement) {\n      this.menuElement.classList.add('hidden');\n      this.menuElement.style.position = 'absolute';\n    }\n  }\n\n  addItem(label, onClick, icon = null) {\n    const item = { label, onClick, icon };\n    this.items.push(item);\n    \n    if (this.menuElement) {\n      const itemElement = createElement('button', {\n        className: 'w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center gap-2',\n      });\n\n      if (icon) {\n        const iconSpan = document.createElement('span');\n        iconSpan.innerHTML = icon;\n        itemElement.appendChild(iconSpan);\n      }\n\n      itemElement.textContent = label;\n      itemElement.addEventListener('click', () => {\n        onClick();\n        this.hide();\n      });\n\n      this.menuElement.appendChild(itemElement);\n    }\n  }\n}\n", "/**\n * Date Picker Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class DatePicker extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.value = options.value || '';\n    this.placeholder = options.placeholder || 'Select date...';\n    this.format = options.format || 'yyyy-mm-dd';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n    this.open = false;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: 'relative w-full'\n    });\n\n    // Input\n    const inputElement = document.createElement('input');\n    inputElement.type = 'text';\n    inputElement.placeholder = this.placeholder;\n    inputElement.value = this.value;\n    inputElement.className = clsx(\n      'w-full px-3 py-2 border border-gray-300 rounded-md',\n      'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent'\n    );\n\n    inputElement.addEventListener('click', () => {\n      this.openPicker();\n    });\n\n    inputElement.addEventListener('change', (e) => {\n      this.value = e.target.value;\n      if (this.onChange) {\n        this.onChange(this.value);\n      }\n    });\n\n    containerElement.appendChild(inputElement);\n\n    // Use native date input for simplicity\n    const nativeInput = document.createElement('input');\n    nativeInput.type = 'date';\n    nativeInput.style.display = 'none';\n    nativeInput.value = this.value;\n\n    nativeInput.addEventListener('change', (e) => {\n      const date = new Date(e.target.value);\n      this.value = this.formatDate(date);\n      inputElement.value = this.value;\n      \n      if (this.onChange) {\n        this.onChange(this.value);\n      }\n    });\n\n    containerElement.appendChild(nativeInput);\n\n    this.inputElement = inputElement;\n    this.nativeInput = nativeInput;\n\n    return containerElement;\n  }\n\n  openPicker() {\n    this.nativeInput.click();\n  }\n\n  formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    \n    if (this.format === 'dd/mm/yyyy') {\n      return `${day}/${month}/${year}`;\n    }\n    return `${year}-${month}-${day}`;\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  setValue(value) {\n    this.value = value;\n    if (this.inputElement) {\n      this.inputElement.value = value;\n    }\n  }\n}\n", "/**\r\n * Dialog Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createBackdrop, createFocusTrap, keyboard } from './utils.js';\r\n\r\nexport class Dialog extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.title = options.title || '';\r\n    this.content = options.content || '';\r\n    this.size = options.size || 'md'; // sm, md, lg, xl\r\n    this.open = options.open || false;\r\n    this.onClose = options.onClose || null;\r\n    this.closeButton = options.closeButton !== false;\r\n    this.closeOnBackdrop = options.closeOnBackdrop !== false;\r\n    this.closeOnEscape = options.closeOnEscape !== false;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: clsx(\r\n        'fixed inset-0 z-50 flex items-center justify-center',\r\n        this.open ? '' : 'hidden'\r\n      ),\r\n      attrs: {\r\n        role: 'dialog',\r\n        'aria-modal': 'true',\r\n        'aria-labelledby': `${this.id}-title`,\r\n        'aria-describedby': `${this.id}-description`\r\n      }\r\n    });\r\n\r\n    // Backdrop\r\n    const backdrop = createBackdrop('dialog-backdrop');\r\n    containerElement.appendChild(backdrop);\r\n\r\n    if (this.closeOnBackdrop) {\r\n      backdrop.addEventListener('click', () => this.close());\r\n    }\r\n\r\n    // Dialog content\r\n    const sizeClasses = {\r\n      sm: 'w-full max-w-sm',\r\n      md: 'w-full max-w-md',\r\n      lg: 'w-full max-w-lg',\r\n      xl: 'w-full max-w-xl'\r\n    };\r\n\r\n    const dialogElement = document.createElement('div');\r\n    dialogElement.className = clsx(\r\n      'bg-white rounded-lg shadow-lg relative z-50',\r\n      sizeClasses[this.size],\r\n      'mx-4 max-h-[90vh] overflow-y-auto'\r\n    );\r\n\r\n    // Header\r\n    if (this.title) {\r\n      const header = document.createElement('div');\r\n      header.className = 'px-6 py-4 border-b border-gray-200 flex items-center justify-between';\r\n      \r\n      const title = document.createElement('h2');\r\n      title.id = `${this.id}-title`;\r\n      title.className = 'text-xl font-semibold text-gray-900';\r\n      title.textContent = this.title;\r\n      header.appendChild(title);\r\n\r\n      if (this.closeButton) {\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.className = 'text-gray-500 hover:text-gray-700 transition-colors duration-200';\r\n        closeBtn.innerHTML = '\u00D7';\r\n        closeBtn.setAttribute('aria-label', 'Close');\r\n        closeBtn.addEventListener('click', () => this.close());\r\n        header.appendChild(closeBtn);\r\n      }\r\n\r\n      dialogElement.appendChild(header);\r\n    }\r\n\r\n    // Content\r\n    if (this.content) {\r\n      const contentDiv = document.createElement('div');\r\n      contentDiv.id = `${this.id}-description`;\r\n      contentDiv.className = 'px-6 py-4';\r\n      contentDiv.innerHTML = this.content;\r\n      dialogElement.appendChild(contentDiv);\r\n    }\r\n\r\n    containerElement.appendChild(dialogElement);\r\n\r\n    // Handle keyboard\r\n    this.on('keydown', (e) => {\r\n      if (keyboard.isEscape(e) && this.closeOnEscape) {\r\n        this.close();\r\n      }\r\n    }, { once: false });\r\n\r\n    this.backdrop = backdrop;\r\n    this.dialogElement = dialogElement;\r\n    this.focusTrap = createFocusTrap(dialogElement);\r\n\r\n    return containerElement;\r\n  }\r\n\r\n  open() {\r\n    if (!this.element) this.create();\r\n    \r\n    this.open = true;\r\n    this.element.classList.remove('hidden');\r\n    this.focusTrap.init();\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  close() {\r\n    this.open = false;\r\n    this.element?.classList.add('hidden');\r\n    document.body.style.overflow = '';\r\n    \r\n    if (this.onClose) {\r\n      this.onClose();\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    this.open ? this.close() : this.open();\r\n  }\r\n\r\n  setContent(content) {\r\n    this.content = content;\r\n    if (this.dialogElement) {\r\n      const contentDiv = this.dialogElement.querySelector(`#${this.id}-description`);\r\n      if (contentDiv) {\r\n        contentDiv.innerHTML = content;\r\n      }\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Dropdown Menu Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createElement } from './utils.js';\r\n\r\nexport class DropdownMenu extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.trigger = options.trigger || 'Menu';\r\n    this.items = options.items || []; // Array of {label, onClick, icon, disabled, divider}\r\n    this.position = options.position || 'bottom'; // top, bottom\r\n    this.align = options.align || 'left'; // left, right\r\n    this.className = options.className || '';\r\n    this.open = false;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: 'relative inline-block'\r\n    });\r\n\r\n    // Trigger button\r\n    const triggerBtn = document.createElement('button');\r\n    triggerBtn.className = 'px-4 py-2 bg-gray-100 text-gray-900 rounded hover:bg-gray-200 transition-colors duration-200 flex items-center gap-2';\r\n    triggerBtn.innerHTML = `${this.trigger} <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"></path></svg>`;\r\n    triggerBtn.addEventListener('click', () => this.toggle());\r\n\r\n    containerElement.appendChild(triggerBtn);\r\n\r\n    // Menu\r\n    const positionClass = this.position === 'top' ? 'bottom-full mb-2' : 'top-full mt-2';\r\n    const alignClass = this.align === 'right' ? 'right-0' : 'left-0';\r\n\r\n    const menuElement = document.createElement('div');\r\n    menuElement.className = clsx(\r\n      'absolute hidden bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50 min-w-max',\r\n      positionClass,\r\n      alignClass,\r\n      this.className\r\n    );\r\n\r\n    this.items.forEach((item) => {\r\n      if (item.divider) {\r\n        const divider = document.createElement('div');\r\n        divider.className = 'border-t border-gray-200 my-1';\r\n        menuElement.appendChild(divider);\r\n        return;\r\n      }\r\n\r\n      const itemElement = createElement('button', {\r\n        className: clsx(\r\n          'w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center gap-2',\r\n          item.disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'\r\n        ),\r\n        attrs: {\r\n          disabled: item.disabled ? '' : null\r\n        }\r\n      });\r\n\r\n      if (item.icon) {\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.innerHTML = item.icon;\r\n        iconSpan.className = 'w-4 h-4';\r\n        itemElement.appendChild(iconSpan);\r\n      }\r\n\r\n      const labelSpan = document.createElement('span');\r\n      labelSpan.textContent = item.label;\r\n      itemElement.appendChild(labelSpan);\r\n\r\n      itemElement.addEventListener('click', () => {\r\n        if (!item.disabled && item.onClick) {\r\n          item.onClick();\r\n        }\r\n        this.close();\r\n      });\r\n\r\n      menuElement.appendChild(itemElement);\r\n    });\r\n\r\n    containerElement.appendChild(menuElement);\r\n\r\n    // Close on outside click\r\n    document.addEventListener('click', (e) => {\r\n      if (!containerElement.contains(e.target) && this.open) {\r\n        this.close();\r\n      }\r\n    });\r\n\r\n    this.triggerBtn = triggerBtn;\r\n    this.menuElement = menuElement;\r\n\r\n    return containerElement;\r\n  }\r\n\r\n  toggle() {\r\n    this.open ? this.close() : this.open();\r\n  }\r\n\r\n  open() {\r\n    this.open = true;\r\n    this.menuElement.classList.remove('hidden');\r\n  }\r\n\r\n  close() {\r\n    this.open = false;\r\n    this.menuElement.classList.add('hidden');\r\n  }\r\n\r\n  addItem(label, onClick, icon = null) {\r\n    const item = { label, onClick, icon };\r\n    this.items.push(item);\r\n    \r\n    if (this.menuElement) {\r\n      const itemElement = createElement('button', {\r\n        className: 'w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center gap-2'\r\n      });\r\n\r\n      if (icon) {\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.innerHTML = icon;\r\n        iconSpan.className = 'w-4 h-4';\r\n        itemElement.appendChild(iconSpan);\r\n      }\r\n\r\n      const labelSpan = document.createElement('span');\r\n      labelSpan.textContent = label;\r\n      itemElement.appendChild(labelSpan);\r\n\r\n      itemElement.addEventListener('click', () => {\r\n        onClick();\r\n        this.close();\r\n      });\r\n\r\n      this.menuElement.appendChild(itemElement);\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Drawer Component (Side Sheet)\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createBackdrop, createFocusTrap, keyboard } from './utils.js';\r\n\r\nexport class Drawer extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.title = options.title || '';\r\n    this.content = options.content || '';\r\n    this.position = options.position || 'right'; // left, right\r\n    this.open = options.open || false;\r\n    this.onClose = options.onClose || null;\r\n    this.closeButton = options.closeButton !== false;\r\n    this.closeOnBackdrop = options.closeOnBackdrop !== false;\r\n    this.closeOnEscape = options.closeOnEscape !== false;\r\n  }\r\n\r\n  create() {\r\n    const containerElement = super.create('div', {\r\n      className: clsx(\r\n        'fixed inset-0 z-50',\r\n        this.open ? '' : 'hidden'\r\n      )\r\n    });\r\n\r\n    // Backdrop\r\n    const backdrop = createBackdrop();\r\n    containerElement.appendChild(backdrop);\r\n\r\n    if (this.closeOnBackdrop) {\r\n      backdrop.addEventListener('click', () => this.close());\r\n    }\r\n\r\n    // Drawer\r\n    const positionClasses = this.position === 'left' ? 'left-0' : 'right-0';\r\n    const drawerElement = document.createElement('div');\r\n    drawerElement.className = clsx(\r\n      'absolute top-0 h-full w-96 bg-white shadow-lg transition-transform duration-300 flex flex-col z-50',\r\n      positionClasses,\r\n      this.open ? 'translate-x-0' : (this.position === 'left' ? '-translate-x-full' : 'translate-x-full')\r\n    );\r\n\r\n    // Header\r\n    if (this.title) {\r\n      const header = document.createElement('div');\r\n      header.className = 'px-6 py-4 border-b border-gray-200 flex items-center justify-between';\r\n      \r\n      const title = document.createElement('h2');\r\n      title.className = 'text-xl font-semibold text-gray-900';\r\n      title.textContent = this.title;\r\n      header.appendChild(title);\r\n\r\n      if (this.closeButton) {\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.className = 'text-gray-500 hover:text-gray-700 transition-colors duration-200';\r\n        closeBtn.innerHTML = '\u00D7';\r\n        closeBtn.addEventListener('click', () => this.close());\r\n        header.appendChild(closeBtn);\r\n      }\r\n\r\n      drawerElement.appendChild(header);\r\n    }\r\n\r\n    // Content\r\n    const contentDiv = document.createElement('div');\r\n    contentDiv.className = 'flex-1 overflow-y-auto px-6 py-4';\r\n    contentDiv.innerHTML = this.content;\r\n    drawerElement.appendChild(contentDiv);\r\n\r\n    containerElement.appendChild(drawerElement);\r\n\r\n    // Handle keyboard\r\n    this.on('keydown', (e) => {\r\n      if (keyboard.isEscape(e) && this.closeOnEscape) {\r\n        this.close();\r\n      }\r\n    }, { once: false });\r\n\r\n    this.backdrop = backdrop;\r\n    this.drawerElement = drawerElement;\r\n\r\n    return containerElement;\r\n  }\r\n\r\n  open() {\r\n    if (!this.element) this.create();\r\n    \r\n    this.open = true;\r\n    this.element.classList.remove('hidden');\r\n    this.drawerElement.classList.remove('-translate-x-full', 'translate-x-full');\r\n    this.drawerElement.classList.add('translate-x-0');\r\n    document.body.style.overflow = 'hidden';\r\n  }\r\n\r\n  close() {\r\n    this.open = false;\r\n    const translateClass = this.position === 'left' ? '-translate-x-full' : 'translate-x-full';\r\n    this.drawerElement.classList.remove('translate-x-0');\r\n    this.drawerElement.classList.add(translateClass);\r\n    \r\n    setTimeout(() => {\r\n      if (this.element?.parentNode) {\r\n        this.element.classList.add('hidden');\r\n      }\r\n      document.body.style.overflow = '';\r\n    }, 300);\r\n    \r\n    if (this.onClose) {\r\n      this.onClose();\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    this.open ? this.close() : this.open();\r\n  }\r\n}\r\n", "/**\n * Empty State Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Empty extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.icon = options.icon || '\uD83D\uDCE6';\n    this.title = options.title || 'No data';\n    this.message = options.message || 'There is no data to display';\n    this.action = options.action || null; // {label, onClick}\n    this.className = options.className || '';\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: clsx(\n        'flex flex-col items-center justify-center p-8 text-center',\n        this.className\n      )\n    });\n\n    // Icon\n    const iconElement = createElement('div', {\n      className: 'text-6xl mb-4',\n      text: this.icon\n    });\n    containerElement.appendChild(iconElement);\n\n    // Title\n    const titleElement = createElement('h3', {\n      className: 'text-lg font-semibold text-gray-900 mb-2',\n      text: this.title\n    });\n    containerElement.appendChild(titleElement);\n\n    // Message\n    const messageElement = createElement('p', {\n      className: 'text-gray-500 mb-4',\n      text: this.message\n    });\n    containerElement.appendChild(messageElement);\n\n    // Action button\n    if (this.action) {\n      const actionBtn = createElement('button', {\n        className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors',\n        text: this.action.label\n      });\n\n      actionBtn.addEventListener('click', this.action.onClick);\n      containerElement.appendChild(actionBtn);\n    }\n\n    return containerElement;\n  }\n}\n", "/**\n * Form Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class Form extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.fields = options.fields || []; // Array of field configs\n    this.onSubmit = options.onSubmit || null;\n    this.submitText = options.submitText || 'Submit';\n    this.className = options.className || '';\n  }\n\n  create() {\n    const formElement = super.create('form', {\n      className: clsx('space-y-6', this.className)\n    });\n\n    formElement.addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handleSubmit();\n    });\n\n    // Render fields\n    this.fieldElements = {};\n\n    this.fields.forEach(field => {\n      const fieldContainer = createElement('div', {\n        className: 'space-y-2'\n      });\n\n      // Label\n      if (field.label) {\n        const label = createElement('label', {\n          className: 'block text-sm font-medium text-gray-700',\n          text: field.label,\n          attrs: { for: field.name }\n        });\n        fieldContainer.appendChild(label);\n      }\n\n      // Input\n      const input = document.createElement(field.type === 'textarea' ? 'textarea' : 'input');\n      input.id = field.name;\n      input.name = field.name;\n      input.className = clsx(\n        'w-full px-3 py-2 border border-gray-300 rounded-md',\n        'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent'\n      );\n\n      if (field.type !== 'textarea') {\n        input.type = field.type || 'text';\n      }\n\n      if (field.placeholder) input.placeholder = field.placeholder;\n      if (field.required) input.required = true;\n      if (field.disabled) input.disabled = true;\n\n      input.value = field.value || '';\n\n      fieldContainer.appendChild(input);\n\n      // Error message\n      const errorDiv = createElement('div', {\n        className: 'text-sm text-red-600 hidden',\n        attrs: { 'data-error': field.name }\n      });\n      fieldContainer.appendChild(errorDiv);\n\n      formElement.appendChild(fieldContainer);\n      this.fieldElements[field.name] = input;\n    });\n\n    // Submit button\n    const submitBtn = createElement('button', {\n      className: clsx(\n        'w-full px-4 py-2 bg-blue-600 text-white font-medium rounded',\n        'hover:bg-blue-700 transition-colors duration-200'\n      ),\n      text: this.submitText,\n      attrs: { type: 'submit' }\n    });\n\n    formElement.appendChild(submitBtn);\n\n    return formElement;\n  }\n\n  handleSubmit() {\n    const formData = {};\n\n    Object.entries(this.fieldElements).forEach(([name, input]) => {\n      formData[name] = input.value;\n    });\n\n    if (this.onSubmit) {\n      this.onSubmit(formData);\n    }\n  }\n\n  getValues() {\n    const values = {};\n    Object.entries(this.fieldElements).forEach(([name, input]) => {\n      values[name] = input.value;\n    });\n    return values;\n  }\n\n  setValues(values) {\n    Object.entries(values).forEach(([name, value]) => {\n      if (this.fieldElements[name]) {\n        this.fieldElements[name].value = value;\n      }\n    });\n  }\n\n  setError(fieldName, message) {\n    const errorDiv = this.element.querySelector(`[data-error=\"${fieldName}\"]`);\n    if (errorDiv) {\n      errorDiv.textContent = message;\n      errorDiv.classList.remove('hidden');\n    }\n  }\n\n  clearError(fieldName) {\n    const errorDiv = this.element.querySelector(`[data-error=\"${fieldName}\"]`);\n    if (errorDiv) {\n      errorDiv.textContent = '';\n      errorDiv.classList.add('hidden');\n    }\n  }\n\n  reset() {\n    if (this.element) {\n      this.element.reset();\n    }\n  }\n}\n", "/**\n * Hover Card Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class HoverCard extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.trigger = options.trigger || 'Hover me';\n    this.content = options.content || '';\n    this.position = options.position || 'bottom'; // top, bottom, left, right\n    this.delay = options.delay || 200;\n    this.className = options.className || '';\n    this.visible = false;\n    this.timeoutId = null;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: 'relative inline-block'\n    });\n\n    // Trigger\n    const triggerElement = document.createElement('div');\n    triggerElement.className = 'cursor-pointer px-3 py-2 rounded hover:bg-gray-100 transition-colors duration-200';\n    triggerElement.textContent = this.trigger;\n\n    containerElement.appendChild(triggerElement);\n\n    // Card content\n    const cardElement = document.createElement('div');\n    cardElement.className = clsx(\n      'absolute hidden bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50',\n      'min-w-max max-w-sm',\n      this.getPositionClasses(),\n      this.className\n    );\n    cardElement.innerHTML = this.content;\n\n    containerElement.appendChild(cardElement);\n\n    // Hover handlers\n    containerElement.addEventListener('mouseenter', () => this.show(cardElement));\n    containerElement.addEventListener('mouseleave', () => this.hide(cardElement));\n\n    this.cardElement = cardElement;\n\n    return containerElement;\n  }\n\n  getPositionClasses() {\n    const positions = {\n      top: 'bottom-full left-0 mb-2',\n      bottom: 'top-full left-0 mt-2',\n      left: 'right-full top-0 mr-2',\n      right: 'left-full top-0 ml-2'\n    };\n    return positions[this.position] || positions.bottom;\n  }\n\n  show(cardElement = this.cardElement) {\n    if (this.visible || !cardElement) return;\n\n    this.timeoutId = setTimeout(() => {\n      this.visible = true;\n      cardElement.classList.remove('hidden');\n      cardElement.classList.add('opacity-100', 'transition-opacity', 'duration-200');\n    }, this.delay);\n  }\n\n  hide(cardElement = this.cardElement) {\n    if (!this.visible || !cardElement) return;\n\n    clearTimeout(this.timeoutId);\n    this.visible = false;\n    cardElement.classList.add('hidden');\n    cardElement.classList.remove('opacity-100');\n  }\n\n  setContent(content) {\n    this.content = content;\n    if (this.cardElement) {\n      this.cardElement.innerHTML = content;\n    }\n  }\n}\n", "/**\n * Input Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Input extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.type = options.type || 'text';\n    this.placeholder = options.placeholder || '';\n    this.value = options.value || '';\n    this.name = options.name || '';\n    this.disabled = options.disabled || false;\n    this.required = options.required || false;\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n  }\n\n  create() {\n    const baseClasses = 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 placeholder-gray-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed';\n\n    const inputElement = super.create('input', {\n      className: clsx(baseClasses, this.className),\n      attrs: {\n        type: this.type,\n        placeholder: this.placeholder,\n        value: this.value,\n        name: this.name,\n        disabled: this.disabled ? '' : null,\n        required: this.required ? '' : null\n      }\n    });\n\n    if (this.onChange) {\n      this.on('change', this.onChange);\n      this.on('input', this.onChange);\n    }\n\n    return inputElement;\n  }\n\n  getValue() {\n    return this.element?.value || '';\n  }\n\n  setValue(value) {\n    this.value = value;\n    if (this.element) {\n      this.element.value = value;\n    }\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.attr('disabled', disabled ? '' : null);\n  }\n\n  setPlaceholder(placeholder) {\n    this.placeholder = placeholder;\n    if (this.element) {\n      this.element.placeholder = placeholder;\n    }\n  }\n\n  focus() {\n    super.focus();\n  }\n\n  clear() {\n    this.setValue('');\n  }\n}\n", "/**\n * Input Group Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class InputGroup extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.prefix = options.prefix || null;\n    this.suffix = options.suffix || null;\n    this.input = options.input || null;\n    this.className = options.className || '';\n  }\n\n  create() {\n    const baseClasses = 'flex items-center border border-gray-300 rounded-md overflow-hidden focus-within:ring-2 focus-within:ring-blue-500';\n\n    const groupElement = super.create('div', {\n      className: clsx(baseClasses, this.className)\n    });\n\n    if (this.prefix) {\n      const prefixEl = createElement('div', {\n        className: 'px-3 py-2 bg-gray-50 text-gray-700 font-medium text-sm',\n        html: this.prefix\n      });\n      groupElement.appendChild(prefixEl);\n    }\n\n    if (this.input) {\n      const inputEl = this.input.element || this.input.create();\n      inputEl.classList.remove('border', 'focus:ring-2', 'focus:ring-blue-500');\n      groupElement.appendChild(inputEl);\n    }\n\n    if (this.suffix) {\n      const suffixEl = createElement('div', {\n        className: 'px-3 py-2 bg-gray-50 text-gray-700 font-medium text-sm',\n        html: this.suffix\n      });\n      groupElement.appendChild(suffixEl);\n    }\n\n    return groupElement;\n  }\n}\n", "/**\n * Input OTP Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class InputOTP extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.length = options.length || 6;\n    this.value = options.value || '';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n    this.onComplete = options.onComplete || null;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: clsx('flex gap-2', this.className)\n    });\n\n    this.inputs = [];\n\n    for (let i = 0; i < this.length; i++) {\n      const input = document.createElement('input');\n      input.type = 'text';\n      input.maxLength = '1';\n      input.inputMode = 'numeric';\n      input.className = clsx(\n        'w-12 h-12 text-center border-2 border-gray-300 rounded-lg font-semibold text-lg',\n        'focus:border-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-200',\n        'transition-colors duration-200'\n      );\n\n      if (this.value && this.value[i]) {\n        input.value = this.value[i];\n      }\n\n      input.addEventListener('input', (e) => {\n        const value = e.target.value;\n        if (!/^\\d*$/.test(value)) {\n          e.target.value = '';\n          return;\n        }\n\n        if (value && i < this.length - 1) {\n          this.inputs[i + 1].focus();\n        }\n\n        this.updateValue();\n      });\n\n      input.addEventListener('keydown', (e) => {\n        if (e.key === 'Backspace') {\n          if (!input.value && i > 0) {\n            this.inputs[i - 1].focus();\n          }\n        } else if (e.key === 'ArrowLeft' && i > 0) {\n          this.inputs[i - 1].focus();\n        } else if (e.key === 'ArrowRight' && i < this.length - 1) {\n          this.inputs[i + 1].focus();\n        }\n      });\n\n      this.inputs.push(input);\n      containerElement.appendChild(input);\n    }\n\n    return containerElement;\n  }\n\n  updateValue() {\n    this.value = this.inputs.map(input => input.value).join('');\n    \n    if (this.onChange) {\n      this.onChange(this.value);\n    }\n\n    if (this.value.length === this.length && this.onComplete) {\n      this.onComplete(this.value);\n    }\n  }\n\n  getValue() {\n    return this.value;\n  }\n\n  setValue(value) {\n    this.value = value;\n    for (let i = 0; i < this.length; i++) {\n      this.inputs[i].value = value[i] || '';\n    }\n  }\n\n  clear() {\n    this.inputs.forEach(input => {\n      input.value = '';\n    });\n    this.value = '';\n  }\n\n  focus() {\n    if (this.inputs.length > 0) {\n      this.inputs[0].focus();\n    }\n  }\n}\n", "/**\n * Item Component (Generic list item)\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Item extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || '';\n    this.value = options.value || '';\n    this.icon = options.icon || null;\n    this.className = options.className || '';\n    this.selected = options.selected || false;\n    this.disabled = options.disabled || false;\n  }\n\n  create() {\n    const baseClasses = 'flex items-center gap-2 px-3 py-2 rounded cursor-pointer transition-colors duration-200 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed';\n    \n    const stateClasses = this.selected ? 'bg-blue-50 text-blue-600' : 'text-gray-900';\n\n    const itemElement = super.create('div', {\n      className: clsx(baseClasses, stateClasses, this.className),\n      attrs: { \n        role: 'option',\n        'aria-selected': this.selected,\n        disabled: this.disabled ? '' : null,\n        'data-value': this.value\n      }\n    });\n\n    let html = '';\n    if (this.icon) {\n      html += `<span class=\"flex-shrink-0\">${this.icon}</span>`;\n    }\n    html += `<span>${this.label}</span>`;\n\n    itemElement.innerHTML = html;\n    return itemElement;\n  }\n\n  setSelected(selected) {\n    this.selected = selected;\n    if (this.element) {\n      this.attr('aria-selected', selected);\n      this.toggleClass('bg-blue-50 text-blue-600', selected);\n    }\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.attr('disabled', disabled ? '' : null);\n  }\n}\n", "/**\n * Label Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Label extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.text = options.text || '';\n    this.htmlFor = options.htmlFor || '';\n    this.required = options.required || false;\n    this.className = options.className || '';\n  }\n\n  create() {\n    const baseClasses = 'block text-sm font-medium text-gray-700 mb-1';\n\n    const labelElement = super.create('label', {\n      className: clsx(baseClasses, this.className),\n      attrs: { for: this.htmlFor }\n    });\n\n    let html = this.text;\n    if (this.required) {\n      html += ' <span class=\"text-red-500 ml-1\">*</span>';\n    }\n\n    labelElement.innerHTML = html;\n    return labelElement;\n  }\n\n  setText(text) {\n    this.text = text;\n    if (this.element) {\n      let html = text;\n      if (this.required) {\n        html += ' <span class=\"text-red-500 ml-1\">*</span>';\n      }\n      this.element.innerHTML = html;\n    }\n  }\n\n  setRequired(required) {\n    this.required = required;\n    if (this.element) {\n      const requiredSpan = this.element.querySelector('[class*=\"text-red\"]');\n      if (required && !requiredSpan) {\n        this.element.innerHTML += ' <span class=\"text-red-500 ml-1\">*</span>';\n      } else if (!required && requiredSpan) {\n        requiredSpan.remove();\n      }\n    }\n  }\n}\n", "/**\n * Kbd Component (Keyboard Key)\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Kbd extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || 'K';\n    this.className = options.className || '';\n  }\n\n  create() {\n    const baseClasses = 'px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-semibold text-gray-900 inline-block font-mono';\n\n    const kbdElement = super.create('kbd', {\n      className: clsx(baseClasses, this.className)\n    });\n\n    kbdElement.textContent = this.label;\n    return kbdElement;\n  }\n\n  setLabel(label) {\n    this.label = label;\n    if (this.element) {\n      this.element.textContent = label;\n    }\n  }\n}\n", "/**\n * Native Select Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class NativeSelect extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.items = options.items || []; // Array of {label, value}\n    this.selected = options.selected || '';\n    this.placeholder = options.placeholder || 'Select...';\n    this.disabled = options.disabled || false;\n    this.required = options.required || false;\n    this.name = options.name || '';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n  }\n\n  create() {\n    const baseClasses = 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed bg-white appearance-none cursor-pointer';\n\n    const selectElement = super.create('select', {\n      className: clsx(baseClasses, this.className),\n      attrs: {\n        disabled: this.disabled ? '' : null,\n        required: this.required ? '' : null,\n        ...(this.name && { name: this.name })\n      }\n    });\n\n    // Add placeholder option\n    if (this.placeholder) {\n      const placeholderOption = document.createElement('option');\n      placeholderOption.value = '';\n      placeholderOption.textContent = this.placeholder;\n      placeholderOption.disabled = true;\n      selectElement.appendChild(placeholderOption);\n    }\n\n    // Add items\n    this.items.forEach(item => {\n      const optionElement = document.createElement('option');\n      optionElement.value = item.value;\n      optionElement.textContent = item.label;\n      if (item.value === this.selected) {\n        optionElement.selected = true;\n      }\n      selectElement.appendChild(optionElement);\n    });\n\n    if (this.onChange) {\n      this.on('change', this.onChange);\n    }\n\n    return selectElement;\n  }\n\n  getValue() {\n    return this.element?.value || '';\n  }\n\n  setValue(value) {\n    this.selected = value;\n    if (this.element) {\n      this.element.value = value;\n    }\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.attr('disabled', disabled ? '' : null);\n  }\n\n  addItem(label, value) {\n    if (this.element) {\n      const option = document.createElement('option');\n      option.value = value;\n      option.textContent = label;\n      this.element.appendChild(option);\n    }\n  }\n\n  removeItem(value) {\n    if (this.element) {\n      const option = this.element.querySelector(`option[value=\"${value}\"]`);\n      if (option) {\n        option.remove();\n      }\n    }\n  }\n}\n", "/**\n * Tooltip Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Tooltip extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.content = options.content || '';\n    this.position = options.position || 'top'; // top, bottom, left, right\n    this.delay = options.delay || 200;\n    this.trigger = options.trigger || 'hover'; // hover, focus, manual\n    this.className = options.className || '';\n    this.visible = false;\n    this.timeoutId = null;\n  }\n\n  create() {\n    const containerElement = super.create('div', {\n      className: 'relative inline-block'\n    });\n\n    // Tooltip content\n    const tooltipElement = document.createElement('div');\n    tooltipElement.className = clsx(\n      'absolute hidden bg-gray-900 text-white px-3 py-2 rounded text-sm whitespace-nowrap z-50',\n      'opacity-0 transition-opacity duration-200',\n      this.getPositionClasses(),\n      this.className\n    );\n    tooltipElement.textContent = this.content;\n\n    // Arrow\n    const arrow = document.createElement('div');\n    arrow.className = clsx(\n      'absolute w-2 h-2 bg-gray-900 transform rotate-45',\n      this.getArrowClasses()\n    );\n    tooltipElement.appendChild(arrow);\n\n    containerElement.appendChild(tooltipElement);\n\n    this.tooltipElement = tooltipElement;\n\n    // Handle trigger\n    if (this.trigger === 'hover') {\n      containerElement.addEventListener('mouseenter', () => this.show());\n      containerElement.addEventListener('mouseleave', () => this.hide());\n    } else if (this.trigger === 'focus') {\n      containerElement.addEventListener('focus', () => this.show(), true);\n      containerElement.addEventListener('blur', () => this.hide(), true);\n    }\n\n    return containerElement;\n  }\n\n  getPositionClasses() {\n    const positions = {\n      top: 'bottom-full left-1/2 transform -translate-x-1/2 mb-2',\n      bottom: 'top-full left-1/2 transform -translate-x-1/2 mt-2',\n      left: 'right-full top-1/2 transform -translate-y-1/2 mr-2',\n      right: 'left-full top-1/2 transform -translate-y-1/2 ml-2'\n    };\n    return positions[this.position] || positions.top;\n  }\n\n  getArrowClasses() {\n    const arrowPositions = {\n      top: 'top-full left-1/2 transform -translate-x-1/2 -translate-y-1/2',\n      bottom: 'bottom-full left-1/2 transform -translate-x-1/2 translate-y-1/2',\n      left: 'left-full top-1/2 transform translate-x-1/2 -translate-y-1/2',\n      right: 'right-full top-1/2 transform -translate-x-1/2 -translate-y-1/2'\n    };\n    return arrowPositions[this.position] || arrowPositions.top;\n  }\n\n  show() {\n    if (this.visible) return;\n\n    this.timeoutId = setTimeout(() => {\n      this.visible = true;\n      this.tooltipElement.classList.remove('hidden');\n      this.tooltipElement.classList.add('opacity-100');\n    }, this.delay);\n  }\n\n  hide() {\n    if (!this.visible) return;\n\n    clearTimeout(this.timeoutId);\n    this.visible = false;\n    this.tooltipElement.classList.remove('opacity-100');\n    this.tooltipElement.classList.add('hidden');\n  }\n\n  setContent(content) {\n    this.content = content;\n    if (this.tooltipElement) {\n      this.tooltipElement.textContent = content;\n    }\n  }\n}\n", "/**\n * Toggle Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx } from './utils.js';\n\nexport class Toggle extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.label = options.label || '';\n    this.pressed = options.pressed || false;\n    this.disabled = options.disabled || false;\n    this.variant = options.variant || 'default'; // default, outline\n    this.size = options.size || 'md'; // sm, md, lg\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n  }\n\n  create() {\n    const baseClasses = 'px-4 py-2 font-medium rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';\n    \n    const variantClasses = {\n      default: this.pressed \n        ? 'bg-gray-900 text-white' \n        : 'bg-gray-100 text-gray-900 hover:bg-gray-200',\n      outline: this.pressed\n        ? 'border-2 border-gray-900 bg-gray-900 text-white'\n        : 'border-2 border-gray-300 text-gray-900 hover:bg-gray-50'\n    };\n\n    const sizeClasses = {\n      sm: 'px-2 py-1 text-sm',\n      md: 'px-4 py-2 text-base',\n      lg: 'px-6 py-3 text-lg'\n    };\n\n    const toggleElement = super.create('button', {\n      className: clsx(\n        baseClasses,\n        variantClasses[this.variant],\n        sizeClasses[this.size],\n        this.className\n      ),\n      attrs: { \n        'aria-pressed': this.pressed,\n        disabled: this.disabled ? '' : null\n      }\n    });\n\n    toggleElement.textContent = this.label;\n\n    this.on('click', () => {\n      this.toggle();\n    });\n\n    return toggleElement;\n  }\n\n  isPressed() {\n    return this.pressed;\n  }\n\n  setPressed(pressed) {\n    this.pressed = pressed;\n    if (this.element) {\n      this.attr('aria-pressed', pressed);\n      this.toggleClass('bg-gray-900 text-white', pressed);\n      if (this.onChange) {\n        this.onChange(pressed);\n      }\n    }\n  }\n\n  toggle() {\n    this.setPressed(!this.pressed);\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.attr('disabled', disabled ? '' : null);\n  }\n}\n", "/**\n * Toggle Group Component\n */\n\nimport { BaseComponent } from './BaseComponent.js';\nimport { clsx, createElement } from './utils.js';\n\nexport class ToggleGroup extends BaseComponent {\n  constructor(options = {}) {\n    super(options);\n    \n    this.items = options.items || []; // Array of {label, value}\n    this.selected = options.selected || null;\n    this.multiple = options.multiple || false;\n    this.orientation = options.orientation || 'horizontal';\n    this.className = options.className || '';\n    this.onChange = options.onChange || null;\n  }\n\n  create() {\n    const orientationClass = this.orientation === 'vertical' ? 'flex-col' : 'flex-row';\n    const baseClasses = 'inline-flex border border-gray-300 rounded-md overflow-hidden';\n\n    const groupElement = super.create('div', {\n      className: clsx('flex', orientationClass, baseClasses, this.className),\n      attrs: { role: 'group' }\n    });\n\n    this.toggleButtons = [];\n\n    this.items.forEach((item, index) => {\n      const isSelected = this.multiple \n        ? (Array.isArray(this.selected) && this.selected.includes(item.value))\n        : item.value === this.selected;\n\n      const btnClasses = clsx(\n        'flex-1 px-4 py-2 font-medium transition-colors duration-200',\n        isSelected ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50',\n        index > 0 ? (this.orientation === 'vertical' ? 'border-t border-gray-300' : 'border-l border-gray-300') : ''\n      );\n\n      const btn = createElement('button', {\n        className: btnClasses,\n        text: item.label,\n        attrs: {\n          'data-value': item.value,\n          'aria-pressed': isSelected,\n          type: 'button'\n        }\n      });\n\n      btn.addEventListener('click', () => {\n        if (this.multiple) {\n          if (!Array.isArray(this.selected)) this.selected = [];\n          const index = this.selected.indexOf(item.value);\n          if (index > -1) {\n            this.selected.splice(index, 1);\n          } else {\n            this.selected.push(item.value);\n          }\n        } else {\n          this.selected = item.value;\n        }\n        this.updateView();\n        if (this.onChange) {\n          this.onChange(this.selected);\n        }\n      });\n\n      groupElement.appendChild(btn);\n      this.toggleButtons.push(btn);\n    });\n\n    return groupElement;\n  }\n\n  updateView() {\n    this.toggleButtons.forEach(btn => {\n      const value = btn.getAttribute('data-value');\n      const isSelected = this.multiple\n        ? (Array.isArray(this.selected) && this.selected.includes(value))\n        : value === this.selected;\n\n      btn.setAttribute('aria-pressed', isSelected);\n      btn.className = clsx(\n        'flex-1 px-4 py-2 font-medium transition-colors duration-200',\n        isSelected ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'\n      );\n    });\n  }\n\n  getValue() {\n    return this.selected;\n  }\n\n  setValue(value) {\n    this.selected = value;\n    this.updateView();\n  }\n}\n", "/**\r\n * Toast/Sonner Component\r\n */\r\n\r\nimport { BaseComponent } from './BaseComponent.js';\r\nimport { clsx, createElement } from './utils.js';\r\n\r\nexport class Toast extends BaseComponent {\r\n  constructor(options = {}) {\r\n    super(options);\r\n    \r\n    this.message = options.message || '';\r\n    this.type = options.type || 'default'; // default, success, error, warning, info\r\n    // On mobile, shorten toast duration slightly for faster UX\r\n    if (typeof options.duration !== 'undefined') {\r\n      this.duration = options.duration;\r\n    } else {\r\n      this.duration = (typeof window !== 'undefined' && window.innerWidth < 640) ? 2500 : 3000;\r\n    }\r\n    this.position = options.position || 'top-right'; // top-left, top-right, bottom-left, bottom-right, top-center\r\n    this.className = options.className || '';\r\n    this.onClose = options.onClose || null;\r\n  }\r\n\r\n  destroy() {\r\n    if (!this.element) return;\r\n    const el = this.element;\r\n    // Play exit animation, then cleanup\r\n    el.classList.add(this.getExitAnimationClass());\r\n    const onDone = () => {\r\n      el.removeEventListener('animationend', onDone);\r\n      // Remove and cleanup via BaseComponent\r\n      super.destroy();\r\n      // If container becomes empty, remove it\r\n      const container = Toast.getContainer(this.position);\r\n      if (container && container.childElementCount === 0 && container.parentNode) {\r\n        container.parentNode.removeChild(container);\r\n        if (Toast._containers) {\r\n          delete Toast._containers[this.position || 'top-right'];\r\n        }\r\n      }\r\n    };\r\n    el.addEventListener('animationend', onDone);\r\n    // Fallback in case animationend doesn\u2019t fire\r\n    setTimeout(onDone, 320);\r\n  }\r\n\r\n  static getContainer(position) {\r\n    const key = position || 'top-right';\r\n    if (!this._containers) this._containers = {};\r\n    if (this._containers[key] && document.body.contains(this._containers[key])) {\r\n      return this._containers[key];\r\n    }\r\n    const container = createElement('div', {\r\n      className: clsx(\r\n        'fixed z-50 p-2 flex flex-col gap-2 pointer-events-none',\r\n        this.getPositionClassesForContainer(key)\r\n      )\r\n    });\r\n    document.body.appendChild(container);\r\n    this._containers[key] = container;\r\n    return container;\r\n  }\r\n\r\n  static getPositionClassesForContainer(position) {\r\n    switch (position) {\r\n      case 'top-left':\r\n        return 'top-4 left-4 items-start';\r\n      case 'top-right':\r\n        return 'top-4 right-4 items-end';\r\n      case 'bottom-left':\r\n        return 'bottom-4 left-4 items-start';\r\n      case 'bottom-right':\r\n        return 'bottom-4 right-4 items-end';\r\n      case 'top-center':\r\n        return 'top-4 left-1/2 -translate-x-1/2 items-center transform';\r\n      default:\r\n        return 'top-4 right-4 items-end';\r\n    }\r\n  }\r\n\r\n  create() {\r\n    const containerElement = Toast.getContainer(this.position);\r\n\r\n    const toastElement = createElement('div', {\r\n      className: clsx(\r\n        // Allow wrapping on small screens, limit max width for mobile, keep compact padding\r\n        'rounded-lg shadow-lg p-2.5 flex items-center gap-2 min-w-0 max-w-[90vw] sm:max-w-sm bg-opacity-95',\r\n        this.getEnterAnimationClass(),\r\n        this.getTypeClasses(),\r\n        this.className\r\n      )\r\n    });\r\n\r\n    // Icon\r\n    const iconElement = createElement('span', {\r\n      className: 'text-base flex-shrink-0',\r\n      text: this.getIcon()\r\n    });\r\n    toastElement.appendChild(iconElement);\r\n\r\n    // Message\r\n    const messageElement = createElement('span', {\r\n      text: this.message,\r\n      // Slightly smaller text on mobile, readable on larger screens\r\n      className: 'flex-1 text-sm sm:text-base'\r\n    });\r\n    toastElement.appendChild(messageElement);\r\n\r\n    // Add ARIA for assistive technologies\r\n    toastElement.setAttribute('role', this.type === 'error' ? 'alert' : 'status');\r\n    toastElement.setAttribute('aria-live', this.type === 'error' ? 'assertive' : 'polite');\r\n\r\n    // Close button\r\n    const closeBtn = createElement('button', {\r\n      className: 'text-base hover:opacity-70 transition-opacity flex-shrink-0',\r\n      text: '\u00D7'\r\n    });\r\n\r\n    closeBtn.setAttribute('aria-label', 'Dismiss notification');\r\n    closeBtn.addEventListener('click', () => {\r\n      this.destroy();\r\n    });\r\n\r\n    toastElement.appendChild(closeBtn);\r\n\r\n    // Set element and append to shared container\r\n    this.element = toastElement;\r\n    containerElement.appendChild(this.element);\r\n\r\n    // Enforce max visible toasts (3). Remove oldest if exceeded.\r\n    while (containerElement.children.length > 3) {\r\n      containerElement.removeChild(containerElement.firstElementChild);\r\n    }\r\n\r\n    // Auto close\r\n    if (this.duration > 0) {\r\n      setTimeout(() => {\r\n        this.destroy();\r\n      }, this.duration);\r\n    }\r\n\r\n    return this.element;\r\n  }\r\n\r\n  getEnterAnimationClass() {\r\n    const pos = this.position || 'top-right';\r\n    if (pos === 'top-right' || pos === 'bottom-right') return 'animate-slide-in-right transition-all duration-300 pointer-events-auto';\r\n    if (pos === 'top-left' || pos === 'bottom-left') return 'animate-slide-in-left transition-all duration-300 pointer-events-auto';\r\n    return 'animate-slide-in-top transition-all duration-300 pointer-events-auto';\r\n  }\r\n\r\n  getExitAnimationClass() {\r\n    const pos = this.position || 'top-right';\r\n    if (pos === 'top-right' || pos === 'bottom-right') return 'animate-slide-out-right';\r\n    if (pos === 'top-left' || pos === 'bottom-left') return 'animate-slide-out-left';\r\n    return 'animate-slide-out-top';\r\n  }\r\n\r\n  getPositionClasses() {\r\n    const positions = {\r\n      'top-left': 'top-4 left-4',\r\n      'top-right': 'top-4 right-4',\r\n      'bottom-left': 'bottom-4 left-4',\r\n      'bottom-right': 'bottom-4 right-4',\r\n      'top-center': 'top-4 left-1/2 -translate-x-1/2 transform'\r\n    };\r\n    return positions[this.position] || positions['bottom-right'];\r\n  }\r\n\r\n  getTypeClasses() {\r\n    const types = {\r\n      default: 'bg-gray-900 text-white',\r\n      success: 'bg-green-600 text-white',\r\n      error: 'bg-red-600 text-white',\r\n      warning: 'bg-yellow-600 text-white',\r\n      info: 'bg-blue-600 text-white'\r\n    };\r\n    return types[this.type] || types.default;\r\n  }\r\n\r\n  getIcon() {\r\n    const icons = {\r\n      default: '\u2139',\r\n      success: '\u2713',\r\n      error: '\u2715',\r\n      warning: '\u26A0',\r\n      info: '\u2139'\r\n    };\r\n    return icons[this.type] || icons.default;\r\n  }\r\n\r\n  static show(message, options = {}) {\r\n    const toast = new Toast({ message, ...options });\r\n    const element = toast.create();\r\n    return toast;\r\n  }\r\n\r\n  // Convenience helpers\r\n  static success(message, options = {}) { return this.show(message, { ...options, type: 'success' }); }\r\n  static error(message, options = {}) { return this.show(message, { ...options, type: 'error', position: options.position || 'top-right' }); }\r\n  static info(message, options = {}) { return this.show(message, { ...options, type: 'info' }); }\r\n  static warning(message, options = {}) { return this.show(message, { ...options, type: 'warning' }); }\r\n}\r\n\r\n// Add CSS animation\r\nif (!document.querySelector('style[data-toast]')) {\r\n  const style = document.createElement('style');\r\n  style.setAttribute('data-toast', 'true');\r\n  style.textContent = `\r\n    @keyframes slideInTop {\r\n      from { transform: translateY(-12px); opacity: 0; }\r\n      to { transform: translateY(0); opacity: 1; }\r\n    }\r\n    .animate-slide-in-top { animation: slideInTop 0.25s ease-out; }\r\n\r\n    @keyframes slideOutTop {\r\n      from { transform: translateY(0); opacity: 1; }\r\n      to { transform: translateY(-12px); opacity: 0; }\r\n    }\r\n    .animate-slide-out-top { animation: slideOutTop 0.2s ease-in forwards; }\r\n\r\n    @keyframes slideInRight {\r\n      from { transform: translateX(16px); opacity: 0; }\r\n      to { transform: translateX(0); opacity: 1; }\r\n    }\r\n    .animate-slide-in-right { animation: slideInRight 0.25s ease-out; }\r\n\r\n    @keyframes slideOutRight {\r\n      from { transform: translateX(0); opacity: 1; }\r\n      to { transform: translateX(16px); opacity: 0; }\r\n    }\r\n    .animate-slide-out-right { animation: slideOutRight 0.2s ease-in forwards; }\r\n\r\n    @keyframes slideInLeft {\r\n      from { transform: translateX(-16px); opacity: 0; }\r\n      to { transform: translateX(0); opacity: 1; }\r\n    }\r\n    .animate-slide-in-left { animation: slideInLeft 0.25s ease-out; }\r\n\r\n    @keyframes slideOutLeft {\r\n      from { transform: translateX(0); opacity: 1; }\r\n      to { transform: translateX(-16px); opacity: 0; }\r\n    }\r\n    .animate-slide-out-left { animation: slideOutLeft 0.2s ease-in forwards; }\r\n  `;\r\n  document.head.appendChild(style);\r\n}\r\n", "// Lazy hydration utility\r\n// Usage: add `data-hydrate=\"components/Carousel.js#init\"` to an element\r\n// Module path is relative to static/js (e.g. components/Carousel.js)\r\n// After the `#` is the exported initializer name (defaults to `init`).\r\nconst MODULE_REGISTRY = {\r\n  // Components\r\n  'components/Alert.js': () => import('../components/Alert.js'),\r\n  'components/AlertDialog.js': () => import('../components/AlertDialog.js'),\r\n  'components/Avatar.js': () => import('../components/Avatar.js'),\r\n  'components/Badge.js': () => import('../components/Badge.js'),\r\n  'components/Button.js': () => import('../components/Button.js'),\r\n  'components/ButtonGroup.js': () => import('../components/ButtonGroup.js'),\r\n  'components/Breadcrumb.js': () => import('../components/Breadcrumb.js'),\r\n  'components/Card.js': () => import('../components/Card.js'),\r\n  'components/Carousel.js': () => import('../components/Carousel.js'),\r\n  'components/Chart.js': () => import('../components/Chart.js'),\r\n  'components/Checkbox.js': () => import('../components/Checkbox.js'),\r\n  'components/Collapsible.js': () => import('../components/Collapsible.js'),\r\n  'components/Command.js': () => import('../components/Command.js'),\r\n  'components/Combobox.js': () => import('../components/Combobox.js'),\r\n  'components/ContextMenu.js': () => import('../components/ContextMenu.js'),\r\n  'components/DatePicker.js': () => import('../components/DatePicker.js'),\r\n  'components/Dialog.js': () => import('../components/Dialog.js'),\r\n  'components/DropdownMenu.js': () => import('../components/DropdownMenu.js'),\r\n  'components/Drawer.js': () => import('../components/Drawer.js'),\r\n  'components/Empty.js': () => import('../components/Empty.js'),\r\n  'components/Form.js': () => import('../components/Form.js'),\r\n  'components/HoverCard.js': () => import('../components/HoverCard.js'),\r\n  'components/Input.js': () => import('../components/Input.js'),\r\n  'components/InputGroup.js': () => import('../components/InputGroup.js'),\r\n  'components/InputOTP.js': () => import('../components/InputOTP.js'),\r\n  'components/Item.js': () => import('../components/Item.js'),\r\n  'components/Label.js': () => import('../components/Label.js'),\r\n  'components/Kbd.js': () => import('../components/Kbd.js'),\r\n  'components/NativeSelect.js': () => import('../components/NativeSelect.js'),\r\n  'components/Tooltip.js': () => import('../components/Tooltip.js'),\r\n  'components/Toggle.js': () => import('../components/Toggle.js'),\r\n  'components/ToggleGroup.js': () => import('../components/ToggleGroup.js'),\r\n  'components/Toast.js': () => import('../components/Toast.js'),\r\n\r\n  // Add other components as needed\r\n};\r\n\r\nexport function initLazyHydration({root = document, selector = '[data-hydrate]', threshold = 0.15} = {}) {\r\n  if (typeof IntersectionObserver === 'undefined') return;\r\n  const observer = new IntersectionObserver(async (entries, obs) => {\r\n    for (const entry of entries) {\r\n      if (!entry.isIntersecting) continue;\r\n      const el = entry.target;\r\n      const spec = el.dataset.hydrate || '';\r\n      const [modulePath, initName = 'init'] = spec.split('#');\r\n      if (!modulePath) { obs.unobserve(el); continue; }\r\n      try {\r\n        let mod = null;\r\n        const loader = MODULE_REGISTRY[modulePath];\r\n        if (typeof loader === 'function') {\r\n          mod = await loader();\r\n        } else {\r\n          // Not registered: skip importing arbitrary files to avoid bundler resolving non-JS assets\r\n          throw new Error('Module not registered for lazy hydration: ' + modulePath);\r\n        }\r\n        const fn = mod[initName] || mod.default || null;\r\n        if (typeof fn === 'function') {\r\n          try { fn(el); } catch (e) { console.error('hydrate init failed', e); }\r\n        }\r\n      } catch (e) {\r\n        console.error('lazy hydrate import failed for', modulePath, e);\r\n      } finally {\r\n        obs.unobserve(el);\r\n      }\r\n    }\r\n  }, {threshold});\r\n  root.querySelectorAll(selector).forEach(el => observer.observe(el));\r\n}\r\n", "/**\n * Account Page - Enhanced with Advanced Features\n * @module pages/account\n */\n\nconst AccountPage = (function() {\n    'use strict';\n\n    let currentUser = null;\n\n    async function init() {\n        // Ensure this page is protected and redirect to login if the user is not authenticated\n        if (!AuthGuard.protectPage()) return;\n\n        await loadUserProfile();\n        // Ensure avatar handlers are bound even when renderProfile cannot inject the header (e.g., server-rendered sidebar present)\n        try {\n            setupAvatarHandlers();\n        } catch (e) {\n            // ignore\n        }\n        initProfileTabs();\n        initProfileForm();\n        initPasswordForm();\n        initAddressManagement();\n        initEnhancedFeatures();\n    }\n\n    // ============================================\n    // ENHANCED FEATURES INITIALIZATION\n    // ============================================\n    function initEnhancedFeatures() {\n        initLoyaltyPoints();\n        initQuickStats();\n        initRecentActivity();\n        initNotificationPreferences();\n        initQuickReorder();\n        initAccountSecurityCheck();\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Loyalty Points Display\n    // ============================================\n    function initLoyaltyPoints() {\n        const container = document.getElementById('loyalty-points');\n        if (!container) return;\n\n        // Mock data - replace with API call in production\n        const points = currentUser?.loyalty_points || Math.floor(Math.random() * 500) + 100;\n        const tier = points >= 500 ? 'Gold' : points >= 200 ? 'Silver' : 'Bronze';\n        const tierColors = {\n            Bronze: 'from-amber-600 to-amber-700',\n            Silver: 'from-gray-400 to-gray-500',\n            Gold: 'from-yellow-400 to-yellow-500'\n        };\n        const nextTier = tier === 'Gold' ? null : tier === 'Silver' ? 'Gold' : 'Silver';\n        const nextTierPoints = tier === 'Gold' ? 0 : tier === 'Silver' ? 500 : 200;\n        const progress = nextTier ? Math.min(100, (points / nextTierPoints) * 100) : 100;\n\n        container.innerHTML = `\n            <div class=\"bg-gradient-to-br ${tierColors[tier]} rounded-2xl p-6 text-white relative overflow-hidden\">\n                <div class=\"absolute top-0 right-0 w-32 h-32 opacity-10\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"w-full h-full\">\n                        <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                    </svg>\n                </div>\n                <div class=\"relative\">\n                    <div class=\"flex items-center justify-between mb-4\">\n                        <div>\n                            <p class=\"text-white/80 text-sm font-medium\">${tier} Member</p>\n                            <p class=\"text-3xl font-bold\">${points.toLocaleString()} pts</p>\n                        </div>\n                        <div class=\"w-14 h-14 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n                            <svg class=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\n                            </svg>\n                        </div>\n                    </div>\n                    ${nextTier ? `\n                        <div class=\"mt-4\">\n                            <div class=\"flex justify-between text-sm mb-1\">\n                                <span>${nextTierPoints - points} points to ${nextTier}</span>\n                                <span>${Math.round(progress)}%</span>\n                            </div>\n                            <div class=\"w-full bg-white/30 rounded-full h-2\">\n                                <div class=\"bg-white h-2 rounded-full transition-all duration-500\" style=\"width: ${progress}%\"></div>\n                            </div>\n                        </div>\n                    ` : '<p class=\"text-sm text-white/80 mt-2\">\uD83C\uDF89 You\\'ve reached the highest tier!</p>'}\n                    <div class=\"mt-4 pt-4 border-t border-white/20\">\n                        <a href=\"/loyalty/\" class=\"text-sm font-medium hover:underline flex items-center gap-1\">\n                            View Rewards\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/></svg>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Quick Stats\n    // ============================================\n    function initQuickStats() {\n        const container = document.getElementById('quick-stats');\n        if (!container) return;\n\n        // Mock data - replace with API call\n        const stats = {\n            totalOrders: currentUser?.total_orders || Math.floor(Math.random() * 20) + 5,\n            totalSpent: currentUser?.total_spent || Math.floor(Math.random() * 1000) + 200,\n            wishlistItems: currentUser?.wishlist_count || Math.floor(Math.random() * 10) + 2,\n            savedAddresses: currentUser?.address_count || Math.floor(Math.random() * 3) + 1\n        };\n\n        container.innerHTML = `\n            <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div class=\"bg-white dark:bg-stone-800 rounded-xl p-4 border border-gray-100 dark:border-stone-700\">\n                    <div class=\"flex items-center gap-3\">\n                        <div class=\"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center\">\n                            <svg class=\"w-5 h-5 text-blue-600 dark:text-blue-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/></svg>\n                        </div>\n                        <div>\n                            <p class=\"text-2xl font-bold text-stone-900 dark:text-white\">${stats.totalOrders}</p>\n                            <p class=\"text-xs text-stone-500 dark:text-stone-400\">Total Orders</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"bg-white dark:bg-stone-800 rounded-xl p-4 border border-gray-100 dark:border-stone-700\">\n                    <div class=\"flex items-center gap-3\">\n                        <div class=\"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center\">\n                            <svg class=\"w-5 h-5 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>\n                        </div>\n                        <div>\n                            <p class=\"text-2xl font-bold text-stone-900 dark:text-white\">${Templates.formatPrice(stats.totalSpent)}</p>\n                            <p class=\"text-xs text-stone-500 dark:text-stone-400\">Total Spent</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"bg-white dark:bg-stone-800 rounded-xl p-4 border border-gray-100 dark:border-stone-700\">\n                    <div class=\"flex items-center gap-3\">\n                        <div class=\"w-10 h-10 bg-rose-100 dark:bg-rose-900/30 rounded-lg flex items-center justify-center\">\n                            <svg class=\"w-5 h-5 text-rose-600 dark:text-rose-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/></svg>\n                        </div>\n                        <div>\n                            <p class=\"text-2xl font-bold text-stone-900 dark:text-white\">${stats.wishlistItems}</p>\n                            <p class=\"text-xs text-stone-500 dark:text-stone-400\">Wishlist Items</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"bg-white dark:bg-stone-800 rounded-xl p-4 border border-gray-100 dark:border-stone-700\">\n                    <div class=\"flex items-center gap-3\">\n                        <div class=\"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center\">\n                            <svg class=\"w-5 h-5 text-purple-600 dark:text-purple-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/></svg>\n                        </div>\n                        <div>\n                            <p class=\"text-2xl font-bold text-stone-900 dark:text-white\">${stats.savedAddresses}</p>\n                            <p class=\"text-xs text-stone-500 dark:text-stone-400\">Saved Addresses</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Recent Activity\n    // ============================================\n    async function initRecentActivity() {\n        const container = document.getElementById('recent-activity');\n        if (!container) return;\n\n        try {\n            // Load recent orders\n            const response = await OrdersApi.getAll({ limit: 3 });\n            const orders = response.data || [];\n\n            if (orders.length === 0) {\n                container.innerHTML = `\n                    <div class=\"text-center py-6 text-stone-500 dark:text-stone-400\">\n                        <p>No recent activity</p>\n                    </div>\n                `;\n                return;\n            }\n\n            container.innerHTML = `\n                <div class=\"bg-white dark:bg-stone-800 rounded-xl border border-gray-100 dark:border-stone-700 overflow-hidden\">\n                    <div class=\"px-4 py-3 border-b border-gray-100 dark:border-stone-700 flex items-center justify-between\">\n                        <h3 class=\"font-semibold text-stone-900 dark:text-white\">Recent Orders</h3>\n                        <a href=\"/orders/\" class=\"text-sm text-primary-600 dark:text-amber-400 hover:underline\">View All</a>\n                    </div>\n                    <div class=\"divide-y divide-gray-100 dark:divide-stone-700\">\n                        ${orders.map(order => {\n                            const statusColors = {\n                                pending: 'text-yellow-600 dark:text-yellow-400',\n                                processing: 'text-blue-600 dark:text-blue-400',\n                                shipped: 'text-indigo-600 dark:text-indigo-400',\n                                delivered: 'text-green-600 dark:text-green-400',\n                                cancelled: 'text-red-600 dark:text-red-400'\n                            };\n                            const statusColor = statusColors[order.status] || 'text-stone-600 dark:text-stone-400';\n                            const firstItem = order.items?.[0];\n                            \n                            return `\n                                <a href=\"/orders/${order.id}/\" class=\"flex items-center gap-4 p-4 hover:bg-stone-50 dark:hover:bg-stone-700/50 transition-colors\">\n                                    <div class=\"w-12 h-12 bg-stone-100 dark:bg-stone-700 rounded-lg overflow-hidden flex-shrink-0\">\n                                        ${firstItem?.product?.image ? \n                                            `<img src=\"${firstItem.product.image}\" alt=\"\" class=\"w-full h-full object-cover\">` :\n                                            `<div class=\"w-full h-full flex items-center justify-center text-stone-400\">\n                                                <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/></svg>\n                                            </div>`\n                                        }\n                                    </div>\n                                    <div class=\"flex-1 min-w-0\">\n                                        <p class=\"font-medium text-stone-900 dark:text-white truncate\">Order #${Templates.escapeHtml(order.order_number || order.id)}</p>\n                                        <p class=\"text-sm ${statusColor}\">${Templates.escapeHtml(order.status_display || order.status)}</p>\n                                    </div>\n                                    <div class=\"text-right\">\n                                        <p class=\"font-semibold text-stone-900 dark:text-white\">${Templates.formatPrice(order.total)}</p>\n                                        <p class=\"text-xs text-stone-500 dark:text-stone-400\">${Templates.formatDate(order.created_at)}</p>\n                                    </div>\n                                </a>\n                            `;\n                        }).join('')}\n                    </div>\n                </div>\n            `;\n        } catch (error) {\n            container.innerHTML = '';\n        }\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Notification Preferences\n    // ============================================\n    function initNotificationPreferences() {\n        const container = document.getElementById('notification-preferences');\n        if (!container) return;\n\n        const preferences = JSON.parse(localStorage.getItem('notificationPreferences') || '{}');\n        const defaultPrefs = {\n            orderUpdates: true,\n            promotions: true,\n            newArrivals: false,\n            priceDrops: true,\n            newsletter: false\n        };\n        const prefs = { ...defaultPrefs, ...preferences };\n\n        container.innerHTML = `\n            <div class=\"space-y-4\">\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <p class=\"font-medium text-stone-900 dark:text-white\">Order Updates</p>\n                        <p class=\"text-sm text-stone-500 dark:text-stone-400\">Get notified about your order status</p>\n                    </div>\n                    <label class=\"relative inline-flex items-center cursor-pointer\">\n                        <input type=\"checkbox\" class=\"sr-only peer\" data-pref=\"orderUpdates\" ${prefs.orderUpdates ? 'checked' : ''}>\n                        <div class=\"w-11 h-6 bg-stone-200 dark:bg-stone-600 peer-focus:ring-2 peer-focus:ring-primary-300 dark:peer-focus:ring-amber-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600 dark:peer-checked:bg-amber-500\"></div>\n                    </label>\n                </div>\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <p class=\"font-medium text-stone-900 dark:text-white\">Promotions & Sales</p>\n                        <p class=\"text-sm text-stone-500 dark:text-stone-400\">Be the first to know about deals</p>\n                    </div>\n                    <label class=\"relative inline-flex items-center cursor-pointer\">\n                        <input type=\"checkbox\" class=\"sr-only peer\" data-pref=\"promotions\" ${prefs.promotions ? 'checked' : ''}>\n                        <div class=\"w-11 h-6 bg-stone-200 dark:bg-stone-600 peer-focus:ring-2 peer-focus:ring-primary-300 dark:peer-focus:ring-amber-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600 dark:peer-checked:bg-amber-500\"></div>\n                    </label>\n                </div>\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <p class=\"font-medium text-stone-900 dark:text-white\">Price Drops</p>\n                        <p class=\"text-sm text-stone-500 dark:text-stone-400\">Alert when wishlist items go on sale</p>\n                    </div>\n                    <label class=\"relative inline-flex items-center cursor-pointer\">\n                        <input type=\"checkbox\" class=\"sr-only peer\" data-pref=\"priceDrops\" ${prefs.priceDrops ? 'checked' : ''}>\n                        <div class=\"w-11 h-6 bg-stone-200 dark:bg-stone-600 peer-focus:ring-2 peer-focus:ring-primary-300 dark:peer-focus:ring-amber-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600 dark:peer-checked:bg-amber-500\"></div>\n                    </label>\n                </div>\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <p class=\"font-medium text-stone-900 dark:text-white\">New Arrivals</p>\n                        <p class=\"text-sm text-stone-500 dark:text-stone-400\">Updates on new products</p>\n                    </div>\n                    <label class=\"relative inline-flex items-center cursor-pointer\">\n                        <input type=\"checkbox\" class=\"sr-only peer\" data-pref=\"newArrivals\" ${prefs.newArrivals ? 'checked' : ''}>\n                        <div class=\"w-11 h-6 bg-stone-200 dark:bg-stone-600 peer-focus:ring-2 peer-focus:ring-primary-300 dark:peer-focus:ring-amber-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600 dark:peer-checked:bg-amber-500\"></div>\n                    </label>\n                </div>\n            </div>\n        `;\n\n        // Bind toggle events\n        container.querySelectorAll('input[data-pref]').forEach(input => {\n            input.addEventListener('change', () => {\n                const key = input.dataset.pref;\n                const preferences = JSON.parse(localStorage.getItem('notificationPreferences') || '{}');\n                preferences[key] = input.checked;\n                localStorage.setItem('notificationPreferences', JSON.stringify(preferences));\n                Toast.success('Preference saved');\n            });\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Quick Reorder\n    // ============================================\n    function initQuickReorder() {\n        const container = document.getElementById('quick-reorder');\n        if (!container) return;\n\n        // Get recently ordered products from localStorage\n        const recentProducts = JSON.parse(localStorage.getItem('recentlyOrdered') || '[]');\n\n        if (recentProducts.length === 0) {\n            container.classList.add('hidden');\n            return;\n        }\n\n        container.innerHTML = `\n            <div class=\"bg-white dark:bg-stone-800 rounded-xl border border-gray-100 dark:border-stone-700 p-4\">\n                <h3 class=\"font-semibold text-stone-900 dark:text-white mb-4\">Quick Reorder</h3>\n                <div class=\"flex gap-3 overflow-x-auto pb-2\">\n                    ${recentProducts.slice(0, 5).map(product => `\n                        <button class=\"quick-reorder-btn flex-shrink-0 flex flex-col items-center gap-2 p-3 bg-stone-50 dark:bg-stone-700 rounded-xl hover:bg-stone-100 dark:hover:bg-stone-600 transition-colors\" data-product-id=\"${product.id}\">\n                            <div class=\"w-16 h-16 rounded-lg bg-stone-200 dark:bg-stone-600 overflow-hidden\">\n                                <img src=\"${product.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(product.name)}\" class=\"w-full h-full object-cover\">\n                            </div>\n                            <span class=\"text-xs font-medium text-stone-700 dark:text-stone-300 text-center line-clamp-2 w-20\">${Templates.escapeHtml(product.name)}</span>\n                        </button>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n\n        // Bind quick reorder buttons\n        container.querySelectorAll('.quick-reorder-btn').forEach(btn => {\n            btn.addEventListener('click', async () => {\n                const productId = btn.dataset.productId;\n                btn.disabled = true;\n                \n                try {\n                    await CartApi.addItem(productId, 1);\n                    Toast.success('Added to cart!');\n                    document.dispatchEvent(new CustomEvent('cart:updated'));\n                } catch (error) {\n                    Toast.error('Failed to add to cart');\n                } finally {\n                    btn.disabled = false;\n                }\n            });\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Account Security Check\n    // ============================================\n    function initAccountSecurityCheck() {\n        const container = document.getElementById('security-check');\n        if (!container) return;\n\n        // Calculate security score\n        let score = 0;\n        const checks = [];\n\n        // Email verified\n        const emailVerified = currentUser?.email_verified !== false;\n        if (emailVerified) score += 25;\n        checks.push({ label: 'Email verified', completed: emailVerified });\n\n        // Phone added\n        const hasPhone = !!currentUser?.phone;\n        if (hasPhone) score += 25;\n        checks.push({ label: 'Phone number added', completed: hasPhone });\n\n        // 2FA enabled (mock)\n        const has2FA = currentUser?.two_factor_enabled || false;\n        if (has2FA) score += 25;\n        checks.push({ label: 'Two-factor authentication', completed: has2FA });\n\n        // Strong password (assume if recently changed)\n        const strongPassword = true; // Default to true\n        if (strongPassword) score += 25;\n        checks.push({ label: 'Strong password', completed: strongPassword });\n\n        const scoreColor = score >= 75 ? 'text-green-600 dark:text-green-400' : score >= 50 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400';\n        const progressColor = score >= 75 ? 'bg-green-500' : score >= 50 ? 'bg-yellow-500' : 'bg-red-500';\n\n        container.innerHTML = `\n            <div class=\"bg-white dark:bg-stone-800 rounded-xl border border-gray-100 dark:border-stone-700 p-4\">\n                <div class=\"flex items-center justify-between mb-4\">\n                    <h3 class=\"font-semibold text-stone-900 dark:text-white\">Account Security</h3>\n                    <span class=\"${scoreColor} font-bold\">${score}%</span>\n                </div>\n                <div class=\"w-full bg-stone-200 dark:bg-stone-600 rounded-full h-2 mb-4\">\n                    <div class=\"${progressColor} h-2 rounded-full transition-all duration-500\" style=\"width: ${score}%\"></div>\n                </div>\n                <div class=\"space-y-2\">\n                    ${checks.map(check => `\n                        <div class=\"flex items-center gap-2 text-sm\">\n                            ${check.completed ? \n                                `<svg class=\"w-4 h-4 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/></svg>` :\n                                `<svg class=\"w-4 h-4 text-stone-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\" stroke-width=\"2\"/></svg>`\n                            }\n                            <span class=\"${check.completed ? 'text-stone-700 dark:text-stone-300' : 'text-stone-500 dark:text-stone-400'}\">${check.label}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    async function loadUserProfile() {\n        if (!AuthApi.isAuthenticated()) {\n            // Avoid calling profile API when user is not authenticated\n            return;\n        }\n        try {\n            const response = await AuthApi.getProfile();\n            currentUser = response.data;\n            renderProfile();\n        } catch (error) {\n            // error logging removed\n            Toast.error('Failed to load profile.');\n        }\n    }\n\n    function initProfileTabs() {\n        const tabs = document.querySelectorAll('[data-profile-tab]');\n        const panels = document.querySelectorAll('[data-profile-panel]');\n        if (!tabs.length || !panels.length) return;\n\n        const setActive = (target) => {\n            panels.forEach(panel => {\n                panel.classList.toggle('hidden', panel.dataset.profilePanel !== target);\n            });\n            tabs.forEach(btn => {\n                const isActive = btn.dataset.profileTab === target;\n                btn.classList.toggle('bg-amber-600', isActive);\n                btn.classList.toggle('text-white', isActive);\n                btn.classList.toggle('shadow-sm', isActive);\n                btn.classList.toggle('text-stone-700', !isActive);\n                btn.classList.toggle('dark:text-stone-200', !isActive);\n            });\n            localStorage.setItem('profileTab', target);\n        };\n\n        const initial = localStorage.getItem('profileTab') || 'overview';\n        setActive(initial);\n\n        tabs.forEach(btn => {\n            btn.addEventListener('click', () => {\n                setActive(btn.dataset.profileTab);\n            });\n        });\n    }\n\n    function renderProfile() {\n        const container = document.getElementById('profile-info');\n        if (!container || !currentUser) return;\n\n        const name = `${Templates.escapeHtml(currentUser.first_name || '')} ${Templates.escapeHtml(currentUser.last_name || '')}`.trim() || Templates.escapeHtml(currentUser.email || 'User');\n        const memberSince = Templates.formatDate(currentUser.created_at || currentUser.date_joined);\n        const avatarImg = currentUser.avatar ? `<img id=\"avatar-preview\" src=\"${currentUser.avatar}\" alt=\"Profile\" class=\"w-full h-full object-cover\">` : `\n            <span class=\"flex h-full w-full items-center justify-center text-3xl font-semibold text-stone-500\">\n                ${(currentUser.first_name?.[0] || currentUser.email?.[0] || 'U').toUpperCase()}\n            </span>`;\n\n        container.innerHTML = `\n            <div class=\"absolute inset-0 bg-gradient-to-r from-amber-50/80 via-amber-100/60 to-transparent dark:from-amber-900/20 dark:via-amber-800/10\" aria-hidden=\"true\"></div>\n            <div class=\"relative flex flex-col gap-4 md:flex-row md:items-center md:gap-6\">\n                <div class=\"relative\">\n                    <div class=\"w-24 h-24 rounded-2xl ring-4 ring-amber-100 dark:ring-amber-900/40 overflow-hidden bg-stone-100 dark:bg-stone-800\">\n                        ${avatarImg}\n                    </div>\n                </div>\n                <div class=\"flex-1 min-w-0\">\n                    <p class=\"text-sm font-semibold text-amber-700 dark:text-amber-300\">Profile</p>\n                    <h1 class=\"text-2xl font-bold text-stone-900 dark:text-white leading-tight truncate\">${name}</h1>\n                    <p class=\"text-sm text-stone-600 dark:text-stone-300 truncate\">${Templates.escapeHtml(currentUser.email)}</p>\n                    <p class=\"text-xs text-stone-500 dark:text-stone-400 mt-1\">Member since ${memberSince}</p>\n                    <div class=\"flex flex-wrap gap-2 mt-4\">\n                        <button type=\"button\" id=\"change-avatar-btn\" class=\"btn btn-primary btn-sm\">Update photo</button>\n                        ${currentUser.avatar ? `<button type=\"button\" id=\"remove-avatar-btn\" class=\"btn btn-ghost btn-sm text-red-600 hover:text-red-700 dark:text-red-400\">Remove photo</button>` : ''}\n                    </div>\n                    <p class=\"text-xs text-stone-500 dark:text-stone-400 mt-3\">JPG, GIF or PNG. Max size 5MB.</p>\n                </div>\n            </div>\n        `;\n\n        setupAvatarHandlers();\n    }\n\n    function initTabs() {\n        Tabs.init();\n    }\n\n    function initProfileForm() {\n        const form = document.getElementById('profile-form');\n        if (!form || !currentUser) return;\n\n        const firstNameInput = document.getElementById('profile-first-name');\n        const lastNameInput = document.getElementById('profile-last-name');\n        const emailInput = document.getElementById('profile-email');\n        const phoneInput = document.getElementById('profile-phone');\n\n        if (firstNameInput) firstNameInput.value = currentUser.first_name || '';\n        if (lastNameInput) lastNameInput.value = currentUser.last_name || '';\n        if (emailInput) emailInput.value = currentUser.email || '';\n        if (phoneInput) phoneInput.value = currentUser.phone || '';\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            const formData = new FormData(form);\n            const data = {\n                first_name: formData.get('first_name'),\n                last_name: formData.get('last_name'),\n                phone: formData.get('phone')\n            };\n\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Saving...';\n\n            try {\n                await AuthApi.updateProfile(data);\n                Toast.success('Profile updated successfully!');\n                await loadUserProfile();\n            } catch (error) {\n                Toast.error(error.message || 'Failed to update profile.');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Save Changes';\n            }\n        });\n    }\n\n    function setupAvatarHandlers() {\n        let avatarInput = document.getElementById('avatar-input');\n        const avatarBtn = document.getElementById('change-avatar-btn');\n        const removeBtn = document.getElementById('remove-avatar-btn');\n\n        // If the hidden file input is missing, create it so buttons still work\n        if (!avatarInput) {\n            avatarInput = document.createElement('input');\n            avatarInput.type = 'file';\n            avatarInput.id = 'avatar-input';\n            avatarInput.name = 'avatar';\n            avatarInput.accept = 'image/*';\n            avatarInput.className = 'hidden';\n            document.body.appendChild(avatarInput);\n        }\n\n        // Bind to all elements that may act as avatar trigger (sidebar + main profile)\n        const avatarBtns = document.querySelectorAll('#change-avatar-btn');\n        avatarBtns.forEach(btn => btn.addEventListener('click', () => avatarInput.click()));\n\n        // Bind remove buttons (may be multiple)\n        const removeBtns = document.querySelectorAll('#remove-avatar-btn');\n        removeBtns.forEach(btn => btn.addEventListener('click', () => {\n            if (typeof window.removeAvatar === 'function') {\n                window.removeAvatar();\n            }\n        }));\n\n        // Ensure the handler is not attached multiple times\n        avatarInput.removeEventListener?.('change', window._avatarChangeHandler);\n        window._avatarChangeHandler = async function (e) {\n            const file = e.target.files?.[0];\n            if (!file) return;\n\n            if (!file.type.startsWith('image/')) {\n                Toast.error('Please select an image file.');\n                return;\n            }\n\n            if (file.size > 5 * 1024 * 1024) {\n                Toast.error('Image must be smaller than 5MB.');\n                return;\n            }\n\n            try {\n                await AuthApi.uploadAvatar(file);\n                Toast.success('Avatar updated!');\n                await loadUserProfile();\n            } catch (error) {\n                Toast.error(error.message || 'Failed to update avatar.');\n            }\n        };\n\n        avatarInput.addEventListener('change', window._avatarChangeHandler);\n    }\n\n    function initPasswordForm() {\n        const form = document.getElementById('password-form');\n        if (!form) return;\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            const formData = new FormData(form);\n            const currentPassword = formData.get('current_password');\n            const newPassword = formData.get('new_password');\n            const confirmPassword = formData.get('confirm_password');\n\n            if (newPassword !== confirmPassword) {\n                Toast.error('Passwords do not match.');\n                return;\n            }\n\n            if (newPassword.length < 8) {\n                Toast.error('Password must be at least 8 characters.');\n                return;\n            }\n\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Updating...';\n\n            try {\n                await AuthApi.changePassword(currentPassword, newPassword);\n                Toast.success('Password updated successfully!');\n                form.reset();\n            } catch (error) {\n                Toast.error(error.message || 'Failed to update password.');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Update Password';\n            }\n        });\n    }\n\n    function initAddressManagement() {\n        loadAddresses();\n\n        const addAddressBtn = document.getElementById('add-address-btn');\n        addAddressBtn?.addEventListener('click', () => {\n            showAddressModal();\n        });\n    }\n\n    async function loadAddresses() {\n        const container = document.getElementById('addresses-list');\n        if (!container) return;\n\n        Loader.show(container, 'spinner');\n\n        try {\n            const response = await AuthApi.getAddresses();\n            const addresses = response.data || [];\n\n            if (addresses.length === 0) {\n                container.innerHTML = `\n                    <div class=\"text-center py-8\">\n                        <svg class=\"w-16 h-16 text-gray-300 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                        </svg>\n                        <p class=\"text-gray-500\">No saved addresses yet.</p>\n                    </div>\n                `;\n                return;\n            }\n\n            container.innerHTML = `\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    ${addresses.map(addr => `\n                        <div class=\"p-4 border border-gray-200 rounded-lg relative\" data-address-id=\"${addr.id}\">\n                            ${addr.is_default ? `\n                                <span class=\"absolute top-2 right-2 px-2 py-0.5 bg-primary-100 text-primary-700 text-xs rounded\">Default</span>\n                            ` : ''}\n                            <p class=\"font-medium text-gray-900\">${Templates.escapeHtml(addr.full_name || `${addr.first_name} ${addr.last_name}`)}</p>\n                            <p class=\"text-sm text-gray-600 mt-1\">${Templates.escapeHtml(addr.address_line_1)}</p>\n                            ${addr.address_line_2 ? `<p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.address_line_2)}</p>` : ''}\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.city)}, ${Templates.escapeHtml(addr.state || '')} ${Templates.escapeHtml(addr.postal_code)}</p>\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.country)}</p>\n                            ${addr.phone ? `<p class=\"text-sm text-gray-600 mt-1\">${Templates.escapeHtml(addr.phone)}</p>` : ''}\n                            \n                            <div class=\"mt-4 flex gap-2\">\n                                <button class=\"edit-address-btn text-sm text-primary-600 hover:text-primary-700\" data-address-id=\"${addr.id}\">Edit</button>\n                                ${!addr.is_default ? `\n                                    <button class=\"set-default-btn text-sm text-gray-600 hover:text-gray-700\" data-address-id=\"${addr.id}\">Set as Default</button>\n                                ` : ''}\n                                <button class=\"delete-address-btn text-sm text-red-600 hover:text-red-700\" data-address-id=\"${addr.id}\">Delete</button>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n\n            bindAddressEvents();\n        } catch (error) {\n            console.error('Failed to load addresses:', error);\n            container.innerHTML = '<p class=\"text-red-500\">Failed to load addresses.</p>';\n        }\n    }\n\n    function bindAddressEvents() {\n        document.querySelectorAll('.edit-address-btn').forEach(btn => {\n            btn.addEventListener('click', async () => {\n                const addressId = btn.dataset.addressId;\n                try {\n                    const response = await AuthApi.getAddress(addressId);\n                    showAddressModal(response.data);\n                } catch (error) {\n                    Toast.error('Failed to load address.');\n                }\n            });\n        });\n\n        document.querySelectorAll('.set-default-btn').forEach(btn => {\n            btn.addEventListener('click', async () => {\n                const addressId = btn.dataset.addressId;\n                try {\n                    await AuthApi.setDefaultAddress(addressId);\n                    Toast.success('Default address updated.');\n                    await loadAddresses();\n                } catch (error) {\n                    Toast.error('Failed to update default address.');\n                }\n            });\n        });\n\n        document.querySelectorAll('.delete-address-btn').forEach(btn => {\n            btn.addEventListener('click', async () => {\n                const addressId = btn.dataset.addressId;\n                const confirmed = await Modal.confirm({\n                    title: 'Delete Address',\n                    message: 'Are you sure you want to delete this address?',\n                    confirmText: 'Delete',\n                    cancelText: 'Cancel'\n                });\n\n                if (confirmed) {\n                    try {\n                        await AuthApi.deleteAddress(addressId);\n                        Toast.success('Address deleted.');\n                        await loadAddresses();\n                    } catch (error) {\n                        Toast.error('Failed to delete address.');\n                    }\n                }\n            });\n        });\n    }\n\n    function showAddressModal(address = null) {\n        const isEdit = !!address;\n\n        Modal.open({\n            title: isEdit ? 'Edit Address' : 'Add New Address',\n            content: `\n                <form id=\"address-modal-form\" class=\"space-y-4\">\n                    <div class=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">First Name *</label>\n                            <input type=\"text\" name=\"first_name\" value=\"${address?.first_name || ''}\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Last Name *</label>\n                            <input type=\"text\" name=\"last_name\" value=\"${address?.last_name || ''}\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                        </div>\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Phone</label>\n                        <input type=\"tel\" name=\"phone\" value=\"${address?.phone || ''}\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Address Line 1 *</label>\n                        <input type=\"text\" name=\"address_line_1\" value=\"${address?.address_line_1 || ''}\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 mb-1\">Address Line 2</label>\n                        <input type=\"text\" name=\"address_line_2\" value=\"${address?.address_line_2 || ''}\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                    </div>\n                    <div class=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">City *</label>\n                            <input type=\"text\" name=\"city\" value=\"${address?.city || ''}\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">State/Province</label>\n                            <input type=\"text\" name=\"state\" value=\"${address?.state || ''}\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                        </div>\n                    </div>\n                    <div class=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Postal Code *</label>\n                            <input type=\"text\" name=\"postal_code\" value=\"${address?.postal_code || ''}\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Country *</label>\n                            <select name=\"country\" required class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\n                                <option value=\"\">Select country</option>\n                                <option value=\"BD\" ${address?.country === 'BD' ? 'selected' : ''}>Bangladesh</option>\n                                <option value=\"US\" ${address?.country === 'US' ? 'selected' : ''}>United States</option>\n                                <option value=\"UK\" ${address?.country === 'UK' ? 'selected' : ''}>United Kingdom</option>\n                                <option value=\"CA\" ${address?.country === 'CA' ? 'selected' : ''}>Canada</option>\n                                <option value=\"AU\" ${address?.country === 'AU' ? 'selected' : ''}>Australia</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div>\n                        <label class=\"flex items-center\">\n                            <input type=\"checkbox\" name=\"is_default\" ${address?.is_default ? 'checked' : ''} class=\"text-primary-600 focus:ring-primary-500 rounded\">\n                            <span class=\"ml-2 text-sm text-gray-600\">Set as default address</span>\n                        </label>\n                    </div>\n                </form>\n            `,\n            confirmText: isEdit ? 'Save Changes' : 'Add Address',\n            onConfirm: async () => {\n                const form = document.getElementById('address-modal-form');\n                const formData = new FormData(form);\n                const data = {\n                    first_name: formData.get('first_name'),\n                    last_name: formData.get('last_name'),\n                    phone: formData.get('phone'),\n                    address_line_1: formData.get('address_line_1'),\n                    address_line_2: formData.get('address_line_2'),\n                    city: formData.get('city'),\n                    state: formData.get('state'),\n                    postal_code: formData.get('postal_code'),\n                    country: formData.get('country'),\n                    is_default: formData.get('is_default') === 'on'\n                };\n\n                try {\n                    if (isEdit) {\n                        await AuthApi.updateAddress(address.id, data);\n                        Toast.success('Address updated!');\n                    } else {\n                        await AuthApi.addAddress(data);\n                        Toast.success('Address added!');\n                    }\n                    await loadAddresses();\n                    return true;\n                } catch (error) {\n                    Toast.error(error.message || 'Failed to save address.');\n                    return false;\n                }\n            }\n        });\n    }\n\n    function destroy() {\n        currentUser = null;\n    }\n\n    return {\n        init,\n        destroy\n    };\n})();\n\nwindow.AccountPage = AccountPage;\nexport default AccountPage;\n", "/**\r\n * Cart Page - Enhanced with Advanced E-commerce Features\r\n * @module pages/cart\r\n */\r\n\r\nconst CartPage = (function() {\r\n    'use strict';\r\n\r\n    let cart = null;\n    let savedForLater = [];\n    let abandonedCartTimer = null;\n    let giftState = null;\n    const ABANDONED_CART_DELAY = 60000; // 1 minute for demo (use 30min in production)\n    const BOUND_ATTR = 'data-bound';\n\r\n    // Single-currency mode: use server-provided currency via Templates and `window.BUNORAA_CURRENCY`.\r\n    function setActiveCurrency(/* currency */) {\r\n        // No-op in single-currency mode - retained for backward compatibility\r\n    }\r\n\r\n    function parseAmount(value) {\r\n        if (value === null || value === undefined || value === '') return 0;\r\n        if (typeof value === 'number' && Number.isFinite(value)) return value;\r\n        const numeric = parseFloat(value);\r\n        return Number.isFinite(numeric) ? numeric : 0;\r\n    }\r\n\r\n    function formatCartPrice(value) {\n        const amount = parseAmount(value);\n        return Templates.formatPrice(amount);\n    }\n\n    function getInitialGiftState() {\n        const gift = window.BUNORAA_CART?.gift || {};\n        const giftWrapEnabled = gift.gift_wrap_enabled !== false;\n        const giftWrapAmount = parseAmount(gift.gift_wrap_amount ?? gift.gift_wrap_cost ?? 0);\n        const isGift = !!gift.is_gift;\n        const giftWrap = isGift && giftWrapEnabled && !!gift.gift_wrap;\n        const giftWrapCost = giftWrap ? parseAmount(gift.gift_wrap_cost ?? giftWrapAmount) : 0;\n\n        return {\n            is_gift: isGift,\n            gift_message: gift.gift_message || '',\n            gift_wrap: giftWrap,\n            gift_wrap_cost: giftWrapCost,\n            gift_wrap_amount: giftWrapAmount,\n            gift_wrap_label: gift.gift_wrap_label || 'Gift Wrap',\n            gift_wrap_enabled: giftWrapEnabled\n        };\n    }\n\n    function applyGiftState(nextState = {}) {\n        giftState = { ...(giftState || getInitialGiftState()), ...nextState };\n\n        if (!giftState.is_gift) {\n            giftState.gift_message = '';\n            giftState.gift_wrap = false;\n            giftState.gift_wrap_cost = 0;\n        }\n\n        if (!giftState.gift_wrap_enabled) {\n            giftState.gift_wrap = false;\n            giftState.gift_wrap_cost = 0;\n        }\n\n        if (giftState.gift_wrap && giftState.gift_wrap_cost <= 0) {\n            giftState.gift_wrap_cost = parseAmount(giftState.gift_wrap_amount);\n        }\n    }\n\n    function hasValue(value) {\n        return value !== null && value !== undefined && value !== '';\n    }\n\n    function getTaxRate() {\n        const rate = window.BUNORAA_CART?.taxRate;\n        return parseAmount(hasValue(rate) ? rate : 0);\n    }\n\n    function getFreeShippingThreshold() {\n        const cartThreshold = window.BUNORAA_CART?.freeShippingThreshold;\n        const shippingMeta = window.BUNORAA_SHIPPING || {};\n        const fallback = shippingMeta.free_shipping_threshold ?? window.BUNORAA_CURRENCY?.free_shipping_threshold ?? 0;\n        return parseAmount(hasValue(cartThreshold) ? cartThreshold : fallback);\n    }\n\n    const SHIPPING_ADDRESS_MESSAGE_HTML = '<a href=\"/account/addresses/\" class=\"text-xs font-medium text-amber-600 dark:text-amber-400 underline underline-offset-2 hover:text-amber-700 dark:hover:text-amber-300\">Add shipping address to see shipping cost.</a>';\n    let shippingAddressCache = null;\n    let shippingAddressPromise = null;\n    let shippingQuoteCache = { key: null, quote: null };\n\n    function getSelectedDivision() {\n        const select = document.getElementById('delivery-division');\n        return (select?.value || 'dhaka').toLowerCase();\n    }\n\n    function formatDivisionLabel(division) {\n        if (!division) return 'Dhaka';\n        return division.charAt(0).toUpperCase() + division.slice(1);\n    }\n\n    function isAuthenticated() {\n        return window.AuthApi?.isAuthenticated && AuthApi.isAuthenticated();\n    }\n\n    function getAddressesFromResponse(response) {\n        if (!response) return [];\n        if (Array.isArray(response)) return response;\n        if (Array.isArray(response.data)) return response.data;\n        if (Array.isArray(response.data?.results)) return response.data.results;\n        if (Array.isArray(response.results)) return response.results;\n        return [];\n    }\n\n    async function getDefaultShippingAddress() {\n        if (!isAuthenticated()) return null;\n        if (shippingAddressCache) return shippingAddressCache;\n        if (!shippingAddressPromise) {\n            shippingAddressPromise = (async () => {\n                try {\n                    const resp = await AuthApi.getAddresses();\n                    const addresses = getAddressesFromResponse(resp);\n                    if (!addresses.length) return null;\n\n                    const shippingAddresses = addresses.filter(addr => {\n                        const type = String(addr.address_type || '').toLowerCase();\n                        return type === 'shipping' || type === 'both';\n                    });\n\n                    return (\n                        shippingAddresses.find(addr => addr.is_default) ||\n                        shippingAddresses[0] ||\n                        addresses.find(addr => addr.is_default) ||\n                        addresses[0] ||\n                        null\n                    );\n                } catch (error) {\n                    return null;\n                }\n            })();\n        }\n        shippingAddressCache = await shippingAddressPromise;\n        return shippingAddressCache;\n    }\n\n    function calculateTax(taxableAmount) {\n        const rate = getTaxRate();\n        return rate > 0 ? (taxableAmount * rate / 100) : 0;\n    }\n\n    function updateShippingLocationLabel(address) {\n        const locationEl = document.getElementById('shipping-location');\n        if (!locationEl) return;\n\n        if (address && (address.city || address.state || address.country)) {\n            locationEl.textContent = address.city || address.state || address.country;\n            return;\n        }\n\n        const divisionSelect = document.getElementById('delivery-division');\n        locationEl.textContent = divisionSelect ? formatDivisionLabel(getSelectedDivision()) : 'Address';\n    }\n\n    function buildShippingPayload(address, subtotalValue, itemCount, productIds) {\n        return {\n            country: address?.country || 'BD',\n            state: address?.state || address?.city || '',\n            postal_code: address?.postal_code || '',\n            subtotal: subtotalValue,\n            weight: 0,\n            item_count: itemCount,\n            product_ids: productIds\n        };\n    }\n\n    async function fetchShippingQuote(cartData, subtotalValue, address) {\n        if (!address) return null;\n\n        const items = cartData?.items || [];\n        const itemCount = items.reduce((sum, item) => sum + Number(item.quantity || 1), 0);\n        const productIds = items.map(item => item.product?.id || item.product_id).filter(Boolean);\n        const payload = buildShippingPayload(address, subtotalValue, itemCount, productIds);\n        const cacheKey = [\n            address.id || '',\n            payload.country,\n            payload.state,\n            payload.postal_code,\n            subtotalValue,\n            itemCount,\n            productIds.join(',')\n        ].join('|');\n\n        if (shippingQuoteCache.key === cacheKey) {\n            return shippingQuoteCache.quote;\n        }\n\n        try {\n            let response;\n            if (window.ShippingApi?.calculateShipping) {\n                response = await ShippingApi.calculateShipping(payload);\n            } else {\n                const currencyCode = window.BUNORAA_CURRENCY?.code;\n                response = await fetch('/api/v1/shipping/calculate/', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': window.CSRF_TOKEN || document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',\n                        ...(currencyCode ? { 'X-User-Currency': currencyCode } : {})\n                    },\n                    body: JSON.stringify(payload)\n                }).then(res => res.json());\n            }\n\n            const methods = response?.data?.methods || response?.data?.data?.methods || response?.methods || [];\n            if (!Array.isArray(methods) || methods.length === 0) return null;\n\n            const cheapest = methods.reduce((min, method) => {\n                const minRate = parseAmount(min.rate);\n                const methodRate = parseAmount(method.rate);\n                return methodRate < minRate ? method : min;\n            }, methods[0]);\n\n            const cost = parseAmount(cheapest.rate);\n            const quote = {\n                cost,\n                isFree: cheapest.is_free || cost <= 0,\n                display: cheapest.rate_display || formatCartPrice(cost)\n            };\n\n            shippingQuoteCache = { key: cacheKey, quote };\n            return quote;\n        } catch (error) {\n            return null;\n        }\n    }\n\n    async function updateOrderSummaryTotals(subtotalValue, discountValue, cartData) {\n        const shippingEl = document.getElementById('shipping');\n        const taxEl = document.getElementById('tax');\n        const totalEl = document.getElementById('total');\n        const giftWrapRow = document.getElementById('gift-wrap-row');\n        const giftWrapCostEl = document.getElementById('gift-wrap-cost');\n\n        const taxableAmount = Math.max(0, subtotalValue - discountValue);\n        const tax = calculateTax(taxableAmount);\n        const giftWrapCost = giftState?.gift_wrap ? parseAmount(giftState.gift_wrap_cost) : 0;\n\n        if (taxEl) taxEl.textContent = formatCartPrice(tax);\n        if (giftWrapRow && giftWrapCostEl) {\n            if (giftState?.gift_wrap) {\n                giftWrapRow.classList.remove('hidden');\n                giftWrapCostEl.textContent = `+${formatCartPrice(giftWrapCost)}`;\n                giftWrapCostEl.dataset.price = giftWrapCost;\n            } else {\n                giftWrapRow.classList.add('hidden');\n                giftWrapCostEl.textContent = `+${formatCartPrice(0)}`;\n                giftWrapCostEl.dataset.price = 0;\n            }\n        }\n\n        const address = await getDefaultShippingAddress();\n        if (!address) {\n            if (shippingEl) shippingEl.innerHTML = SHIPPING_ADDRESS_MESSAGE_HTML;\n            if (totalEl) totalEl.textContent = formatCartPrice(taxableAmount + tax + giftWrapCost);\n            updateShippingLocationLabel(null);\n            return;\n        }\n\n        if (shippingEl) shippingEl.textContent = 'Calculating...';\n        const quote = await fetchShippingQuote(cartData || cart, subtotalValue, address);\n\n        if (!quote) {\n            if (shippingEl) shippingEl.innerHTML = SHIPPING_ADDRESS_MESSAGE_HTML;\n            if (totalEl) totalEl.textContent = formatCartPrice(taxableAmount + tax + giftWrapCost);\n            updateShippingLocationLabel(address);\n            return;\n        }\n\n        if (shippingEl) shippingEl.textContent = quote.isFree ? 'Free' : quote.display;\n        if (totalEl) totalEl.textContent = formatCartPrice(taxableAmount + tax + giftWrapCost + quote.cost);\n\n        updateShippingLocationLabel(address);\n    }\n\n    async function init() {\n        giftState = getInitialGiftState();\n        applyGiftState(giftState);\n        await loadCart();\n        initCartActionButtons();\n        initCouponForm();\n        initEnhancedFeatures();\n    }\n\n    function setButtonState(button, isLoading, loadingText) {\n        if (!button) return;\n        if (!button.dataset.originalText) {\n            button.dataset.originalText = button.textContent;\n        }\n        button.disabled = isLoading;\n        button.textContent = isLoading ? loadingText : button.dataset.originalText;\n    }\n\n    function resolveErrorMessage(error, fallback) {\n        const generic = [\n            'request failed.',\n            'request failed',\n            'invalid response format',\n            'invalid request format'\n        ];\n\n        const isGeneric = (msg) => {\n            if (!msg) return true;\n            const normalized = String(msg).trim().toLowerCase();\n            return generic.includes(normalized);\n        };\n\n        const pickFromErrors = (errObj) => {\n            if (!errObj) return null;\n            if (typeof errObj === 'string') return errObj;\n            if (Array.isArray(errObj)) return errObj[0];\n            if (typeof errObj === 'object') {\n                const values = Object.values(errObj);\n                const flattened = values.flat ? values.flat() : values.reduce((acc, val) => acc.concat(val), []);\n                const first = flattened[0] ?? values[0];\n                if (typeof first === 'string') return first;\n                if (first && typeof first === 'object') {\n                    return pickFromErrors(first);\n                }\n            }\n            return null;\n        };\n\n        const candidates = [];\n        if (error?.message) candidates.push(error.message);\n        if (error?.data?.message) candidates.push(error.data.message);\n        if (error?.data?.detail) candidates.push(error.data.detail);\n        if (error?.data && typeof error.data === 'string') candidates.push(error.data);\n        if (error?.errors) candidates.push(pickFromErrors(error.errors));\n        if (error?.data && typeof error.data === 'object') candidates.push(pickFromErrors(error.data));\n\n        const best = candidates.find(msg => msg && !isGeneric(msg));\n        return best || fallback;\n    }\n\n    function updateCouponUI(couponCode) {\n        const applied = document.getElementById('applied-coupon');\n        const nameEl = document.getElementById('coupon-name');\n        const form = document.getElementById('coupon-form');\n        const input = document.getElementById('coupon-code');\n        const applyBtn = document.getElementById('apply-coupon-btn');\n        const formRow = input?.closest('div.flex');\n        const messageEl = document.getElementById('coupon-message');\n\n        if (couponCode) {\n            if (applied) applied.classList.remove('hidden');\n            if (nameEl) nameEl.textContent = couponCode;\n            if (form) form.classList.add('hidden');\n            if (!form && formRow) formRow.classList.add('hidden');\n            if (applyBtn) applyBtn.classList.add('hidden');\n            if (input) input.value = couponCode;\n            if (messageEl) messageEl.classList.add('hidden');\n            return;\n        }\n\n        if (applied) applied.classList.add('hidden');\n        if (form) form.classList.remove('hidden');\n        if (!form && formRow) formRow.classList.remove('hidden');\n        if (applyBtn) applyBtn.classList.remove('hidden');\n        if (input) input.value = '';\n    }\n\n    function renderValidationResults(validation) {\n        const container = document.getElementById('validation-messages');\n        const issuesBox = document.getElementById('validation-issues');\n        const warningsBox = document.getElementById('validation-warnings');\n        const issuesList = document.getElementById('issues-list');\n        const warningsList = document.getElementById('warnings-list');\n\n        if (!container || !issuesBox || !warningsBox || !issuesList || !warningsList) return;\n\n        const issues = Array.isArray(validation?.issues) ? validation.issues : [];\n        const warnings = Array.isArray(validation?.warnings) ? validation.warnings : [];\n\n        issuesList.innerHTML = issues.map(issue => {\n            const msg = Templates.escapeHtml(issue?.message || 'Issue found');\n            return `<li class=\"flex items-start gap-2\"><span class=\"mt-1 w-1.5 h-1.5 rounded-full bg-red-500 flex-shrink-0\"></span><span>${msg}</span></li>`;\n        }).join('');\n\n        warningsList.innerHTML = warnings.map(warn => {\n            const msg = Templates.escapeHtml(warn?.message || 'Warning');\n            return `<li class=\"flex items-start gap-2\"><span class=\"mt-1 w-1.5 h-1.5 rounded-full bg-amber-500 flex-shrink-0\"></span><span>${msg}</span></li>`;\n        }).join('');\n\n        if (!issues.length && !warnings.length) {\n            container.classList.add('hidden');\n            issuesBox.classList.add('hidden');\n            warningsBox.classList.add('hidden');\n            return;\n        }\n\n        container.classList.remove('hidden');\n        issuesBox.classList.toggle('hidden', issues.length === 0);\n        warningsBox.classList.toggle('hidden', warnings.length === 0);\n\n        container.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n\n    function initCartActionButtons() {\n        const validateBtn = document.getElementById('validate-cart-btn');\n        const lockBtn = document.getElementById('lock-prices-btn');\n        const shareBtn = document.getElementById('share-cart-btn');\n\n        if (validateBtn && validateBtn.getAttribute(BOUND_ATTR) !== 'true') {\n            validateBtn.setAttribute(BOUND_ATTR, 'true');\n            validateBtn.addEventListener('click', async () => {\n                setButtonState(validateBtn, true, 'Validating...');\n                try {\n                    const response = await CartApi.validateCart();\n                    renderValidationResults(response.data);\n                    const hasIssues = (response.data?.issues || []).length > 0;\n                    if (!hasIssues) {\n                        Toast.success('Cart looks good!');\n                    } else {\n                        Toast.warning('We found a few issues in your cart.');\n                    }\n                } catch (error) {\n                    Toast.error(resolveErrorMessage(error, 'Unable to validate cart right now.'));\n                } finally {\n                    setButtonState(validateBtn, false);\n                }\n            });\n        }\n\n        if (lockBtn && lockBtn.getAttribute(BOUND_ATTR) !== 'true') {\n            lockBtn.setAttribute(BOUND_ATTR, 'true');\n            lockBtn.addEventListener('click', async () => {\n                setButtonState(lockBtn, true, 'Locking...');\n                try {\n                    const response = await CartApi.lockPrices();\n                    const count = response.data?.locked_count ?? 0;\n                    Toast.success(`Locked prices for ${count} item${count === 1 ? '' : 's'}.`);\n                    await loadCart();\n                } catch (error) {\n                    Toast.error(resolveErrorMessage(error, 'Failed to lock prices.'));\n                } finally {\n                    setButtonState(lockBtn, false);\n                }\n            });\n        }\n\n        if (shareBtn && shareBtn.getAttribute(BOUND_ATTR) !== 'true') {\n            shareBtn.setAttribute(BOUND_ATTR, 'true');\n            shareBtn.addEventListener('click', async () => {\n                setButtonState(shareBtn, true, 'Creating...');\n                try {\n                    const response = await CartApi.shareCart({ permission: 'view', expires_days: 7 });\n                    const shareUrl = response.data?.share_url;\n                    if (!shareUrl) {\n                        throw new Error('Share link unavailable.');\n                    }\n\n                    if (navigator.share) {\n                        await navigator.share({\n                            title: 'Shared Cart',\n                            url: shareUrl\n                        });\n                        Toast.success('Share link ready.');\n                    } else if (navigator.clipboard?.writeText) {\n                        await navigator.clipboard.writeText(shareUrl);\n                        Toast.success('Share link copied to clipboard.');\n                    } else {\n                        window.prompt('Copy this link to share your cart:', shareUrl);\n                    }\n                } catch (error) {\n                    Toast.error(resolveErrorMessage(error, 'Failed to create share link.'));\n                } finally {\n                    setButtonState(shareBtn, false);\n                }\n            });\n        }\n    }\n\r\n    // ============================================\r\n    // ENHANCED FEATURES INITIALIZATION\r\n    // ============================================\r\n    function initEnhancedFeatures() {\n        initSavedForLater();\n        initAbandonedCartRecovery();\n        initFreeShippingProgress();\n        initRecommendedProducts();\n        initGiftOptions();\n    }\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Saved for Later\r\n    // ============================================\r\n    function initSavedForLater() {\r\n        savedForLater = JSON.parse(localStorage.getItem('savedForLater') || '[]');\r\n        renderSavedForLater();\r\n    }\r\n\r\n    function renderSavedForLater() {\r\n        const container = document.getElementById('saved-for-later');\r\n        if (!container) return;\r\n\r\n        if (savedForLater.length === 0) {\r\n            container.innerHTML = '';\r\n            container.classList.add('hidden');\r\n            return;\r\n        }\r\n\r\n        container.classList.remove('hidden');\r\n        container.innerHTML = `\r\n            <div class=\"mt-8 bg-white dark:bg-stone-800 rounded-xl shadow-sm border border-gray-100 dark:border-stone-700 overflow-hidden\">\r\n                <div class=\"px-6 py-4 border-b border-gray-100 dark:border-stone-700 flex items-center justify-between\">\r\n                    <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white\">Saved for Later (${savedForLater.length})</h3>\r\n                    <button id=\"clear-saved-btn\" class=\"text-sm text-gray-500 dark:text-stone-400 hover:text-gray-700 dark:hover:text-stone-300\">Clear All</button>\r\n                </div>\r\n                <div class=\"p-6 grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                    ${savedForLater.map(item => `\r\n                        <div class=\"saved-item\" data-product-id=\"${item.id}\">\r\n                            <div class=\"aspect-square bg-gray-100 dark:bg-stone-700 rounded-lg overflow-hidden mb-2\">\r\n                                <img src=\"${item.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(item.name)}\" class=\"w-full h-full object-cover\">\r\n                            </div>\r\n                            <h4 class=\"text-sm font-medium text-gray-900 dark:text-white truncate\">${Templates.escapeHtml(item.name)}</h4>\r\n                            <p class=\"text-sm font-semibold text-primary-600 dark:text-amber-400\">${formatCartPrice(item.price)}</p>\r\n                            <div class=\"flex gap-2 mt-2\">\r\n                                <button class=\"move-to-cart-btn flex-1 px-2 py-1 bg-primary-600 dark:bg-amber-600 text-white text-xs font-medium rounded hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">Move to Cart</button>\r\n                                <button class=\"remove-saved-btn px-2 py-1 text-gray-400 hover:text-red-500\">\r\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    `).join('')}\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        // Bind events\r\n        container.querySelectorAll('.move-to-cart-btn').forEach(btn => {\r\n            btn.addEventListener('click', async () => {\r\n                const item = btn.closest('.saved-item');\r\n                const productId = item?.dataset.productId;\r\n                if (!productId) return;\r\n\r\n                try {\r\n                    await CartApi.addItem(productId, 1);\r\n                    savedForLater = savedForLater.filter(i => i.id !== productId);\r\n                    localStorage.setItem('savedForLater', JSON.stringify(savedForLater));\r\n                    Toast.success('Item moved to cart');\r\n                    await loadCart();\r\n                    renderSavedForLater();\r\n                } catch (error) {\r\n                    Toast.error('Failed to move item to cart');\r\n                }\r\n            });\r\n        });\r\n\r\n        container.querySelectorAll('.remove-saved-btn').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const item = btn.closest('.saved-item');\r\n                const productId = item?.dataset.productId;\r\n                if (!productId) return;\r\n\r\n                savedForLater = savedForLater.filter(i => i.id !== productId);\r\n                localStorage.setItem('savedForLater', JSON.stringify(savedForLater));\r\n                renderSavedForLater();\r\n                Toast.info('Item removed');\r\n            });\r\n        });\r\n\r\n        document.getElementById('clear-saved-btn')?.addEventListener('click', () => {\r\n            savedForLater = [];\r\n            localStorage.removeItem('savedForLater');\r\n            renderSavedForLater();\r\n            Toast.info('Saved items cleared');\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Abandoned Cart Recovery\r\n    // ============================================\r\n    function initAbandonedCartRecovery() {\r\n        // Check for existing abandoned cart\r\n        const abandonedCart = JSON.parse(localStorage.getItem('abandonedCart') || 'null');\r\n        \r\n        if (abandonedCart && abandonedCart.items?.length > 0 && (!cart || cart.items?.length === 0)) {\r\n            showAbandonedCartRecovery(abandonedCart);\r\n        }\r\n\r\n        // Start tracking for abandonment\r\n        startAbandonedCartTracking();\r\n\r\n        // Save cart state on unload\r\n        window.addEventListener('beforeunload', () => {\r\n            if (cart && cart.items?.length > 0) {\r\n                localStorage.setItem('abandonedCart', JSON.stringify({\r\n                    items: cart.items,\r\n                    savedAt: new Date().toISOString()\r\n                }));\r\n            }\r\n        });\r\n    }\r\n\r\n    function startAbandonedCartTracking() {\r\n        // Reset timer on user interaction\r\n        const resetTimer = () => {\r\n            if (abandonedCartTimer) clearTimeout(abandonedCartTimer);\r\n            abandonedCartTimer = setTimeout(() => {\r\n                if (cart && cart.items?.length > 0) {\r\n                    showAbandonedCartReminder();\r\n                }\r\n            }, ABANDONED_CART_DELAY);\r\n        };\r\n\r\n        ['click', 'scroll', 'keypress', 'mousemove'].forEach(event => {\r\n            document.addEventListener(event, resetTimer, { passive: true, once: false });\r\n        });\r\n\r\n        resetTimer();\r\n    }\r\n\r\n    function showAbandonedCartRecovery(abandonedCart) {\r\n        const modal = document.createElement('div');\r\n        modal.id = 'abandoned-cart-modal';\r\n        modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\r\n        modal.innerHTML = `\r\n            <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('abandoned-cart-modal').remove()\"></div>\r\n            <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-md w-full p-6\">\r\n                <button onclick=\"document.getElementById('abandoned-cart-modal').remove()\" class=\"absolute top-4 right-4 w-8 h-8 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center\">\r\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                </button>\r\n                <div class=\"text-center mb-6\">\r\n                    <div class=\"w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                        <svg class=\"w-8 h-8 text-amber-600 dark:text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/></svg>\r\n                    </div>\r\n                    <h3 class=\"text-xl font-bold text-stone-900 dark:text-white mb-2\">Welcome Back!</h3>\r\n                    <p class=\"text-stone-600 dark:text-stone-400\">You left ${abandonedCart.items.length} item(s) in your cart.</p>\r\n                </div>\r\n                <div class=\"max-h-48 overflow-y-auto mb-6 space-y-2\">\r\n                    ${abandonedCart.items.slice(0, 3).map(item => `\r\n                        <div class=\"flex items-center gap-3 p-2 bg-stone-50 dark:bg-stone-700/50 rounded-lg\">\r\n                            <img src=\"${item.product_image || item.product?.image || '/static/images/placeholder.jpg'}\" alt=\"\" class=\"w-12 h-12 rounded object-cover\">\r\n                            <div class=\"flex-1 min-w-0\">\r\n                                <p class=\"text-sm font-medium text-stone-900 dark:text-white truncate\">${Templates.escapeHtml(item.product_name || item.product?.name || 'Product')}</p>\r\n                                <p class=\"text-xs text-stone-500 dark:text-stone-400\">Qty: ${item.quantity}</p>\r\n                            </div>\r\n                        </div>\r\n                    `).join('')}\r\n                    ${abandonedCart.items.length > 3 ? `<p class=\"text-center text-sm text-stone-500 dark:text-stone-400\">+${abandonedCart.items.length - 3} more items</p>` : ''}\r\n                </div>\r\n                <div class=\"grid grid-cols-2 gap-3\">\r\n                    <button onclick=\"document.getElementById('abandoned-cart-modal').remove(); localStorage.removeItem('abandonedCart');\" class=\"py-3 px-4 border border-stone-300 dark:border-stone-600 text-stone-700 dark:text-stone-300 font-medium rounded-xl hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors\">\r\n                        Start Fresh\r\n                    </button>\r\n                    <button onclick=\"document.getElementById('abandoned-cart-modal').remove();\" class=\"py-3 px-4 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-xl hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\r\n                        Continue Shopping\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n        document.body.appendChild(modal);\r\n    }\r\n\r\n    function showAbandonedCartReminder() {\r\n        // Don't show if already shown this session\r\n        if (sessionStorage.getItem('cartReminderShown')) return;\r\n\r\n        Toast.info(\"Don't forget! You have items in your cart\", {\r\n            duration: 8000,\r\n            action: {\r\n                text: 'Checkout',\r\n                onClick: () => window.location.href = '/checkout/'\r\n            }\r\n        });\r\n\r\n        sessionStorage.setItem('cartReminderShown', 'true');\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Free Shipping Progress\r\n    // ============================================\r\n    function initFreeShippingProgress() {\r\n        updateFreeShippingProgress();\r\n    }\r\n\r\n    function updateFreeShippingProgress() {\r\n        const container = document.getElementById('free-shipping-progress');\r\n        if (!container || !cart) return;\r\n\r\n        const threshold = parseAmount(window.BUNORAA_CART?.freeShippingThreshold ?? 50);\n        const subtotal = parseAmount(cart.summary?.subtotal || cart.subtotal || 0);\r\n        const remaining = Math.max(0, threshold - subtotal);\r\n        const progress = Math.min(100, (subtotal / threshold) * 100);\r\n\r\n        if (container.dataset.freeShippingProgress === 'bar') {\r\n            const statusEl = document.getElementById('free-shipping-status');\r\n            const messageEl = document.getElementById('free-shipping-message');\r\n\r\n            container.style.width = `${progress}%`;\r\n            if (subtotal >= threshold) {\r\n                if (statusEl) statusEl.textContent = 'Unlocked';\r\n                if (messageEl) messageEl.textContent = \"You've unlocked free delivery\";\r\n            } else {\r\n                if (statusEl) statusEl.textContent = `${formatCartPrice(remaining)} away`;\r\n                if (messageEl) messageEl.textContent = `Free delivery on orders over ${formatCartPrice(threshold)}`;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (subtotal >= threshold) {\r\n            container.innerHTML = `\r\n                <div class=\"flex items-center gap-2 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl\">\r\n                    <svg class=\"w-5 h-5 text-emerald-600 dark:text-emerald-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\r\n                    <span class=\"text-sm font-medium text-emerald-700 dark:text-emerald-300\">You've unlocked FREE shipping!</span>\r\n                </div>\r\n            `;\r\n        } else {\r\n            container.innerHTML = `\r\n                <div class=\"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl\">\r\n                    <div class=\"flex items-center justify-between text-sm mb-2\">\r\n                        <span class=\"text-amber-700 dark:text-amber-300\">Add ${formatCartPrice(remaining)} for FREE shipping</span>\r\n                        <span class=\"text-amber-600 dark:text-amber-400 font-medium\">${Math.round(progress)}%</span>\r\n                    </div>\r\n                    <div class=\"w-full bg-amber-200 dark:bg-amber-800 rounded-full h-2\">\r\n                        <div class=\"bg-amber-500 h-2 rounded-full transition-all duration-500\" style=\"width: ${progress}%\"></div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Delivery Estimate\r\n    // ============================================\r\n    function initDeliveryEstimate() {\n        const container = document.getElementById('cart-delivery-estimate');\n        if (!container) return;\n\r\n        const today = new Date();\r\n        const minDays = 3;\r\n        const maxDays = 7;\r\n        const minDate = new Date(today.getTime() + minDays * 24 * 60 * 60 * 1000);\r\n        const maxDate = new Date(today.getTime() + maxDays * 24 * 60 * 60 * 1000);\r\n\r\n        const formatDate = (date) => date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });\r\n\r\n        container.innerHTML = `\n            <div class=\"flex items-center gap-2 text-sm text-stone-600 dark:text-stone-400\">\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4\"/></svg>\n                <span>Estimated delivery: <strong class=\"text-stone-900 dark:text-white\">${formatDate(minDate)} - ${formatDate(maxDate)}</strong></span>\n            </div>\n        `;\n    }\n\n    function initDeliveryLocation() {\n        const select = document.getElementById('delivery-division');\n        if (!select) return;\n\n        const updateTotalsForLocation = () => {\n            const summary = cart?.summary || {};\n            const subtotalValue = parseAmount(summary.subtotal ?? cart?.subtotal ?? 0);\n            const discountValue = parseAmount(summary.discount_amount ?? cart?.discount_amount ?? 0);\n            void updateOrderSummaryTotals(subtotalValue, discountValue, cart);\n        };\n\n        select.addEventListener('change', updateTotalsForLocation);\n        updateTotalsForLocation();\n    }\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Recommended Products\r\n    // ============================================\r\n    async function initRecommendedProducts() {\r\n        const container = document.getElementById('cart-recommendations');\r\n        if (!container || !cart || !cart.items?.length) return;\r\n\r\n        try {\r\n            // Get product IDs from cart\r\n            const productIds = cart.items.map(item => item.product?.id || item.product_id).filter(Boolean);\n            if (!productIds.length) return;\r\n\r\n            // Fetch recommendations (mock - use API in production)\r\n            const response = await ProductsApi.getRelated(productIds[0], { limit: 4 });\r\n            const products = response?.data || response?.results || [];\r\n\r\n            if (!products.length) return;\r\n\r\n            container.innerHTML = `\r\n                <div class=\"mt-8\">\r\n                    <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">You might also like</h3>\r\n                    <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        ${products.slice(0, 4).map(product => `\r\n                            <div class=\"bg-white dark:bg-stone-800 rounded-xl shadow-sm border border-gray-100 dark:border-stone-700 overflow-hidden group\">\r\n                                <a href=\"/products/${product.slug}/\" class=\"block aspect-square bg-gray-100 dark:bg-stone-700 overflow-hidden\">\r\n                                    <img src=\"${product.primary_image || product.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(product.name)}\" class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\">\r\n                                </a>\r\n                                <div class=\"p-3\">\r\n                                    <h4 class=\"text-sm font-medium text-gray-900 dark:text-white truncate\">${Templates.escapeHtml(product.name)}</h4>\r\n                                    <p class=\"text-sm font-semibold text-primary-600 dark:text-amber-400 mt-1\">${formatCartPrice(product.current_price || product.price)}</p>\r\n                                    <button class=\"quick-add-btn w-full mt-2 py-2 text-xs font-medium text-primary-600 dark:text-amber-400 border border-primary-600 dark:border-amber-400 rounded-lg hover:bg-primary-50 dark:hover:bg-amber-900/20 transition-colors\" data-product-id=\"${product.id}\">\r\n                                        + Add to Cart\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        `).join('')}\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            // Bind quick add buttons\r\n            container.querySelectorAll('.quick-add-btn').forEach(btn => {\r\n                btn.addEventListener('click', async () => {\r\n                    const productId = btn.dataset.productId;\r\n                    btn.disabled = true;\r\n                    btn.textContent = 'Adding...';\r\n                    \r\n                    try {\r\n                        await CartApi.addItem(productId, 1);\r\n                        Toast.success('Added to cart');\r\n                        await loadCart();\r\n                    } catch (error) {\r\n                        Toast.error('Failed to add item');\r\n                    } finally {\r\n                        btn.disabled = false;\r\n                        btn.textContent = '+ Add to Cart';\r\n                    }\r\n                });\r\n            });\r\n        } catch (error) {\r\n            console.warn('Failed to load recommendations:', error);\r\n        }\r\n    }\r\n\r\n    // ============================================\n    // ENHANCED FEATURE: Gift Options\n    // ============================================\n    function initGiftOptions() {\n        const giftCheckbox = document.getElementById('gift-order');\n        const giftDetails = document.getElementById('gift-details');\n        const giftMessage = document.getElementById('gift-message');\n        const giftMessageCount = document.getElementById('gift-message-count');\n        const giftWrapCheckbox = document.getElementById('gift-wrap');\n\n        if (!giftCheckbox || giftCheckbox.getAttribute(BOUND_ATTR) === 'true') return;\n        giftCheckbox.setAttribute(BOUND_ATTR, 'true');\n\n        const updateMessageCount = () => {\n            if (giftMessage && giftMessageCount) {\n                giftMessageCount.textContent = String(giftMessage.value.length);\n            }\n        };\n\n        const renderGiftState = () => {\n            if (!giftState) {\n                giftState = getInitialGiftState();\n            }\n\n            giftCheckbox.checked = !!giftState.is_gift;\n            if (giftDetails) {\n                giftDetails.classList.toggle('hidden', !giftState.is_gift);\n            }\n\n            if (giftMessage) {\n                giftMessage.value = giftState.gift_message || '';\n            }\n\n            if (giftWrapCheckbox) {\n                giftWrapCheckbox.checked = !!giftState.gift_wrap;\n                giftWrapCheckbox.disabled = !giftState.gift_wrap_enabled || !giftState.is_gift;\n            }\n\n            updateMessageCount();\n        };\n\n        const persistGiftOptions = debounce(async () => {\n            try {\n                const payload = {\n                    is_gift: !!giftState?.is_gift,\n                    gift_message: giftState?.gift_message || '',\n                    gift_wrap: !!giftState?.gift_wrap\n                };\n\n                const response = await CartApi.updateGiftOptions(payload);\n                if (response?.success === false) {\n                    throw new Error(response.message || 'Failed to update gift options.');\n                }\n                const data = response?.data || response;\n                const state = data?.gift_state;\n\n                if (state) {\n                    applyGiftState({\n                        is_gift: state.is_gift,\n                        gift_message: state.gift_message || '',\n                        gift_wrap: state.gift_wrap,\n                        gift_wrap_cost: parseAmount(state.gift_wrap_cost)\n                    });\n                }\n\n                if (data?.gift_wrap_amount !== undefined) {\n                    giftState.gift_wrap_amount = parseAmount(data.gift_wrap_amount);\n                }\n                if (data?.gift_wrap_label) {\n                    giftState.gift_wrap_label = data.gift_wrap_label;\n                }\n                if (data?.gift_wrap_enabled !== undefined) {\n                    giftState.gift_wrap_enabled = !!data.gift_wrap_enabled;\n                }\n\n                renderGiftState();\n\n                const summary = cart?.summary || {};\n                const subtotalValue = parseAmount(summary.subtotal ?? cart?.subtotal ?? 0);\n                const discountValue = parseAmount(summary.discount_amount ?? cart?.discount_amount ?? 0);\n                void updateOrderSummaryTotals(subtotalValue, discountValue, cart);\n            } catch (error) {\n                Toast.error(resolveErrorMessage(error, 'Failed to update gift options.'));\n            }\n        }, 400);\n\n        giftCheckbox.addEventListener('change', () => {\n            applyGiftState({ is_gift: giftCheckbox.checked });\n\n            if (!giftCheckbox.checked) {\n                applyGiftState({ gift_message: '', gift_wrap: false, gift_wrap_cost: 0 });\n            }\n\n            renderGiftState();\n\n            const summary = cart?.summary || {};\n            const subtotalValue = parseAmount(summary.subtotal ?? cart?.subtotal ?? 0);\n            const discountValue = parseAmount(summary.discount_amount ?? cart?.discount_amount ?? 0);\n            void updateOrderSummaryTotals(subtotalValue, discountValue, cart);\n\n            persistGiftOptions();\n        });\n\n        giftMessage?.addEventListener('input', () => {\n            if (!giftState?.is_gift) return;\n            applyGiftState({ gift_message: giftMessage.value.slice(0, 200) });\n            updateMessageCount();\n            persistGiftOptions();\n        });\n\n        giftWrapCheckbox?.addEventListener('change', () => {\n            if (!giftState?.is_gift || !giftState?.gift_wrap_enabled) {\n                giftWrapCheckbox.checked = false;\n                return;\n            }\n\n            applyGiftState({ gift_wrap: giftWrapCheckbox.checked });\n\n            const summary = cart?.summary || {};\n            const subtotalValue = parseAmount(summary.subtotal ?? cart?.subtotal ?? 0);\n            const discountValue = parseAmount(summary.discount_amount ?? cart?.discount_amount ?? 0);\n            void updateOrderSummaryTotals(subtotalValue, discountValue, cart);\n\n            persistGiftOptions();\n        });\n\n        renderGiftState();\n    }\n\r\n    function debounce(func, wait) {\r\n        let timeout;\r\n        return function executedFunction(...args) {\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(() => func(...args), wait);\r\n        };\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Express Checkout Buttons\r\n    // ============================================\r\n    function initExpressCheckout() {\r\n        const container = document.getElementById('express-checkout');\r\n        if (!container) return;\r\n\r\n        container.innerHTML = `\r\n            <div class=\"mt-4 space-y-2\">\r\n                <p class=\"text-xs text-center text-stone-500 dark:text-stone-400 mb-3\">Or checkout faster with</p>\r\n                <div class=\"grid grid-cols-2 gap-2\">\r\n                    <button class=\"express-pay-btn flex items-center justify-center gap-2 px-4 py-2.5 bg-black text-white rounded-lg font-medium text-sm hover:bg-gray-800 transition-colors\">\r\n                        <svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.53 4.08zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.27 2.43-2.22 4.38-3.74 4.25z\"/></svg>\r\n                        Apple Pay\r\n                    </button>\r\n                    <button class=\"express-pay-btn flex items-center justify-center gap-2 px-4 py-2.5 bg-[#5f6368] text-white rounded-lg font-medium text-sm hover:bg-[#4a4e52] transition-colors\">\r\n                        <svg class=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/><path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/><path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/><path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/></svg>\r\n                        Google Pay\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        // Bind express checkout buttons (mock - implement payment gateway integration)\r\n        container.querySelectorAll('.express-pay-btn').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                Toast.info('Express checkout coming soon!');\r\n            });\r\n        });\r\n    }\r\n\r\n    async function loadCart() {\r\n        const container = document.getElementById('cart-container');\r\n        if (!container) return;\r\n\r\n        if (container.dataset.cartRender !== 'server') {\r\n            Loader.show(container, 'skeleton');\r\n        }\r\n\r\n        try {\r\n            const response = await CartApi.getCart();\r\n            cart = response.data;\r\n\r\n            if (container.dataset.cartRender === 'server') {\r\n                hydrateServerCart(cart);\r\n            } else {\r\n                renderCart(cart);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load cart:', error);\r\n            container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load cart. Please try again.</p>';\r\n        }\r\n    }\r\n\r\n    function hydrateServerCart(cartData) {\n        const container = document.getElementById('cart-container');\n        if (!container) return;\n\n        const items = cartData?.items || [];\n        const summary = cartData?.summary || {};\n\r\n        if (!items.length) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-16\">\r\n                    <svg class=\"w-24 h-24 text-gray-300 dark:text-gray-600 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n                    </svg>\r\n                    <h2 class=\"text-2xl font-semibold text-gray-900 dark:text-white mb-2\">Your cart is empty</h2>\r\n                    <p class=\"text-gray-600 dark:text-gray-300 mb-6\">Explore the collection and add your favorites to the bag.</p>\r\n                    <a href=\"/products/\" class=\"inline-block bg-gradient-to-r from-amber-600 to-amber-700 text-white px-8 py-3 rounded-xl font-semibold hover:from-amber-700 hover:to-amber-800 transition-colors shadow-lg shadow-amber-500/20\">\r\n                        Start Shopping\r\n                    </a>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        // Update summary totals\r\n        const subtotalValue = summary.subtotal ?? cartData?.subtotal ?? 0;\r\n        const discountValue = parseAmount(summary.discount_amount ?? cartData?.discount_amount);\r\n        const subtotalEl = document.getElementById('subtotal');\n        const discountRow = document.getElementById('discount-row');\n        const discountEl = document.getElementById('discount');\n        const savingsRow = document.getElementById('savings-row');\n        const savingsEl = document.getElementById('savings');\n        if (subtotalEl) subtotalEl.textContent = formatCartPrice(subtotalValue);\n\r\n        if (discountRow && discountEl) {\r\n            if (discountValue > 0) {\r\n                discountRow.classList.remove('hidden');\r\n                discountEl.textContent = `-${formatCartPrice(discountValue)}`;\r\n            } else {\r\n                discountRow.classList.add('hidden');\r\n            }\r\n        }\r\n\r\n        if (savingsRow && savingsEl) {\n            const savingsValue = parseAmount(summary.total_savings);\n            if (savingsValue > 0) {\n                savingsRow.classList.remove('hidden');\n                savingsEl.textContent = formatCartPrice(savingsValue);\n            } else {\n                savingsRow.classList.add('hidden');\n            }\n        }\n\n        void updateOrderSummaryTotals(subtotalValue, discountValue, cartData);\n        updateCouponUI(cartData?.coupon_code || cartData?.coupon?.code || summary?.coupon_code || '');\n\n        // Update item rows\n        items.forEach(item => {\n            const row = container.querySelector(`.cart-item[data-item-id=\"${item.id}\"]`);\n            if (!row) return;\n\r\n            const qtyInput = row.querySelector('.qty-input');\r\n            if (qtyInput && item.quantity) {\r\n                qtyInput.value = item.quantity;\r\n            }\r\n\r\n            const totalCell = row.querySelector('.item-total');\n            if (totalCell) {\n                totalCell.textContent = formatCartPrice(item.total || item.line_total || 0);\n            }\n\n            const unitPriceCell = row.querySelector('.item-unit-price');\n            if (unitPriceCell) {\n                unitPriceCell.textContent = formatCartPrice(item.unit_price || item.current_price || item.price_at_add || 0);\n            }\n\n            const imageEl = row.querySelector('img');\n            if (imageEl && item.product_image) {\n                imageEl.src = item.product_image;\n            }\n        });\n\n        bindCartEvents();\n        updateFreeShippingProgress();\n    }\n\r\n    function renderCart(cartData) {\n        const container = document.getElementById('cart-container');\r\n        if (!container) return;\r\n\r\n        const items = cartData?.items || [];\r\n        const summary = cartData?.summary || {};\r\n        const subtotalValue = summary.subtotal ?? cartData?.subtotal ?? 0;\r\n        const discountValue = parseAmount(summary.discount_amount ?? cartData?.discount_amount);\r\n        const taxableAmount = Math.max(0, subtotalValue - discountValue);\n        const taxValue = calculateTax(taxableAmount);\n        const giftWrapCost = giftState?.gift_wrap ? parseAmount(giftState.gift_wrap_cost) : 0;\n        const totalValue = taxableAmount + taxValue + giftWrapCost;\n        const taxRate = getTaxRate();\n        const couponCode = cartData?.coupon?.code || cartData?.coupon_code || '';\n\r\n        if (items.length === 0) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-16\">\r\n                    <svg class=\"w-24 h-24 text-gray-300 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n                    </svg>\r\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Your cart is empty</h2>\r\n                    <p class=\"text-gray-600 mb-8\">Looks like you haven't added any items to your cart yet.</p>\r\n                    <a href=\"/products/\" class=\"inline-flex items-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors\">\r\n                        Start Shopping\r\n                        <svg class=\"w-5 h-5 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"/>\r\n                        </svg>\r\n                    </a>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                <!-- Cart Items -->\r\n                <div class=\"lg:col-span-2\">\r\n                    <div class=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n                        <div class=\"px-6 py-4 border-b border-gray-100\">\r\n                            <h2 class=\"text-lg font-semibold text-gray-900\">Shopping Cart (${items.length} items)</h2>\r\n                        </div>\r\n                        <div id=\"cart-items\" class=\"divide-y divide-gray-100\">\r\n                            ${items.map(item => renderCartItem(item)).join('')}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Continue Shopping -->\r\n                    <div class=\"mt-6 flex items-center justify-between\">\r\n                        <a href=\"/products/\" class=\"inline-flex items-center text-primary-600 hover:text-primary-700 font-medium\">\r\n                            <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16l-4-4m0 0l4-4m-4 4h18\"/>\r\n                            </svg>\r\n                            Continue Shopping\r\n                        </a>\r\n                        <button id=\"clear-cart-btn\" class=\"text-red-600 hover:text-red-700 font-medium\">\r\n                            Clear Cart\r\n                        </button>\r\n                    </div>\r\n                    \r\n                    <!-- Saved for Later -->\r\n                    <div id=\"saved-for-later\"></div>\r\n                    \r\n                    <!-- Recommendations -->\r\n                    <div id=\"cart-recommendations\"></div>\r\n                </div>\r\n\r\n                <!-- Order Summary -->\r\n                <div class=\"lg:col-span-1\">\r\n                    <div class=\"bg-white dark:bg-stone-800 rounded-xl shadow-sm border border-gray-100 dark:border-stone-700 p-6 sticky top-4\">\r\n                        <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Order Summary</h3>\r\n                        \r\n                        <!-- Free Shipping Progress -->\r\n                        <div id=\"free-shipping-progress\" class=\"mb-4\"></div>\r\n                        \r\n                        <div class=\"space-y-3 text-sm\">\r\n                            <div class=\"flex justify-between\">\r\n                                <span class=\"text-gray-600 dark:text-stone-400\">Subtotal</span>\r\n                                <span class=\"font-medium text-gray-900 dark:text-white\">${formatCartPrice(subtotalValue)}</span>\r\n                            </div>\r\n                            ${discountValue > 0 ? `\n                                <div class=\"flex justify-between text-green-600 dark:text-green-400\">\n                                    <span>Discount</span>\n                                    <span>-${formatCartPrice(discountValue)}</span>\n                                </div>\n                            ` : ''}\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600 dark:text-stone-400\">Shipping</span>\n                                <span id=\"shipping\" class=\"font-medium text-gray-900 dark:text-white\">Calculating...</span>\n                            </div>\n                            <div id=\"gift-wrap-row\" class=\"flex justify-between ${giftState?.gift_wrap ? '' : 'hidden'}\">\n                                <span class=\"text-gray-600 dark:text-stone-400\">${Templates.escapeHtml(giftState?.gift_wrap_label || 'Gift Wrap')}</span>\n                                <span id=\"gift-wrap-cost\" class=\"font-medium text-gray-900 dark:text-white\" data-price=\"${giftWrapCost}\">+${formatCartPrice(giftWrapCost)}</span>\n                            </div>\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600 dark:text-stone-400\">VAT (${taxRate}%)</span>\n                                <span id=\"tax\" class=\"font-medium text-gray-900 dark:text-white\">${formatCartPrice(taxValue)}</span>\n                            </div>\n                            <div class=\"pt-3 border-t border-gray-200 dark:border-stone-600\">\n                                <div class=\"flex justify-between\">\n                                    <span class=\"text-base font-semibold text-gray-900 dark:text-white\">Total</span>\n                                    <span id=\"total\" class=\"text-base font-bold text-gray-900 dark:text-white\">${formatCartPrice(totalValue)}</span>\n                                </div>\n                                <p class=\"text-xs text-gray-500 dark:text-stone-400 mt-1\">Shipping calculated from your saved address</p>\n                            </div>\n                        </div>\n                        \r\n                        <!-- Coupon Form -->\n                        <div class=\"mt-6 pt-6 border-t border-gray-200 dark:border-stone-600\">\n                            ${couponCode ? `\n                                <div class=\"flex items-center justify-between px-3 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                                    <p class=\"text-sm font-medium text-green-700 dark:text-green-400\">\n                                        Coupon Applied: <span class=\"font-semibold\">${Templates.escapeHtml(couponCode)}</span>\n                                    </p>\n                                    <button id=\"remove-coupon-btn\" class=\"text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300\" aria-label=\"Remove coupon\">\n                                        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n                                        </svg>\n                                    </button>\n                                </div>\n                            ` : `\n                                <form id=\"coupon-form\" class=\"flex gap-2\">\r\n                                    <input \r\n                                        type=\"text\" \r\n                                        id=\"coupon-code\" \r\n                                        placeholder=\"Enter coupon code\"\r\n                                        class=\"flex-1 px-3 py-2 border border-gray-300 dark:border-stone-600 dark:bg-stone-700 dark:text-white rounded-lg text-sm focus:ring-primary-500 dark:focus:ring-amber-500 focus:border-primary-500 dark:focus:border-amber-500\"\r\n                                        value=\"${Templates.escapeHtml(couponCode)}\"\r\n                                    >\r\n                                    <button type=\"submit\" class=\"px-4 py-2 bg-gray-100 dark:bg-stone-700 hover:bg-gray-200 dark:hover:bg-stone-600 text-gray-700 dark:text-stone-200 font-medium rounded-lg transition-colors text-sm\">\r\n                                        Apply\r\n                                    </button>\r\n                                </form>\r\n                            `}\n                        </div>\n\n                        <!-- Gift Options -->\n                        <div class=\"mt-6 pt-6 border-t border-gray-200 dark:border-stone-600\">\n                            <h4 class=\"text-sm font-semibold text-gray-900 dark:text-white mb-3\">Gift options</h4>\n                            <label class=\"flex items-center gap-2 cursor-pointer\">\n                                <input type=\"checkbox\" id=\"gift-order\" class=\"rounded border-gray-300 dark:border-stone-600 text-primary-600 dark:text-amber-500 focus:ring-primary-500 dark:focus:ring-amber-500\" ${giftState?.is_gift ? 'checked' : ''}>\n                                <span class=\"text-sm text-gray-700 dark:text-stone-300\">This order is a gift</span>\n                            </label>\n                            <div id=\"gift-details\" class=\"${giftState?.is_gift ? '' : 'hidden'} mt-3 space-y-3 pl-6\">\n                                <div>\n                                    <label class=\"block text-xs font-medium text-gray-600 dark:text-stone-400 mb-1\">Gift message (optional)</label>\n                                    <textarea id=\"gift-message\" maxlength=\"200\" rows=\"3\"\n                                              class=\"w-full px-3 py-2 border border-gray-300 dark:border-stone-600 dark:bg-stone-700 dark:text-white rounded-lg text-sm focus:ring-primary-500 dark:focus:ring-amber-500 focus:border-primary-500 dark:focus:border-amber-500\"\n                                              placeholder=\"Add a personal message (max 200 characters)\">${Templates.escapeHtml(giftState?.gift_message || '')}</textarea>\n                                    <p class=\"text-xs text-gray-500 dark:text-stone-400 mt-1\"><span id=\"gift-message-count\">0</span>/200 characters</p>\n                                </div>\n                                <label class=\"flex items-center gap-2 cursor-pointer\">\n                                    <input type=\"checkbox\" id=\"gift-wrap\"\n                                           class=\"rounded border-gray-300 dark:border-stone-600 text-primary-600 dark:text-amber-500 focus:ring-primary-500 dark:focus:ring-amber-500\"\n                                           ${giftState?.gift_wrap ? 'checked' : ''} ${giftState?.gift_wrap_enabled ? '' : 'disabled'}>\n                                    <span class=\"text-sm text-gray-700 dark:text-stone-300\">Add ${Templates.escapeHtml(giftState?.gift_wrap_label || 'Gift Wrap')}${giftState?.gift_wrap_enabled ? ` (+${formatCartPrice(giftState?.gift_wrap_amount || giftWrapCost)})` : ' (Unavailable)'}</span>\n                                </label>\n                            </div>\n                        </div>\n\r\n                        <!-- Checkout Button -->\r\n                        <a href=\"${window.BUNORAA_CART && window.BUNORAA_CART.checkoutUrl ? window.BUNORAA_CART.checkoutUrl : '/checkout/'}\" class=\"mt-6 w-full px-6 py-3 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-lg hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors flex items-center justify-center gap-2\">\r\n                            Proceed to Checkout\r\n                            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"/>\r\n                            </svg>\r\n                        </a>\r\n                        \r\n                        <!-- Trust Badges -->\n                        <div class=\"mt-6 pt-6 border-t border-gray-200 dark:border-stone-600\">\n                            <div class=\"flex items-center justify-center gap-4 text-gray-400 dark:text-stone-500\">\r\n                                <div class=\"flex flex-col items-center\">\r\n                                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"/>\r\n                                    </svg>\r\n                                    <span class=\"text-xs mt-1\">Secure</span>\r\n                                </div>\r\n                                <div class=\"flex flex-col items-center\">\r\n                                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\r\n                                    </svg>\r\n                                    <span class=\"text-xs mt-1\">Protected</span>\r\n                                </div>\r\n                                <div class=\"flex flex-col items-center\">\r\n                                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\"/>\r\n                                    </svg>\r\n                                    <span class=\"text-xs mt-1\">Easy Pay</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        bindCartEvents();\n        initEnhancedFeatures();\n        void updateOrderSummaryTotals(subtotalValue, discountValue, cartData);\n    }\n\r\n    function renderCartItem(item) {\r\n        const product = item.product || {};\r\n        const variant = item.variant;\r\n        const productSlug = product.slug || item.product_slug || '#';\r\n        const productName = product.name || item.product_name || 'Product';\r\n        const productImage = item.product_image || product.primary_image || product.image;\r\n        const productId = product.id || item.product_id || '';\r\n        const priceAtAdd = parseAmount(item.price_at_add);\r\n        const currentPrice = parseAmount(item.current_price || item.unit_price);\r\n        const lineTotal = parseAmount(item.total || item.line_total) || currentPrice * (item.quantity || 1);\r\n        const showOriginal = priceAtAdd > currentPrice && currentPrice > 0;\r\n\r\n        return `\r\n            <div class=\"cart-item p-6 flex gap-4\" data-item-id=\"${item.id}\" data-product-id=\"${productId}\">\r\n                <div class=\"flex-shrink-0 w-24 h-24 bg-gray-100 dark:bg-stone-700 rounded-lg overflow-hidden\">\r\n                    <a href=\"/products/${productSlug}/\">\r\n                        ${productImage ? `\r\n                        <img \r\n                            src=\"${productImage}\" \r\n                            alt=\"${Templates.escapeHtml(productName)}\"\r\n                            class=\"w-full h-full object-cover\"\r\n                            onerror=\"this.style.display='none'\"\r\n                        >` : `\r\n                        <div class=\"w-full h-full flex items-center justify-center text-gray-400 dark:text-stone-500\">\r\n                            <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                            </svg>\r\n                        </div>`}\r\n                    </a>\r\n                </div>\r\n                <div class=\"flex-1 min-w-0\">\r\n                    <div class=\"flex justify-between\">\r\n                        <div>\r\n                            <h3 class=\"font-medium text-gray-900 dark:text-white\">\r\n                                <a href=\"/products/${productSlug}/\" class=\"hover:text-primary-600 dark:hover:text-amber-400\">\r\n                                    ${Templates.escapeHtml(productName)}\r\n                                </a>\r\n                            </h3>\r\n                            ${variant || item.variant_name ? `\r\n                                <p class=\"text-sm text-gray-500 dark:text-stone-400 mt-1\">${Templates.escapeHtml(variant?.name || variant?.value || item.variant_name)}</p>\r\n                            ` : ''}\r\n                        </div>\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <button class=\"save-for-later-btn text-gray-400 dark:text-stone-500 hover:text-primary-600 dark:hover:text-amber-400 transition-colors\" aria-label=\"Save for later\" title=\"Save for later\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\r\n                                </svg>\r\n                            </button>\r\n                            <button class=\"remove-item-btn text-gray-400 dark:text-stone-500 hover:text-red-500 transition-colors\" aria-label=\"Remove item\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"mt-4 flex items-center justify-between\">\r\n                        <div class=\"flex items-center border border-gray-300 dark:border-stone-600 rounded-lg\">\r\n                            <button \r\n                                class=\"qty-decrease px-3 py-1 text-gray-600 dark:text-stone-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-stone-700 transition-colors\"\r\n                                aria-label=\"Decrease quantity\"\r\n                            >\r\n                                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"/>\r\n                                </svg>\r\n                            </button>\r\n                            <input \n                                type=\"text\"\n                                inputmode=\"numeric\"\n                                readonly\n                                class=\"item-quantity w-12 text-center border-0 bg-transparent dark:text-white focus:ring-0 text-sm appearance-none\"\n                                value=\"${item.quantity}\" \n                                min=\"1\" \n                                max=\"${product.stock_quantity || 99}\"\n                            >\n                            <button \r\n                                class=\"qty-increase px-3 py-1 text-gray-600 dark:text-stone-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-stone-700 transition-colors\"\r\n                                aria-label=\"Increase quantity\"\r\n                            >\r\n                                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                        <div class=\"text-right\">\r\n                            ${showOriginal ? `\r\n                                <span class=\"text-sm text-gray-400 dark:text-stone-500 line-through\">${formatCartPrice(priceAtAdd * item.quantity)}</span>\r\n                            ` : ''}\r\n                            <span class=\"font-semibold text-gray-900 dark:text-white block\">${formatCartPrice(lineTotal)}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    function bindCartEvents() {\n        const cartItems = document.getElementById('cart-items');\n        const clearCartBtn = document.getElementById('clear-cart-btn');\n        const removeCouponBtn = document.getElementById('remove-coupon-btn');\n\n        if (cartItems && cartItems.getAttribute(BOUND_ATTR) !== 'true') {\n            cartItems.setAttribute(BOUND_ATTR, 'true');\n            cartItems.addEventListener('click', async (e) => {\n            const cartItem = e.target.closest('.cart-item');\n            if (!cartItem) return;\n\r\n            const itemId = cartItem.dataset.itemId;\r\n            const productId = cartItem.dataset.productId;\r\n            const qtyInput = cartItem.querySelector('.item-quantity') || cartItem.querySelector('.qty-input');\r\n\r\n            if (e.target.closest('.remove-item-btn')) {\r\n                await removeItem(itemId);\r\n            } else if (e.target.closest('.save-for-later-btn')) {\r\n                await saveForLater(itemId, productId, cartItem);\r\n            } else if (e.target.closest('.qty-decrease')) {\r\n                const current = parseInt(qtyInput?.value, 10) || 1;\r\n                if (current > 1) {\r\n                    await updateQuantity(itemId, current - 1);\r\n                }\r\n            } else if (e.target.closest('.qty-increase')) {\r\n                const current = parseInt(qtyInput?.value, 10) || 1;\r\n                const max = parseInt(qtyInput?.max, 10) || 99;\r\n                if (current < max) {\r\n                    await updateQuantity(itemId, current + 1);\r\n                }\r\n            }\n            });\n\n            cartItems.addEventListener('change', async (e) => {\n            if (e.target.classList.contains('item-quantity') || e.target.classList.contains('qty-input')) {\n                const cartItem = e.target.closest('.cart-item');\n                const itemId = cartItem?.dataset.itemId;\n                const quantity = parseInt(e.target.value, 10) || 1;\n                \n                if (itemId && quantity > 0) {\n                    await updateQuantity(itemId, quantity);\n                }\n            }\n            });\n        }\n\n        if (clearCartBtn && clearCartBtn.getAttribute(BOUND_ATTR) !== 'true') {\n            clearCartBtn.setAttribute(BOUND_ATTR, 'true');\n            clearCartBtn.addEventListener('click', async () => {\n            const confirmed = await Modal.confirm({\n                title: 'Clear Cart',\n                message: 'Are you sure you want to remove all items from your cart?',\n                confirmText: 'Clear Cart',\n                cancelText: 'Cancel'\n            });\n\n            if (confirmed) {\n                await clearCart();\n            }\n            });\n        }\n\n        if (removeCouponBtn && removeCouponBtn.getAttribute(BOUND_ATTR) !== 'true') {\n            removeCouponBtn.setAttribute(BOUND_ATTR, 'true');\n            removeCouponBtn.addEventListener('click', async () => {\n                await removeCoupon();\n            });\n        }\n    }\n\r\n    async function updateQuantity(itemId, quantity) {\r\n        try {\r\n            await CartApi.updateItem(itemId, quantity);\r\n            await loadCart();\r\n            document.dispatchEvent(new CustomEvent('cart:updated'));\r\n        } catch (error) {\r\n            Toast.error(error.message || 'Failed to update quantity.');\r\n        }\r\n    }\r\n\r\n    async function removeItem(itemId) {\r\n        try {\r\n            await CartApi.removeItem(itemId);\r\n            Toast.success('Item removed from cart.');\r\n            await loadCart();\r\n            document.dispatchEvent(new CustomEvent('cart:updated'));\r\n        } catch (error) {\r\n            Toast.error(error.message || 'Failed to remove item.');\r\n        }\r\n    }\r\n\r\n    async function saveForLater(itemId, productId, cartItemElement) {\r\n        try {\r\n            // Find the item in cart\r\n            const item = cart?.items?.find(i => String(i.id) === String(itemId));\r\n            if (!item) return;\r\n\r\n            const product = item.product || {};\r\n            \r\n            // Add to saved for later\r\n            const savedItem = {\r\n                id: productId || product.id || item.product_id,\r\n                name: product.name || item.product_name || 'Product',\r\n                image: item.product_image || product.primary_image || product.image || '',\r\n                price: item.current_price || item.unit_price || product.price || 0\r\n            };\r\n\r\n            // Check if already saved\r\n            const existingIndex = savedForLater.findIndex(i => i.id === productId);\r\n            if (existingIndex === -1) {\r\n                savedForLater.push(savedItem);\r\n                localStorage.setItem('savedForLater', JSON.stringify(savedForLater));\r\n            }\r\n\r\n            // Remove from cart\r\n            await CartApi.removeItem(itemId);\r\n            Toast.success('Item saved for later');\r\n            await loadCart();\r\n            document.dispatchEvent(new CustomEvent('cart:updated'));\r\n        } catch (error) {\r\n            Toast.error(error.message || 'Failed to save item.');\r\n        }\r\n    }\r\n\r\n    async function clearCart() {\r\n        try {\r\n            await CartApi.clearCart();\r\n            Toast.success('Cart cleared.');\r\n            await loadCart();\r\n            document.dispatchEvent(new CustomEvent('cart:updated'));\r\n        } catch (error) {\r\n            Toast.error(error.message || 'Failed to clear cart.');\r\n        }\r\n    }\r\n\r\n    function initCouponForm() {\n        const form = document.getElementById('coupon-form');\n        \n        form?.addEventListener('submit', async (e) => {\n            e.preventDefault();\r\n            \r\n            const codeInput = document.getElementById('coupon-code');\r\n            const code = codeInput?.value.trim();\r\n\r\n            if (!code) {\r\n                Toast.error('Please enter a coupon code.');\r\n                return;\r\n            }\r\n\r\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            submitBtn.disabled = true;\n            submitBtn.textContent = 'Applying...';\n\n            try {\n                const subtotalValue = parseAmount(cart?.summary?.subtotal ?? cart?.subtotal ?? 0);\n                const response = await CartApi.applyCoupon(code, { subtotal: subtotalValue });\n                const appliedCode = response?.data?.cart?.coupon?.code || response?.data?.cart?.coupon_code || code;\n                updateCouponUI(appliedCode);\n                Toast.success('Coupon applied!');\n                await loadCart();\n            } catch (error) {\n                Toast.error(resolveErrorMessage(error, 'Invalid coupon code.'));\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = 'Apply';\n            }\n        });\n\n        const applyBtn = document.getElementById('apply-coupon-btn');\n        applyBtn?.addEventListener('click', async () => {\n            const codeInput = document.getElementById('coupon-code');\n            const code = codeInput?.value.trim();\n\n            if (!code) {\n                Toast.error('Please enter a coupon code.');\n                return;\n            }\n\n            applyBtn.disabled = true;\n            const originalText = applyBtn.textContent;\n            applyBtn.textContent = 'Applying...';\n\n            try {\n                const subtotalValue = parseAmount(cart?.summary?.subtotal ?? cart?.subtotal ?? 0);\n                const response = await CartApi.applyCoupon(code, { subtotal: subtotalValue });\n                const appliedCode = response?.data?.cart?.coupon?.code || response?.data?.cart?.coupon_code || code;\n                updateCouponUI(appliedCode);\n                Toast.success('Coupon applied!');\n                await loadCart();\n            } catch (error) {\n                Toast.error(resolveErrorMessage(error, 'Invalid coupon code.'));\n            } finally {\n                applyBtn.disabled = false;\n                applyBtn.textContent = originalText || 'Apply';\n            }\n        });\n    }\n\r\n    async function removeCoupon() {\r\n        try {\n            await CartApi.removeCoupon();\n            updateCouponUI('');\n            Toast.success('Coupon removed.');\n            await loadCart();\n        } catch (error) {\n            Toast.error(resolveErrorMessage(error, 'Failed to remove coupon.'));\n        }\n    }\n\r\n    function destroy() {\r\n        cart = null;\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy\r\n    };\r\n})();\r\n\r\nwindow.CartPage = CartPage;\r\nexport default CartPage;\r\n", "/**\n * Category Page - Enhanced with Advanced E-commerce Features\n * @module pages/category\n */\n\nconst CategoryPage = (function() {\n    'use strict';\n\n    let currentFilters = {};\n    let currentPage = 1;\n    let currentCategory = null;\n    let abortController = null;\n    let initialized = false;\n    let isLoadingMore = false;\n    let hasMoreProducts = true;\n    let allProducts = [];\n    let compareList = [];\n    const MAX_COMPARE = 4;\n\n    async function init() {\n        // Prevent multiple initializations\n        if (initialized) return;\n        initialized = true;\n\n        const categorySlug = getCategorySlugFromUrl();\n        \n        // If no category slug, this is the categories list page - don't try to load a specific category\n        if (!categorySlug) {\n            // Just initialize any list-specific functionality if needed\n            return;\n        }\n\n        // Check if content is already server-rendered\n        const headerContainer = document.getElementById('category-header');\n        if (headerContainer && headerContainer.querySelector('h1')) {\n            // Server-rendered content exists - just bind event handlers\n            initFilterHandlers();\n            initSortHandler();\n            initViewToggle();\n            initEnhancedFeatures();\n            return;\n        }\n\n        currentFilters = getFiltersFromUrl();\n        currentPage = parseInt(new URLSearchParams(window.location.search).get('page')) || 1;\n\n        await loadCategory(categorySlug);\n        initFilterHandlers();\n        initSortHandler();\n        initViewToggle();\n        initEnhancedFeatures();\n    }\n\n    // ============================================\n    // ENHANCED FEATURES INITIALIZATION\n    // ============================================\n    function initEnhancedFeatures() {\n        initInfiniteScroll();\n        initCompareProducts();\n        initQuickView();\n        initPriceRangeSlider();\n        initActiveFiltersDisplay();\n        initProductCountDisplay();\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Infinite Scroll\n    // ============================================\n    function initInfiniteScroll() {\n        const loadMoreTrigger = document.getElementById('load-more-trigger');\n        if (!loadMoreTrigger) return;\n\n        const observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting && !isLoadingMore && hasMoreProducts) {\n                    loadMoreProducts();\n                }\n            });\n        }, {\n            rootMargin: '200px 0px',\n            threshold: 0.01\n        });\n\n        observer.observe(loadMoreTrigger);\n    }\n\n    async function loadMoreProducts() {\n        if (isLoadingMore || !hasMoreProducts || !currentCategory) return;\n        \n        isLoadingMore = true;\n        currentPage++;\n        \n        const loadingIndicator = document.getElementById('loading-more-indicator');\n        if (loadingIndicator) {\n            loadingIndicator.classList.remove('hidden');\n        }\n\n        try {\n            const params = {\n                category: currentCategory.id,\n                page: currentPage,\n                limit: 12,\n                ...currentFilters\n            };\n\n            const response = await ProductsApi.getAll(params);\n            const products = response.data || [];\n            const meta = response.meta || {};\n\n            if (products.length === 0) {\n                hasMoreProducts = false;\n            } else {\n                allProducts = [...allProducts, ...products];\n                appendProducts(products);\n                hasMoreProducts = currentPage < (meta.total_pages || 1);\n            }\n\n            updateUrl();\n        } catch (error) {\n            console.error('Failed to load more products:', error);\n        } finally {\n            isLoadingMore = false;\n            if (loadingIndicator) {\n                loadingIndicator.classList.add('hidden');\n            }\n        }\n    }\n\n    function appendProducts(products) {\n        const container = document.getElementById('products-grid');\n        if (!container) return;\n\n        const viewMode = Storage.get('productViewMode') || 'grid';\n        \n        products.forEach(product => {\n            const productHtml = ProductCard.render(product, { \n                layout: viewMode,\n                showCompare: true,\n                showQuickView: true\n            });\n            const tempDiv = document.createElement('div');\n            tempDiv.innerHTML = productHtml;\n            const productEl = tempDiv.firstElementChild;\n            productEl.classList.add('animate-fadeInUp');\n            container.appendChild(productEl);\n        });\n\n        ProductCard.bindEvents(container);\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Compare Products\n    // ============================================\n    function initCompareProducts() {\n        // Load compare list from storage\n        compareList = JSON.parse(localStorage.getItem('compareProducts') || '[]');\n        updateCompareBar();\n\n        // Listen for compare toggle events\n        document.addEventListener('click', (e) => {\n            const compareBtn = e.target.closest('[data-compare]');\n            if (!compareBtn) return;\n\n            e.preventDefault();\n            const productId = parseInt(compareBtn.dataset.compare);\n            toggleCompare(productId);\n        });\n    }\n\n    function toggleCompare(productId) {\n        const index = compareList.findIndex(p => p.id === productId);\n        \n        if (index > -1) {\n            compareList.splice(index, 1);\n            Toast.info('Removed from compare');\n        } else {\n            if (compareList.length >= MAX_COMPARE) {\n                Toast.warning(`You can compare up to ${MAX_COMPARE} products`);\n                return;\n            }\n            \n            const product = allProducts.find(p => p.id === productId);\n            if (product) {\n                compareList.push({\n                    id: product.id,\n                    name: product.name,\n                    image: product.primary_image || product.image,\n                    price: product.price,\n                    sale_price: product.sale_price\n                });\n                Toast.success('Added to compare');\n            }\n        }\n\n        localStorage.setItem('compareProducts', JSON.stringify(compareList));\n        updateCompareBar();\n        updateCompareButtons();\n    }\n\n    function updateCompareBar() {\n        let compareBar = document.getElementById('compare-bar');\n        \n        if (compareList.length === 0) {\n            compareBar?.remove();\n            return;\n        }\n\n        if (!compareBar) {\n            compareBar = document.createElement('div');\n            compareBar.id = 'compare-bar';\n            compareBar.className = 'fixed bottom-0 left-0 right-0 bg-white dark:bg-stone-800 border-t border-stone-200 dark:border-stone-700 shadow-2xl z-40 transform transition-transform duration-300';\n            document.body.appendChild(compareBar);\n        }\n\n        compareBar.innerHTML = `\n            <div class=\"container mx-auto px-4 py-4\">\n                <div class=\"flex items-center justify-between gap-4\">\n                    <div class=\"flex items-center gap-3 overflow-x-auto\">\n                        <span class=\"text-sm font-medium text-stone-600 dark:text-stone-400 whitespace-nowrap\">Compare (${compareList.length}/${MAX_COMPARE}):</span>\n                        ${compareList.map(product => `\n                            <div class=\"relative flex-shrink-0 group\">\n                                <img src=\"${product.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(product.name)}\" class=\"w-14 h-14 object-cover rounded-lg border border-stone-200 dark:border-stone-600\">\n                                <button data-remove-compare=\"${product.id}\" class=\"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                                    <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                                </button>\n                            </div>\n                        `).join('')}\n                    </div>\n                    <div class=\"flex items-center gap-2\">\n                        <button id=\"compare-now-btn\" class=\"px-4 py-2 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-lg hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\" ${compareList.length < 2 ? 'disabled' : ''}>\n                            Compare Now\n                        </button>\n                        <button id=\"clear-compare-btn\" class=\"px-4 py-2 text-stone-600 dark:text-stone-400 hover:text-stone-800 dark:hover:text-stone-200 transition-colors\">\n                            Clear All\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Bind compare bar events\n        compareBar.querySelectorAll('[data-remove-compare]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const productId = parseInt(btn.dataset.removeCompare);\n                toggleCompare(productId);\n            });\n        });\n\n        document.getElementById('compare-now-btn')?.addEventListener('click', openCompareModal);\n        document.getElementById('clear-compare-btn')?.addEventListener('click', clearCompare);\n    }\n\n    function updateCompareButtons() {\n        document.querySelectorAll('[data-compare]').forEach(btn => {\n            const productId = parseInt(btn.dataset.compare);\n            const isInCompare = compareList.some(p => p.id === productId);\n            \n            if (isInCompare) {\n                btn.classList.add('bg-primary-100', 'text-primary-600');\n                btn.classList.remove('bg-stone-100', 'text-stone-600');\n            } else {\n                btn.classList.remove('bg-primary-100', 'text-primary-600');\n                btn.classList.add('bg-stone-100', 'text-stone-600');\n            }\n        });\n    }\n\n    function clearCompare() {\n        compareList = [];\n        localStorage.removeItem('compareProducts');\n        updateCompareBar();\n        updateCompareButtons();\n        Toast.info('Compare list cleared');\n    }\n\n    async function openCompareModal() {\n        if (compareList.length < 2) return;\n\n        const modal = document.createElement('div');\n        modal.id = 'compare-modal';\n        modal.className = 'fixed inset-0 z-50 overflow-auto';\n        modal.innerHTML = `\n            <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('compare-modal').remove()\"></div>\n            <div class=\"relative min-h-full flex items-center justify-center p-4\">\n                <div class=\"bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto\">\n                    <div class=\"sticky top-0 bg-white dark:bg-stone-800 border-b border-stone-200 dark:border-stone-700 p-4 flex items-center justify-between z-10\">\n                        <h2 class=\"text-xl font-bold text-stone-900 dark:text-white\">Compare Products</h2>\n                        <button onclick=\"document.getElementById('compare-modal').remove()\" class=\"w-10 h-10 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\">\n                            <svg class=\"w-5 h-5 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                        </button>\n                    </div>\n                    <div class=\"p-4 overflow-x-auto\">\n                        <table class=\"w-full min-w-[600px]\">\n                            <thead>\n                                <tr>\n                                    <th class=\"text-left p-3 text-sm font-medium text-stone-500 dark:text-stone-400 w-32\">Feature</th>\n                                    ${compareList.map(p => `\n                                        <th class=\"p-3 text-center\">\n                                            <div class=\"flex flex-col items-center\">\n                                                <img src=\"${p.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(p.name)}\" class=\"w-24 h-24 object-cover rounded-xl mb-2\">\n                                                <span class=\"text-sm font-semibold text-stone-900 dark:text-white\">${Templates.escapeHtml(p.name)}</span>\n                                            </div>\n                                        </th>\n                                    `).join('')}\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr class=\"border-t border-stone-100 dark:border-stone-700\">\n                                    <td class=\"p-3 text-sm font-medium text-stone-600 dark:text-stone-400\">Price</td>\n                                    ${compareList.map(p => `\n                                        <td class=\"p-3 text-center\">\n                                            ${p.sale_price ? `\n                                                <span class=\"text-lg font-bold text-primary-600 dark:text-amber-400\">${Templates.formatPrice(p.sale_price)}</span>\n                                                <span class=\"text-sm text-stone-400 line-through ml-1\">${Templates.formatPrice(p.price)}</span>\n                                            ` : `\n                                                <span class=\"text-lg font-bold text-stone-900 dark:text-white\">${Templates.formatPrice(p.price)}</span>\n                                            `}\n                                        </td>\n                                    `).join('')}\n                                </tr>\n                                <tr class=\"border-t border-stone-100 dark:border-stone-700\">\n                                    <td class=\"p-3 text-sm font-medium text-stone-600 dark:text-stone-400\">Actions</td>\n                                    ${compareList.map(p => `\n                                        <td class=\"p-3 text-center\">\n                                            <button onclick=\"CartApi.addItem(${p.id}, 1).then(() => Toast.success('Added to cart'))\" class=\"px-4 py-2 bg-primary-600 dark:bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\n                                                Add to Cart\n                                            </button>\n                                        </td>\n                                    `).join('')}\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        document.body.appendChild(modal);\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Quick View Modal\n    // ============================================\n    function initQuickView() {\n        document.addEventListener('click', async (e) => {\n            const quickViewBtn = e.target.closest('[data-quick-view]');\n            if (!quickViewBtn) return;\n\n            const productId = quickViewBtn.dataset.quickView;\n            if (!productId) return;\n\n            e.preventDefault();\n            await showQuickView(productId);\n        });\n    }\n\n    async function showQuickView(productId) {\n        const modal = document.createElement('div');\n        modal.id = 'quick-view-modal';\n        modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\n        modal.innerHTML = `\n            <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('quick-view-modal').remove()\"></div>\n            <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto\">\n                <div class=\"p-8 flex items-center justify-center min-h-[400px]\">\n                    <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 dark:border-amber-400\"></div>\n                </div>\n            </div>\n        `;\n        document.body.appendChild(modal);\n\n        try {\n            const response = await ProductsApi.getProduct(productId);\n            const product = response.data || response;\n\n            const modalContent = modal.querySelector('.relative');\n            modalContent.innerHTML = `\n                <button class=\"absolute top-4 right-4 z-10 w-10 h-10 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\" onclick=\"document.getElementById('quick-view-modal').remove()\">\n                    <svg class=\"w-5 h-5 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                </button>\n                <div class=\"grid md:grid-cols-2 gap-8 p-8\">\n                    <div>\n                        <div class=\"aspect-square rounded-xl overflow-hidden bg-stone-100 dark:bg-stone-700 mb-4\">\n                            <img src=\"${product.primary_image || product.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(product.name)}\" class=\"w-full h-full object-cover\" id=\"quick-view-main-image\">\n                        </div>\n                        ${product.images && product.images.length > 1 ? `\n                            <div class=\"flex gap-2 overflow-x-auto pb-2\">\n                                ${product.images.slice(0, 5).map((img, i) => `\n                                    <button class=\"w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden border-2 ${i === 0 ? 'border-primary-600 dark:border-amber-400' : 'border-transparent'} hover:border-primary-400 transition-colors\" onclick=\"document.getElementById('quick-view-main-image').src='${img.image || img}'\">\n                                        <img src=\"${img.thumbnail || img.image || img}\" alt=\"\" class=\"w-full h-full object-cover\">\n                                    </button>\n                                `).join('')}\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <h2 class=\"text-2xl font-bold text-stone-900 dark:text-white mb-2\">${Templates.escapeHtml(product.name)}</h2>\n                        <div class=\"flex items-center gap-2 mb-4\">\n                            <div class=\"flex text-amber-400\">\n                                ${'<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.385 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.385-2.46a1 1 0 00-1.175 0l-3.385 2.46c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118l-3.385-2.46c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.286-3.967z\"/></svg>'.repeat(Math.round(product.rating || 4))}\n                            </div>\n                            <span class=\"text-sm text-stone-500 dark:text-stone-400\">(${product.review_count || 0} reviews)</span>\n                            ${product.stock_quantity <= 5 && product.stock_quantity > 0 ? `\n                                <span class=\"text-sm text-orange-600 dark:text-orange-400 font-medium\">Only ${product.stock_quantity} left!</span>\n                            ` : ''}\n                        </div>\n                        <div class=\"mb-6\">\n                            ${product.sale_price || product.discounted_price ? `\n                                <span class=\"text-3xl font-bold text-primary-600 dark:text-amber-400\">${Templates.formatPrice(product.sale_price || product.discounted_price)}</span>\n                                <span class=\"text-lg text-stone-400 line-through ml-2\">${Templates.formatPrice(product.price)}</span>\n                                <span class=\"ml-2 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-sm font-medium rounded\">Save ${Math.round((1 - (product.sale_price || product.discounted_price) / product.price) * 100)}%</span>\n                            ` : `\n                                <span class=\"text-3xl font-bold text-stone-900 dark:text-white\">${Templates.formatPrice(product.price)}</span>\n                            `}\n                        </div>\n                        <p class=\"text-stone-600 dark:text-stone-400 mb-6 line-clamp-3\">${Templates.escapeHtml(product.short_description || product.description || '')}</p>\n                        \n                        <!-- Quantity Selector -->\n                        <div class=\"flex items-center gap-4 mb-6\">\n                            <span class=\"text-sm font-medium text-stone-700 dark:text-stone-300\">Quantity:</span>\n                            <div class=\"flex items-center border border-stone-300 dark:border-stone-600 rounded-lg\">\n                                <button id=\"qv-qty-minus\" class=\"w-10 h-10 flex items-center justify-center text-stone-600 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-700 transition-colors\">\u2212</button>\n                                <input type=\"number\" id=\"qv-qty-input\" value=\"1\" min=\"1\" max=\"${product.stock_quantity || 99}\" class=\"w-16 h-10 text-center border-x border-stone-300 dark:border-stone-600 bg-transparent text-stone-900 dark:text-white\">\n                                <button id=\"qv-qty-plus\" class=\"w-10 h-10 flex items-center justify-center text-stone-600 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-700 transition-colors\">+</button>\n                            </div>\n                        </div>\n\n                        <div class=\"mt-auto space-y-3\">\n                            <button id=\"qv-add-to-cart\" class=\"w-full py-3 px-6 bg-primary-600 dark:bg-amber-600 hover:bg-primary-700 dark:hover:bg-amber-700 text-white font-semibold rounded-xl transition-colors flex items-center justify-center gap-2\">\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/></svg>\n                                Add to Cart\n                            </button>\n                            <div class=\"grid grid-cols-2 gap-3\">\n                                <button onclick=\"WishlistApi.add(${product.id}).then(() => Toast.success('Added to wishlist'))\" class=\"py-3 px-6 border-2 border-stone-200 dark:border-stone-600 text-stone-700 dark:text-stone-300 font-semibold rounded-xl hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors flex items-center justify-center gap-2\">\n                                    <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/></svg>\n                                    Wishlist\n                                </button>\n                                <a href=\"/products/${product.slug || product.id}/\" class=\"py-3 px-6 border-2 border-stone-200 dark:border-stone-600 text-stone-700 dark:text-stone-300 font-semibold rounded-xl text-center hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors\">\n                                    Full Details\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n\n            // Bind quantity controls\n            const qtyInput = document.getElementById('qv-qty-input');\n            const qtyMinus = document.getElementById('qv-qty-minus');\n            const qtyPlus = document.getElementById('qv-qty-plus');\n            const addToCartBtn = document.getElementById('qv-add-to-cart');\n\n            qtyMinus?.addEventListener('click', () => {\n                const val = parseInt(qtyInput.value) || 1;\n                if (val > 1) qtyInput.value = val - 1;\n            });\n\n            qtyPlus?.addEventListener('click', () => {\n                const val = parseInt(qtyInput.value) || 1;\n                const max = parseInt(qtyInput.max) || 99;\n                if (val < max) qtyInput.value = val + 1;\n            });\n\n            addToCartBtn?.addEventListener('click', async () => {\n                const qty = parseInt(qtyInput.value) || 1;\n                addToCartBtn.disabled = true;\n                addToCartBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\n                \n                try {\n                    await CartApi.addItem(product.id, qty);\n                    Toast.success('Added to cart');\n                    modal.remove();\n                } catch (error) {\n                    Toast.error('Failed to add to cart');\n                } finally {\n                    addToCartBtn.disabled = false;\n                    addToCartBtn.innerHTML = '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/></svg> Add to Cart';\n                }\n            });\n        } catch (error) {\n            console.error('Failed to load product:', error);\n            modal.remove();\n            Toast.error('Failed to load product details');\n        }\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Price Range Slider\n    // ============================================\n    function initPriceRangeSlider() {\n        const sliderContainer = document.getElementById('price-range-slider');\n        if (!sliderContainer) return;\n\n        // This creates an enhanced dual-thumb slider\n        const minInput = document.getElementById('filter-min-price');\n        const maxInput = document.getElementById('filter-max-price');\n        \n        if (!minInput || !maxInput) return;\n\n        // Add input event listeners for real-time feedback\n        [minInput, maxInput].forEach(input => {\n            input.addEventListener('input', () => {\n                updatePriceRangeDisplay();\n            });\n        });\n    }\n\n    function updatePriceRangeDisplay() {\n        const display = document.getElementById('price-range-display');\n        const minVal = document.getElementById('filter-min-price')?.value || 0;\n        const maxVal = document.getElementById('filter-max-price')?.value || '\u221E';\n        \n        if (display) {\n            display.textContent = `$${minVal} - $${maxVal}`;\n        }\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Active Filters Display\n    // ============================================\n    function initActiveFiltersDisplay() {\n        updateActiveFiltersDisplay();\n    }\n\n    function updateActiveFiltersDisplay() {\n        const container = document.getElementById('active-filters');\n        if (!container) return;\n\n        const filters = [];\n        \n        if (currentFilters.min_price) {\n            filters.push({ key: 'min_price', label: `Min: $${currentFilters.min_price}` });\n        }\n        if (currentFilters.max_price) {\n            filters.push({ key: 'max_price', label: `Max: $${currentFilters.max_price}` });\n        }\n        if (currentFilters.in_stock) {\n            filters.push({ key: 'in_stock', label: 'In Stock' });\n        }\n        if (currentFilters.on_sale) {\n            filters.push({ key: 'on_sale', label: 'On Sale' });\n        }\n        if (currentFilters.ordering) {\n            const orderLabels = {\n                'price': 'Price: Low to High',\n                '-price': 'Price: High to Low',\n                '-created_at': 'Newest First',\n                'name': 'A-Z',\n                '-popularity': 'Most Popular'\n            };\n            filters.push({ key: 'ordering', label: orderLabels[currentFilters.ordering] || currentFilters.ordering });\n        }\n\n        if (filters.length === 0) {\n            container.innerHTML = '';\n            return;\n        }\n\n        container.innerHTML = `\n            <div class=\"flex flex-wrap items-center gap-2 mb-4\">\n                <span class=\"text-sm text-stone-500 dark:text-stone-400\">Active filters:</span>\n                ${filters.map(f => `\n                    <button data-remove-filter=\"${f.key}\" class=\"inline-flex items-center gap-1 px-3 py-1 bg-primary-100 dark:bg-amber-900/30 text-primary-700 dark:text-amber-400 rounded-full text-sm hover:bg-primary-200 dark:hover:bg-amber-900/50 transition-colors\">\n                        ${f.label}\n                        <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                    </button>\n                `).join('')}\n                <button id=\"clear-all-active-filters\" class=\"text-sm text-stone-500 dark:text-stone-400 hover:text-stone-700 dark:hover:text-stone-300 underline\">Clear all</button>\n            </div>\n        `;\n\n        container.querySelectorAll('[data-remove-filter]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const key = btn.dataset.removeFilter;\n                delete currentFilters[key];\n                applyFilters();\n            });\n        });\n\n        document.getElementById('clear-all-active-filters')?.addEventListener('click', () => {\n            currentFilters = {};\n            applyFilters();\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Product Count Display\n    // ============================================\n    function initProductCountDisplay() {\n        updateProductCount();\n    }\n\n    function updateProductCount(total = null) {\n        const countEl = document.getElementById('product-count');\n        if (!countEl) return;\n        \n        if (total !== null) {\n            countEl.textContent = `${total} products`;\n        }\n    }\n\n    function getCategorySlugFromUrl() {\n        const path = window.location.pathname;\n        const match = path.match(/\\/categories\\/([^\\/]+)/);\n        return match ? match[1] : null;\n    }\n\n    function getFiltersFromUrl() {\n        const params = new URLSearchParams(window.location.search);\n        const filters = {};\n\n        if (params.get('min_price')) filters.min_price = params.get('min_price');\n        if (params.get('max_price')) filters.max_price = params.get('max_price');\n        if (params.get('ordering')) filters.ordering = params.get('ordering');\n        if (params.get('in_stock')) filters.in_stock = params.get('in_stock') === 'true';\n        if (params.get('on_sale')) filters.on_sale = params.get('on_sale') === 'true';\n        \n        const attributes = params.getAll('attr');\n        if (attributes.length) filters.attributes = attributes;\n\n        return filters;\n    }\n\n    async function loadCategory(slug) {\n        const headerContainer = document.getElementById('category-header');\n        const productsContainer = document.getElementById('category-products');\n        const filtersContainer = document.getElementById('category-filters');\n\n        if (headerContainer) Loader.show(headerContainer, 'skeleton');\n        if (productsContainer) Loader.show(productsContainer, 'skeleton');\n\n        try {\n            const categoryResponse = await CategoriesApi.getCategory(slug);\n            currentCategory = categoryResponse.data || categoryResponse;\n\n            if (!currentCategory) {\n                window.location.href = '/404/';\n                return;\n            }\n\n            renderCategoryHeader(currentCategory);\n            await loadBreadcrumbs(currentCategory);\n            await loadFilters(currentCategory);\n            await loadProducts();\n            await loadSubcategories(currentCategory);\n        } catch (error) {\n            console.error('Failed to load category:', error);\n            if (headerContainer) {\n                headerContainer.innerHTML = '<p class=\"text-red-500\">Failed to load category.</p>';\n            }\n        }\n    }\n\n    function renderCategoryHeader(category) {\n        const container = document.getElementById('category-header');\n        if (!container) return;\n\n        document.title = `${category.name} | Bunoraa`;\n\n        container.innerHTML = `\n            <div class=\"relative py-8 md:py-12\">\n                ${category.image ? `\n                    <div class=\"absolute inset-0 overflow-hidden rounded-2xl\">\n                        <img src=\"${category.image}\" alt=\"\" class=\"w-full h-full object-cover opacity-20\">\n                        <div class=\"absolute inset-0 bg-gradient-to-r from-white via-white/95 to-white/80\"></div>\n                    </div>\n                ` : ''}\n                <div class=\"relative\">\n                    <h1 class=\"text-3xl md:text-4xl font-bold text-gray-900 mb-2\">${Templates.escapeHtml(category.name)}</h1>\n                    ${category.description ? `\n                        <p class=\"text-gray-600 max-w-2xl\">${Templates.escapeHtml(category.description)}</p>\n                    ` : ''}\n                    ${category.product_count ? `\n                        <p class=\"mt-4 text-sm text-gray-500\">${category.product_count} products</p>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    async function loadBreadcrumbs(category) {\n        const container = document.getElementById('breadcrumbs');\n        if (!container) return;\n\n        try {\n            const response = await CategoriesApi.getBreadcrumbs(category.id);\n            const breadcrumbs = response.data || [];\n            \n            const items = [\n                { label: 'Home', url: '/' },\n                { label: 'Categories', url: '/categories/' },\n                ...breadcrumbs.map(item => ({\n                    label: item.name,\n                    url: `/categories/${item.slug}/`\n                }))\n            ];\n\n            container.innerHTML = Breadcrumb.render(items);\n        } catch (error) {\n            console.error('Failed to load breadcrumbs:', error);\n        }\n    }\n\n    async function loadFilters(category) {\n        const container = document.getElementById('category-filters');\n        if (!container) return;\n\n        try {\n            const response = await ProductsApi.getFilterOptions({ category: category.id });\n            const filterOptions = response.data || {};\n\n            container.innerHTML = `\n                <div class=\"space-y-6\">\n                    <!-- Price Range -->\n                    <div class=\"border-b border-gray-200 pb-6\">\n                        <h3 class=\"text-sm font-semibold text-gray-900 mb-4\">Price Range</h3>\n                        <div class=\"flex items-center gap-2\">\n                            <input \n                                type=\"number\" \n                                id=\"filter-min-price\" \n                                placeholder=\"Min\"\n                                value=\"${currentFilters.min_price || ''}\"\n                                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500\"\n                            >\n                            <span class=\"text-gray-400\">-</span>\n                            <input \n                                type=\"number\" \n                                id=\"filter-max-price\" \n                                placeholder=\"Max\"\n                                value=\"${currentFilters.max_price || ''}\"\n                                class=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500\"\n                            >\n                        </div>\n                        <button id=\"apply-price-filter\" class=\"mt-3 w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium rounded-lg transition-colors\">\n                            Apply\n                        </button>\n                    </div>\n\n                    <!-- Availability -->\n                    <div class=\"border-b border-gray-200 pb-6\">\n                        <h3 class=\"text-sm font-semibold text-gray-900 mb-4\">Availability</h3>\n                        <div class=\"space-y-2\">\n                            <label class=\"flex items-center\">\n                                <input \n                                    type=\"checkbox\" \n                                    id=\"filter-in-stock\"\n                                    ${currentFilters.in_stock ? 'checked' : ''}\n                                    class=\"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500\"\n                                >\n                                <span class=\"ml-2 text-sm text-gray-600\">In Stock</span>\n                            </label>\n                            <label class=\"flex items-center\">\n                                <input \n                                    type=\"checkbox\" \n                                    id=\"filter-on-sale\"\n                                    ${currentFilters.on_sale ? 'checked' : ''}\n                                    class=\"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500\"\n                                >\n                                <span class=\"ml-2 text-sm text-gray-600\">On Sale</span>\n                            </label>\n                        </div>\n                    </div>\n\n                    ${filterOptions.attributes && filterOptions.attributes.length ? `\n                        ${filterOptions.attributes.map(attr => `\n                            <div class=\"border-b border-gray-200 pb-6\">\n                                <h3 class=\"text-sm font-semibold text-gray-900 mb-4\">${Templates.escapeHtml(attr.name)}</h3>\n                                <div class=\"space-y-2 max-h-48 overflow-y-auto\">\n                                    ${attr.values.map(value => `\n                                        <label class=\"flex items-center\">\n                                            <input \n                                                type=\"checkbox\" \n                                                name=\"attr-${attr.slug}\"\n                                                value=\"${Templates.escapeHtml(value.value)}\"\n                                                ${currentFilters.attributes?.includes(`${attr.slug}:${value.value}`) ? 'checked' : ''}\n                                                class=\"filter-attribute w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500\"\n                                                data-attribute=\"${attr.slug}\"\n                                            >\n                                            <span class=\"ml-2 text-sm text-gray-600\">${Templates.escapeHtml(value.value)}</span>\n                                            ${value.count ? `<span class=\"ml-auto text-xs text-gray-400\">(${value.count})</span>` : ''}\n                                        </label>\n                                    `).join('')}\n                                </div>\n                            </div>\n                        `).join('')}\n                    ` : ''}\n\n                    <!-- Clear Filters -->\n                    <button id=\"clear-filters\" class=\"w-full px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors\">\n                        Clear All Filters\n                    </button>\n                </div>\n            `;\n\n            bindFilterEvents();\n        } catch (error) {\n            console.error('Failed to load filters:', error);\n            container.innerHTML = '';\n        }\n    }\n\n    function bindFilterEvents() {\n        const applyPriceBtn = document.getElementById('apply-price-filter');\n        const inStockCheckbox = document.getElementById('filter-in-stock');\n        const onSaleCheckbox = document.getElementById('filter-on-sale');\n        const clearBtn = document.getElementById('clear-filters');\n        const attributeCheckboxes = document.querySelectorAll('.filter-attribute');\n\n        applyPriceBtn?.addEventListener('click', () => {\n            const minPrice = document.getElementById('filter-min-price')?.value;\n            const maxPrice = document.getElementById('filter-max-price')?.value;\n            \n            if (minPrice) currentFilters.min_price = minPrice;\n            else delete currentFilters.min_price;\n            \n            if (maxPrice) currentFilters.max_price = maxPrice;\n            else delete currentFilters.max_price;\n\n            applyFilters();\n        });\n\n        inStockCheckbox?.addEventListener('change', (e) => {\n            if (e.target.checked) currentFilters.in_stock = true;\n            else delete currentFilters.in_stock;\n            applyFilters();\n        });\n\n        onSaleCheckbox?.addEventListener('change', (e) => {\n            if (e.target.checked) currentFilters.on_sale = true;\n            else delete currentFilters.on_sale;\n            applyFilters();\n        });\n\n        attributeCheckboxes.forEach(checkbox => {\n            checkbox.addEventListener('change', () => {\n                updateAttributeFilters();\n                applyFilters();\n            });\n        });\n\n        clearBtn?.addEventListener('click', () => {\n            currentFilters = {};\n            currentPage = 1;\n            applyFilters();\n        });\n    }\n\n    function updateAttributeFilters() {\n        const checkboxes = document.querySelectorAll('.filter-attribute:checked');\n        const attributes = [];\n        \n        checkboxes.forEach(cb => {\n            attributes.push(`${cb.dataset.attribute}:${cb.value}`);\n        });\n\n        if (attributes.length) {\n            currentFilters.attributes = attributes;\n        } else {\n            delete currentFilters.attributes;\n        }\n    }\n\n    function applyFilters() {\n        currentPage = 1;\n        updateUrl();\n        loadProducts();\n    }\n\n    function updateUrl() {\n        const params = new URLSearchParams();\n        \n        if (currentFilters.min_price) params.set('min_price', currentFilters.min_price);\n        if (currentFilters.max_price) params.set('max_price', currentFilters.max_price);\n        if (currentFilters.ordering) params.set('ordering', currentFilters.ordering);\n        if (currentFilters.in_stock) params.set('in_stock', 'true');\n        if (currentFilters.on_sale) params.set('on_sale', 'true');\n        if (currentFilters.attributes) {\n            currentFilters.attributes.forEach(attr => params.append('attr', attr));\n        }\n        if (currentPage > 1) params.set('page', currentPage);\n\n        const newUrl = `${window.location.pathname}${params.toString() ? '?' + params.toString() : ''}`;\n        window.history.pushState({}, '', newUrl);\n    }\n\n    async function loadProducts() {\n        const container = document.getElementById('category-products');\n        if (!container || !currentCategory) return;\n\n        if (abortController) {\n            abortController.abort();\n        }\n        abortController = new AbortController();\n\n        Loader.show(container, 'skeleton');\n\n        try {\n            const params = {\n                category: currentCategory.id,\n                page: currentPage,\n                limit: 12,\n                ...currentFilters\n            };\n\n            if (currentFilters.attributes) {\n                delete params.attributes;\n                currentFilters.attributes.forEach(attr => {\n                    const [key, value] = attr.split(':');\n                    params[`attr_${key}`] = value;\n                });\n            }\n\n            const response = await ProductsApi.getAll(params);\n            const products = response.data || [];\n            const meta = response.meta || {};\n\n            // Track products for compare feature\n            allProducts = products;\n            hasMoreProducts = currentPage < (meta.total_pages || 1);\n\n            renderProducts(products, meta);\n            updateActiveFiltersDisplay();\n            updateProductCount(meta.total || products.length);\n        } catch (error) {\n            if (error.name === 'AbortError') return;\n            console.error('Failed to load products:', error);\n            container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load products. Please try again.</p>';\n        }\n    }\n\n    function renderProducts(products, meta) {\n        const container = document.getElementById('category-products');\n        if (!container) return;\n\n        const viewMode = Storage.get('productViewMode') || 'grid';\n        const gridClass = viewMode === 'list' \n            ? 'space-y-4' \n            : 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6';\n\n        if (products.length === 0) {\n            container.innerHTML = `\n                <div class=\"text-center py-12\">\n                    <svg class=\"w-16 h-16 text-gray-300 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                    </svg>\n                    <h3 class=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">No products found</h3>\n                    <p class=\"text-gray-500 dark:text-stone-400 mb-4\">Try adjusting your filters or browse other categories.</p>\n                    <button id=\"clear-filters-empty\" class=\"px-4 py-2 bg-primary-600 dark:bg-amber-600 text-white rounded-lg hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\n                        Clear Filters\n                    </button>\n                </div>\n            `;\n\n            document.getElementById('clear-filters-empty')?.addEventListener('click', () => {\n                currentFilters = {};\n                currentPage = 1;\n                applyFilters();\n            });\n            return;\n        }\n\n        container.innerHTML = `\n            <div id=\"active-filters\" class=\"mb-4\"></div>\n            <div id=\"products-grid\" class=\"${gridClass}\">\n                ${products.map(product => ProductCard.render(product, { \n                    layout: viewMode,\n                    showCompare: true,\n                    showQuickView: true\n                })).join('')}\n            </div>\n            \n            <!-- Infinite Scroll Trigger -->\n            <div id=\"load-more-trigger\" class=\"h-20 flex items-center justify-center\">\n                <div id=\"loading-more-indicator\" class=\"hidden\">\n                    <svg class=\"animate-spin h-8 w-8 text-primary-600 dark:text-amber-400\" fill=\"none\" viewBox=\"0 0 24 24\">\n                        <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n                        <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                    </svg>\n                </div>\n            </div>\n            \n            ${meta.total_pages > 1 ? `\n                <div id=\"products-pagination\" class=\"mt-8\"></div>\n            ` : ''}\n        `;\n\n        ProductCard.bindEvents(container);\n        updateActiveFiltersDisplay();\n        updateCompareButtons();\n\n        // Initialize infinite scroll observer\n        initInfiniteScroll();\n\n        if (meta.total_pages > 1) {\n            const paginationContainer = document.getElementById('products-pagination');\n            paginationContainer.innerHTML = Pagination.render({\n                currentPage: meta.current_page || currentPage,\n                totalPages: meta.total_pages,\n                totalItems: meta.total\n            });\n\n            paginationContainer.addEventListener('click', (e) => {\n                const pageBtn = e.target.closest('[data-page]');\n                if (pageBtn) {\n                    currentPage = parseInt(pageBtn.dataset.page);\n                    hasMoreProducts = true;\n                    updateUrl();\n                    loadProducts();\n                    window.scrollTo({ top: 0, behavior: 'smooth' });\n                }\n            });\n        }\n    }\n\n    async function loadSubcategories(category) {\n        const container = document.getElementById('subcategories');\n        if (!container) return;\n\n        try {\n            const response = await CategoriesApi.getSubcategories(category.id);\n            const subcategories = response.data || [];\n\n            if (subcategories.length === 0) {\n                container.innerHTML = '';\n                return;\n            }\n\n            container.innerHTML = `\n                <div class=\"mb-8\">\n                    <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Browse Subcategories</h2>\n                    <div class=\"flex flex-wrap gap-2\">\n                        ${subcategories.map(sub => `\n                            <a href=\"/categories/${sub.slug}/\" class=\"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-sm transition-colors\">\n                                ${Templates.escapeHtml(sub.name)}\n                                ${sub.product_count ? `<span class=\"text-gray-400 ml-1\">(${sub.product_count})</span>` : ''}\n                            </a>\n                        `).join('')}\n                    </div>\n                </div>\n            `;\n        } catch (error) {\n            console.error('Failed to load subcategories:', error);\n            container.innerHTML = '';\n        }\n    }\n\n    function initFilterHandlers() {\n        const mobileFilterBtn = document.getElementById('mobile-filter-btn');\n        const filterSidebar = document.getElementById('filter-sidebar');\n        const closeFilterBtn = document.getElementById('close-filter-btn');\n\n        mobileFilterBtn?.addEventListener('click', () => {\n            filterSidebar?.classList.remove('hidden');\n            document.body.classList.add('overflow-hidden');\n        });\n\n        closeFilterBtn?.addEventListener('click', () => {\n            filterSidebar?.classList.add('hidden');\n            document.body.classList.remove('overflow-hidden');\n        });\n    }\n\n    function initSortHandler() {\n        const sortSelect = document.getElementById('sort-select');\n        if (!sortSelect) return;\n\n        sortSelect.value = currentFilters.ordering || '';\n\n        sortSelect.addEventListener('change', (e) => {\n            if (e.target.value) {\n                currentFilters.ordering = e.target.value;\n            } else {\n                delete currentFilters.ordering;\n            }\n            applyFilters();\n        });\n    }\n\n    function initViewToggle() {\n        const gridBtn = document.getElementById('view-grid');\n        const listBtn = document.getElementById('view-list');\n        const currentView = Storage.get('productViewMode') || 'grid';\n\n        if (currentView === 'list') {\n            gridBtn?.classList.remove('bg-gray-200');\n            listBtn?.classList.add('bg-gray-200');\n        }\n\n        gridBtn?.addEventListener('click', () => {\n            Storage.set('productViewMode', 'grid');\n            gridBtn.classList.add('bg-gray-200');\n            listBtn?.classList.remove('bg-gray-200');\n            loadProducts();\n        });\n\n        listBtn?.addEventListener('click', () => {\n            Storage.set('productViewMode', 'list');\n            listBtn.classList.add('bg-gray-200');\n            gridBtn?.classList.remove('bg-gray-200');\n            loadProducts();\n        });\n    }\n\n    function destroy() {\n        if (abortController) {\n            abortController.abort();\n            abortController = null;\n        }\n        currentFilters = {};\n        currentPage = 1;\n        currentCategory = null;\n        initialized = false;\n        isLoadingMore = false;\n        hasMoreProducts = true;\n        allProducts = [];\n        // Remove compare bar\n        document.getElementById('compare-bar')?.remove();\n        // Remove quick view modal\n        document.getElementById('quick-view-modal')?.remove();\n        // Remove compare modal\n        document.getElementById('compare-modal')?.remove();\n    }\n\n    return {\n        init,\n        destroy,\n        // Expose for external use\n        toggleCompare,\n        clearCompare\n    };\n})();\n\nwindow.CategoryPage = CategoryPage;\nexport default CategoryPage;\n", "/**\r\n * Checkout Page\r\n * @module pages/checkout\r\n */\r\n\r\nconst CheckoutPage = (async function() {\r\n    'use strict';\r\n\r\n    let cart = null;\r\n    let checkoutData = {\r\n        shipping_address: null,\r\n        billing_address: null,\r\n        same_as_shipping: true,\r\n        shipping_method: null,\r\n        payment_method: null,\r\n        notes: ''\r\n    };\r\n    let currentStep = 1;\r\n    let cartLoadFailed = false;\n    let cartLoadError = null;\n    const toNumber = (value, fallback = 0) => {\n        if (value === null || value === undefined || value === '') return fallback;\n        const num = Number(value);\n        return Number.isFinite(num) ? num : fallback;\n    };\n    const SHIPPING_STORAGE_KEY = 'checkout:shipping';\n    const SHIPPING_CACHE_TTL = 1000 * 60 * 60 * 24 * 7;\n\n    function readStoredShipping() {\n        try {\n            const raw = localStorage.getItem(SHIPPING_STORAGE_KEY);\n            if (!raw) return null;\n            const data = JSON.parse(raw);\n            if (!data || typeof data !== 'object') return null;\n            if (data.ts && Date.now() - data.ts > SHIPPING_CACHE_TTL) return null;\n            if (data.cost !== undefined && data.cost !== null) {\n                const cost = Number(data.cost);\n                if (!Number.isFinite(cost)) return null;\n                data.cost = cost;\n            }\n            return data;\n        } catch (err) {\n            return null;\n        }\n    }\n\n    function getCheckedShippingInput() {\n        return document.querySelector('input[name=\"shipping_rate_id\"]:checked') ||\n            document.querySelector('input[name=\"shipping_method\"]:checked');\n    }\n\n    function resolveShippingCost(container, cartPayload) {\n        const checked = getCheckedShippingInput();\n        if (checked) {\n            const cost = toNumber(checked.dataset.price, NaN);\n            if (Number.isFinite(cost)) {\n                return {\n                    cost,\n                    display: checked.dataset.display || null,\n                    currency: checked.dataset.currency || null,\n                    source: 'checked'\n                };\n            }\n        }\n\n        const stored = readStoredShipping();\n        if (stored && Number.isFinite(Number(stored.cost))) {\n            return {\n                cost: Number(stored.cost),\n                display: stored.display || null,\n                currency: stored.currency || null,\n                source: 'stored'\n            };\n        }\n\n        const shippingEl = container?.querySelector('#shipping-cost') || document.getElementById('shipping-cost');\n        const existingRaw = shippingEl?.dataset?.price;\n        if (existingRaw !== undefined && existingRaw !== '') {\n            const cost = toNumber(existingRaw, NaN);\n            if (Number.isFinite(cost)) {\n                const text = shippingEl?.textContent?.trim() || '';\n                const display = text && text.toLowerCase() !== 'calculated next' ? text : null;\n                return {\n                    cost,\n                    display,\n                    currency: shippingEl?.dataset?.currency || null,\n                    source: 'dom'\n                };\n            }\n        }\n\n        if (cartPayload && cartPayload.shipping_cost !== undefined && cartPayload.shipping_cost !== null) {\n            const cost = toNumber(cartPayload.shipping_cost, NaN);\n            if (Number.isFinite(cost) && cost > 0) {\n                return {\n                    cost,\n                    display: null,\n                    currency: null,\n                    source: 'cart'\n                };\n            }\n        }\n\n        return null;\n    }\n\n    function formatShippingDisplay(info) {\n        if (!info || info.cost === null || Number.isNaN(info.cost)) {\n            return 'Calculated next';\n        }\n        if (info.display && String(info.display).trim() && String(info.display).toLowerCase() !== 'calculated next') {\n            return String(info.display);\n        }\n        if (info.cost <= 0) return 'Free';\n        return Templates.formatPrice(info.cost, info.currency || null);\n    }\n\r\n    function getPaymentFeeMeta() {\r\n        const selected = document.querySelector('input[name=\"payment_method\"]:checked');\r\n        if (selected) {\r\n            return {\r\n                type: selected.dataset.feeType || 'none',\r\n                amount: toNumber(selected.dataset.feeAmount, 0),\r\n                percent: toNumber(selected.dataset.feePercent, 0),\r\n                name: selected.dataset.feeName || ''\r\n            };\r\n        }\r\n\r\n        const summary = document.getElementById('order-summary');\r\n        if (summary) {\r\n            const feeAmount = toNumber(summary.dataset.paymentFee, 0);\r\n            return {\r\n                type: feeAmount > 0 ? 'flat' : 'none',\r\n                amount: feeAmount,\r\n                percent: 0,\r\n                name: summary.dataset.paymentFeeLabel || ''\r\n            };\r\n        }\r\n\r\n        return { type: 'none', amount: 0, percent: 0, name: '' };\r\n    }\r\n\r\n    function computePaymentFee(total, meta) {\r\n        if (!meta) return 0;\r\n        if (meta.type === 'flat') return toNumber(meta.amount, 0);\r\n        if (meta.type === 'percent') return Math.max(0, total * (toNumber(meta.percent, 0) / 100));\r\n        return 0;\r\n    }\r\n\r\n    function updatePaymentFeeRow(totalValue = null) {\r\n        const row = document.getElementById('payment-fee-row');\r\n        const amountEl = document.getElementById('payment-fee-amount');\r\n        const labelEl = document.getElementById('payment-fee-label');\r\n        if (!row || !amountEl) return;\r\n\r\n        const totalEl = document.getElementById('order-total');\r\n        const total = totalValue !== null ? totalValue : toNumber(totalEl?.dataset?.price ?? totalEl?.textContent, 0);\r\n        const meta = getPaymentFeeMeta();\r\n        const feeAmount = computePaymentFee(total, meta);\r\n\r\n        if (!feeAmount || feeAmount <= 0) {\r\n            row.classList.add('hidden');\r\n            return;\r\n        }\r\n\r\n        row.classList.remove('hidden');\r\n        amountEl.textContent = Templates.formatPrice(feeAmount);\r\n        if (labelEl) {\r\n            labelEl.textContent = meta?.name ? `Extra payment fee (${meta.name})` : 'Extra payment fee';\r\n        }\r\n\r\n        const summary = document.getElementById('order-summary');\r\n        if (summary) {\r\n            summary.dataset.paymentFee = feeAmount;\r\n            summary.dataset.paymentFeeLabel = meta?.name || '';\r\n        }\r\n    }\r\n\r\n    async function init() {\r\n        if (!AuthApi.isAuthenticated()) {\r\n            const continueAsGuest = document.getElementById('guest-checkout');\r\n            if (!continueAsGuest) {\r\n                Toast.info('Please login to continue checkout.');\r\n                window.location.href = '/account/login/?next=/checkout/';\r\n                return;\r\n            }\r\n        }\r\n\r\n        await loadCart();\r\n        if (cartLoadFailed) return;\r\n        \r\n        if (!cart || !cart.items || cart.items.length === 0) {\r\n            Toast.warning('Your cart is empty.');\r\n            return;\r\n        }\r\n\r\n        await loadUserAddresses();\r\n        initStepNavigation();\r\n        initFormValidation();\r\n        initOrderSummaryToggle();\r\n        initStepForms();\r\n    }\r\n\r\n    async function loadCart() {\r\n        try {\r\n            const response = await CartApi.getCart();\r\n            if (!response || response.success === false) {\r\n                throw { message: response?.message || 'Failed to load cart', data: response?.data };\r\n            }\r\n            cart = response.data;\r\n            renderOrderSummary();\r\n            cartLoadFailed = false;\r\n            cartLoadError = null;\r\n        } catch (error) {\r\n            console.error('Failed to load cart:', error);\r\n            cartLoadFailed = true;\r\n            cartLoadError = error;\r\n            Toast.error(resolveErrorMessage(error, 'Failed to load cart.'));\r\n        }\r\n    }\r\n\r\n    function resolveErrorMessage(error, fallback) {\r\n        const generic = [\r\n            'request failed.',\r\n            'request failed',\r\n            'invalid response format',\r\n            'invalid request format'\r\n        ];\r\n\r\n        const isGeneric = (msg) => {\r\n            if (!msg) return true;\r\n            const normalized = String(msg).trim().toLowerCase();\r\n            return generic.includes(normalized);\r\n        };\r\n\r\n        const pickFromErrors = (errObj) => {\r\n            if (!errObj) return null;\r\n            if (typeof errObj === 'string') return errObj;\r\n            if (Array.isArray(errObj)) return errObj[0];\r\n            if (typeof errObj === 'object') {\r\n                const values = Object.values(errObj);\r\n                const flattened = values.flat ? values.flat() : values.reduce((acc, val) => acc.concat(val), []);\r\n                const first = flattened[0] ?? values[0];\r\n                if (typeof first === 'string') return first;\r\n                if (first && typeof first === 'object') {\r\n                    return pickFromErrors(first);\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n\r\n        const candidates = [];\r\n        if (error?.message) candidates.push(error.message);\r\n        if (error?.data?.message) candidates.push(error.data.message);\r\n        if (error?.data?.detail) candidates.push(error.data.detail);\r\n        if (error?.data && typeof error.data === 'string') candidates.push(error.data);\r\n        if (error?.errors) candidates.push(pickFromErrors(error.errors));\r\n        if (error?.data && typeof error.data === 'object') candidates.push(pickFromErrors(error.data));\r\n\r\n        const best = candidates.find(msg => msg && !isGeneric(msg));\r\n        return best || fallback;\r\n    }\r\n\r\n    function getSubmitUi(form) {\r\n        if (!form) return {};\r\n        const button = form.querySelector('button[type=\"submit\"]');\r\n        const textEl = form.querySelector('#btn-text') || form.querySelector('#button-text');\r\n        const spinnerEl = form.querySelector('#btn-spinner') || form.querySelector('#spinner');\r\n        const arrowEl = form.querySelector('#arrow-icon');\r\n        const defaultText = textEl ? textEl.textContent : button ? button.textContent : '';\r\n        return { button, textEl, spinnerEl, arrowEl, defaultText };\r\n    }\r\n\r\n    function setSubmitLoading(ui, loading, loadingText = 'Processing...') {\r\n        if (!ui) return;\r\n        if (ui.button) ui.button.disabled = loading;\r\n        if (ui.textEl) ui.textEl.textContent = loading ? loadingText : ui.defaultText;\r\n        if (ui.spinnerEl) ui.spinnerEl.classList.toggle('hidden', !loading);\r\n        if (ui.arrowEl) ui.arrowEl.classList.toggle('hidden', loading);\r\n    }\r\n\r\n    async function submitCheckoutForm(form, options = {}) {\r\n        if (!form || form.dataset.submitting === 'true') return;\r\n        if (cartLoadFailed) {\r\n            Toast.error(resolveErrorMessage(cartLoadError, 'Failed to load cart.'));\r\n            return;\r\n        }\r\n\r\n        const validate = options.validate;\r\n        if (typeof validate === 'function') {\r\n            const isValid = await validate();\r\n            if (!isValid) return;\r\n        }\r\n\r\n        const ui = getSubmitUi(form);\r\n        setSubmitLoading(ui, true, options.loadingText || 'Processing...');\r\n        form.dataset.submitting = 'true';\r\n\r\n        try {\r\n            const response = await fetch(form.action || window.location.href, {\r\n                method: (form.method || 'POST').toUpperCase(),\r\n                body: new FormData(form),\r\n                headers: {\r\n                    'X-Requested-With': 'XMLHttpRequest',\r\n                },\r\n                credentials: 'same-origin'\r\n            });\r\n\r\n            let data = null;\r\n            try {\r\n                data = await response.json();\r\n            } catch (e) {\r\n                data = null;\r\n            }\r\n\r\n            if (!response.ok || (data && data.success === false)) {\r\n                throw { message: data?.message || response.statusText || 'Request failed.', data };\r\n            }\r\n\r\n            const redirectUrl = data?.redirect_url || options.redirectUrl;\r\n            if (redirectUrl) {\r\n                window.location.href = redirectUrl;\r\n                return;\r\n            }\r\n\r\n            if (typeof options.onSuccess === 'function') {\r\n                options.onSuccess(data);\r\n            }\r\n        } catch (error) {\r\n            Toast.error(resolveErrorMessage(error, options.errorMessage || 'Request failed.'));\r\n            if (typeof options.onError === 'function') {\r\n                options.onError(error);\r\n            }\r\n        } finally {\r\n            form.dataset.submitting = 'false';\r\n            setSubmitLoading(ui, false, options.loadingText || 'Processing...');\r\n        }\r\n    }\r\n\r\n    function renderOrderSummary() {\n        const container = document.getElementById('order-summary');\n        if (!container || !cart) return;\n\r\n        const items = Array.isArray(cart.items) ? cart.items : [];\r\n        const itemCount = Number(cart.item_count ?? items.length ?? 0);\r\n        const countText = `${itemCount} item${itemCount === 1 ? '' : 's'}`;\r\n\r\n        document.querySelectorAll('[data-order-items-count]').forEach(el => {\r\n            el.textContent = countText;\r\n        });\r\n\r\n        const safeNumber = (value) => {\r\n            const num = Number(value);\r\n            return Number.isFinite(num) ? num : 0;\r\n        };\r\n\r\n        const getTaxRate = () => {\r\n            const el = document.getElementById('tax-rate-data') || document.querySelector('[data-tax-rate]');\r\n            if (!el) return 0;\r\n            const raw = el.dataset?.taxRate ?? el.textContent ?? '';\r\n            const val = parseFloat(raw);\r\n            return Number.isFinite(val) ? val : 0;\r\n        };\r\n\r\n        const escape = (val) => Templates.escapeHtml(String(val ?? ''));\r\n\r\n        const renderItems = () => {\r\n            if (!items.length) {\r\n                return `<p class=\"text-gray-500 dark:text-gray-400 text-center py-4\">Your cart is empty</p>`;\r\n            }\r\n\r\n            return items.map((item, idx) => {\r\n                const productName = item.product?.name || item.product_name || item.name || 'Item';\r\n                const productImage = item.product?.image || item.product_image || item.image || null;\r\n                const variantName = item.variant?.name || item.variant?.value || item.variant_name || '';\r\n                const quantity = safeNumber(item.quantity || 0);\r\n                const unitPrice = safeNumber(item.price ?? item.unit_price ?? item.unitPrice ?? item.price_at_add ?? 0);\r\n                const lineTotal = safeNumber(item.total ?? (unitPrice * quantity));\r\n                const borderClass = idx !== items.length - 1 ? 'border-b border-gray-100 dark:border-gray-700' : '';\r\n\r\n                return `\r\n                    <div class=\"flex items-start space-x-4 py-3 ${borderClass}\">\r\n                        <div class=\"relative flex-shrink-0\">\r\n                            ${productImage ? `\r\n                                <img src=\"${productImage}\" alt=\"${escape(productName)}\" class=\"w-16 h-16 object-cover rounded-lg\" loading=\"lazy\" decoding=\"async\" onerror=\"this.style.display='none'\">\r\n                            ` : `\r\n                                <div class=\"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-400\">\r\n                                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                            `}\r\n                            <span class=\"absolute -top-2 -right-2 w-5 h-5 bg-gray-600 text-white text-xs rounded-full flex items-center justify-center font-medium\">\r\n                                ${quantity}\r\n                            </span>\r\n                        </div>\r\n                        <div class=\"flex-1 min-w-0\">\r\n                            <p class=\"text-sm font-medium text-gray-900 dark:text-white truncate\">${escape(productName)}</p>\r\n                            ${variantName ? `<p class=\"text-xs text-gray-500 dark:text-gray-400\">${escape(variantName)}</p>` : ''}\r\n                        </div>\r\n                        <p class=\"text-sm font-medium text-gray-900 dark:text-white\">${Templates.formatPrice(lineTotal)}</p>\r\n                    </div>\r\n                `;\r\n            }).join('');\r\n        };\r\n\r\n        const subtotal = safeNumber(cart.subtotal);\r\n        const discount = safeNumber(cart.discount_amount);\r\n        const baseTotal = cart.total !== undefined && cart.total !== null\r\n            ? safeNumber(cart.total)\r\n            : Math.max(0, subtotal - discount);\r\n\r\n        const shippingInfo = resolveShippingCost(container, cart);\n\n        const taxRate = getTaxRate();\n        const taxEl = container.querySelector('#tax-amount') || document.getElementById('tax-amount');\n        const existingTaxRaw = taxEl?.dataset?.price;\n        const existingTax = existingTaxRaw !== undefined && existingTaxRaw !== '' ? safeNumber(existingTaxRaw) : null;\n        const taxAmount = cart.tax_amount !== undefined && cart.tax_amount !== null\n            ? safeNumber(cart.tax_amount)\n            : (existingTax !== null ? existingTax : (taxRate > 0 ? (baseTotal * taxRate / 100) : 0));\n\n        const giftWrapRow = container.querySelector('#gift-wrap-row') || document.getElementById('gift-wrap-row');\n        const giftWrapCostEl = container.querySelector('#gift-wrap-cost') || document.getElementById('gift-wrap-cost');\n        const giftWrapLabel = giftWrapRow?.querySelector('span')?.textContent?.trim() || 'Gift Wrapping';\n        const giftWrapCostRaw = giftWrapCostEl?.dataset?.price ?? giftWrapCostEl?.textContent ?? container.dataset?.giftWrapCost ?? 0;\n        const giftWrapAmount = safeNumber(container.dataset?.giftWrapAmount ?? 0);\n        const giftWrapToggle = document.getElementById('gift_wrap');\n        const giftWrapSelected = !!giftWrapToggle?.checked || (giftWrapRow && giftWrapRow.style.display !== 'none' && !giftWrapRow.classList.contains('hidden'));\n        let giftWrapCost = safeNumber(giftWrapCostRaw);\n        if (giftWrapSelected && giftWrapCost <= 0 && giftWrapAmount > 0) {\n            giftWrapCost = giftWrapAmount;\n        }\n        const giftWrapVisible = giftWrapSelected || giftWrapCost > 0;\n\n        const hasShipping = shippingInfo && shippingInfo.cost !== null && !Number.isNaN(shippingInfo.cost);\n        const total = baseTotal + (hasShipping ? shippingInfo.cost : 0) + (taxAmount || 0) + (giftWrapVisible ? giftWrapCost : 0);\n        const shippingDisplay = hasShipping ? formatShippingDisplay(shippingInfo) : 'Calculated next';\n        const shippingCurrencyAttr = shippingInfo?.currency ? ` data-currency=\"${escape(shippingInfo.currency)}\"` : '';\n        const feeMeta = getPaymentFeeMeta();\n        const paymentFee = computePaymentFee(total, feeMeta);\n        if (container) {\n            container.dataset.paymentFee = paymentFee;\n            if (feeMeta?.name) container.dataset.paymentFeeLabel = feeMeta.name;\n            container.dataset.giftWrapCost = giftWrapCost;\n            container.dataset.giftWrapAmount = giftWrapAmount;\n        }\n\r\n        const itemsHtml = `\r\n            <div class=\"space-y-4 max-h-80 overflow-y-auto scrollbar-thin pr-2\">\r\n                ${renderItems()}\r\n            </div>\r\n        `;\r\n\r\n        const feeRowHtml = `\n            <div id=\"payment-fee-row\" class=\"flex justify-between text-sm text-gray-600 dark:text-gray-400 ${paymentFee > 0 ? '' : 'hidden'}\">\n                <span id=\"payment-fee-label\">Extra payment fee${feeMeta?.name ? ` (${escape(feeMeta.name)})` : ''}</span>\n                <span id=\"payment-fee-amount\">${Templates.formatPrice(paymentFee)}</span>\n            </div>\n        `;\n        const giftWrapRowHtml = `\n            <div id=\"gift-wrap-row\" class=\"flex justify-between text-sm text-gray-600 dark:text-gray-400\" style=\"display: ${giftWrapVisible ? 'flex' : 'none'};\">\n                <span>${escape(giftWrapLabel)}</span>\n                <span id=\"gift-wrap-cost\" data-price=\"${giftWrapCost}\">+${Templates.formatPrice(giftWrapCost)}</span>\n            </div>\n        `;\n\n        const totalsHtml = `\n            <div class=\"space-y-3 border-t border-gray-200 dark:border-gray-700 mt-4 pt-4\">\n                <div class=\"flex justify-between text-sm text-gray-600 dark:text-gray-400\">\n                    <span>Subtotal</span>\n                    <span id=\"subtotal\" data-price=\"${subtotal}\">${Templates.formatPrice(subtotal)}</span>\r\n                </div>\r\n                <div id=\"discount-row\" class=\"flex justify-between text-sm text-green-600 ${discount > 0 ? '' : 'hidden'}\">\r\n                    <span>Discount</span>\r\n                    <span id=\"discount-amount\" data-price=\"${discount}\">-${Templates.formatPrice(discount)}</span>\r\n                    <span id=\"discount\" class=\"hidden\" data-price=\"${discount}\">-${Templates.formatPrice(discount)}</span>\r\n                </div>\r\n                <div class=\"flex justify-between text-sm text-gray-600 dark:text-gray-400\">\n                    <span>Shipping</span>\n                    <span id=\"shipping-cost\" data-price=\"${hasShipping ? shippingInfo.cost : ''}\"${shippingCurrencyAttr} class=\"font-medium text-gray-900 dark:text-white\">\n                        ${hasShipping ? escape(shippingDisplay) : 'Calculated next'}\n                    </span>\n                </div>\n                ${giftWrapRowHtml}\n                ${feeRowHtml}\n                <div class=\"flex justify-between text-sm text-gray-600 dark:text-gray-400 ${taxRate > 0 || taxAmount > 0 ? '' : 'hidden'}\">\n                    <span>Tax${taxRate > 0 ? ` (${taxRate}%)` : ''}</span>\n                    <span id=\"tax-amount\" data-price=\"${taxAmount}\">${Templates.formatPrice(taxAmount)}</span>\n                </div>\n                <div class=\"flex justify-between text-lg font-bold text-gray-900 dark:text-white border-t border-gray-200 dark:border-gray-700 pt-3\">\r\n                    <span>Total</span>\r\n                    <span id=\"order-total\" data-price=\"${total}\">${Templates.formatPrice(total)}</span>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        const itemsTarget = container.querySelector('[data-order-items]');\r\n        const totalsTarget = container.querySelector('[data-order-totals]');\r\n\r\n        if (itemsTarget || totalsTarget) {\r\n            if (itemsTarget) itemsTarget.innerHTML = itemsHtml;\r\n            if (totalsTarget) totalsTarget.innerHTML = totalsHtml;\r\n            updatePaymentFeeRow(total);\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = itemsHtml + totalsHtml;\r\n        updatePaymentFeeRow(total);\r\n    }\r\n\r\n    async function loadUserAddresses() {\r\n        if (!AuthApi.isAuthenticated()) return;\r\n\r\n        try {\r\n            const response = await AuthApi.getAddresses();\r\n            const addresses = response.data || [];\r\n\r\n            const shippingContainer = document.getElementById('saved-addresses');\r\n            const shouldRender = shippingContainer && (shippingContainer.dataset.jsRender === 'true' || shippingContainer.children.length === 0);\r\n            if (shippingContainer && addresses.length > 0) {\r\n                if (shouldRender) {\r\n                    shippingContainer.innerHTML = `\r\n                    <div class=\"mb-4\">\r\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Saved Addresses</label>\r\n                        <div class=\"space-y-2\">\r\n                            ${addresses.map(addr => `\r\n                                <label class=\"flex items-start p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-primary-500 transition-colors\">\r\n                                    <input type=\"radio\" name=\"saved_address\" value=\"${addr.id}\" class=\"mt-1 text-primary-600 focus:ring-primary-500\">\r\n                                    <div class=\"ml-3\">\r\n                                        <p class=\"font-medium text-gray-900\">${Templates.escapeHtml(addr.full_name || `${addr.first_name} ${addr.last_name}`)}</p>\r\n                                        <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.address_line_1)}</p>\r\n                                        ${addr.address_line_2 ? `<p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.address_line_2)}</p>` : ''}\r\n                                        <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.city)}, ${Templates.escapeHtml(addr.state || '')} ${Templates.escapeHtml(addr.postal_code)}</p>\r\n                                        <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(addr.country)}</p>\r\n                                        ${addr.is_default ? '<span class=\"inline-block mt-1 px-2 py-0.5 bg-primary-100 text-primary-700 text-xs rounded\">Default</span>' : ''}\r\n                                    </div>\r\n                                </label>\r\n                            `).join('')}\r\n                            <label class=\"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-primary-500 transition-colors\">\r\n                                <input type=\"radio\" name=\"saved_address\" value=\"new\" class=\"text-primary-600 focus:ring-primary-500\" checked>\r\n                                <span class=\"ml-3 text-gray-700\">Enter a new address</span>\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                `;\r\n                }\r\n\r\n                bindAddressSelection();\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load addresses:', error);\r\n        }\r\n    }\r\n\r\n    function bindAddressSelection() {\r\n        const addressRadios = document.querySelectorAll('input[name=\"saved_address\"]');\r\n        const newAddressForm = document.getElementById('new-address-form');\r\n\r\n        addressRadios.forEach(radio => {\r\n            radio.addEventListener('change', (e) => {\r\n                if (e.target.value === 'new') {\r\n                    newAddressForm?.classList.remove('hidden');\r\n                } else {\r\n                    newAddressForm?.classList.add('hidden');\r\n                    checkoutData.shipping_address = e.target.value;\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    function initStepNavigation() {\r\n        const steps = document.querySelectorAll('[data-step]');\r\n        const stepIndicators = document.querySelectorAll('[data-step-indicator]');\r\n        const nextBtns = document.querySelectorAll('[data-next-step]');\r\n        const prevBtns = document.querySelectorAll('[data-prev-step]');\r\n\r\n        function showStep(stepNumber) {\r\n            steps.forEach(step => {\r\n                step.classList.toggle('hidden', parseInt(step.dataset.step) !== stepNumber);\r\n            });\r\n\r\n            stepIndicators.forEach(indicator => {\r\n                const indicatorStep = parseInt(indicator.dataset.stepIndicator);\r\n                indicator.classList.toggle('bg-primary-600', indicatorStep <= stepNumber);\r\n                indicator.classList.toggle('text-white', indicatorStep <= stepNumber);\r\n                indicator.classList.toggle('bg-gray-200', indicatorStep > stepNumber);\r\n                indicator.classList.toggle('text-gray-600', indicatorStep > stepNumber);\r\n            });\r\n\r\n            currentStep = stepNumber;\r\n        }\r\n\r\n        nextBtns.forEach(btn => {\r\n            btn.addEventListener('click', async () => {\r\n                const valid = await validateCurrentStep();\r\n                if (valid) {\r\n                    if (currentStep === 1) {\r\n                        await loadShippingMethods();\r\n                    }\r\n                    showStep(currentStep + 1);\r\n                    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n                }\r\n            });\r\n        });\r\n\r\n        prevBtns.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                showStep(currentStep - 1);\r\n                window.scrollTo({ top: 0, behavior: 'smooth' });\r\n            });\r\n        });\r\n\r\n        showStep(1);\r\n    }\r\n\r\n    async function validateCurrentStep() {\r\n        switch (currentStep) {\r\n            case 1:\r\n                return validateShippingAddress();\r\n            case 2:\r\n                return validateShippingMethod();\r\n            case 3:\r\n                return validatePaymentMethod();\r\n            default:\r\n                return true;\r\n        }\r\n    }\r\n\r\n    // Inline error helpers\r\n    function clearStepErrors(container) {\r\n        if (!container) return;\r\n        container.querySelectorAll('[data-error-for]').forEach(el => el.remove());\r\n        // Use CSS attribute selector to find elements with the !border-red-500 class\r\n        container.querySelectorAll('[class*=\"!border-red-500\"]').forEach(el => el.classList.remove('!border-red-500'));\r\n    }\r\n\r\n    function showInlineError(fieldEl, message) {\r\n        if (!fieldEl) return;\r\n        // Remove existing error for this field\r\n        const name = fieldEl.getAttribute('name') || fieldEl.id || Math.random().toString(36).slice(2, 8);\r\n        const existing = fieldEl.closest('form')?.querySelector(`[data-error-for=\"${name}\"]`);\r\n        if (existing) existing.remove();\r\n\r\n        const msg = document.createElement('p');\r\n        msg.className = 'text-sm text-red-600 mt-1';\r\n        msg.setAttribute('data-error-for', name);\r\n        msg.textContent = message;\r\n\r\n        // Add visual state to the field\r\n        fieldEl.classList.add('!border-red-500');\r\n\r\n        // Insert after field or its parent wrapper\r\n        if (fieldEl.nextSibling) {\r\n            fieldEl.parentNode.insertBefore(msg, fieldEl.nextSibling);\r\n        } else {\r\n            fieldEl.parentNode.appendChild(msg);\r\n        }\r\n    }\r\n\r\n    function focusFirstInvalid(container) {\r\n        if (!container) return;\r\n        const first = container.querySelector('[data-error-for]');\r\n        if (!first) return;\r\n        // Try to focus associated input without scrolling the page\r\n        const name = first.getAttribute('data-error-for');\r\n        const input = container.querySelector(`[name=\"${name}\"]`) || container.querySelector(`#${name}`) || first.previousElementSibling;\r\n        if (input && typeof input.focus === 'function') {\r\n            try {\r\n                input.focus({ preventScroll: true });\r\n            } catch (e) {\r\n                // Old browsers may not support options \u2014 fallback to normal focus\r\n                input.focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    function validateShippingAddress() {\r\n        // Support both 'information-form' (wizard first step) and dedicated 'shipping-address-form'\r\n        const savedAddressRadio = document.querySelector('input[name=\"saved_address\"]:checked');\r\n        \r\n        if (savedAddressRadio && savedAddressRadio.value !== 'new') {\r\n            clearStepErrors(document.getElementById('new-address-form') || document.getElementById('information-form'));\r\n            checkoutData.shipping_address = savedAddressRadio.value;\r\n            return true;\r\n        }\r\n\r\n        const form = document.getElementById('shipping-address-form') || document.getElementById('information-form') || document.getElementById('new-address-form');\r\n        if (!form) return false;\r\n\r\n        clearStepErrors(form);\r\n\r\n        const formData = new FormData(form);\r\n        const address = {\r\n            first_name: formData.get('first_name') || formData.get('full_name')?.split(' ')?.[0],\r\n            last_name: formData.get('last_name') || (formData.get('full_name') ? formData.get('full_name').split(' ').slice(1).join(' ') : ''),\r\n            email: formData.get('email'),\r\n            phone: formData.get('phone'),\r\n            address_line_1: formData.get('address_line1') || formData.get('address_line_1'),\r\n            address_line_2: formData.get('address_line2') || formData.get('address_line_2'),\r\n            city: formData.get('city'),\r\n            state: formData.get('state'),\r\n            postal_code: formData.get('postal_code'),\r\n            country: formData.get('country')\r\n        };\r\n\r\n        // Required fields depending on context\r\n        const required = ['email', 'first_name', 'address_line_1', 'city', 'postal_code'];\r\n        const missing = required.filter(field => !address[field]);\r\n\r\n        if (missing.length > 0) {\r\n            // Show inline errors and focus first\r\n            missing.forEach(field => {\r\n                // Map back to input names in form\r\n                let selector = `[name=\"${field}\"]`;\r\n                if (field === 'address_line_1') selector = `[name=\"address_line1\"],[name=\"address_line_1\"]`;\r\n                const fieldEl = form.querySelector(selector);\r\n                showInlineError(fieldEl || form, field.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase()) + ' is required.');\r\n            });\r\n\r\n            focusFirstInvalid(form);\r\n            return false;\r\n        }\r\n\r\n        // Basic email format check\r\n        if (address.email && !/^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/.test(address.email)) {\r\n            const emailEl = form.querySelector('[name=\"email\"]');\r\n            showInlineError(emailEl || form, 'Please enter a valid email address.');\r\n            focusFirstInvalid(form);\r\n            return false;\r\n        }\r\n\r\n        checkoutData.shipping_address = address;\r\n        return true;\r\n    }\r\n\r\n    async function loadShippingMethods() {\r\n        const container = document.getElementById('shipping-methods');\r\n        if (!container) return;\r\n\r\n        Loader.show(container, 'spinner');\r\n\r\n        try {\r\n            const address = checkoutData.shipping_address;\r\n\r\n            if (!address) {\r\n                // No address available yet (user hasn't filled or selected one)\r\n                container.innerHTML = '<p class=\"text-gray-500\">Please provide a shipping address to view shipping methods.</p>';\r\n                return;\r\n            }\r\n\r\n            const params = typeof address === 'object' ? {\r\n                country: address.country,\r\n                postal_code: address.postal_code,\r\n                city: address.city\r\n            } : { address_id: address };\r\n\r\n            const response = await ShippingApi.getRates(params);\r\n            const methods = response.data || [];\r\n\r\n            if (methods.length === 0) {\r\n                container.innerHTML = '<p class=\"text-gray-500\">No shipping methods available for your location.</p>';\r\n                return;\r\n            }\r\n\r\n            container.innerHTML = `\r\n                <div class=\"space-y-3\">\r\n                    ${methods.map((method, index) => `\r\n                        <label class=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-primary-500 transition-colors\">\r\n                            <div class=\"flex items-center\">\r\n                                <input \r\n                                    type=\"radio\" \r\n                                    name=\"shipping_method\" \r\n                                    value=\"${method.id}\" \r\n                                    ${index === 0 ? 'checked' : ''}\r\n                                    class=\"text-primary-600 focus:ring-primary-500\"\r\n                                    data-price=\"${method.price}\"\r\n                                >\r\n                                <div class=\"ml-3\">\r\n                                    <p class=\"font-medium text-gray-900\">${Templates.escapeHtml(method.name)}</p>\r\n                                    ${method.description ? `<p class=\"text-sm text-gray-500\">${Templates.escapeHtml(method.description)}</p>` : ''}\r\n                                    ${method.estimated_days ? `<p class=\"text-sm text-gray-500\">Delivery in ${method.estimated_days} days</p>` : ''}\r\n                                </div>\r\n                            </div>\r\n                            <span class=\"font-semibold text-gray-900\">${method.price > 0 ? Templates.formatPrice(method.price) : 'Free'}</span>\r\n                        </label>\r\n                    `).join('')}\r\n                </div>\r\n            `;\r\n\r\n            const shippingRadios = container.querySelectorAll('input[name=\"shipping_method\"]');\n            shippingRadios.forEach((radio, idx) => {\n                const method = methods[idx] || {};\n                const price = Number(method.price ?? method.rate ?? 0) || 0;\n                const display = method.price_display || method.rate_display || (price > 0 ? Templates.formatPrice(price) : 'Free');\n                radio.__price = price;\n                radio.dataset.display = display;\n                if (method.currency && method.currency.code) {\n                    radio.dataset.currency = method.currency.code;\n                }\n                radio.addEventListener('change', () => {\n                    updateShippingCost(parseFloat(radio.__price) || 0, {\n                        rateId: radio.value,\n                        display: radio.dataset.display,\n                        currency: radio.dataset.currency || null,\n                        persist: true,\n                        type: 'delivery'\n                    });\n                });\n            });\n\n            if (methods.length > 0) {\n                checkoutData.shipping_method = methods[0].id;\n                const first = methods[0] || {};\n                const price = Number(first.price ?? first.rate ?? 0) || 0;\n                const display = first.price_display || first.rate_display || (price > 0 ? Templates.formatPrice(price) : 'Free');\n                updateShippingCost(price, {\n                    rateId: shippingRadios[0]?.value || first.id,\n                    display,\n                    currency: shippingRadios[0]?.dataset?.currency || null,\n                    persist: true,\n                    type: 'delivery'\n                });\n            }\n        } \r\n        catch (error) {\r\n            console.error('Failed to load shipping methods:', error);\r\n            container.innerHTML = '<p class=\"text-red-500\">Failed to load shipping methods. Please try again.</p>';\r\n        }\r\n    }\r\n\r\n    // -----------------------------\r\n    // Payment gateways (dynamic)\r\n    // -----------------------------\r\n    function updatePaymentContinueState(hasGateways) {\r\n        const submitButton = document.getElementById('submit-button');\r\n        const buttonText = document.getElementById('button-text');\r\n        if (!submitButton || !buttonText) return;\r\n\r\n        submitButton.disabled = !hasGateways;\r\n        buttonText.textContent = hasGateways ? 'Continue to Review' : 'No payment methods available';\r\n    }\r\n\r\n    async function fetchAndRenderPaymentGateways() {\r\n        const container = document.getElementById('payment-methods-container');\r\n        if (!container) return;\r\n\r\n        try {\r\n            const params = new URLSearchParams();\r\n            // Client-side currency parameter removed; server handles currency formatting.\r\n            if (window.CONFIG && CONFIG.shippingData && CONFIG.shippingData.countryCode) params.set('country', CONFIG.shippingData.countryCode);\r\n            if (cart && (cart.total || cart.total === 0)) params.set('amount', cart.total);\r\n\r\n            const resp = await fetch(`/api/v1/payments/gateways/available/?${params.toString()}`, {\r\n                credentials: 'same-origin'\r\n            });\r\n            const data = await resp.json();\r\n\r\n            const gateways = (data && data.data) || [];\r\n\r\n            // If server already rendered gateways (non-empty) try to avoid re-render to prevent UI flicker.\r\n            const existing = container.querySelectorAll('.payment-option');\r\n            if (existing && existing.length > 0) {\r\n                try {\r\n                    const existingCodes = Array.from(existing).map(el => el.dataset.gateway).filter(Boolean);\r\n                    const remoteCodes = (gateways || []).map(g => g.code);\r\n\r\n                    // If codes match exactly in order and length, keep server markup and just re-bind handlers.\r\n                const same = existingCodes.length === remoteCodes.length && existingCodes.every((c, i) => c === remoteCodes[i]);\r\n                if (same) {\r\n                    initFormValidation(); // ensure event handlers and initial visibility are in place\r\n                    updatePaymentContinueState(existingCodes.length > 0);\r\n                    return;\r\n                }\r\n            } catch (err) {\r\n                // Fall back to previous behavior if anything goes wrong\r\n                console.warn('Failed to compare existing payment gateways:', err);\r\n            }\r\n\r\n            // If remote returned nothing but server has content, keep server content (avoid replacing with empty state)\r\n            if (gateways.length === 0) {\r\n                updatePaymentContinueState(existing.length > 0);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If no gateways, show informative block (template also handles this case)\r\n        if (!gateways || gateways.length === 0) {\r\n            container.innerHTML = `\r\n                    <div class=\"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl\">\r\n                        <svg class=\"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\"></path></svg>\r\n                        <h3 class=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">No payment methods are configured</h3>\r\n                        <p class=\"text-gray-500 dark:text-gray-400 mb-2\">We don't have any payment providers configured for your currency or location. Please contact support to enable online payments.</p>\r\n                        <p class=\"text-sm text-gray-400\">You can still place an order if Cash on Delivery or Bank Transfer is available from admin.</p>\r\n                  </div>\r\n              `;\r\n            updatePaymentContinueState(false);\r\n            return;\r\n        }\r\n\r\n            // Build radio options into a fragment, add animations and staggered delays to improve perceived performance\r\n            const frag = document.createDocumentFragment();\r\n            gateways.forEach((g, idx) => {\r\n                const wrapper = document.createElement('div');\r\n                wrapper.className = 'relative payment-option transform transition-all duration-300 hover:scale-[1.01]';\r\n                wrapper.dataset.gateway = g.code;\r\n\r\n                // Apply slideIn animation with staggered delay so new DOM shows with animation\r\n                wrapper.style.animation = 'slideIn 0.3s ease-out both';\r\n                wrapper.style.animationDelay = `${idx * 80}ms`;\r\n\r\n                const input = document.createElement('input');\r\n                input.type = 'radio';\r\n                input.name = 'payment_method';\r\n                input.value = g.code;\r\n                input.id = `payment-${g.code}`;\r\n                input.className = 'peer sr-only';\r\n                input.dataset.feeType = g.fee_type || 'none';\r\n                input.dataset.feeAmount = (g.fee_amount_converted ?? g.fee_amount ?? 0);\r\n                input.dataset.feePercent = g.fee_amount ?? 0;\r\n                input.dataset.feeName = g.name || '';\r\n                if (idx === 0) input.checked = true;\r\n\r\n                const label = document.createElement('label');\r\n                label.setAttribute('for', input.id);\r\n                label.className = 'flex items-center justify-between p-4 border-2 rounded-xl cursor-pointer transition-all duration-300 hover:border-gray-400 border-gray-200';\r\n\r\n                label.innerHTML = `\r\n                    <div class=\"flex items-center\">\r\n                        <div class=\"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mr-4\">\r\n                            ${g.icon_url ? `<img src=\"${g.icon_url}\" class=\"h-6\" alt=\"${g.name}\">` : `<span class=\"font-bold\">${g.code.toUpperCase()}</span>`}\r\n                        </div>\r\n                        <div>\r\n                            <p class=\"font-medium text-gray-900 dark:text-white\">${Templates.escapeHtml(g.name)}</p>\r\n                            <p class=\"text-sm text-gray-500 dark:text-gray-400\">${Templates.escapeHtml(g.description || '')}</p>\r\n                            ${g.fee_text ? `<p class=\"text-xs text-amber-600 dark:text-amber-400 mt-1\">${Templates.escapeHtml(g.fee_text)}</p>` : ''}\r\n                            ${g.instructions ? `<p class=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">${g.instructions}</p>` : ''}\r\n                        </div>\r\n                    </div>\r\n                `;\r\n\r\n                wrapper.appendChild(input);\r\n                wrapper.appendChild(label);\r\n\r\n                // Append selection indicator\r\n                const indicator = document.createElement('div');\r\n                indicator.className = 'absolute top-4 right-4 opacity-0 peer-checked:opacity-100 transition-opacity duration-300';\r\n                indicator.innerHTML = `<svg class=\"w-6 h-6 text-primary-600\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"></path></svg>`;\r\n                wrapper.appendChild(indicator);\r\n\r\n                frag.appendChild(wrapper);\r\n\r\n                // If gateway requires client side (Stripe), load JS and init (do this early so elements can initialize)\r\n                if (g.public_key && g.requires_client) {\r\n                    loadStripeJsIfNeeded(g.public_key).catch(err => console.error('Failed to load Stripe:', err));\r\n                }\r\n            });\r\n\r\n        // Atomically replace existing nodes to reduce flicker\r\n        container.replaceChildren(frag);\r\n\r\n        // Re-bind form handlers\r\n        initFormValidation();\r\n        updatePaymentContinueState(gateways.length > 0);\r\n        updatePaymentFeeRow();\r\n\r\n    } catch (error) {\r\n        console.error('Failed to load payment gateways:', error);\r\n    }\r\n    }\r\n\r\n    function loadStripeJsIfNeeded(publishableKey) {\r\n        return new Promise((resolve, reject) => {\r\n            if (window.Stripe && window.STRIPE_PUBLISHABLE_KEY === publishableKey) {\r\n                // Already configured\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            // Set global publishable key\r\n            window.STRIPE_PUBLISHABLE_KEY = publishableKey;\r\n\r\n            // If Stripe script is already loaded, just initialize elements\r\n            if (window.Stripe) {\r\n                initStripeElements(publishableKey);\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const script = document.createElement('script');\r\n            script.src = 'https://js.stripe.com/v3/';\r\n            script.async = true;\r\n            script.onload = () => {\r\n                try {\r\n                    initStripeElements(publishableKey);\r\n                    resolve();\r\n                } catch (err) {\r\n                    reject(err);\r\n                }\r\n            };\r\n            script.onerror = (e) => reject(e);\r\n            document.head.appendChild(script);\r\n        });\r\n    }\r\n\r\n    function initStripeElements(publishableKey) {\r\n        if (typeof Stripe === 'undefined') throw new Error('Stripe script not loaded');\r\n\r\n        try {\r\n            const stripe = Stripe(publishableKey);\r\n            const elements = stripe.elements();\r\n            const cardEl = elements.create('card');\r\n            const mountPoint = document.getElementById('card-element');\r\n            if (mountPoint) {\r\n                // Clean previous mount if any\r\n                mountPoint.innerHTML = '';\r\n                cardEl.mount('#card-element');\r\n\r\n                // Show realtime validation errors\r\n                cardEl.on('change', (e) => {\r\n                    const errContainer = document.getElementById('card-errors');\r\n                    if (errContainer) errContainer.textContent = e.error ? e.error.message : '';\r\n                });\r\n\r\n                // Expose card element for confirmCardPayment\r\n                window.stripeInstance = stripe;\r\n                window.stripeCard = cardEl;\r\n            }\r\n        } catch (err) {\r\n            console.error('Error initializing Stripe elements:', err);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    // Call dynamic loading on init\r\n    (function autoInitGateways() {\r\n        // Delay slightly to let server-rendered DOM settle\r\n        document.addEventListener('DOMContentLoaded', () => {\r\n            setTimeout(() => {\r\n                fetchAndRenderPaymentGateways();\r\n            }, 50);\r\n        });\r\n    })();\r\n\r\n\r\n\r\n    function updateShippingCost(cost, meta = {}) {\n        const shippingCostEl = document.getElementById('shipping-cost');\n        const orderTotalEl = document.getElementById('order-total');\n        const numericCost = toNumber(cost, 0);\n        const display = meta.display || (numericCost > 0 ? Templates.formatPrice(numericCost, meta.currency || null) : 'Free');\n\n        if (shippingCostEl) {\n            shippingCostEl.textContent = display;\n            shippingCostEl.dataset.price = String(numericCost);\n            if (meta.currency) shippingCostEl.dataset.currency = meta.currency;\n        }\n\n        if (meta.persist) {\n            try {\n                localStorage.setItem(SHIPPING_STORAGE_KEY, JSON.stringify({\n                    type: meta.type || 'delivery',\n                    rateId: meta.rateId || null,\n                    cost: numericCost,\n                    display: display || '',\n                    currency: meta.currency || null,\n                    ts: Date.now()\n                }));\n            } catch (err) {\n                // ignore storage failures\n            }\n        }\n\n        if (orderTotalEl && cart) {\n            const total = (cart.total || 0) + numericCost;\n            orderTotalEl.textContent = Templates.formatPrice(total);\n            orderTotalEl.dataset.price = total;\n        }\n    }\n\r\n    function validateShippingMethod() {\r\n        const selected = document.querySelector('input[name=\"shipping_method\"]:checked');\r\n        if (!selected) {\r\n            Toast.error('Please select a shipping method.');\r\n            return false;\r\n        }\r\n        checkoutData.shipping_method = selected.value;\r\n        return true;\r\n    }\r\n\r\n    function initOrderSummaryToggle() {\r\n        const toggle = document.getElementById('order-summary-toggle');\r\n        const block = document.getElementById('order-summary-block');\r\n        if (!toggle || !block) return;\r\n\r\n        toggle.addEventListener('click', () => {\r\n            const hidden = block.classList.toggle('hidden');\r\n            toggle.setAttribute('aria-expanded', (!hidden).toString());\r\n            const chevron = toggle.querySelector('svg');\r\n            if (chevron) chevron.classList.toggle('rotate-180', !hidden);\r\n        });\r\n\r\n        // If the block is hidden on mobile by responsive classes, ensure aria is accurate\r\n        const isHidden = window.getComputedStyle(block).display === 'none' || block.classList.contains('hidden');\r\n        toggle.setAttribute('aria-expanded', (!isHidden).toString());\r\n    }\r\n\r\n    function validatePaymentMethod() {\r\n        const selected = document.querySelector('input[name=\"payment_method\"]:checked');\r\n        const form = document.getElementById('payment-form');\r\n        clearStepErrors(form);\r\n\r\n        if (!selected) {\r\n            // Show inline message in payment block\r\n            const container = document.getElementById('payment-methods-container') || form;\r\n            showInlineError(container, 'Please select a payment method.');\r\n            focusFirstInvalid(container);\r\n            return false;\r\n        }\r\n\r\n        const code = selected.value;\r\n\r\n        // Payment-specific checks\r\n        if (code === 'stripe') {\r\n            const nameEl = document.getElementById('cardholder-name');\r\n            if (!nameEl || !nameEl.value.trim()) {\r\n                showInlineError(nameEl || form, 'Cardholder name is required.');\r\n                focusFirstInvalid(form);\r\n                return false;\r\n            }\r\n            // Ensure Stripe element exists (mounting handled elsewhere)\r\n            if (!window.stripeCard) {\r\n                showInlineError(document.getElementById('card-element') || form, 'Card input not ready. Please wait and try again.');\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (code === 'bkash') {\r\n            const el = document.getElementById('bkash-number');\r\n            if (!el || !el.value.trim()) {\r\n                showInlineError(el || form, 'bKash mobile number is required.');\r\n                focusFirstInvalid(form);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (code === 'nagad') {\r\n            const el = document.getElementById('nagad-number');\r\n            if (!el || !el.value.trim()) {\r\n                showInlineError(el || form, 'Nagad mobile number is required.');\r\n                focusFirstInvalid(form);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Clear any errors and proceed\r\n        checkoutData.payment_method = code;\r\n        return true;\r\n    }\r\n\r\n    function initFormValidation() {\r\n        const sameAsBillingCheckbox = document.getElementById('same-as-shipping');\r\n        const billingAddressForm = document.getElementById('billing-address-form');\r\n\r\n        sameAsBillingCheckbox?.addEventListener('change', (e) => {\r\n            checkoutData.same_as_shipping = e.target.checked;\r\n            billingAddressForm?.classList.toggle('hidden', e.target.checked);\r\n        });\r\n\r\n        const paymentMethods = document.querySelectorAll('input[name=\"payment_method\"]');\r\n        paymentMethods.forEach(method => {\r\n            const handler = (e) => {\r\n                // Hide all payment form blocks marked with data-payment-form\r\n                document.querySelectorAll('[data-payment-form]').forEach(form => {\r\n                    form.classList.add('hidden');\r\n                });\r\n\r\n                // Show the matching form using data attribute; fallback to id `${code}-form`\r\n                const code = e.target ? e.target.value : (method.value || null);\r\n                if (!code) return;\r\n\r\n                let targetForm = document.querySelector(`[data-payment-form=\"${code}\"]`);\r\n                if (!targetForm) {\r\n                    targetForm = document.getElementById(`${code}-form`);\r\n                }\r\n\r\n                  targetForm?.classList.remove('hidden');\r\n                  updatePaymentFeeRow();\r\n              };\r\n\r\n            method.addEventListener('change', handler);\r\n\r\n            // If this method is pre-selected on page load, trigger handler to set initial visibility\r\n            if (method.checked) {\r\n                handler({ target: method });\r\n            }\r\n        });\r\n\r\n        // Only attach the SPA place order handler if NOT on the traditional form-based review page\r\n        // The traditional form has action attribute and we should let it submit normally\r\n        const placeOrderBtn = document.getElementById('place-order-btn');\r\n        const placeOrderForm = document.getElementById('place-order-form');\r\n        \r\n        // Only use JavaScript-based checkout if the form doesn't have a traditional action\r\n        if (placeOrderBtn && (!placeOrderForm || !placeOrderForm.action || placeOrderForm.action.includes('javascript'))) {\r\n            placeOrderBtn.addEventListener('click', async (e) => {\r\n                e.preventDefault();\r\n                await placeOrder();\r\n            });\r\n        }\r\n    }\r\n\r\n    function initStepForms() {\r\n        const infoForm = document.getElementById('information-form');\r\n        if (infoForm && infoForm.dataset.ajaxBound !== 'true') {\r\n            infoForm.dataset.ajaxBound = 'true';\r\n            infoForm.addEventListener('submit', (e) => {\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n                submitCheckoutForm(infoForm, {\r\n                    validate: validateShippingAddress,\r\n                    redirectUrl: '/checkout/shipping/',\r\n                    loadingText: 'Processing...'\r\n                });\r\n            }, true);\r\n        }\r\n\r\n        const shippingForm = document.getElementById('shipping-form');\r\n        if (shippingForm && shippingForm.dataset.ajaxBound !== 'true') {\r\n            shippingForm.dataset.ajaxBound = 'true';\r\n            shippingForm.addEventListener('submit', (e) => {\r\n                e.preventDefault();\r\n                e.stopImmediatePropagation();\r\n                const shippingType = document.getElementById('shipping-type')?.value || 'delivery';\r\n                if (shippingType === 'pickup') {\r\n                    const selectedPickup = document.querySelector('input[name=\"pickup_location\"]:checked');\r\n                    if (!selectedPickup) {\r\n                        Toast.error('Please select a pickup location.');\r\n                        return;\r\n                    }\r\n                } else {\r\n                    const selectedRate = document.querySelector('input[name=\"shipping_rate_id\"]:checked') ||\r\n                        document.querySelector('input[name=\"shipping_method\"]:checked');\r\n                    if (!selectedRate) {\r\n                        Toast.error('Please select a shipping method.');\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                submitCheckoutForm(shippingForm, {\r\n                    redirectUrl: '/checkout/payment/',\r\n                    loadingText: 'Processing...'\r\n                });\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    async function placeOrder() {\r\n        if (!validatePaymentMethod()) return;\r\n\r\n        const placeOrderBtn = document.getElementById('place-order-btn');\r\n        placeOrderBtn.disabled = true;\r\n        placeOrderBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\r\n\r\n        try {\r\n            const orderNotes = document.getElementById('order-notes')?.value;\r\n            checkoutData.notes = orderNotes || '';\r\n\r\n            if (!checkoutData.same_as_shipping) {\r\n                const billingForm = document.getElementById('billing-address-form');\r\n                if (billingForm) {\r\n                    const formData = new FormData(billingForm);\r\n                    checkoutData.billing_address = {\r\n                        first_name: formData.get('billing_first_name'),\r\n                        last_name: formData.get('billing_last_name'),\r\n                        address_line_1: formData.get('billing_address_line_1'),\r\n                        address_line_2: formData.get('billing_address_line_2'),\r\n                        city: formData.get('billing_city'),\r\n                        state: formData.get('billing_state'),\r\n                        postal_code: formData.get('billing_postal_code'),\r\n                        country: formData.get('billing_country')\r\n                    };\r\n                }\r\n            }\r\n\r\n            const response = await CheckoutApi.createOrder(checkoutData);\r\n            const order = response.data;\r\n\r\n            if (checkoutData.payment_method === 'stripe' || checkoutData.payment_method === 'card') {\r\n                await processStripePayment(order);\r\n            } else if (checkoutData.payment_method === 'paypal') {\r\n                await processPayPalPayment(order);\r\n            } else {\r\n                window.location.href = `/orders/${order.id}/confirmation/`;\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to place order:', error);\r\n            Toast.error(error.message || 'Failed to place order. Please try again.');\r\n            \r\n            placeOrderBtn.disabled = false;\r\n            placeOrderBtn.textContent = 'Place Order';\r\n        }\r\n    }\r\n\r\n    async function processStripePayment(order) {\r\n        try {\r\n            const response = await CheckoutApi.createPaymentIntent(order.id);\r\n            const { client_secret } = response.data;\r\n            const publishable_key = response.data.publishable_key || window.STRIPE_PUBLISHABLE_KEY || (window.stripeInstance ? window.STRIPE_PUBLISHABLE_KEY : null);\r\n\r\n            if (typeof Stripe === 'undefined' && !window.stripeInstance) {\r\n                throw new Error('Stripe is not loaded.');\r\n            }\r\n\r\n            const stripe = window.stripeInstance || Stripe(publishable_key);\r\n            const result = await stripe.confirmCardPayment(client_secret, {\r\n                payment_method: {\r\n                    card: window.stripeCard,\r\n                    billing_details: {\r\n                        name: `${checkoutData.shipping_address.first_name} ${checkoutData.shipping_address.last_name}`\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (result.error) {\r\n                throw new Error(result.error.message);\r\n            }\r\n\r\n            window.location.href = `/orders/${order.id}/confirmation/`;\r\n        } catch (error) {\r\n            console.error('Stripe payment failed:', error);\r\n            Toast.error(error.message || 'Payment failed. Please try again.');\r\n            \r\n            const placeOrderBtn = document.getElementById('place-order-btn');\r\n            placeOrderBtn.disabled = false;\r\n            placeOrderBtn.textContent = 'Place Order';\r\n        }\r\n    }\r\n\r\n    async function processPayPalPayment(order) {\r\n        try {\r\n            const response = await CheckoutApi.createPayPalOrder(order.id);\r\n            const { approval_url } = response.data;\r\n            window.location.href = approval_url;\r\n        } catch (error) {\r\n            console.error('PayPal payment failed:', error);\r\n            Toast.error(error.message || 'Payment failed. Please try again.');\r\n            \r\n            const placeOrderBtn = document.getElementById('place-order-btn');\r\n            placeOrderBtn.disabled = false;\r\n            placeOrderBtn.textContent = 'Place Order';\r\n        }\r\n    }\r\n\r\n    function destroy() {\r\n        cart = null;\r\n        checkoutData = {\r\n            shipping_address: null,\r\n            billing_address: null,\r\n            same_as_shipping: true,\r\n            shipping_method: null,\r\n            payment_method: null,\r\n            notes: ''\r\n        };\r\n        currentStep = 1;\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy\r\n    };\r\n}());\r\n\r\nwindow.CheckoutPage = CheckoutPage;\r\nexport default CheckoutPage;\r\n", "/**\n * Contact Page - Enhanced with Advanced Features\n * @module pages/contact\n */\n\nconst ContactPage = (function() {\n    'use strict';\n\n    async function init() {\n        initContactForm();\n        await loadContactInfo();\n        initEnhancedFeatures();\n    }\n\n    // ============================================\n    // ENHANCED FEATURES INITIALIZATION\n    // ============================================\n    function initEnhancedFeatures() {\n        initInteractiveMap();\n        initLiveChatButton();\n        initQuickContactOptions();\n        initFAQPreview();\n        initOfficeHoursStatus();\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Interactive Map\n    // ============================================\n    function initInteractiveMap() {\n        const mapContainer = document.getElementById('contact-map');\n        if (!mapContainer) return;\n\n        // Get coordinates from data attributes or defaults\n        const lat = mapContainer.dataset.lat || '0';\n        const lng = mapContainer.dataset.lng || '0';\n        const address = mapContainer.dataset.address || 'Our Location';\n\n        // Render static map with link to Google Maps\n        mapContainer.innerHTML = `\n            <div class=\"relative w-full h-64 md:h-80 rounded-2xl overflow-hidden bg-stone-100 dark:bg-stone-800 group\">\n                <iframe \n                    src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3022.9663095343008!2d${lng}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zM!5e0!3m2!1sen!2sus!4v1234567890\"\n                    class=\"w-full h-full border-0\"\n                    allowfullscreen=\"\"\n                    loading=\"lazy\"\n                    referrerpolicy=\"no-referrer-when-downgrade\"\n                ></iframe>\n                <a \n                    href=\"https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    class=\"absolute bottom-4 right-4 px-4 py-2 bg-white dark:bg-stone-800 rounded-xl shadow-lg flex items-center gap-2 text-sm font-medium text-stone-700 dark:text-stone-200 hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors\"\n                >\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"/></svg>\n                    Open in Google Maps\n                </a>\n            </div>\n        `;\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Live Chat Button\n    // ============================================\n    function initLiveChatButton() {\n        const container = document.getElementById('live-chat-cta');\n        if (!container) return;\n\n        container.innerHTML = `\n            <div class=\"bg-gradient-to-br from-primary-600 to-primary-700 dark:from-amber-600 dark:to-amber-700 rounded-2xl p-6 text-white\">\n                <div class=\"flex items-start gap-4\">\n                    <div class=\"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center flex-shrink-0\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"/></svg>\n                    </div>\n                    <div class=\"flex-1\">\n                        <h3 class=\"font-bold text-lg\">Need Instant Help?</h3>\n                        <p class=\"text-white/90 text-sm mt-1 mb-4\">Our support team is online and ready to assist you right now.</p>\n                        <button id=\"open-live-chat\" class=\"inline-flex items-center gap-2 px-4 py-2 bg-white text-primary-700 dark:text-amber-700 font-semibold rounded-xl hover:bg-white/90 transition-colors\">\n                            <span class=\"relative flex h-2 w-2\">\n                                <span class=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75\"></span>\n                                <span class=\"relative inline-flex rounded-full h-2 w-2 bg-green-500\"></span>\n                            </span>\n                            Start Live Chat\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        document.getElementById('open-live-chat')?.addEventListener('click', () => {\n            // Trigger chat widget to open\n            document.dispatchEvent(new CustomEvent('chat:open'));\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Quick Contact Options\n    // ============================================\n    function initQuickContactOptions() {\n        const container = document.getElementById('quick-contact');\n        if (!container) return;\n\n        const options = [\n            { icon: 'phone', label: 'Call Us', action: 'tel:', color: 'emerald' },\n            { icon: 'whatsapp', label: 'WhatsApp', action: 'https://wa.me/', color: 'green' },\n            { icon: 'email', label: 'Email', action: 'mailto:', color: 'blue' }\n        ];\n\n        container.innerHTML = `\n            <div class=\"grid grid-cols-3 gap-4\">\n                <a href=\"tel:+1234567890\" class=\"flex flex-col items-center gap-2 p-4 bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 hover:border-emerald-500 dark:hover:border-emerald-500 hover:shadow-lg transition-all group\">\n                    <div class=\"w-12 h-12 bg-emerald-100 dark:bg-emerald-900/30 rounded-xl flex items-center justify-center text-emerald-600 dark:text-emerald-400 group-hover:scale-110 transition-transform\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/></svg>\n                    </div>\n                    <span class=\"text-sm font-medium text-stone-700 dark:text-stone-300\">Call Us</span>\n                </a>\n                <a href=\"https://wa.me/1234567890\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"flex flex-col items-center gap-2 p-4 bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 hover:border-green-500 dark:hover:border-green-500 hover:shadow-lg transition-all group\">\n                    <div class=\"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform\">\n                        <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/></svg>\n                    </div>\n                    <span class=\"text-sm font-medium text-stone-700 dark:text-stone-300\">WhatsApp</span>\n                </a>\n                <a href=\"mailto:support@bunoraa.com\" class=\"flex flex-col items-center gap-2 p-4 bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 hover:border-blue-500 dark:hover:border-blue-500 hover:shadow-lg transition-all group\">\n                    <div class=\"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform\">\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/></svg>\n                    </div>\n                    <span class=\"text-sm font-medium text-stone-700 dark:text-stone-300\">Email</span>\n                </a>\n            </div>\n        `;\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: FAQ Preview\n    // ============================================\n    function initFAQPreview() {\n        const container = document.getElementById('faq-preview');\n        if (!container) return;\n\n        const faqs = [\n            { q: 'How long does shipping take?', a: 'Standard shipping takes 5-7 business days. Express options are available at checkout.' },\n            { q: 'What is your return policy?', a: 'We offer a 30-day hassle-free return policy on all unused items in original packaging.' },\n            { q: 'Do you ship internationally?', a: 'Yes! We ship to over 100 countries worldwide.' }\n        ];\n\n        container.innerHTML = `\n            <div class=\"bg-white dark:bg-stone-800 rounded-2xl border border-stone-200 dark:border-stone-700 overflow-hidden\">\n                <div class=\"px-6 py-4 border-b border-stone-200 dark:border-stone-700 flex items-center justify-between\">\n                    <h3 class=\"font-semibold text-stone-900 dark:text-white\">Frequently Asked Questions</h3>\n                    <a href=\"/faq/\" class=\"text-sm text-primary-600 dark:text-amber-400 hover:underline\">View All</a>\n                </div>\n                <div class=\"divide-y divide-stone-200 dark:divide-stone-700\">\n                    ${faqs.map((faq, index) => `\n                        <div class=\"faq-item\" data-index=\"${index}\">\n                            <button class=\"faq-trigger w-full px-6 py-4 flex items-center justify-between text-left hover:bg-stone-50 dark:hover:bg-stone-700/50 transition-colors\">\n                                <span class=\"font-medium text-stone-900 dark:text-white pr-4\">${Templates.escapeHtml(faq.q)}</span>\n                                <svg class=\"faq-icon w-5 h-5 text-stone-400 transform transition-transform flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\n                            </button>\n                            <div class=\"faq-answer hidden px-6 pb-4 text-stone-600 dark:text-stone-400\">\n                                ${Templates.escapeHtml(faq.a)}\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n\n        // Bind FAQ accordion\n        container.querySelectorAll('.faq-trigger').forEach(trigger => {\n            trigger.addEventListener('click', () => {\n                const item = trigger.closest('.faq-item');\n                const answer = item.querySelector('.faq-answer');\n                const icon = item.querySelector('.faq-icon');\n                const isOpen = !answer.classList.contains('hidden');\n\n                // Close all others\n                container.querySelectorAll('.faq-item').forEach(otherItem => {\n                    if (otherItem !== item) {\n                        otherItem.querySelector('.faq-answer').classList.add('hidden');\n                        otherItem.querySelector('.faq-icon').classList.remove('rotate-180');\n                    }\n                });\n\n                // Toggle current\n                answer.classList.toggle('hidden');\n                icon.classList.toggle('rotate-180');\n            });\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Office Hours Status\n    // ============================================\n    function initOfficeHoursStatus() {\n        const container = document.getElementById('office-status');\n        if (!container) return;\n\n        // Define office hours (adjust as needed)\n        const officeHours = {\n            start: 9, // 9 AM\n            end: 18,  // 6 PM\n            timezone: 'America/New_York',\n            days: [1, 2, 3, 4, 5] // Monday - Friday\n        };\n\n        function updateStatus() {\n            const now = new Date();\n            const day = now.getDay();\n            const hour = now.getHours();\n            const isWeekday = officeHours.days.includes(day);\n            const isOpen = isWeekday && hour >= officeHours.start && hour < officeHours.end;\n\n            container.innerHTML = `\n                <div class=\"flex items-center gap-3 p-4 rounded-xl ${isOpen ? 'bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800' : 'bg-stone-100 dark:bg-stone-800 border border-stone-200 dark:border-stone-700'}\">\n                    <span class=\"relative flex h-3 w-3\">\n                        ${isOpen ? \n                            `<span class=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\n                             <span class=\"relative inline-flex rounded-full h-3 w-3 bg-emerald-500\"></span>` :\n                            `<span class=\"relative inline-flex rounded-full h-3 w-3 bg-stone-400\"></span>`\n                        }\n                    </span>\n                    <div>\n                        <p class=\"font-medium ${isOpen ? 'text-emerald-700 dark:text-emerald-400' : 'text-stone-600 dark:text-stone-400'}\">\n                            ${isOpen ? 'We\\'re Open!' : 'Currently Closed'}\n                        </p>\n                        <p class=\"text-xs ${isOpen ? 'text-emerald-600 dark:text-emerald-500' : 'text-stone-500 dark:text-stone-500'}\">\n                            ${isOpen ? 'Our team is available to help you.' : `Office hours: Mon-Fri ${officeHours.start}AM - ${officeHours.end > 12 ? (officeHours.end - 12) + 'PM' : officeHours.end + 'AM'}`}\n                        </p>\n                    </div>\n                </div>\n            `;\n        }\n\n        updateStatus();\n        // Update every minute\n        setInterval(updateStatus, 60000);\n    }\n\n    function initContactForm() {\n        const form = document.getElementById('contact-form');\n        if (!form) return;\n\n        const validator = FormValidator.create(form, {\n            name: {\n                required: true,\n                minLength: 2,\n                maxLength: 100\n            },\n            email: {\n                required: true,\n                email: true\n            },\n            subject: {\n                required: true,\n                minLength: 5,\n                maxLength: 200\n            },\n            message: {\n                required: true,\n                minLength: 20,\n                maxLength: 2000\n            }\n        });\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            if (!validator.validate()) {\n                Toast.error('Please fill in all required fields correctly.');\n                return;\n            }\n\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            const originalText = submitBtn.textContent;\n            submitBtn.disabled = true;\n            submitBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\n\n            try {\n                const formData = new FormData(form);\n                const data = {\n                    name: formData.get('name'),\n                    email: formData.get('email'),\n                    phone: formData.get('phone'),\n                    subject: formData.get('subject'),\n                    message: formData.get('message')\n                };\n\n                await SupportApi.submitContactForm(data);\n                \n                Toast.success('Thank you for your message! We\\'ll get back to you soon.');\n                form.reset();\n                validator.clearErrors();\n                \n                showSuccessState();\n            } catch (error) {\n                Toast.error(error.message || 'Failed to send message. Please try again.');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = originalText;\n            }\n        });\n    }\n\n    function showSuccessState() {\n        const form = document.getElementById('contact-form');\n        const successContainer = document.getElementById('contact-success');\n\n        if (form && successContainer) {\n            form.classList.add('hidden');\n            successContainer.classList.remove('hidden');\n            successContainer.innerHTML = `\n                <div class=\"text-center py-12\">\n                    <div class=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                        <svg class=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n                        </svg>\n                    </div>\n                    <h3 class=\"text-xl font-semibold text-gray-900 mb-2\">Message Sent!</h3>\n                    <p class=\"text-gray-600 mb-6\">Thank you for reaching out. We'll respond to your inquiry within 24-48 hours.</p>\n                    <button id=\"send-another-btn\" class=\"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\">\n                        Send Another Message\n                    </button>\n                </div>\n            `;\n\n            document.getElementById('send-another-btn')?.addEventListener('click', () => {\n                form.classList.remove('hidden');\n                successContainer.classList.add('hidden');\n            });\n        }\n    }\n\n    async function loadContactInfo() {\n        const container = document.getElementById('contact-info');\n        if (!container) return;\n\n        try {\n            const response = await PagesApi.getContactInfo();\n            const info = response.data;\n\n            if (!info) return;\n\n            container.innerHTML = `\n                <div class=\"space-y-6\">\n                    ${info.address ? `\n                        <div class=\"flex gap-4\">\n                            <div class=\"flex-shrink-0 w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center\">\n                                <svg class=\"w-6 h-6 text-primary-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                                </svg>\n                            </div>\n                            <div>\n                                <h3 class=\"font-semibold text-gray-900\">Address</h3>\n                                <p class=\"text-gray-600\">${Templates.escapeHtml(info.address)}</p>\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${info.phone ? `\n                        <div class=\"flex gap-4\">\n                            <div class=\"flex-shrink-0 w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center\">\n                                <svg class=\"w-6 h-6 text-primary-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\n                                </svg>\n                            </div>\n                            <div>\n                                <h3 class=\"font-semibold text-gray-900\">Phone</h3>\n                                <a href=\"tel:${info.phone}\" class=\"text-gray-600 hover:text-primary-600\">${Templates.escapeHtml(info.phone)}</a>\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${info.email ? `\n                        <div class=\"flex gap-4\">\n                            <div class=\"flex-shrink-0 w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center\">\n                                <svg class=\"w-6 h-6 text-primary-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                                </svg>\n                            </div>\n                            <div>\n                                <h3 class=\"font-semibold text-gray-900\">Email</h3>\n                                <a href=\"mailto:${info.email}\" class=\"text-gray-600 hover:text-primary-600\">${Templates.escapeHtml(info.email)}</a>\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${info.business_hours ? `\n                        <div class=\"flex gap-4\">\n                            <div class=\"flex-shrink-0 w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center\">\n                                <svg class=\"w-6 h-6 text-primary-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                                </svg>\n                            </div>\n                            <div>\n                                <h3 class=\"font-semibold text-gray-900\">Business Hours</h3>\n                                <p class=\"text-gray-600\">${Templates.escapeHtml(info.business_hours)}</p>\n                            </div>\n                        </div>\n                    ` : ''}\n                    \n                    ${info.social_links && Object.keys(info.social_links).length > 0 ? `\n                        <div class=\"pt-4 border-t border-gray-200\">\n                            <h3 class=\"font-semibold text-gray-900 mb-3\">Follow Us</h3>\n                            <div class=\"flex gap-3\">\n                                ${info.social_links.facebook ? `\n                                    <a href=\"${info.social_links.facebook}\" target=\"_blank\" class=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors\">\n                                        <svg class=\"w-5 h-5 text-[#1877F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"/></svg>\n                                    </a>\n                                ` : ''}\n                                ${info.social_links.instagram ? `\n                                    <a href=\"${info.social_links.instagram}\" target=\"_blank\" class=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors\">\n                                        <svg class=\"w-5 h-5 text-[#E4405F]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"/></svg>\n                                    </a>\n                                ` : ''}\n                                ${info.social_links.twitter ? `\n                                    <a href=\"${info.social_links.twitter}\" target=\"_blank\" class=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors\">\n                                        <svg class=\"w-5 h-5 text-[#1DA1F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"/></svg>\n                                    </a>\n                                ` : ''}\n                                ${info.social_links.youtube ? `\n                                    <a href=\"${info.social_links.youtube}\" target=\"_blank\" class=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors\">\n                                        <svg class=\"w-5 h-5 text-[#FF0000]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\"/></svg>\n                                    </a>\n                                ` : ''}\n                            </div>\n                        </div>\n                    ` : ''}\n                </div>\n            `;\n        } catch (error) {\n            console.error('Failed to load contact info:', error);\n        }\n    }\n\n    function destroy() {}\n\n    return {\n        init,\n        destroy\n    };\n})();\n\nwindow.ContactPage = ContactPage;\nexport default ContactPage;\n", "/**\r\n * FAQ Page - Enhanced with Advanced Features\r\n * @module pages/faq\r\n */\r\n\r\nconst FAQPage = (function() {\r\n    'use strict';\r\n\r\n    let categories = [];\r\n    let allFAQs = [];\r\n\r\n    async function init() {\r\n        // Check if FAQs are already rendered server-side\r\n        const existingFAQList = document.getElementById('faq-list');\r\n        if (existingFAQList && existingFAQList.querySelector('.faq-item')) {\r\n            // Server-rendered content exists - just bind events\r\n            bindServerRenderedContent();\r\n        } else {\r\n            // Load dynamically\r\n            await loadFAQs();\r\n        }\r\n        initSearch();\r\n        initEnhancedFeatures();\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURES INITIALIZATION\r\n    // ============================================\r\n    function initEnhancedFeatures() {\r\n        initVoiceSearch();\r\n        initFAQRating();\r\n        initContactPromo();\r\n        initPopularQuestions();\r\n        initShareQuestion();\r\n        initKeyboardNavigation();\r\n        trackFAQAnalytics();\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Voice Search\r\n    // ============================================\r\n    function initVoiceSearch() {\r\n        const searchContainer = document.querySelector('.faq-search-container');\r\n        if (!searchContainer || !('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) return;\r\n\r\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n        const recognition = new SpeechRecognition();\r\n        recognition.continuous = false;\r\n        recognition.lang = 'en-US';\r\n\r\n        // Add voice button\r\n        const voiceBtn = document.createElement('button');\r\n        voiceBtn.id = 'faq-voice-search';\r\n        voiceBtn.type = 'button';\r\n        voiceBtn.className = 'absolute right-12 top-1/2 -translate-y-1/2 p-2 text-stone-400 hover:text-primary-600 dark:hover:text-amber-400 transition-colors';\r\n        voiceBtn.innerHTML = `\r\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"/></svg>\r\n        `;\r\n\r\n        const searchInput = document.getElementById('faq-search');\r\n        if (searchInput && searchInput.parentElement) {\r\n            searchInput.parentElement.style.position = 'relative';\r\n            searchInput.parentElement.appendChild(voiceBtn);\r\n        }\r\n\r\n        let isListening = false;\r\n\r\n        voiceBtn.addEventListener('click', () => {\r\n            if (isListening) {\r\n                recognition.stop();\r\n            } else {\r\n                recognition.start();\r\n                voiceBtn.classList.add('text-red-500', 'animate-pulse');\r\n            }\r\n            isListening = !isListening;\r\n        });\r\n\r\n        recognition.onresult = (event) => {\r\n            const transcript = event.results[0][0].transcript;\r\n            if (searchInput) {\r\n                searchInput.value = transcript;\r\n                searchInput.dispatchEvent(new Event('input'));\r\n            }\r\n            voiceBtn.classList.remove('text-red-500', 'animate-pulse');\r\n            isListening = false;\r\n        };\r\n\r\n        recognition.onerror = () => {\r\n            voiceBtn.classList.remove('text-red-500', 'animate-pulse');\r\n            isListening = false;\r\n        };\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: FAQ Rating (Was this helpful?)\r\n    // ============================================\r\n    function initFAQRating() {\r\n        // Add rating buttons to each FAQ answer\r\n        document.querySelectorAll('.faq-content, .accordion-content, .faq-answer').forEach(content => {\r\n            if (content.querySelector('.faq-rating')) return;\r\n\r\n            const faqItem = content.closest('.faq-item') || content.closest('[data-accordion]');\r\n            const questionId = faqItem?.dataset.id || Math.random().toString(36).substr(2, 9);\r\n\r\n            const ratingHtml = `\r\n                <div class=\"faq-rating mt-4 pt-4 border-t border-stone-200 dark:border-stone-700 flex items-center justify-between\">\r\n                    <span class=\"text-sm text-stone-500 dark:text-stone-400\">Was this answer helpful?</span>\r\n                    <div class=\"flex gap-2\">\r\n                        <button class=\"faq-rate-btn px-3 py-1 text-sm border border-stone-200 dark:border-stone-600 rounded-lg hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400 transition-all\" data-helpful=\"yes\" data-question=\"${questionId}\">\r\n                            <span class=\"flex items-center gap-1\">\r\n                                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5\"/></svg>\r\n                                Yes\r\n                            </span>\r\n                        </button>\r\n                        <button class=\"faq-rate-btn px-3 py-1 text-sm border border-stone-200 dark:border-stone-600 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 hover:border-red-500 hover:text-red-600 dark:hover:text-red-400 transition-all\" data-helpful=\"no\" data-question=\"${questionId}\">\r\n                            <span class=\"flex items-center gap-1\">\r\n                                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5\"/></svg>\r\n                                No\r\n                            </span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            content.insertAdjacentHTML('beforeend', ratingHtml);\r\n        });\r\n\r\n        // Bind rating clicks\r\n        document.addEventListener('click', (e) => {\r\n            const rateBtn = e.target.closest('.faq-rate-btn');\r\n            if (!rateBtn) return;\r\n\r\n            const helpful = rateBtn.dataset.helpful === 'yes';\r\n            const questionId = rateBtn.dataset.question;\r\n            const container = rateBtn.closest('.faq-rating');\r\n\r\n            // Save to localStorage\r\n            const ratings = JSON.parse(localStorage.getItem('faqRatings') || '{}');\r\n            ratings[questionId] = helpful;\r\n            localStorage.setItem('faqRatings', JSON.stringify(ratings));\r\n\r\n            // Show thank you\r\n            container.innerHTML = `\r\n                <div class=\"flex items-center gap-2 text-sm ${helpful ? 'text-emerald-600 dark:text-emerald-400' : 'text-stone-500 dark:text-stone-400'}\">\r\n                    <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>\r\n                    <span>Thanks for your feedback!</span>\r\n                </div>\r\n            `;\r\n\r\n            // Track analytics\r\n            if (typeof analytics !== 'undefined') {\r\n                analytics.track('faq_rated', { questionId, helpful });\r\n            }\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Contact CTA Promo\r\n    // ============================================\r\n    function initContactPromo() {\r\n        const container = document.getElementById('faq-contact-promo');\r\n        if (!container) return;\r\n\r\n        container.innerHTML = `\r\n            <div class=\"bg-gradient-to-br from-stone-900 to-stone-800 dark:from-stone-800 dark:to-stone-900 text-white rounded-2xl p-6 md:p-8\">\r\n                <div class=\"flex flex-col md:flex-row items-center gap-6\">\r\n                    <div class=\"w-16 h-16 bg-primary-600 dark:bg-amber-600 rounded-2xl flex items-center justify-center flex-shrink-0\">\r\n                        <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>\r\n                    </div>\r\n                    <div class=\"text-center md:text-left flex-1\">\r\n                        <h3 class=\"text-xl font-bold mb-2\">Can't Find What You're Looking For?</h3>\r\n                        <p class=\"text-stone-300 mb-4\">Our support team is here to help. Get personalized assistance for your questions.</p>\r\n                        <div class=\"flex flex-col sm:flex-row gap-3 justify-center md:justify-start\">\r\n                            <a href=\"/contact/\" class=\"inline-flex items-center justify-center gap-2 px-6 py-3 bg-white text-stone-900 font-semibold rounded-xl hover:bg-stone-100 transition-colors\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/></svg>\r\n                                Contact Support\r\n                            </a>\r\n                            <button id=\"open-chat-faq\" class=\"inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-xl hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\r\n                                <span class=\"relative flex h-2 w-2\">\r\n                                    <span class=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75\"></span>\r\n                                    <span class=\"relative inline-flex rounded-full h-2 w-2 bg-white\"></span>\r\n                                </span>\r\n                                Live Chat\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        document.getElementById('open-chat-faq')?.addEventListener('click', () => {\r\n            document.dispatchEvent(new CustomEvent('chat:open'));\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Popular Questions\r\n    // ============================================\r\n    function initPopularQuestions() {\r\n        const container = document.getElementById('popular-questions');\r\n        if (!container) return;\r\n\r\n        // Get popular questions from localStorage ratings\r\n        const ratings = JSON.parse(localStorage.getItem('faqRatings') || '{}');\r\n        const popularIds = Object.entries(ratings)\r\n            .filter(([_, helpful]) => helpful)\r\n            .slice(0, 5)\r\n            .map(([id]) => id);\r\n\r\n        // Find matching FAQ items\r\n        const popularQuestions = [];\r\n        document.querySelectorAll('.faq-item, [data-accordion]').forEach(item => {\r\n            const id = item.dataset.id;\r\n            if (popularIds.includes(id) || popularQuestions.length < 3) {\r\n                const questionText = item.querySelector('button span, .accordion-toggle span')?.textContent?.trim();\r\n                if (questionText) {\r\n                    popularQuestions.push({ id, question: questionText, element: item });\r\n                }\r\n            }\r\n        });\r\n\r\n        if (popularQuestions.length === 0) return;\r\n\r\n        container.innerHTML = `\r\n            <div class=\"bg-primary-50 dark:bg-amber-900/20 rounded-2xl p-6\">\r\n                <h3 class=\"font-semibold text-stone-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                    <svg class=\"w-5 h-5 text-primary-600 dark:text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\"/></svg>\r\n                    Most Helpful Questions\r\n                </h3>\r\n                <ul class=\"space-y-2\">\r\n                    ${popularQuestions.slice(0, 5).map(q => `\r\n                        <li>\r\n                            <button class=\"popular-q-link text-left text-primary-600 dark:text-amber-400 hover:underline text-sm\" data-target=\"${q.id}\">\r\n                                ${Templates.escapeHtml(q.question)}\r\n                            </button>\r\n                        </li>\r\n                    `).join('')}\r\n                </ul>\r\n            </div>\r\n        `;\r\n\r\n        // Bind clicks to scroll and expand\r\n        container.querySelectorAll('.popular-q-link').forEach(link => {\r\n            link.addEventListener('click', () => {\r\n                const targetId = link.dataset.target;\r\n                const targetItem = document.querySelector(`[data-id=\"${targetId}\"], .faq-item`);\r\n                if (targetItem) {\r\n                    targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    const trigger = targetItem.querySelector('.faq-trigger, .accordion-toggle');\r\n                    if (trigger) trigger.click();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Share Question\r\n    // ============================================\r\n    function initShareQuestion() {\r\n        document.querySelectorAll('.faq-content, .accordion-content, .faq-answer').forEach(content => {\r\n            if (content.querySelector('.faq-share')) return;\r\n\r\n            const faqItem = content.closest('.faq-item') || content.closest('[data-accordion]');\r\n            const questionText = faqItem?.querySelector('button span, .accordion-toggle span')?.textContent?.trim();\r\n            \r\n            if (!questionText) return;\r\n\r\n            const shareHtml = `\r\n                <div class=\"faq-share flex items-center gap-2 mt-3\">\r\n                    <span class=\"text-xs text-stone-400 dark:text-stone-500\">Share:</span>\r\n                    <button class=\"faq-share-btn p-1.5 hover:bg-stone-100 dark:hover:bg-stone-700 rounded transition-colors\" data-platform=\"copy\" title=\"Copy link\">\r\n                        <svg class=\"w-4 h-4 text-stone-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/></svg>\r\n                    </button>\r\n                    <a href=\"https://twitter.com/intent/tweet?text=${encodeURIComponent('Q: ' + questionText)}&url=${encodeURIComponent(window.location.href)}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"faq-share-btn p-1.5 hover:bg-stone-100 dark:hover:bg-stone-700 rounded transition-colors\" title=\"Share on Twitter\">\r\n                        <svg class=\"w-4 h-4 text-stone-400\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/></svg>\r\n                    </a>\r\n                    <a href=\"mailto:?subject=${encodeURIComponent('FAQ: ' + questionText)}&body=${encodeURIComponent(window.location.href)}\" class=\"faq-share-btn p-1.5 hover:bg-stone-100 dark:hover:bg-stone-700 rounded transition-colors\" title=\"Share via email\">\r\n                        <svg class=\"w-4 h-4 text-stone-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/></svg>\r\n                    </a>\r\n                </div>\r\n            `;\r\n\r\n            content.insertAdjacentHTML('beforeend', shareHtml);\r\n        });\r\n\r\n        // Copy link handler\r\n        document.addEventListener('click', (e) => {\r\n            const copyBtn = e.target.closest('.faq-share-btn[data-platform=\"copy\"]');\r\n            if (!copyBtn) return;\r\n\r\n            navigator.clipboard.writeText(window.location.href).then(() => {\r\n                const originalHtml = copyBtn.innerHTML;\r\n                copyBtn.innerHTML = `<svg class=\"w-4 h-4 text-emerald-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>`;\r\n                setTimeout(() => { copyBtn.innerHTML = originalHtml; }, 2000);\r\n            });\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Keyboard Navigation\r\n    // ============================================\r\n    function initKeyboardNavigation() {\r\n        const faqItems = document.querySelectorAll('.faq-item, [data-accordion]');\r\n        let currentIndex = -1;\r\n\r\n        document.addEventListener('keydown', (e) => {\r\n            // Only if we're in FAQ context\r\n            if (!document.querySelector('#faq-container, #faq-list')) return;\r\n\r\n            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                \r\n                if (e.key === 'ArrowDown') {\r\n                    currentIndex = Math.min(currentIndex + 1, faqItems.length - 1);\r\n                } else {\r\n                    currentIndex = Math.max(currentIndex - 1, 0);\r\n                }\r\n\r\n                const item = faqItems[currentIndex];\r\n                if (item) {\r\n                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    const trigger = item.querySelector('.faq-trigger, .accordion-toggle, button');\r\n                    if (trigger) trigger.focus();\r\n                }\r\n            }\r\n\r\n            if (e.key === 'Enter' && currentIndex >= 0) {\r\n                const item = faqItems[currentIndex];\r\n                const trigger = item?.querySelector('.faq-trigger, .accordion-toggle');\r\n                if (trigger) trigger.click();\r\n            }\r\n\r\n            // '/' to focus search\r\n            if (e.key === '/' && document.activeElement?.tagName !== 'INPUT') {\r\n                e.preventDefault();\r\n                document.getElementById('faq-search')?.focus();\r\n            }\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: FAQ Analytics\r\n    // ============================================\r\n    function trackFAQAnalytics() {\r\n        // Track which questions are viewed\r\n        const observer = new IntersectionObserver((entries) => {\r\n            entries.forEach(entry => {\r\n                if (entry.isIntersecting) {\r\n                    const item = entry.target;\r\n                    const questionText = item.querySelector('button span, .accordion-toggle span')?.textContent?.trim();\r\n                    \r\n                    // Track view\r\n                    const views = JSON.parse(localStorage.getItem('faqViews') || '{}');\r\n                    const id = item.dataset.id || questionText?.substring(0, 30);\r\n                    if (id) {\r\n                        views[id] = (views[id] || 0) + 1;\r\n                        localStorage.setItem('faqViews', JSON.stringify(views));\r\n                    }\r\n                }\r\n            });\r\n        }, { threshold: 0.5 });\r\n\r\n        document.querySelectorAll('.faq-item, [data-accordion]').forEach(item => {\r\n            observer.observe(item);\r\n        });\r\n\r\n        // Track accordion opens\r\n        document.addEventListener('click', (e) => {\r\n            const trigger = e.target.closest('.faq-trigger, .accordion-toggle');\r\n            if (trigger) {\r\n                const item = trigger.closest('.faq-item, [data-accordion]');\r\n                const questionText = trigger.querySelector('span')?.textContent?.trim();\r\n                \r\n                if (typeof analytics !== 'undefined') {\r\n                    analytics.track('faq_opened', { question: questionText?.substring(0, 100) });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function bindServerRenderedContent() {\r\n        // Bind category tabs\r\n        const categoryBtns = document.querySelectorAll('.category-tab');\r\n        const categoryGroups = document.querySelectorAll('.faq-category');\r\n\r\n        categoryBtns.forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                e.preventDefault();\r\n                \r\n                // Update active state\r\n                categoryBtns.forEach(b => {\r\n                    b.classList.remove('bg-primary-600', 'dark:bg-amber-600', 'text-white');\r\n                    b.classList.add('bg-stone-100', 'dark:bg-stone-800', 'text-stone-700', 'dark:text-stone-300');\r\n                });\r\n                btn.classList.add('bg-primary-600', 'dark:bg-amber-600', 'text-white');\r\n                btn.classList.remove('bg-stone-100', 'dark:bg-stone-800', 'text-stone-700', 'dark:text-stone-300');\r\n\r\n                const category = btn.dataset.category;\r\n\r\n                // Show/hide categories\r\n                if (category === 'all') {\r\n                    categoryGroups.forEach(cat => cat.classList.remove('hidden'));\r\n                } else {\r\n                    categoryGroups.forEach(cat => {\r\n                        cat.classList.toggle('hidden', cat.dataset.category !== category);\r\n                    });\r\n                }\r\n\r\n                // Clear search and show all items\r\n                const searchInput = document.getElementById('faq-search');\r\n                if (searchInput) searchInput.value = '';\r\n                document.querySelectorAll('.faq-item').forEach(item => item.classList.remove('hidden'));\r\n            });\r\n        });\r\n\r\n        // Bind accordion toggles\r\n        const accordionToggles = document.querySelectorAll('.accordion-toggle');\r\n        accordionToggles.forEach(toggle => {\r\n            toggle.addEventListener('click', () => {\r\n                const item = toggle.closest('[data-accordion]');\r\n                const content = item.querySelector('.accordion-content');\r\n                const icon = item.querySelector('.accordion-icon');\r\n                const isOpen = !content.classList.contains('hidden');\r\n\r\n                // Close all others\r\n                document.querySelectorAll('[data-accordion]').forEach(otherItem => {\r\n                    if (otherItem !== item) {\r\n                        otherItem.querySelector('.accordion-content')?.classList.add('hidden');\r\n                        otherItem.querySelector('.accordion-icon')?.classList.remove('rotate-180');\r\n                    }\r\n                });\r\n\r\n                // Toggle current\r\n                if (!isOpen) {\r\n                    content.classList.remove('hidden');\r\n                    icon.classList.add('rotate-180');\r\n                } else {\r\n                    content.classList.add('hidden');\r\n                    icon.classList.remove('rotate-180');\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    async function loadFAQs() {\r\n        const container = document.getElementById('faq-container');\r\n        if (!container) return;\r\n\r\n        Loader.show(container, 'skeleton');\r\n\r\n        try {\r\n            const response = await PagesApi.getFAQs();\r\n            const faqs = response.data || [];\r\n            allFAQs = faqs;\r\n\r\n            if (faqs.length === 0) {\r\n                container.innerHTML = `\r\n                    <div class=\"text-center py-12\">\r\n                        <svg class=\"w-16 h-16 text-stone-300 dark:text-stone-600 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                        </svg>\r\n                        <p class=\"text-stone-500 dark:text-stone-400\">No FAQs available at the moment.</p>\r\n                    </div>\r\n                `;\r\n                return;\r\n            }\r\n\r\n            categories = groupByCategory(faqs);\r\n            renderFAQs(categories);\r\n        } catch (error) {\r\n            console.error('Failed to load FAQs:', error);\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12\">\r\n                    <svg class=\"w-16 h-16 text-red-300 dark:text-red-600 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                    </svg>\r\n                    <p class=\"text-red-500 dark:text-red-400\">Failed to load FAQs. Please try again later.</p>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n\r\n    function groupByCategory(faqs) {\r\n        const grouped = {};\r\n        \r\n        faqs.forEach(faq => {\r\n            const category = faq.category || 'General';\r\n            if (!grouped[category]) {\r\n                grouped[category] = [];\r\n            }\r\n            grouped[category].push(faq);\r\n        });\r\n\r\n        return grouped;\r\n    }\r\n\r\n    function renderFAQs(categorizedFaqs, searchTerm = '') {\r\n        const container = document.getElementById('faq-container');\r\n        if (!container) return;\r\n\r\n        const categoryNames = Object.keys(categorizedFaqs);\r\n\r\n        if (categoryNames.length === 0) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12\">\r\n                    <svg class=\"w-16 h-16 text-stone-300 dark:text-stone-600 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                    </svg>\r\n                    <p class=\"text-stone-500 dark:text-stone-400\">No FAQs found${searchTerm ? ` for \"${Templates.escapeHtml(searchTerm)}\"` : ''}.</p>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <!-- Category Tabs -->\r\n            <div class=\"mb-8 overflow-x-auto scrollbar-hide\">\r\n                <div class=\"flex gap-2 pb-2\">\r\n                    <button class=\"faq-category-btn px-4 py-2 bg-primary-600 dark:bg-amber-600 text-white rounded-full text-sm font-medium whitespace-nowrap transition-colors\" data-category=\"all\">\r\n                        All\r\n                    </button>\r\n                    ${categoryNames.map(cat => `\r\n                        <button class=\"faq-category-btn px-4 py-2 bg-stone-100 dark:bg-stone-800 hover:bg-stone-200 dark:hover:bg-stone-700 text-stone-600 dark:text-stone-300 rounded-full text-sm font-medium whitespace-nowrap transition-colors\" data-category=\"${Templates.escapeHtml(cat)}\">\r\n                            ${Templates.escapeHtml(cat)}\r\n                        </button>\r\n                    `).join('')}\r\n                </div>\r\n            </div>\r\n\r\n            <!-- FAQ Accordion -->\r\n            <div id=\"faq-list\" class=\"space-y-6\">\r\n                ${categoryNames.map(category => `\r\n                    <div class=\"faq-category\" data-category=\"${Templates.escapeHtml(category)}\">\r\n                        <h2 class=\"text-lg font-semibold text-stone-900 dark:text-white mb-4\">${Templates.escapeHtml(category)}</h2>\r\n                        <div class=\"space-y-3\">\r\n                            ${categorizedFaqs[category].map(faq => renderFAQItem(faq, searchTerm)).join('')}\r\n                        </div>\r\n                    </div>\r\n                `).join('')}\r\n            </div>\r\n        `;\r\n\r\n        bindCategoryTabs();\r\n        bindAccordion();\r\n        \r\n        // Re-init enhanced features for dynamic content\r\n        initFAQRating();\r\n        initShareQuestion();\r\n    }\r\n\r\n    function renderFAQItem(faq, searchTerm = '') {\r\n        let question = Templates.escapeHtml(faq.question);\r\n        let answer = faq.answer;\r\n\r\n        if (searchTerm) {\r\n            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi');\r\n            question = question.replace(regex, '<mark class=\"bg-yellow-200 dark:bg-yellow-800\">$1</mark>');\r\n            answer = answer.replace(regex, '<mark class=\"bg-yellow-200 dark:bg-yellow-800\">$1</mark>');\r\n        }\r\n\r\n        return `\r\n            <div class=\"faq-item border border-stone-200 dark:border-stone-700 rounded-xl overflow-hidden bg-white dark:bg-stone-800\" data-id=\"${faq.id || ''}\">\r\n                <button class=\"faq-trigger w-full px-6 py-4 text-left flex items-center justify-between hover:bg-stone-50 dark:hover:bg-stone-700/50 transition-colors\">\r\n                    <span class=\"font-medium text-stone-900 dark:text-white pr-4\">${question}</span>\r\n                    <svg class=\"faq-icon w-5 h-5 text-stone-500 dark:text-stone-400 flex-shrink-0 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/>\r\n                    </svg>\r\n                </button>\r\n                <div class=\"faq-content hidden px-6 pb-4\">\r\n                    <div class=\"prose prose-sm dark:prose-invert max-w-none text-stone-600 dark:text-stone-300\">\r\n                        ${answer}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    function bindCategoryTabs() {\r\n        const categoryBtns = document.querySelectorAll('.faq-category-btn');\r\n        const categoryGroups = document.querySelectorAll('.faq-category');\r\n\r\n        categoryBtns.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                categoryBtns.forEach(b => {\r\n                    b.classList.remove('bg-primary-600', 'dark:bg-amber-600', 'text-white');\r\n                    b.classList.add('bg-stone-100', 'dark:bg-stone-800', 'text-stone-600', 'dark:text-stone-300');\r\n                });\r\n                btn.classList.add('bg-primary-600', 'dark:bg-amber-600', 'text-white');\r\n                btn.classList.remove('bg-stone-100', 'dark:bg-stone-800', 'text-stone-600', 'dark:text-stone-300');\r\n\r\n                const category = btn.dataset.category;\r\n\r\n                categoryGroups.forEach(group => {\r\n                    if (category === 'all' || group.dataset.category === category) {\r\n                        group.classList.remove('hidden');\r\n                    } else {\r\n                        group.classList.add('hidden');\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    function bindAccordion() {\r\n        const triggers = document.querySelectorAll('.faq-trigger');\r\n\r\n        triggers.forEach(trigger => {\r\n            trigger.addEventListener('click', () => {\r\n                const item = trigger.closest('.faq-item');\r\n                const content = item.querySelector('.faq-content');\r\n                const icon = item.querySelector('.faq-icon');\r\n                const isOpen = !content.classList.contains('hidden');\r\n\r\n                // Close all others\r\n                document.querySelectorAll('.faq-item').forEach(otherItem => {\r\n                    if (otherItem !== item) {\r\n                        otherItem.querySelector('.faq-content')?.classList.add('hidden');\r\n                        otherItem.querySelector('.faq-icon')?.classList.remove('rotate-180');\r\n                    }\r\n                });\r\n\r\n                // Toggle current\r\n                content.classList.toggle('hidden');\r\n                icon.classList.toggle('rotate-180');\r\n            });\r\n        });\r\n    }\r\n\r\n    function initSearch() {\r\n        const searchInput = document.getElementById('faq-search');\r\n        if (!searchInput) return;\r\n\r\n        let debounceTimer = null;\r\n\r\n        searchInput.addEventListener('input', (e) => {\r\n            const query = e.target.value.trim().toLowerCase();\r\n\r\n            clearTimeout(debounceTimer);\r\n            debounceTimer = setTimeout(() => {\r\n                // Check if we're working with server-rendered or JS-rendered content\r\n                const serverRendered = document.querySelector('.accordion-toggle');\r\n                \r\n                if (serverRendered) {\r\n                    // Server-rendered: filter existing DOM elements\r\n                    filterServerRenderedFAQs(query);\r\n                } else if (categories && Object.keys(categories).length > 0) {\r\n                    // JS-rendered: re-render filtered content\r\n                    if (query.length < 2) {\r\n                        renderFAQs(categories);\r\n                        return;\r\n                    }\r\n\r\n                    const filtered = {};\r\n                    Object.entries(categories).forEach(([category, faqs]) => {\r\n                        const matchingFaqs = faqs.filter(faq => \r\n                            faq.question.toLowerCase().includes(query) ||\r\n                            faq.answer.toLowerCase().includes(query)\r\n                        );\r\n                        if (matchingFaqs.length > 0) {\r\n                            filtered[category] = matchingFaqs;\r\n                        }\r\n                    });\r\n\r\n                    renderFAQs(filtered, query);\r\n                }\r\n            }, 300);\r\n        });\r\n\r\n        // Show keyboard shortcut hint\r\n        const hint = document.createElement('span');\r\n        hint.className = 'absolute right-3 top-1/2 -translate-y-1/2 text-xs text-stone-400 dark:text-stone-500 hidden md:block';\r\n        hint.textContent = 'Press / to search';\r\n        if (searchInput.parentElement) {\r\n            searchInput.parentElement.style.position = 'relative';\r\n            searchInput.parentElement.appendChild(hint);\r\n\r\n            searchInput.addEventListener('focus', () => hint.classList.add('hidden'));\r\n            searchInput.addEventListener('blur', () => hint.classList.remove('hidden'));\r\n        }\r\n    }\r\n\r\n    function filterServerRenderedFAQs(query) {\r\n        const faqItems = document.querySelectorAll('.faq-item');\r\n        const categoryGroups = document.querySelectorAll('.faq-category');\r\n        const noResults = document.getElementById('no-results');\r\n        \r\n        let visibleCount = 0;\r\n        \r\n        faqItems.forEach(item => {\r\n            const questionEl = item.querySelector('.accordion-toggle span, button span');\r\n            const contentEl = item.querySelector('.accordion-content');\r\n            \r\n            const question = questionEl ? questionEl.textContent.toLowerCase() : '';\r\n            const answer = contentEl ? contentEl.textContent.toLowerCase() : '';\r\n            \r\n            if (!query || question.includes(query) || answer.includes(query)) {\r\n                item.classList.remove('hidden');\r\n                visibleCount++;\r\n            } else {\r\n                item.classList.add('hidden');\r\n            }\r\n        });\r\n        \r\n        // Hide empty categories\r\n        categoryGroups.forEach(cat => {\r\n            const visibleItems = cat.querySelectorAll('.faq-item:not(.hidden)');\r\n            cat.classList.toggle('hidden', visibleItems.length === 0);\r\n        });\r\n        \r\n        // Show no results message\r\n        if (noResults) {\r\n            noResults.classList.toggle('hidden', visibleCount > 0);\r\n        }\r\n    }\r\n\r\n    function destroy() {\r\n        categories = [];\r\n        allFAQs = [];\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy\r\n    };\r\n})();\r\n\r\nwindow.FAQPage = FAQPage;\r\nexport default FAQPage;\r\n", "/**\r\n * CategoryCard Component\r\n */\r\n\r\nexport function CategoryCard(category) {\r\n    // Create anchor element\r\n    const card = document.createElement('a');\r\n    card.href = `/categories/${category.slug}/`;\r\n    card.className = 'group block';\r\n\r\n    // Card inner (image or fallback)\r\n    const cardInner = document.createElement('div');\r\n    cardInner.className = 'relative aspect-square rounded-xl overflow-hidden bg-gray-100';\r\n\r\n    // Image or fallback\r\n    let imgSrc = '';\r\n    // API provides `image_url` by default; prefer that\r\n    if (typeof category.image_url === 'string' && category.image_url) imgSrc = category.image_url;\r\n    else if (typeof category.image === 'string' && category.image) imgSrc = category.image;\r\n    else if (category.image && typeof category.image === 'object') imgSrc = category.image.url || category.image.src || category.image_url || '';\r\n    else if (typeof category.banner_image === 'string' && category.banner_image) imgSrc = category.banner_image;\r\n    else if (category.banner_image && typeof category.banner_image === 'object') imgSrc = category.banner_image.url || category.banner_image.src || '';\r\n    else if (typeof category.hero_image === 'string' && category.hero_image) imgSrc = category.hero_image;\r\n    else if (category.hero_image && typeof category.hero_image === 'object') imgSrc = category.hero_image.url || category.hero_image.src || '';\r\n    else if (typeof category.thumbnail === 'string' && category.thumbnail) imgSrc = category.thumbnail;\r\n    else if (category.thumbnail && typeof category.thumbnail === 'object') imgSrc = category.thumbnail.url || category.thumbnail.src || '';\r\n\r\n\r\n\r\n    if (imgSrc) {\r\n        const img = document.createElement('img');\r\n        img.src = imgSrc;\r\n        img.alt = category.name || '';\r\n        img.className = 'w-full h-full object-cover group-hover:scale-105 transition-transform duration-300';\r\n        img.loading = 'lazy';\r\n        img.decoding = 'async';\r\n        // If image fails to load, show fallback block instead\r\n        img.onerror = (err) => {\r\n            try {\r\n                img.remove();\r\n                const fallback = document.createElement('div');\r\n                fallback.className = 'w-full h-full flex items-center justify-center bg-gradient-to-br from-primary-100 to-primary-200';\r\n                fallback.innerHTML = `<svg class=\"w-12 h-12 text-primary-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"/></svg>`;\r\n                cardInner.appendChild(fallback);\r\n            } catch (e) {}\r\n        }; \r\n        cardInner.appendChild(img);\r\n    } else {\r\n        const fallback = document.createElement('div');\r\n        fallback.className = 'w-full h-full flex items-center justify-center bg-gradient-to-br from-primary-100 to-primary-200';\r\n        fallback.innerHTML = `<svg class=\"w-12 h-12 text-primary-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\"/></svg>`;\r\n        cardInner.appendChild(fallback);\r\n    }\r\n\r\n    const overlay = document.createElement('div');\r\n    // Lighter overlay on light mode, stronger on dark\r\n    overlay.className = 'absolute inset-0 bg-gradient-to-t from-black/30 dark:from-black/60 to-transparent';\r\n    cardInner.appendChild(overlay);\r\n    card.appendChild(cardInner);\r\n\r\n    const name = document.createElement('h3');\r\n    name.className = 'mt-3 text-sm font-medium text-stone-900 group-hover:text-primary-600 transition-colors text-center dark:text-white';\r\n    name.textContent = category.name;\r\n    card.appendChild(name);\r\n\r\n    if (category.product_count) {\r\n        const count = document.createElement('p');\r\n        count.className = 'text-xs text-stone-600 dark:text-white/60 text-center';\r\n        count.textContent = `${category.product_count} products`;\r\n        card.appendChild(count);\r\n    }\r\n\r\n    return card;\r\n}\r\n", "/**\n * Home Page - Enhanced with Advanced E-commerce Features\n * @module pages/home\n */\n\nconst HomePage = (function() {\n    'use strict';\n\n    let heroSliderInterval = null;\n    let liveVisitorCount = 0;\n    let socialProofInterval = null;\n    let countdownInterval = null;\n\n    async function init() {\n        // OPTIMIZED: Load critical sections first, then non-critical sections in background\n        \n        // Ensure page starts at the top\n        window.scrollTo(0, 0);\n        \n        // Critical sections (above the fold) - load with Promise.all\n        await Promise.all([\n            loadHeroBanners(),\n            loadFeaturedProducts(),\n            loadNewArrivals(),\n        ]);\n        \n        // Initialize interactive features immediately\n        initNewsletterForm();\n        initScrollAnimations();\n        initQuickViewModal();\n        \n        // Non-critical sections (below the fold) - load in background without blocking\n        // These will load while user is viewing the top sections\n        Promise.all([\n            loadCategoriesShowcase(),\n            loadBestSellers(),\n            loadTestimonials()\n        ]).catch(err => console.error('Failed to load secondary sections:', err));\n        \n        // Delayed features (don't impact initial load)\n        setTimeout(() => {\n            initLiveVisitorCounter();\n            initSocialProofPopups();\n            initRecentlyViewed();\n            initFlashSaleCountdown();\n        }, 2000);\n        \n        // Non-blocking enhancements\n        try {\n            loadPromotions();\n            loadCustomOrderCTA();\n        } catch (e) {\n            console.warn('Failed to load promotions/CTA:', e);\n        }\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Live Visitor Counter\n    // ============================================\n    function initLiveVisitorCounter() {\n        const container = document.getElementById('live-visitors');\n        if (!container) return;\n        \n        async function fetchAndUpdateCount() {\n            try {\n                // Fetch active sessions from analytics\n                const response = await window.ApiClient.get('/analytics/active-visitors/', {});\n                const data = response.data || response;\n                \n                // Get real active visitor count\n                liveVisitorCount = data.active_visitors || data.count || 0;\n                \n                // If no real data, don't show anything (don't use fallback)\n                if (liveVisitorCount === 0) {\n                    container.innerHTML = '';\n                    return;\n                }\n                \n                container.innerHTML = `\n                    <div class=\"flex items-center gap-2 px-3 py-1.5 bg-emerald-100 dark:bg-emerald-900/30 rounded-full\">\n                        <span class=\"relative flex h-2 w-2\">\n                            <span class=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\n                            <span class=\"relative inline-flex rounded-full h-2 w-2 bg-emerald-500\"></span>\n                        </span>\n                        <span class=\"text-xs font-medium text-emerald-700 dark:text-emerald-300\">${liveVisitorCount} browsing now</span>\n                    </div>\n                `;\n            } catch (error) {\n                console.warn('Failed to fetch active visitors:', error);\n                // Don't show fallback, just log error\n                container.innerHTML = '';\n            }\n        }\n        \n        // Fetch immediately and then every 8 seconds\n        fetchAndUpdateCount();\n        setInterval(fetchAndUpdateCount, 8000);\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Social Proof Popups\n    // ============================================\n    function initSocialProofPopups() {\n        \n        let recentPurchases = [];\n        let index = 0;\n        let proofCount = 0;\n        const maxProofs = 10; // Limit to 10 popups per session\n\n        async function fetchRecentPurchases() {\n            try {\n                // Fetch real recent purchases from analytics API\n                const response = await window.ApiClient.get('/analytics/recent-purchases/', {});\n                recentPurchases = response.data || response.purchases || [];\n                \n                // If no real purchases, don't start the popup rotation\n                if (recentPurchases.length === 0) {\n                    return;\n                }\n                \n                // Start showing popups after 10 seconds\n                setTimeout(() => {\n                    showProof();\n                    socialProofInterval = setInterval(() => {\n                        if (proofCount < maxProofs) showProof();\n                        else clearInterval(socialProofInterval);\n                    }, 30000);\n                }, 10000);\n            } catch (error) {\n                console.warn('Failed to fetch recent purchases:', error);\n                // Don't show any fallback data\n            }\n        }\n\n        function showProof() {\n            if (recentPurchases.length === 0 || proofCount >= maxProofs) return;\n            \n            const proof = recentPurchases[index];\n            if (!proof) return;\n            \n            const popup = document.createElement('div');\n            popup.className = 'social-proof-popup fixed bottom-4 left-4 z-50 max-w-xs bg-white dark:bg-stone-800 rounded-xl shadow-2xl border border-stone-200 dark:border-stone-700 p-4 transform translate-y-full opacity-0 transition-all duration-500';\n            \n            // Using real data structure from API\n            let content = `\n                <div class=\"flex items-start gap-3\">\n                    <div class=\"w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center flex-shrink-0\">\n                        <svg class=\"w-5 h-5 text-emerald-600 dark:text-emerald-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\n                    </div>\n                    <div>\n                        <p class=\"text-sm font-medium text-stone-900 dark:text-white\">${proof.message}</p>\n                        <p class=\"text-xs text-stone-400 dark:text-stone-500 mt-1\">${proof.time_ago}</p>\n                    </div>\n                </div>\n            `;\n\n            popup.innerHTML = `\n                ${content}\n                <button class=\"absolute top-2 right-2 text-stone-400 hover:text-stone-600 dark:hover:text-stone-300\" onclick=\"this.parentElement.remove()\">\n                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                </button>\n            `;\n\n            document.body.appendChild(popup);\n            proofCount++; // Increment counter\n            \n            // Animate in\n            requestAnimationFrame(() => {\n                popup.classList.remove('translate-y-full', 'opacity-0');\n            });\n\n            // Remove after 5 seconds\n            setTimeout(() => {\n                popup.classList.add('translate-y-full', 'opacity-0');\n                setTimeout(() => popup.remove(), 500);\n            }, 5000);\n\n            index = (index + 1) % recentPurchases.length;\n            \n            // Stop showing if we've reached max count\n            if (proofCount >= maxProofs && socialProofInterval) {\n                clearInterval(socialProofInterval);\n            }\n        }\n        // Fetch real purchases and start popup rotation\n        fetchRecentPurchases();\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Recently Viewed Products\n    // ============================================\n    function initRecentlyViewed() {\n        const section = document.getElementById('recently-viewed-section');\n        const container = document.getElementById('recently-viewed');\n        const clearBtn = document.getElementById('clear-recently-viewed');\n        \n        if (!section || !container) return;\n\n        const viewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');\n        \n        if (viewed.length === 0) {\n            section.classList.add('hidden');\n            return;\n        }\n\n        section.classList.remove('hidden');\n        \n        container.innerHTML = viewed.slice(0, 5).map(product => {\n            let badge = null;\n            if (product.discount_percent && product.discount_percent > 0) {\n                badge = `-${product.discount_percent}%`;\n            }\n            return ProductCard.render(product, { showBadge: !!badge, badge, priceSize: 'small' });\n        }).join('');\n        \n        ProductCard.bindEvents(container);\n\n        clearBtn?.addEventListener('click', () => {\n            localStorage.removeItem('recentlyViewed');\n            section.classList.add('hidden');\n            Toast.success('Recently viewed items cleared');\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Flash Sale Countdown\n    // ============================================\n    function initFlashSaleCountdown() {\n        const section = document.getElementById('flash-sale-section');\n        const countdown = document.getElementById('flash-sale-countdown');\n        \n        if (!section || !countdown) return;\n\n        // Check if there's an active flash sale (in production, fetch from API)\n        const saleEndTime = localStorage.getItem('flashSaleEnd');\n        \n        if (!saleEndTime) {\n            // Set a mock flash sale for demo (ends in 4 hours)\n            const endTime = new Date().getTime() + (4 * 60 * 60 * 1000);\n            localStorage.setItem('flashSaleEnd', endTime.toString());\n        }\n\n        const endTime = parseInt(localStorage.getItem('flashSaleEnd'));\n        \n        function updateCountdown() {\n            const now = new Date().getTime();\n            const distance = endTime - now;\n\n            if (distance <= 0) {\n                section.classList.add('hidden');\n                clearInterval(countdownInterval);\n                localStorage.removeItem('flashSaleEnd');\n                return;\n            }\n\n            section.classList.remove('hidden');\n\n            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));\n            const seconds = Math.floor((distance % (1000 * 60)) / 1000);\n\n            countdown.innerHTML = `\n                <div class=\"flex items-center gap-2 text-white\">\n                    <span class=\"text-sm font-medium\">Ends in:</span>\n                    <div class=\"flex items-center gap-1\">\n                        <span class=\"bg-white/20 px-2 py-1 rounded font-mono font-bold\">${hours.toString().padStart(2, '0')}</span>\n                        <span class=\"font-bold\">:</span>\n                        <span class=\"bg-white/20 px-2 py-1 rounded font-mono font-bold\">${minutes.toString().padStart(2, '0')}</span>\n                        <span class=\"font-bold\">:</span>\n                        <span class=\"bg-white/20 px-2 py-1 rounded font-mono font-bold\">${seconds.toString().padStart(2, '0')}</span>\n                    </div>\n                </div>\n            `;\n        }\n\n        updateCountdown();\n        countdownInterval = setInterval(updateCountdown, 1000);\n    }\n\n    // // ============================================\n    // // ENHANCED FEATURE: Artisan Spotlight\n    // // ============================================\n    // async function initArtisanSpotlight() {\n    //     const container = document.getElementById('artisan-spotlight');\n    //     if (!container) return;\n    //     try {\n    //         // In production, fetch from API\n    //         const artisans = [\n    //             {\n    //                 name: 'Sarah Chen',\n    //                 specialty: 'Ceramic Art',\n    //                 image: '/static/images/artisans/sarah.jpg',\n    //                 story: 'Third-generation potter from the mountain villages, crafting unique pieces for over 15 years.',\n    //                 products: 45,\n    //                 rating: 4.9\n    //             },\n    //             {\n    //                 name: 'Ahmed Hassan',\n    //                 specialty: 'Leatherwork',\n    //                 image: '/static/images/artisans/ahmed.jpg',\n    //                 story: 'Master craftsman preserving traditional techniques passed down through generations.',\n    //                 products: 32,\n    //                 rating: 4.8\n    //             },\n    //             {\n    //                 name: 'Maria Santos',\n    //                 specialty: 'Textile Weaving',\n    //                 image: '/static/images/artisans/maria.jpg',\n    //                 story: 'Creating vibrant handwoven textiles using natural dyes and ancestral patterns.',\n    //                 products: 28,\n    //                 rating: 4.9\n    //             }\n    //         ];\n\n    //         container.innerHTML = `\n    //             <div class=\"grid md:grid-cols-3 gap-6\">\n    //                 ${artisans.map(artisan => `\n    //                     <div class=\"group relative bg-white dark:bg-stone-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow\">\n    //                         <div class=\"aspect-[4/3] overflow-hidden bg-stone-100 dark:bg-stone-700\">\n    //                             <img src=\"${artisan.image}\" alt=\"${Templates.escapeHtml(artisan.name)}\" class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\" loading=\"lazy\" decoding=\"async\">\n    //                         </div>\n    //                         <div class=\"p-6\">\n    //                             <div class=\"flex items-center justify-between mb-2\">\n    //                                 <h3 class=\"text-lg font-semibold text-stone-900 dark:text-white\">${Templates.escapeHtml(artisan.name)}</h3>\n    //                                 <div class=\"flex items-center gap-1 text-amber-500\">\n    //                                     <svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.385 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.385-2.46a1 1 0 00-1.175 0l-3.385 2.46c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118l-3.385-2.46c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.286-3.967z\"/></svg>\n    //                                     <span class=\"text-sm font-medium\">${artisan.rating}</span>\n    //                                 </div>\n    //                             </div>\n    //                             <p class=\"text-sm text-primary-600 dark:text-amber-400 font-medium mb-3\">${Templates.escapeHtml(artisan.specialty)}</p>\n    //                             <p class=\"text-sm text-stone-600 dark:text-stone-400 mb-4 line-clamp-2\">${Templates.escapeHtml(artisan.story)}</p>\n    //                             <div class=\"flex items-center justify-between\">\n    //                                 <span class=\"text-xs text-stone-500 dark:text-stone-500\">${artisan.products} products</span>\n    //                                 <a href=\"/artisans/${artisan.name.toLowerCase().replace(/\\s+/g, '-')}/\" class=\"text-sm font-medium text-primary-600 dark:text-amber-400 hover:underline\">View Profile \u2192</a>\n    //                             </div>\n    //                         </div>\n    //                     </div>\n    //                 `).join('')}\n    //             </div>\n    //         `;\n    //     } catch (error) {\n    //         console.warn('Artisan spotlight unavailable:', error);\n    //     }\n    // }\n\n    // ============================================\n    // ENHANCED FEATURE: Scroll Animations\n    // ============================================\n    function initScrollAnimations() {\n        const animatedElements = document.querySelectorAll('[data-animate]');\n        \n        if (!animatedElements.length) return;\n\n        const observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    const animation = entry.target.dataset.animate || 'fadeInUp';\n                    entry.target.classList.add('animate-' + animation);\n                    entry.target.classList.remove('opacity-0');\n                    observer.unobserve(entry.target);\n                }\n            });\n        }, {\n            threshold: 0.1,\n            rootMargin: '0px 0px -50px 0px'\n        });\n\n        animatedElements.forEach(el => {\n            el.classList.add('opacity-0');\n            observer.observe(el);\n        });\n    }\n\n    // ============================================\n    // ENHANCED FEATURE: Quick View Modal\n    // ============================================\n    function initQuickViewModal() {\n        document.addEventListener('click', async (e) => {\n            const quickViewBtn = e.target.closest('[data-quick-view]');\n            if (!quickViewBtn) return;\n\n            const productId = quickViewBtn.dataset.quickView;\n            if (!productId) return;\n\n            e.preventDefault();\n            \n            // Show loading modal\n            const modal = document.createElement('div');\n            modal.id = 'quick-view-modal';\n            modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\n            modal.innerHTML = `\n                <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('quick-view-modal').remove()\"></div>\n                <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto\">\n                    <button class=\"absolute top-4 right-4 z-10 w-10 h-10 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\" onclick=\"document.getElementById('quick-view-modal').remove()\">\n                        <svg class=\"w-5 h-5 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                    </button>\n                    <div class=\"p-8 flex items-center justify-center min-h-[400px]\">\n                        <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600\"></div>\n                    </div>\n                </div>\n            `;\n            document.body.appendChild(modal);\n\n            try {\n                const response = await ProductsApi.getProduct(productId);\n                const product = response.data || response;\n\n                const modalContent = modal.querySelector('.relative');\n                modalContent.innerHTML = `\n                    <button class=\"absolute top-4 right-4 z-10 w-10 h-10 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\" onclick=\"document.getElementById('quick-view-modal').remove()\">\n                        <svg class=\"w-5 h-5 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\n                    </button>\n                    <div class=\"grid md:grid-cols-2 gap-8 p-8\">\n                        <div class=\"aspect-square rounded-xl overflow-hidden bg-stone-100 dark:bg-stone-700\">\n                            <img src=\"${product.primary_image || product.image || '/static/images/placeholder.jpg'}\" alt=\"${Templates.escapeHtml(product.name)}\" class=\"w-full h-full object-cover\">\n                        </div>\n                        <div class=\"flex flex-col\">\n                            <h2 class=\"text-2xl font-bold text-stone-900 dark:text-white mb-2\">${Templates.escapeHtml(product.name)}</h2>\n                            <div class=\"flex items-center gap-2 mb-4\">\n                                <div class=\"flex text-amber-400\">\n                                    ${'<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.385 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.385-2.46a1 1 0 00-1.175 0l-3.385 2.46c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118l-3.385-2.46c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.286-3.967z\"/></svg>'.repeat(Math.round(product.rating || 4))}\n                                </div>\n                                <span class=\"text-sm text-stone-500 dark:text-stone-400\">(${product.review_count || 0} reviews)</span>\n                            </div>\n                            <div class=\"mb-6\">\n                                ${product.sale_price || product.discounted_price ? `\n                                    <span class=\"text-3xl font-bold text-primary-600 dark:text-amber-400\">${Templates.formatPrice(product.sale_price || product.discounted_price)}</span>\n                                    <span class=\"text-lg text-stone-400 line-through ml-2\">${Templates.formatPrice(product.price)}</span>\n                                ` : `\n                                    <span class=\"text-3xl font-bold text-stone-900 dark:text-white\">${Templates.formatPrice(product.price)}</span>\n                                `}\n                            </div>\n                            <p class=\"text-stone-600 dark:text-stone-400 mb-6 line-clamp-3\">${Templates.escapeHtml(product.short_description || product.description || '')}</p>\n                            <div class=\"mt-auto space-y-3\">\n                                <button class=\"w-full py-3 px-6 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors\" onclick=\"CartApi.addItem(${product.id}, 1).then(() => { Toast.success('Added to cart'); document.getElementById('quick-view-modal').remove(); })\">\n                                    Add to Cart\n                                </button>\n                                <a href=\"/products/${product.slug || product.id}/\" class=\"block w-full py-3 px-6 border-2 border-stone-200 dark:border-stone-600 text-stone-700 dark:text-stone-300 font-semibold rounded-xl text-center hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors\">\n                                    View Full Details\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            } catch (error) {\n                console.error('Failed to load product:', error);\n                modal.remove();\n                Toast.error('Failed to load product details');\n            }\n        });\n    }\n\n\n        async function loadTestimonials() {\n            const container = document.getElementById('testimonials-grid');\n            if (!container) return;\n            Loader.show(container, 'skeleton');\n            try {\n                // OPTIMIZED: Fetch reviews directly instead of looping through categories->products->reviews\n                // This reduces API calls from 50+ to just 1\n                let reviewsResponse = await ProductsApi.getReviews(null, { pageSize: 6, orderBy: '-rating' });\n                let allReviews = reviewsResponse?.data?.results || reviewsResponse?.data || reviewsResponse?.results || [];\n                \n                container.innerHTML = '';\n                if (!allReviews.length) {\n                    container.innerHTML = '<p class=\"text-gray-500 text-center py-8\">No user reviews available.</p>';\n                    return;\n                }\n                \n                // Limit to 6 reviews\n                allReviews = allReviews.slice(0, 6);\n                allReviews.forEach(review => {\n                    const card = document.createElement('div');\n                    card.className = 'rounded-2xl bg-white dark:bg-stone-800 shadow p-6 flex flex-col gap-3';\n                    card.innerHTML = `\n                        <div class=\"flex items-center gap-3 mb-2\">\n                            <div class=\"w-10 h-10 rounded-full bg-primary-100 dark:bg-stone-700 flex items-center justify-center text-lg font-bold text-primary-700 dark:text-amber-400\">\n                                ${review.user?.first_name?.[0] || review.user?.username?.[0] || '?'}\n                            </div>\n                            <div>\n                                <div class=\"font-semibold text-gray-900 dark:text-white\">${review.user?.first_name || review.user?.username || 'Anonymous'}</div>\n                                <div class=\"text-xs text-gray-500 dark:text-stone-400\">${review.created_at ? new Date(review.created_at).toLocaleDateString() : ''}</div>\n                            </div>\n                        </div>\n                        <div class=\"flex gap-1 mb-1\">\n                            ${'<svg class=\"w-4 h-4 text-amber-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.385 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.385-2.46a1 1 0 00-1.175 0l-3.385 2.46c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118l-3.385-2.46c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.286-3.967z\"/></svg>'.repeat(Math.round(review.rating || 5))}\n                        </div>\n                        <div class=\"text-gray-800 dark:text-stone-200 text-base mb-2\">${Templates.escapeHtml(review.title || '')}</div>\n                        <div class=\"text-gray-600 dark:text-stone-400 text-sm\">${Templates.escapeHtml(review.content || '')}</div>\n                    `;\n                    container.appendChild(card);\n                });\n            } catch (error) {\n                console.error('Failed to load testimonials:', error);\n                container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load reviews. Please try again later.</p>';\n            }\n    }\n    async function loadBestSellers() {\n        const container = document.getElementById('best-sellers');\n        if (!container) return;\n\n        const grid = container.querySelector('.products-grid') || container;\n        Loader.show(grid, 'skeleton');\n\n        try {\n            // Use backend bestseller logic, like featured\n            const response = await ProductsApi.getProducts({ bestseller: true, pageSize: 5 });\n            const products = response.data?.results || response.data || response.results || [];\n\n            if (products.length === 0) {\n                grid.innerHTML = '<p class=\"text-gray-500 text-center py-8\">No best sellers available.</p>';\n                return;\n            }\n\n            grid.innerHTML = products.map(product => {\n                // Only show discount badge if available\n                let badge = null;\n                if (product.discount_percent && product.discount_percent > 0) {\n                    badge = `-${product.discount_percent}%`;\n                }\n                return ProductCard.render(product, { showBadge: !!badge, badge, priceSize: 'small' });\n            }).join('');\n            ProductCard.bindEvents(grid);\n        } catch (error) {\n            console.error('Failed to load best sellers:', error);\n            grid.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load products. Please try again later.</p>';\n        }\n    }\n\n    async function loadHeroBanners() {\n        const container = document.getElementById('hero-slider');\n        if (!container) return;\n\n        try {\n            const response = await PagesApi.getBanners('home_hero');\n            const banners = response.data?.results || response.data || response.results || [];\n\n            if (banners.length === 0) {\n                container.innerHTML = '';\n                return;\n            }\n\n            container.innerHTML = `\n                <div class=\"relative overflow-hidden w-full h-[55vh] sm:h-[70vh] md:h-[80vh]\">\n                    <div class=\"hero-slides relative w-full h-full\">\n                        ${banners.map((banner, index) => `\n                            <div class=\"hero-slide ${index === 0 ? '' : 'hidden'} w-full h-full\" data-index=\"${index}\">\n                                <a href=\"${banner.link_url || '#'}\" class=\"block relative w-full h-full\">\n                                    <img \n                                        src=\"${banner.image}\" \n                                        alt=\"${Templates.escapeHtml(banner.title || '')}\"\n                                        class=\"absolute inset-0 w-full h-full object-cover\"\n                                        loading=\"${index === 0 ? 'eager' : 'lazy'}\"\n                                        decoding=\"async\"\n                                    >\n                                    ${banner.title || banner.subtitle ? `\n                                        <div class=\"absolute inset-0 bg-gradient-to-r from-black/60 via-black/30 to-transparent flex items-center\">\n                                            <div class=\"px-8 md:px-16 max-w-xl\">\n                                                ${banner.title ? `<h2 class=\"text-2xl sm:text-3xl md:text-5xl font-bold text-white mb-4\">${Templates.escapeHtml(banner.title)}</h2>` : ''}\n                                                ${banner.subtitle ? `<p class=\"text-sm sm:text-lg text-white/90 mb-6\">${Templates.escapeHtml(banner.subtitle)}</p>` : ''}\n                                                ${(banner.link_text || banner.button_text) ? `\n                                                    <span class=\"inline-flex items-center px-6 py-3 bg-white text-gray-900 font-semibold rounded-lg hover:bg-gray-100 transition-colors\">\n                                                        ${Templates.escapeHtml(banner.link_text || banner.button_text)}\n                                                        <svg class=\"w-5 h-5 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"/>\n                                                        </svg>\n                                                    </span>\n                                                ` : ''}\n                                            </div>\n                                        </div>\n                                    ` : ''}\n                                </a>\n                            </div>\n                        `).join('')}\n                    </div>\n                    ${banners.length > 1 ? `\n                        <button class=\"hero-prev absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 dark:bg-stone-800/30 hover:bg-white/40 dark:hover:bg-stone-700/40 rounded-full text-stone-900 dark:text-stone-100 flex items-center justify-center shadow-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500\" aria-label=\"Previous slide\">\n                            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\"/>\n                            </svg>\n                        </button>\n                        <button class=\"hero-next absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 dark:bg-stone-800/30 hover:bg-white/40 dark:hover:bg-stone-700/40 rounded-full text-stone-900 dark:text-stone-100 flex items-center justify-center shadow-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500\" aria-label=\"Next slide\">\n                            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n                            </svg>\n                        </button>\n                        <div class=\"hero-dots absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2\">\n                            ${banners.map((_, index) => `\n                                <button class=\"w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-white dark:bg-stone-200' : 'bg-white/50 dark:bg-stone-600/60 hover:bg-white/75 dark:hover:bg-stone-500/80'}\" data-slide=\"${index}\" aria-label=\"Go to slide ${index + 1}\"></button>\n                            `).join('')}\n                        </div>\n                    ` : ''}\n                </div>\n            `;\n\n            if (banners.length > 1) {\n                initHeroSlider(banners.length);\n            }\n        } catch (error) {\n            // Gracefully ignore missing banners endpoint and render a simple fallback hero\n            console.warn('Hero banners unavailable:', error?.status || error);\n        }\n    }\n\n    function initHeroSlider(totalSlides) {\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.hero-slide');\n        const dots = document.querySelectorAll('.hero-dots button');\n        const prevBtn = document.querySelector('.hero-prev');\n        const nextBtn = document.querySelector('.hero-next');\n\n        function goToSlide(index) {\n            slides[currentSlide].classList.add('hidden');\n            dots[currentSlide]?.classList.remove('bg-stone-100');\n            dots[currentSlide]?.classList.add('bg-white/50');\n\n            currentSlide = (index + totalSlides) % totalSlides;\n\n            slides[currentSlide].classList.remove('hidden');\n            dots[currentSlide]?.classList.add('bg-stone-100');\n            dots[currentSlide]?.classList.remove('bg-white/50');\n        }\n\n        prevBtn?.addEventListener('click', () => {\n            goToSlide(currentSlide - 1);\n            resetAutoplay();\n        });\n\n        nextBtn?.addEventListener('click', () => {\n            goToSlide(currentSlide + 1);\n            resetAutoplay();\n        });\n\n        dots.forEach((dot, index) => {\n            dot.addEventListener('click', () => {\n                goToSlide(index);\n                resetAutoplay();\n            });\n        });\n\n        function resetAutoplay() {\n            if (heroSliderInterval) {\n                clearInterval(heroSliderInterval);\n            }\n            heroSliderInterval = setInterval(() => goToSlide(currentSlide + 1), 5000);\n        }\n\n        // Add simple touch/swipe support for mobile\n        try {\n            const slidesContainer = document.querySelector('.hero-slides');\n            let touchStartX = 0;\n            slidesContainer?.addEventListener('touchstart', (e) => {\n                touchStartX = e.touches[0].clientX;\n            }, { passive: true });\n            slidesContainer?.addEventListener('touchend', (e) => {\n                const touchEndX = e.changedTouches[0].clientX;\n                const dx = touchEndX - touchStartX;\n                if (Math.abs(dx) > 50) {\n                    if (dx < 0) {\n                        goToSlide(currentSlide + 1);\n                    } else {\n                        goToSlide(currentSlide - 1);\n                    }\n                    resetAutoplay();\n                }\n            });\n        } catch (err) {\n            // ignore if touch listeners fail\n        }\n\n        resetAutoplay();\n    }\n\n    async function loadFeaturedProducts() {\n        const container = document.getElementById('featured-products');\n        if (!container) return;\n\n        const grid = container.querySelector('.products-grid') || container;\n        Loader.show(grid, 'skeleton');\n\n        try {\n            const response = await ProductsApi.getFeatured(8);\n            const products = response.data?.results || response.data || response.results || [];\n\n            if (products.length === 0) {\n                grid.innerHTML = '<p class=\"text-gray-500 text-center py-8\">No featured products available.</p>';\n                return;\n            }\n\n            grid.innerHTML = products.map(product => {\n                let badge = null;\n                if (product.discount_percent && product.discount_percent > 0) {\n                    badge = `-${product.discount_percent}%`;\n                }\n                return ProductCard.render(product, { showBadge: !!badge, badge, priceSize: 'small' });\n            }).join('');\n            ProductCard.bindEvents(grid);\n        } catch (error) {\n            console.error('Failed to load featured products:', error);\n            grid.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load products. Please try again later.</p>';\n        }\n    }\n\n    async function loadCategoriesShowcase() {\n        const container = document.getElementById('categories-showcase');\n        if (!container) return;\n\n\n\n        Loader.show(container, 'skeleton');\n\n        try {\n            // Clear any client cache for categories and fetch fresh data\n            try { window.ApiClient?.clearCache('/api/v1/catalog/categories/'); } catch (e) {}\n            const response = await window.ApiClient.get('/catalog/categories/', { page_size: 6, is_featured: true }, { useCache: false });\n            // info removed\n            const categories = response.data?.results || response.data || response.results || [];\n\n            if (categories.length === 0) {\n                container.innerHTML = '';\n                return;\n            }\n\n            // Import CategoryCard component\n            let CategoryCard;\n            try {\n                CategoryCard = (await import('../components/CategoryCard.js')).CategoryCard;\n            } catch (e) {\n                console.error('Failed to import CategoryCard:', e);\n                return;\n            }\n\n            container.innerHTML = '';\n            // info removed\n            categories.forEach(category => {\n                const card = CategoryCard(category);\n                // Log whether the created card contains an <img> and its src (if present)\n                try {\n                    const imgEl = card.querySelector('img');\n                    console.info('[Home] card image for', category.name, imgEl ? imgEl.src : 'NO_IMAGE');\n                } catch (e) { /* error logging removed */ }\n                container.appendChild(card);\n            });\n            container.classList.add('grid','grid-cols-2','sm:grid-cols-2','md:grid-cols-3','lg:grid-cols-6','gap-4','lg:gap-6');\n        } catch (error) {\n            console.error('Failed to load categories:', error);\n            container.innerHTML = '';\n        }\n    }\n\n    async function loadNewArrivals() {\n        const container = document.getElementById('new-arrivals');\n        if (!container) return;\n\n        const grid = container.querySelector('.products-grid') || container;\n        Loader.show(grid, 'skeleton');\n\n        try {\n            const response = await ProductsApi.getNewArrivals(4);\n            const products = response.data?.results || response.data || response.results || [];\n\n            if (products.length === 0) {\n                grid.innerHTML = '<p class=\"text-gray-500 text-center py-8\">No new products available.</p>';\n                return;\n            }\n\n            grid.innerHTML = products.map(product => {\n                let badge = null;\n                if (product.discount_percent && product.discount_percent > 0) {\n                    badge = `-${product.discount_percent}%`;\n                }\n                return ProductCard.render(product, { showBadge: !!badge, badge, priceSize: 'small' });\n            }).join('');\n            ProductCard.bindEvents(grid);\n        } catch (error) {\n            console.error('Failed to load new arrivals:', error);\n            grid.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load products.</p>';\n        }\n    }\n\n    async function loadPromotions() {\n        const container = document.getElementById('promotions-banner') || document.getElementById('promotion-banners');\n        if (!container) return;\n\n        try {\n            const response = await PagesApi.getPromotions();\n            let promotions = response?.data?.results ?? response?.results ?? response?.data ?? [];\n            if (!Array.isArray(promotions)) {\n                if (promotions && typeof promotions === 'object') {\n                    promotions = Array.isArray(promotions.items) ? promotions.items : [promotions];\n                } else {\n                    promotions = [];\n                }\n            }\n\n            if (promotions.length === 0) {\n                container.innerHTML = '';\n                return;\n            }\n\n            const promo = promotions[0] || {};\n            container.innerHTML = `\n                <div class=\"bg-gradient-to-r from-primary-600 to-primary-700 rounded-2xl overflow-hidden\">\n                    <div class=\"px-6 py-8 md:px-12 md:py-12 flex flex-col md:flex-row items-center justify-between gap-6\">\n                        <div class=\"text-center md:text-left\">\n                            <span class=\"inline-block px-3 py-1 bg-white/20 text-white text-sm font-medium rounded-full mb-3\">\n                                Limited Time Offer\n                            </span>\n                            <h3 class=\"text-2xl md:text-3xl font-bold text-white mb-2\">\n                                ${Templates.escapeHtml(promo.title || promo.name || '')}\n                            </h3>\n                            ${promo.description ? `\n                                <p class=\"text-white/90 max-w-lg\">${Templates.escapeHtml(promo.description)}</p>\n                            ` : ''}\n                            ${promo.discount_value ? `\n                                <p class=\"text-3xl font-bold text-white mt-4\">\n                                    ${promo.discount_type === 'percentage' ? `${promo.discount_value}% OFF` : `Save ${Templates.formatPrice(promo.discount_value)}`}\n                                </p>\n                            ` : ''}\n                        </div>\n                        <div class=\"flex flex-col items-center gap-4\">\n                            ${promo.code ? `\n                                <div class=\"bg-white/10 backdrop-blur-sm px-6 py-3 rounded-lg border-2 border-dashed border-white/30\">\n                                    <p class=\"text-sm text-white/80 mb-1\">Use code:</p>\n                                    <p class=\"text-2xl font-mono font-bold text-white tracking-wider\">${Templates.escapeHtml(promo.code)}</p>\n                                </div>\n                            ` : ''}\n                            <a href=\"/products/?promotion=${promo.id || ''}\" class=\"inline-flex items-center px-6 py-3 bg-stone-100 text-primary-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors\">\n                                Shop Now\n                                <svg class=\"w-5 h-5 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"/>\n                                </svg>\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            `;\n        } catch (error) {\n            console.warn('Promotions unavailable:', error?.status || error);\n            container.innerHTML = '';\n        }\n    }\n\n    async function loadCustomOrderCTA() {\n        const container = document.getElementById('custom-order-cta');\n        if (!container) return;\n        // prevent double initialization\n        if (container.dataset?.loaded) return;\n        container.dataset.loaded = '1';\n\n        // Insert a lightweight skeleton first to avoid layout shift / flash\n        container.innerHTML = `\n            <div class=\"container mx-auto px-4\">\n                <div class=\"max-w-full w-full mx-auto rounded-3xl p-6 md:p-10\">\n                    <div class=\"animate-pulse\">\n                        <div class=\"h-6 w-1/3 bg-gray-200 dark:bg-stone-700 rounded mb-4\"></div>\n                        <div class=\"h-10 w-full bg-gray-200 dark:bg-stone-700 rounded mb-4\"></div>\n                        <div class=\"h-44 bg-gray-200 dark:bg-stone-800 rounded\"></div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        const routeMap = window.BUNORAA_ROUTES || {};\n        const wizardUrl = routeMap.preordersWizard || '/preorders/create/';\n        const landingUrl = routeMap.preordersLanding || '/preorders/';\n\n        try {\n            // Try to load featured pre-order categories\n            let categories = [];\n            if (typeof PreordersApi !== 'undefined' && PreordersApi.getCategories) {\n                try {\n                    const response = await PreordersApi.getCategories({ featured: true, pageSize: 4 });\n                    categories = response?.data?.results || response?.data || response?.results || [];\n                } catch (e) {\n                    console.warn('Pre-order categories unavailable:', e);\n                }\n            }\n\n            container.innerHTML = `\n                <div class=\"container mx-auto px-4 relative\">\n                    <div class=\"max-w-full w-full mx-auto rounded-3xl shadow-lg overflow-hidden bg-white dark:bg-neutral-900 p-6 md:p-10 border border-stone-100 dark:border-stone-700\">\n                      <div class=\"grid lg:grid-cols-2 gap-12 items-center\">\n                        <div class=\"text-stone-900 dark:text-white\">\n                            <span class=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-100/40 dark:bg-amber-700/20 text-xs uppercase tracking-[0.2em] mb-6 text-amber-800 dark:text-white\">\n                                <span class=\"w-2 h-2 bg-purple-400 rounded-full animate-pulse\"></span>\n                                Made Just For You\n                            </span>\n                            <h2 class=\"text-3xl lg:text-5xl font-display font-bold mb-6 leading-tight text-stone-900 dark:text-white\">Create Your Perfect Custom Order</h2>\n                            <p class=\"text-stone-700 dark:text-white/80 text-lg mb-8 max-w-xl\">Have a unique vision? Our skilled artisans will bring your ideas to life. From personalized gifts to custom designs, we craft exactly what you need.</p>\n                            <div class=\"grid sm:grid-cols-3 gap-4 mb-8\">\n                                <div class=\"flex items-center gap-3 bg-white/5 dark:bg-stone-800/40 backdrop-blur-sm rounded-xl p-4 border border-stone-100 dark:border-stone-700\">\n                                    <div class=\"w-10 h-10 bg-purple-500/30 rounded-lg flex items-center justify-center\">\n                                        <svg class=\"w-5 h-5 text-purple-800\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/></svg>\n                                    </div>\n                                    <div>\n                                        <p class=\"text-sm font-semibold text-stone-900 dark:text-white\">Custom Design</p>\n                                        <p class=\"text-xs text-stone-600 dark:text-white/60\">Your vision, our craft</p>\n                                    </div>\n                                </div>\n                                <div class=\"flex items-center gap-3 bg-white/5 dark:bg-stone-800/40 backdrop-blur-sm rounded-xl p-4 border border-stone-100 dark:border-stone-700\">\n                                    <div class=\"w-10 h-10 bg-indigo-500/30 rounded-lg flex items-center justify-center\">\n                                        <svg class=\"w-5 h-5 text-indigo-700 dark:text-indigo-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"/></svg>\n                                    </div>\n                                    <div>\n                                        <p class=\"text-sm font-semibold text-stone-900 dark:text-white\">Direct Chat</p>\n                                        <p class=\"text-xs text-stone-600 dark:text-white/60\">Talk to artisans</p>\n                                    </div>\n                                </div>\n                                <div class=\"flex items-center gap-3 bg-white/5 dark:bg-stone-800/40 backdrop-blur-sm rounded-xl p-4 border border-stone-100 dark:border-stone-700\">\n                                    <div class=\"w-10 h-10 bg-pink-500/30 rounded-lg flex items-center justify-center\">\n                                        <svg class=\"w-5 h-5 text-pink-700 dark:text-pink-200\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>\n                                    </div>\n                                    <div>\n                                        <p class=\"text-sm font-semibold text-stone-900 dark:text-white\">Quality Assured</p>\n                                        <p class=\"text-xs text-stone-600 dark:text-white/60\">Satisfaction guaranteed</p>\n                                    </div>\n                                </div>\n                            </div>\n                            ${categories.length > 0 ? `\n                                <div class=\"mb-8\">\n                                    <p class=\"text-stone-600 dark:text-white/60 text-sm mb-3\">Popular categories:</p>\n                                    <div class=\"flex flex-wrap gap-2\">\n                                        ${categories.slice(0, 4).map(cat => `\n                                            <a href=\"${landingUrl}category/${cat.slug}/\" class=\"inline-flex items-center gap-2 px-4 py-2 bg-white/10 dark:bg-stone-800/30 hover:bg-white/20 dark:hover:bg-stone-700 rounded-full text-sm text-stone-900 dark:text-white transition-colors\">\n                                                ${cat.icon ? `<span>${cat.icon}</span>` : ''}\n                                                ${Templates.escapeHtml(cat.name)}\n                                            </a>\n                                        `).join('')}\n                                    </div>\n                                </div>\n                            ` : ''}\n                            <div class=\"flex flex-wrap gap-4\">\n                                <a href=\"${wizardUrl}\" class=\"cta-unlock inline-flex items-center gap-2 px-8 py-4 bg-amber-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:text-black dark:hover:text-black transition-colors group dark:bg-amber-600 dark:text-white\">\n                                    Start Your Custom Order\n                                    <svg class=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\"/></svg>\n                                </a>\n                                <a href=\"${landingUrl}\" class=\"inline-flex items-center gap-2 px-8 py-4 bg-transparent text-stone-900 dark:text-white font-semibold rounded-xl border-2 border-stone-200 dark:border-stone-700 hover:bg-stone-100 dark:hover:bg-stone-800 transition-all\">\n                                    Learn More\n                                </a>\n                            </div>\n                        </div>\n                        <div class=\"hidden lg:block\">\n                            <div class=\"relative\">\n                                <div class=\"absolute -inset-4 bg-gradient-to-r from-purple-500/30 to-indigo-500/30 rounded-3xl blur-2xl\"></div>\n                                <div class=\"relative bg-white/5 dark:bg-stone-800/40 backdrop-blur-md rounded-3xl p-8 border border-stone-100 dark:border-stone-700\">\n                                    <div class=\"space-y-6\">\n                                        <div class=\"flex items-start gap-4\">\n                                            <div class=\"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold shadow-sm ring-1 ring-stone-100 dark:ring-stone-700\">1</div>\n                                            <div>\n                                                <h4 class=\"text-stone-900 dark:text-white font-semibold mb-1\">Choose Category</h4>\n                                                <p class=\"text-stone-600 dark:text-white/60 text-sm\">Select from custom apparel, gifts, home decor & more</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex items-start gap-4\">\n                                            <div class=\"w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold shadow-sm ring-1 ring-stone-100 dark:ring-stone-700\">2</div>\n                                            <div>\n                                                <h4 class=\"text-stone-900 dark:text-white font-semibold mb-1\">Share Your Vision</h4>\n                                                <p class=\"text-stone-600 dark:text-white/60 text-sm\">Upload designs, describe your requirements</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex items-start gap-4\">\n                                            <div class=\"w-12 h-12 bg-amber-600 rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold shadow-sm ring-1 ring-stone-100 dark:ring-stone-700\">3</div>\n                                            <div>\n                                                <h4 class=\"text-stone-900 dark:text-white font-semibold mb-1\">Get Your Quote</h4>\n                                                <p class=\"text-stone-600 dark:text-white/60 text-sm\">Receive pricing and timeline from our team</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"flex items-start gap-4\">\n                                            <div class=\"w-12 h-12 bg-emerald-600 rounded-xl flex items-center justify-center flex-shrink-0 text-white text-xl font-bold shadow-sm ring-1 ring-stone-100 dark:ring-stone-700\">4</div>\n                                            <div>\n                                                <h4 class=\"text-stone-900 dark:text-white font-semibold mb-1\">We Create & Deliver</h4>\n                                                <p class=\"text-stone-600 dark:text-white/60 text-sm\">Track progress and receive your masterpiece</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        } catch (error) {\n            console.warn('Custom order CTA failed to load:', error);\n            // Fallback static content\n            container.innerHTML = `\n                <div class=\"container mx-auto px-4 text-center text-stone-900 dark:text-white\">\n                    <h2 class=\"text-3xl lg:text-4xl font-display font-bold mb-4 text-stone-900 dark:text-white\">Create Your Perfect Custom Order</h2>\n                    <p class=\"text-stone-700 dark:text-white/80 mb-8 max-w-2xl mx-auto\">Have a unique vision? Our skilled artisans will bring your ideas to life.</p>\n                    <a href=\"${wizardUrl}\" class=\"cta-unlock inline-flex items-center gap-2 px-8 py-4 bg-amber-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:text-black dark:hover:text-black transition-colors group dark:bg-amber-600 dark:text-white\">\n                        Start Your Custom Order\n                    </a>\n                </div>\n            `;\n        }\n    }\n\n    function initNewsletterForm() {\n        // Support both IDs for compatibility\n        const form = document.getElementById('newsletter-form') || document.getElementById('newsletter-form-home');\n        if (!form) return;\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            \n            const emailInput = form.querySelector('input[type=\"email\"]');\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            const email = emailInput?.value?.trim();\n\n            if (!email) {\n                Toast.error('Please enter your email address.');\n                return;\n            }\n\n            const originalText = submitBtn.textContent;\n            submitBtn.disabled = true;\n            submitBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\n\n            try {\n                await SupportApi.submitContactForm({ email, type: 'newsletter' });\n                Toast.success('Thank you for subscribing!');\n                emailInput.value = '';\n            } catch (error) {\n                Toast.error(error.message || 'Failed to subscribe. Please try again.');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.textContent = originalText;\n            }\n        });\n    }\n\n    function destroy() {\n        if (heroSliderInterval) {\n            clearInterval(heroSliderInterval);\n            heroSliderInterval = null;\n        }\n        if (socialProofInterval) {\n            clearInterval(socialProofInterval);\n            socialProofInterval = null;\n        }\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n        // Remove quick view modal\n        document.getElementById('quick-view-modal')?.remove();\n        // Remove social proof popups\n        document.querySelectorAll('.social-proof-popup').forEach(el => el.remove());\n    }\n\n    return {\n        init,\n        destroy,\n        // Expose for external use\n        initRecentlyViewed,\n        initFlashSaleCountdown\n    };\n})();\n\nwindow.HomePage = HomePage;\nexport default HomePage;\n", "/**\n * Orders Page - Enhanced with Advanced Features\n * @module pages/orders\n */\n\nconst OrdersPage = (function() {\n    'use strict';\n\n    let currentPage = 1;\n    let currentFilter = 'all';\n\n    async function init() {\n        if (!AuthGuard.protectPage()) return;\n\n        const orderId = getOrderIdFromUrl();\n        if (orderId) {\n            await loadOrderDetail(orderId);\n        } else {\n            await loadOrders();\n            initFilters();\n        }\n    }\n\n    function getOrderIdFromUrl() {\n        const path = window.location.pathname;\n        const match = path.match(/\\/orders\\/([^\\/]+)/);\n        return match ? match[1] : null;\n    }\n\n    async function loadOrders() {\n        const container = document.getElementById('orders-list');\n        if (!container) return;\n\n        Loader.show(container, 'skeleton');\n\n        try {\n            const params = {\n                page: currentPage,\n                limit: 10\n            };\n\n            if (currentFilter !== 'all') {\n                params.status = currentFilter;\n            }\n\n            const response = await OrdersApi.getAll(params);\n            const orders = response.data || [];\n            const meta = response.meta || {};\n\n            renderOrders(orders, meta);\n        } catch (error) {\n            console.error('Failed to load orders:', error);\n            container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load orders.</p>';\n        }\n    }\n\n    function renderOrders(orders, meta) {\n        const container = document.getElementById('orders-list');\n        if (!container) return;\n\n        if (orders.length === 0) {\n            container.innerHTML = `\n                <div class=\"text-center py-16\">\n                    <svg class=\"w-24 h-24 text-gray-300 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/>\n                    </svg>\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">No orders yet</h2>\n                    <p class=\"text-gray-600 mb-8\">When you place an order, it will appear here.</p>\n                    <a href=\"/products/\" class=\"inline-flex items-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors\">\n                        Start Shopping\n                    </a>\n                </div>\n            `;\n            return;\n        }\n\n        container.innerHTML = `\n            <div class=\"space-y-4\">\n                ${orders.map(order => renderOrderCard(order)).join('')}\n            </div>\n            ${meta.total_pages > 1 ? `\n                <div id=\"orders-pagination\" class=\"mt-8\">${Pagination.render({\n                    currentPage: meta.current_page || currentPage,\n                    totalPages: meta.total_pages,\n                    totalItems: meta.total\n                })}</div>\n            ` : ''}\n        `;\n\n        const paginationContainer = document.getElementById('orders-pagination');\n        paginationContainer?.addEventListener('click', (e) => {\n            const pageBtn = e.target.closest('[data-page]');\n            if (pageBtn) {\n                currentPage = parseInt(pageBtn.dataset.page);\n                loadOrders();\n                window.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n        });\n    }\n\n    function renderOrderCard(order) {\n        const statusClasses = {\n            pending: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',\n            processing: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',\n            shipped: 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400',\n            delivered: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',\n            cancelled: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',\n            refunded: 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400'\n        };\n\n        const statusClass = statusClasses[order.status] || 'bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400';\n        const items = order.items || [];\n        const displayItems = items.slice(0, 3);\n        const remainingCount = items.length - 3;\n\n        // Visual progress steps\n        const steps = ['pending', 'processing', 'shipped', 'delivered'];\n        const currentStepIndex = steps.indexOf(order.status);\n        const isCancelled = order.status === 'cancelled' || order.status === 'refunded';\n\n        return `\n            <div class=\"bg-white dark:bg-stone-800 rounded-xl shadow-sm border border-gray-100 dark:border-stone-700 overflow-hidden\">\n                <div class=\"px-6 py-4 border-b border-gray-100 dark:border-stone-700 flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <p class=\"text-sm text-gray-500 dark:text-stone-400\">Order #${Templates.escapeHtml(order.order_number || order.id)}</p>\n                        <p class=\"text-sm text-gray-500 dark:text-stone-400\">Placed on ${Templates.formatDate(order.created_at)}</p>\n                    </div>\n                    <div class=\"flex items-center gap-4\">\n                        <span class=\"px-3 py-1 rounded-full text-sm font-medium ${statusClass}\">\n                            ${Templates.escapeHtml(order.status_display || order.status)}\n                        </span>\n                        <a href=\"/orders/${order.id}/\" class=\"text-primary-600 dark:text-amber-400 hover:text-primary-700 dark:hover:text-amber-300 font-medium text-sm\">\n                            View Details\n                        </a>\n                    </div>\n                </div>\n                \n                <!-- Visual Progress Bar -->\n                ${!isCancelled ? `\n                    <div class=\"px-6 py-3 bg-stone-50 dark:bg-stone-900/50 border-b border-gray-100 dark:border-stone-700\">\n                        <div class=\"flex items-center justify-between relative\">\n                            <div class=\"absolute left-0 right-0 top-1/2 h-1 bg-stone-200 dark:bg-stone-700 -translate-y-1/2 rounded-full\"></div>\n                            <div class=\"absolute left-0 top-1/2 h-1 bg-primary-500 dark:bg-amber-500 -translate-y-1/2 rounded-full transition-all duration-500\" style=\"width: ${Math.max(0, (currentStepIndex / (steps.length - 1)) * 100)}%\"></div>\n                            ${steps.map((step, i) => `\n                                <div class=\"relative z-10 flex flex-col items-center\">\n                                    <div class=\"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${i <= currentStepIndex ? 'bg-primary-500 dark:bg-amber-500 text-white' : 'bg-stone-200 dark:bg-stone-700 text-stone-500 dark:text-stone-400'}\">\n                                        ${i < currentStepIndex ? '<svg class=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/></svg>' : (i + 1)}\n                                    </div>\n                                    <span class=\"text-xs text-stone-500 dark:text-stone-400 mt-1 capitalize hidden sm:block\">${step}</span>\n                                </div>\n                            `).join('')}\n                        </div>\n                    </div>\n                ` : ''}\n                \n                <div class=\"p-6\">\n                    <div class=\"flex flex-wrap gap-4\">\n                        ${displayItems.map(item => `\n                            <div class=\"flex items-center gap-3\">\n                                <div class=\"w-16 h-16 bg-gray-100 dark:bg-stone-700 rounded-lg overflow-hidden flex-shrink-0\">\n                                    ${item.product?.image ? `<img src=\"${item.product.image}\" alt=\"\" class=\"w-full h-full object-cover\" onerror=\"this.parentElement.innerHTML='<div class=\\\\'w-full h-full flex items-center justify-center text-gray-400 dark:text-stone-500\\\\'><svg class=\\\\'w-6 h-6\\\\' fill=\\\\'none\\\\' stroke=\\\\'currentColor\\\\' viewBox=\\\\'0 0 24 24\\\\'><path stroke-linecap=\\\\'round\\\\' stroke-linejoin=\\\\'round\\\\' stroke-width=\\\\'1.5\\\\' d=\\\\'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\\\\'/></svg></div>'\">` : `<div class=\"w-full h-full flex items-center justify-center text-gray-400 dark:text-stone-500\"><svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/></svg></div>`}\n                                </div>\n                                <div>\n                                    <p class=\"text-sm font-medium text-gray-900 dark:text-white\">${Templates.escapeHtml(item.product?.name || item.product_name)}</p>\n                                    <p class=\"text-sm text-gray-500 dark:text-stone-400\">Qty: ${item.quantity}</p>\n                                </div>\n                            </div>\n                        `).join('')}\n                        ${remainingCount > 0 ? `\n                            <div class=\"flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-stone-700 rounded-lg\">\n                                <span class=\"text-sm text-gray-500 dark:text-stone-400\">+${remainingCount}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"mt-4 pt-4 border-t border-gray-100 flex justify-between items-center\">\n                        <p class=\"text-sm text-gray-600\">\n                            ${items.length} ${items.length === 1 ? 'item' : 'items'}\n                        </p>\n                        <p class=\"font-semibold text-gray-900\">Total: ${Templates.formatPrice(order.total)}</p>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    async function loadOrderDetail(orderId) {\n        const container = document.getElementById('order-detail');\n        if (!container) return;\n\n        Loader.show(container, 'skeleton');\n\n        try {\n            const response = await OrdersApi.getById(orderId);\n            const order = response.data;\n\n            if (!order) {\n                window.location.href = '/orders/';\n                return;\n            }\n\n            renderOrderDetail(order);\n        } catch (error) {\n            console.error('Failed to load order:', error);\n            container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load order details.</p>';\n        }\n    }\n\n    function renderOrderDetail(order) {\n        const container = document.getElementById('order-detail');\n        if (!container) return;\n\n        const statusClasses = {\n            pending: 'bg-yellow-100 text-yellow-700',\n            processing: 'bg-blue-100 text-blue-700',\n            shipped: 'bg-indigo-100 text-indigo-700',\n            delivered: 'bg-green-100 text-green-700',\n            cancelled: 'bg-red-100 text-red-700',\n            refunded: 'bg-gray-100 text-gray-700'\n        };\n\n        const statusClass = statusClasses[order.status] || 'bg-gray-100 text-gray-700';\n        const items = order.items || [];\n\n        container.innerHTML = `\n            <div class=\"mb-6\">\n                <a href=\"/orders/\" class=\"inline-flex items-center text-primary-600 hover:text-primary-700\">\n                    <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16l-4-4m0 0l4-4m-4 4h18\"/>\n                    </svg>\n                    Back to Orders\n                </a>\n            </div>\n\n            <div class=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\n                <div class=\"px-6 py-4 border-b border-gray-100\">\n                    <div class=\"flex flex-wrap items-center justify-between gap-4\">\n                        <div>\n                            <h1 class=\"text-xl font-bold text-gray-900\">Order #${Templates.escapeHtml(order.order_number || order.id)}</h1>\n                            <p class=\"text-sm text-gray-500\">Placed on ${Templates.formatDate(order.created_at)}</p>\n                        </div>\n                        <span class=\"px-4 py-1.5 rounded-full text-sm font-medium ${statusClass}\">\n                            ${Templates.escapeHtml(order.status_display || order.status)}\n                        </span>\n                    </div>\n                </div>\n\n                <!-- Order Timeline -->\n                ${order.timeline && order.timeline.length > 0 ? `\n                    <div class=\"px-6 py-4 border-b border-gray-100\">\n                        <h2 class=\"text-sm font-semibold text-gray-900 mb-4\">Order Timeline</h2>\n                        <div class=\"relative\">\n                            <div class=\"absolute left-2 top-2 bottom-2 w-0.5 bg-gray-200\"></div>\n                            <div class=\"space-y-4\">\n                                ${order.timeline.map((event, index) => `\n                                    <div class=\"relative pl-8\">\n                                        <div class=\"absolute left-0 w-4 h-4 rounded-full ${index === 0 ? 'bg-primary-600' : 'bg-gray-300'}\"></div>\n                                        <p class=\"text-sm font-medium text-gray-900\">${Templates.escapeHtml(event.status)}</p>\n                                        <p class=\"text-xs text-gray-500\">${Templates.formatDate(event.timestamp, { includeTime: true })}</p>\n                                        ${event.note ? `<p class=\"text-sm text-gray-600 mt-1\">${Templates.escapeHtml(event.note)}</p>` : ''}\n                                    </div>\n                                `).join('')}\n                            </div>\n                        </div>\n                    </div>\n                ` : ''}\n\n                <!-- Tracking Info -->\n                ${order.tracking_number ? `\n                    <div class=\"px-6 py-4 border-b border-gray-100 bg-blue-50\">\n                        <div class=\"flex items-center justify-between\">\n                            <div>\n                                <p class=\"text-sm font-medium text-blue-900\">Tracking Number</p>\n                                <p class=\"text-lg font-mono text-blue-700\">${Templates.escapeHtml(order.tracking_number)}</p>\n                            </div>\n                            ${order.tracking_url ? `\n                                <a href=\"${order.tracking_url}\" target=\"_blank\" class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\">\n                                    Track Package\n                                </a>\n                            ` : ''}\n                        </div>\n                    </div>\n                ` : ''}\n\n                <!-- Order Items -->\n                <div class=\"px-6 py-4 border-b border-gray-100\">\n                    <h2 class=\"text-sm font-semibold text-gray-900 mb-4\">Items Ordered</h2>\n                    <div class=\"space-y-4\">\n                        ${items.map(item => `\n                            <div class=\"flex gap-4\">\n                                <div class=\"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0\">\n                                    ${item.product?.image ? `<img src=\"${item.product.image}\" alt=\"\" class=\"w-full h-full object-cover\" onerror=\"this.style.display='none'\">` : ''}\n                                </div>\n                                <div class=\"flex-1\">\n                                    <div class=\"flex justify-between\">\n                                        <div>\n                                            <h3 class=\"font-medium text-gray-900\">${Templates.escapeHtml(item.product?.name || item.product_name)}</h3>\n                                            ${item.variant ? `<p class=\"text-sm text-gray-500\">${Templates.escapeHtml(item.variant.name || item.variant_name)}</p>` : ''}\n                                            <p class=\"text-sm text-gray-500\">Qty: ${item.quantity}</p>\n                                        </div>\n                                        <p class=\"font-medium text-gray-900\">${Templates.formatPrice(item.price * item.quantity)}</p>\n                                    </div>\n                                    ${item.product?.slug ? `\n                                        <a href=\"/products/${item.product.slug}/\" class=\"text-sm text-primary-600 hover:text-primary-700 mt-2 inline-block\">\n                                            View Product\n                                        </a>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n\n                <!-- Addresses -->\n                <div class=\"px-6 py-4 border-b border-gray-100 grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                        <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">Shipping Address</h2>\n                        ${order.shipping_address ? `\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.shipping_address.full_name || `${order.shipping_address.first_name} ${order.shipping_address.last_name}`)}</p>\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.shipping_address.address_line_1)}</p>\n                            ${order.shipping_address.address_line_2 ? `<p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.shipping_address.address_line_2)}</p>` : ''}\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.shipping_address.city)}, ${Templates.escapeHtml(order.shipping_address.state || '')} ${Templates.escapeHtml(order.shipping_address.postal_code)}</p>\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.shipping_address.country)}</p>\n                        ` : '<p class=\"text-sm text-gray-500\">Not available</p>'}\n                    </div>\n                    <div>\n                        <h2 class=\"text-sm font-semibold text-gray-900 mb-2\">Billing Address</h2>\n                        ${order.billing_address ? `\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.billing_address.full_name || `${order.billing_address.first_name} ${order.billing_address.last_name}`)}</p>\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.billing_address.address_line_1)}</p>\n                            ${order.billing_address.address_line_2 ? `<p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.billing_address.address_line_2)}</p>` : ''}\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.billing_address.city)}, ${Templates.escapeHtml(order.billing_address.state || '')} ${Templates.escapeHtml(order.billing_address.postal_code)}</p>\n                            <p class=\"text-sm text-gray-600\">${Templates.escapeHtml(order.billing_address.country)}</p>\n                        ` : '<p class=\"text-sm text-gray-500\">Same as shipping</p>'}\n                    </div>\n                </div>\n\n                <!-- Order Summary -->\n                <div class=\"px-6 py-4\">\n                    <h2 class=\"text-sm font-semibold text-gray-900 mb-4\">Order Summary</h2>\n                    <div class=\"space-y-2 text-sm\">\n                        <div class=\"flex justify-between\">\n                            <span class=\"text-gray-600\">Subtotal</span>\n                            <span class=\"font-medium\">${Templates.formatPrice(order.subtotal || 0)}</span>\n                        </div>\n                        ${order.discount_amount ? `\n                            <div class=\"flex justify-between text-green-600\">\n                                <span>Discount</span>\n                                <span>-${Templates.formatPrice(order.discount_amount)}</span>\n                            </div>\n                        ` : ''}\n                        <div class=\"flex justify-between\">\n                            <span class=\"text-gray-600\">Shipping</span>\n                            <span class=\"font-medium\">${order.shipping_cost > 0 ? Templates.formatPrice(order.shipping_cost) : 'Free'}</span>\n                        </div>\n                        ${order.tax_amount ? `\n                            <div class=\"flex justify-between\">\n                                <span class=\"text-gray-600\">Tax</span>\n                                <span class=\"font-medium\">${Templates.formatPrice(order.tax_amount)}</span>\n                            </div>\n                        ` : ''}\n                        <div class=\"flex justify-between pt-2 border-t border-gray-200\">\n                            <span class=\"font-semibold text-gray-900\">Total</span>\n                            <span class=\"font-bold text-gray-900\">${Templates.formatPrice(order.total)}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Actions -->\n            <div class=\"mt-6 flex flex-wrap gap-4\">\n                ${order.status === 'delivered' ? `\n                    <button id=\"reorder-btn\" class=\"px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors\" data-order-id=\"${order.id}\">\n                        Order Again\n                    </button>\n                ` : ''}\n                ${['pending', 'processing'].includes(order.status) ? `\n                    <button id=\"cancel-order-btn\" class=\"px-6 py-3 border border-red-300 text-red-600 font-semibold rounded-lg hover:bg-red-50 transition-colors\" data-order-id=\"${order.id}\">\n                        Cancel Order\n                    </button>\n                ` : ''}\n                <button id=\"print-invoice-btn\" class=\"px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-colors\">\n                    Print Invoice\n                </button>\n            </div>\n        `;\n\n        bindOrderDetailEvents(order);\n    }\n\n    function bindOrderDetailEvents(order) {\n        const reorderBtn = document.getElementById('reorder-btn');\n        const cancelBtn = document.getElementById('cancel-order-btn');\n        const printBtn = document.getElementById('print-invoice-btn');\n\n        reorderBtn?.addEventListener('click', async () => {\n            try {\n                await OrdersApi.reorder(order.id);\n                Toast.success('Items added to cart!');\n                document.dispatchEvent(new CustomEvent('cart:updated'));\n                window.location.href = '/cart/';\n            } catch (error) {\n                Toast.error(error.message || 'Failed to reorder.');\n            }\n        });\n\n        cancelBtn?.addEventListener('click', async () => {\n            const confirmed = await Modal.confirm({\n                title: 'Cancel Order',\n                message: 'Are you sure you want to cancel this order? This action cannot be undone.',\n                confirmText: 'Cancel Order',\n                cancelText: 'Keep Order'\n            });\n\n            if (confirmed) {\n                try {\n                    await OrdersApi.cancel(order.id);\n                    Toast.success('Order cancelled.');\n                    window.location.reload();\n                } catch (error) {\n                    Toast.error(error.message || 'Failed to cancel order.');\n                }\n            }\n        });\n\n        printBtn?.addEventListener('click', () => {\n            window.print();\n        });\n    }\n\n    function initFilters() {\n        const filterBtns = document.querySelectorAll('[data-filter-status]');\n        \n        filterBtns.forEach(btn => {\n            btn.addEventListener('click', () => {\n                filterBtns.forEach(b => {\n                    b.classList.remove('bg-primary-100', 'text-primary-700');\n                    b.classList.add('text-gray-600');\n                });\n                btn.classList.add('bg-primary-100', 'text-primary-700');\n                btn.classList.remove('text-gray-600');\n\n                currentFilter = btn.dataset.filterStatus;\n                currentPage = 1;\n                loadOrders();\n            });\n        });\n    }\n\n    function destroy() {\n        currentPage = 1;\n        currentFilter = 'all';\n    }\n\n    return {\n        init,\n        destroy\n    };\n})();\n\nwindow.OrdersPage = OrdersPage;\nexport default OrdersPage;\n", "/**\n * Pre-orders Pages Module\n * @module pages/preorders\n */\n\nconst PreordersPage = (function() {\n    'use strict';\n\n    const routeMap = window.BUNORAA_ROUTES || {};\n    const wizardUrl = routeMap.preordersWizard || '/preorders/create/';\n    const landingUrl = routeMap.preordersLanding || '/preorders/';\n\n    /**\n     * Initialize the landing page\n     */\n    async function initLanding() {\n        await Promise.all([\n            loadFeaturedCategories(),\n            loadPopularTemplates(),\n            loadStats()\n        ]);\n    }\n\n    /**\n     * Load featured pre-order categories\n     */\n    async function loadFeaturedCategories() {\n        const container = document.getElementById('preorder-categories');\n        if (!container) return;\n\n        try {\n            const response = await PreordersApi.getCategories({ featured: true, pageSize: 8 });\n            const categories = response?.data?.results || response?.data || response?.results || [];\n\n            if (categories.length === 0) {\n                container.innerHTML = `\n                    <div class=\"col-span-full text-center py-12\">\n                        <svg class=\"w-16 h-16 mx-auto text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" \n                                  d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>\n                        </svg>\n                        <p class=\"text-gray-600 dark:text-gray-400 mb-4\">No categories available at the moment</p>\n                        <p class=\"text-sm text-gray-500 dark:text-gray-500\">Check back soon or contact us for custom requests</p>\n                    </div>\n                `;\n                return;\n            }\n\n            container.innerHTML = categories.map(category => renderCategoryCard(category)).join('');\n        } catch (error) {\n            console.error('Failed to load pre-order categories:', error);\n            container.innerHTML = `\n                <div class=\"col-span-full text-center py-12\">\n                    <svg class=\"w-16 h-16 mx-auto text-gray-400 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" \n                              d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>\n                    </svg>\n                    <p class=\"text-gray-600 dark:text-gray-400\">No categories available at the moment</p>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Render a category card\n     */\n    function renderCategoryCard(category) {\n        const imageUrl = category.image?.url || category.image || category.thumbnail || '';\n        const hasImage = imageUrl && imageUrl.length > 0;\n        const escapeHtml = Templates?.escapeHtml || ((s) => s);\n        const formatPrice = Templates?.formatPrice || ((p) => `${window.BUNORAA_CURRENCY?.symbol || '\u09F3'}${p}`);\n\n        return `\n            <a href=\"${landingUrl}category/${category.slug}/\" \n               class=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 dark:border-gray-700\">\n                ${hasImage ? `\n                    <div class=\"aspect-video relative overflow-hidden\">\n                        <img src=\"${imageUrl}\" alt=\"${escapeHtml(category.name)}\" \n                             class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n                             loading=\"lazy\">\n                        <div class=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent\"></div>\n                    </div>\n                ` : `\n                    <div class=\"aspect-video bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center\">\n                        ${category.icon ? `<span class=\"text-5xl\">${category.icon}</span>` : `\n                            <svg class=\"w-16 h-16 text-white/80\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" \n                                      d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>\n                            </svg>\n                        `}\n                    </div>\n                `}\n                \n                <div class=\"p-6\">\n                    <div class=\"flex items-start justify-between mb-3\">\n                        <h3 class=\"text-xl font-bold text-gray-900 dark:text-white group-hover:text-purple-600 transition-colors\">\n                            ${escapeHtml(category.name)}\n                        </h3>\n                        ${category.icon ? `<span class=\"text-2xl\">${category.icon}</span>` : ''}\n                    </div>\n                    \n                    ${category.description ? `\n                        <p class=\"text-gray-600 dark:text-gray-400 mb-4 line-clamp-2\">\n                            ${escapeHtml(category.description)}\n                        </p>\n                    ` : ''}\n                    \n                    <div class=\"flex items-center justify-between text-sm\">\n                        ${category.base_price ? `\n                            <span class=\"text-gray-500 dark:text-gray-500\">\n                                Starting from <span class=\"font-semibold text-purple-600\">${formatPrice(category.base_price)}</span>\n                            </span>\n                        ` : '<span></span>'}\n                        ${category.min_production_days && category.max_production_days ? `\n                            <span class=\"text-gray-500 dark:text-gray-500\">\n                                ${category.min_production_days}-${category.max_production_days} days\n                            </span>\n                        ` : ''}\n                    </div>\n                    \n                    <div class=\"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700 flex items-center justify-between\">\n                        <div class=\"flex gap-2 flex-wrap\">\n                            ${category.requires_design ? `\n                                <span class=\"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full\">\n                                    Design Required\n                                </span>\n                            ` : ''}\n                            ${category.allow_rush_order ? `\n                                <span class=\"text-xs px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-full\">\n                                    Rush Available\n                                </span>\n                            ` : ''}\n                        </div>\n                        <svg class=\"w-5 h-5 text-gray-400 group-hover:text-purple-600 group-hover:translate-x-1 transition-all flex-shrink-0\" \n                             fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n                        </svg>\n                    </div>\n                </div>\n            </a>\n        `;\n    }\n\n    /**\n     * Load popular templates\n     */\n    async function loadPopularTemplates() {\n        const container = document.getElementById('preorder-templates');\n        if (!container) return;\n\n        // Templates would be loaded from API when available\n        // For now, show a placeholder or hide the section\n        container.closest('section')?.classList.add('hidden');\n    }\n\n    /**\n     * Load statistics\n     */\n    async function loadStats() {\n        const statsContainer = document.getElementById('preorder-stats');\n        if (!statsContainer) return;\n\n        // Stats can be loaded from API or use defaults\n        const stats = {\n            totalOrders: '500+',\n            happyCustomers: '450+',\n            avgRating: '4.9'\n        };\n\n        statsContainer.innerHTML = `\n            <div class=\"flex items-center gap-8 justify-center flex-wrap\">\n                <div class=\"text-center\">\n                    <p class=\"text-3xl font-bold text-purple-600 dark:text-purple-400\">${stats.totalOrders}</p>\n                    <p class=\"text-sm text-gray-600 dark:text-gray-400\">Orders Completed</p>\n                </div>\n                <div class=\"h-12 w-px bg-gray-200 dark:bg-gray-700 hidden sm:block\"></div>\n                <div class=\"text-center\">\n                    <p class=\"text-3xl font-bold text-purple-600 dark:text-purple-400\">${stats.happyCustomers}</p>\n                    <p class=\"text-sm text-gray-600 dark:text-gray-400\">Happy Customers</p>\n                </div>\n                <div class=\"h-12 w-px bg-gray-200 dark:bg-gray-700 hidden sm:block\"></div>\n                <div class=\"text-center\">\n                    <p class=\"text-3xl font-bold text-purple-600 dark:text-purple-400\">${stats.avgRating}</p>\n                    <p class=\"text-sm text-gray-600 dark:text-gray-400\">Average Rating</p>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Initialize category detail page\n     */\n    async function initCategoryDetail(categorySlug) {\n        const optionsContainer = document.getElementById('category-options');\n        if (!optionsContainer || !categorySlug) return;\n\n        try {\n            const category = await PreordersApi.getCategory(categorySlug);\n            const options = await PreordersApi.getCategoryOptions(category.id);\n\n            renderCategoryOptions(optionsContainer, options);\n        } catch (error) {\n            console.error('Failed to load category options:', error);\n        }\n    }\n\n    /**\n     * Render category customization options\n     */\n    function renderCategoryOptions(container, options) {\n        if (!options || options.length === 0) {\n            container.innerHTML = '<p class=\"text-gray-500\">No customization options available.</p>';\n            return;\n        }\n\n        container.innerHTML = options.map(option => `\n            <div class=\"border border-gray-200 dark:border-gray-700 rounded-xl p-4\">\n                <h4 class=\"font-semibold text-gray-900 dark:text-white mb-2\">${Templates.escapeHtml(option.name)}</h4>\n                ${option.description ? `<p class=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">${Templates.escapeHtml(option.description)}</p>` : ''}\n                <div class=\"space-y-2\">\n                    ${option.choices?.map(choice => `\n                        <label class=\"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\">\n                            <input type=\"${option.allow_multiple ? 'checkbox' : 'radio'}\" name=\"option_${option.id}\" value=\"${choice.id}\" class=\"text-purple-600 focus:ring-purple-500\">\n                            <span class=\"flex-1\">\n                                <span class=\"font-medium text-gray-900 dark:text-white\">${Templates.escapeHtml(choice.name)}</span>\n                                ${choice.price_modifier && choice.price_modifier !== '0.00' ? `\n                                    <span class=\"text-sm text-purple-600 dark:text-purple-400 ml-2\">+${Templates.formatPrice(choice.price_modifier)}</span>\n                                ` : ''}\n                            </span>\n                        </label>\n                    `).join('') || ''}\n                </div>\n            </div>\n        `).join('');\n    }\n\n    /**\n     * Initialize my pre-orders page\n     */\n    async function initMyPreorders() {\n        const container = document.getElementById('my-preorders-list');\n        if (!container) return;\n\n        Loader.show(container, 'skeleton');\n\n        try {\n            const response = await PreordersApi.getMyPreorders();\n            const preorders = response?.data?.results || response?.data || response?.results || [];\n\n            if (preorders.length === 0) {\n                container.innerHTML = `\n                    <div class=\"text-center py-12\">\n                        <svg class=\"w-20 h-20 text-gray-300 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"/>\n                        </svg>\n                        <h3 class=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">No custom orders yet</h3>\n                        <p class=\"text-gray-600 dark:text-gray-400 mb-6\">Start creating your first custom order today!</p>\n                        <a href=\"${wizardUrl}\" class=\"inline-flex items-center gap-2 px-6 py-3 bg-purple-600 text-white font-semibold rounded-xl hover:bg-purple-700 transition-colors\">\n                            Create Custom Order\n                            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/></svg>\n                        </a>\n                    </div>\n                `;\n                return;\n            }\n\n            container.innerHTML = preorders.map(preorder => renderPreorderCard(preorder)).join('');\n        } catch (error) {\n            console.error('Failed to load pre-orders:', error);\n            container.innerHTML = `\n                <div class=\"text-center py-12\">\n                    <p class=\"text-red-500\">Failed to load your orders. Please try again.</p>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Render a pre-order card\n     */\n    function renderPreorderCard(preorder) {\n        const statusColors = {\n            'pending': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',\n            'quoted': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',\n            'accepted': 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-400',\n            'in_progress': 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400',\n            'review': 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400',\n            'approved': 'bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-400',\n            'completed': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',\n            'cancelled': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',\n            'refunded': 'bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400'\n        };\n\n        const statusLabels = {\n            'pending': 'Pending Review',\n            'quoted': 'Quote Sent',\n            'accepted': 'Quote Accepted',\n            'in_progress': 'In Progress',\n            'review': 'Under Review',\n            'approved': 'Approved',\n            'completed': 'Completed',\n            'cancelled': 'Cancelled',\n            'refunded': 'Refunded'\n        };\n\n        const statusClass = statusColors[preorder.status] || 'bg-gray-100 text-gray-800';\n        const statusLabel = statusLabels[preorder.status] || preorder.status;\n\n        return `\n            <a href=\"${landingUrl}order/${preorder.preorder_number}/\" class=\"block bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 hover:shadow-lg transition-shadow\">\n                <div class=\"flex items-start justify-between gap-4 mb-4\">\n                    <div>\n                        <p class=\"text-sm text-gray-500 dark:text-gray-400\">${preorder.preorder_number}</p>\n                        <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white\">${Templates.escapeHtml(preorder.title || preorder.category?.name || 'Custom Order')}</h3>\n                    </div>\n                    <span class=\"px-3 py-1 text-xs font-medium rounded-full ${statusClass}\">${statusLabel}</span>\n                </div>\n                ${preorder.description ? `\n                    <p class=\"text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2\">${Templates.escapeHtml(preorder.description)}</p>\n                ` : ''}\n                <div class=\"flex items-center justify-between text-sm\">\n                    <span class=\"text-gray-500 dark:text-gray-400\">\n                        ${new Date(preorder.created_at).toLocaleDateString()}\n                    </span>\n                    ${preorder.final_price || preorder.estimated_price ? `\n                        <span class=\"font-semibold text-purple-600 dark:text-purple-400\">\n                            ${Templates.formatPrice(preorder.final_price || preorder.estimated_price)}\n                        </span>\n                    ` : ''}\n                </div>\n            </a>\n        `;\n    }\n\n    /**\n     * Initialize pre-order detail page\n     */\n    async function initDetail(preorderNumber) {\n        if (!preorderNumber) return;\n\n        // Load messages, status updates, etc.\n        await Promise.all([\n            loadPreorderStatus(preorderNumber),\n            initMessageForm(preorderNumber)\n        ]);\n    }\n\n    /**\n     * Load pre-order status\n     */\n    async function loadPreorderStatus(preorderNumber) {\n        const statusContainer = document.getElementById('preorder-status');\n        if (!statusContainer) return;\n\n        try {\n            const status = await PreordersApi.getPreorderStatus(preorderNumber);\n            // Update UI with status\n        } catch (error) {\n        }\n    }\n\n    /**\n     * Initialize message form\n     */\n    function initMessageForm(preorderNumber) {\n        const form = document.getElementById('message-form');\n        if (!form) return;\n\n        form.addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            const messageInput = form.querySelector('textarea[name=\"message\"]');\n            const submitBtn = form.querySelector('button[type=\"submit\"]');\n            const message = messageInput?.value?.trim();\n\n            if (!message) {\n                Toast.error('Please enter a message');\n                return;\n            }\n\n            const originalText = submitBtn.innerHTML;\n            submitBtn.disabled = true;\n            submitBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\n\n            try {\n                await PreordersApi.sendMessage(preorderNumber, message);\n                Toast.success('Message sent successfully');\n                messageInput.value = '';\n                // Reload messages\n                location.reload();\n            } catch (error) {\n                Toast.error(error.message || 'Failed to send message');\n            } finally {\n                submitBtn.disabled = false;\n                submitBtn.innerHTML = originalText;\n            }\n        });\n    }\n\n    return {\n        initLanding,\n        initCategoryDetail,\n        initMyPreorders,\n        initDetail,\n        loadFeaturedCategories,\n        renderCategoryCard,\n        renderPreorderCard\n    };\n})();\n\nwindow.PreordersPage = PreordersPage;\n", "/**\r\n * Product Detail Page - Enhanced with Advanced E-commerce Features\r\n * @module pages/product\r\n */\r\n\r\nconst ProductPage = (function() {\r\n    'use strict';\r\n\r\n    let currentProduct = null;\r\n    let selectedVariant = null;\r\n    let gallery = null;\r\n    let initialized = false;\r\n    let serverRendered = false;\r\n    let zoomEnabled = false;\r\n    let stockAlertEmail = null;\r\n\r\n    async function init() {\r\n        // Prevent multiple initializations\r\n        if (initialized) return;\r\n        initialized = true;\r\n\r\n        const container = document.getElementById('product-detail');\r\n        if (!container) return;\r\n\r\n        // Check if content is already server-rendered\r\n        const isServerRendered = container.querySelector('h1') || container.dataset.productId;\r\n        serverRendered = Boolean(isServerRendered);\r\n        \r\n        if (isServerRendered) {\r\n            // Server-rendered content - just bind event handlers\r\n            currentProduct = {\r\n                id: container.dataset.productId,\r\n                slug: container.dataset.productSlug\r\n            };\r\n            bindExistingEvents();\r\n            initEnhancedFeatures();\r\n            return;\r\n        }\r\n\r\n        // Dynamic loading for SPA navigation\r\n        const productSlug = getProductSlugFromUrl();\r\n        if (!productSlug) {\r\n            window.location.href = '/products/';\r\n            return;\r\n        }\r\n\r\n        await loadProduct(productSlug);\r\n        initEnhancedFeatures();\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURES INITIALIZATION\r\n    // ============================================\r\n    function initEnhancedFeatures() {\r\n        initImageZoom();\r\n        initSizeGuideModal();\r\n        initStockAlerts();\r\n        initSocialSharing();\r\n        initQASection();\r\n        initDeliveryEstimate();\r\n        initRecentlyViewedTracking();\r\n        initStickyAddToCart();\r\n        initProductVideoPlayer();\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Image Zoom on Hover\r\n    // ============================================\r\n    function initImageZoom() {\r\n        const mainImage = document.getElementById('main-product-image') || document.getElementById('main-image');\r\n        const container = mainImage?.parentElement;\r\n        \r\n        if (!mainImage || !container) return;\r\n\r\n        // Create zoom lens\r\n        const lens = document.createElement('div');\r\n        lens.className = 'zoom-lens absolute w-32 h-32 border-2 border-primary-500 bg-white/30 pointer-events-none opacity-0 transition-opacity duration-200 z-10';\r\n        lens.style.backgroundRepeat = 'no-repeat';\r\n        \r\n        // Create zoom result container\r\n        const result = document.createElement('div');\r\n        result.className = 'zoom-result fixed right-8 top-1/2 -translate-y-1/2 w-96 h-96 border border-stone-200 dark:border-stone-700 rounded-xl shadow-2xl bg-white dark:bg-stone-800 opacity-0 pointer-events-none transition-opacity duration-200 z-50 hidden lg:block';\r\n        result.style.backgroundRepeat = 'no-repeat';\r\n        \r\n        container.classList.add('relative');\r\n        container.appendChild(lens);\r\n        document.body.appendChild(result);\r\n\r\n        container.addEventListener('mouseenter', () => {\r\n            if (window.innerWidth < 1024) return;\r\n            lens.classList.remove('opacity-0');\r\n            result.classList.remove('opacity-0');\r\n            zoomEnabled = true;\r\n        });\r\n\r\n        container.addEventListener('mouseleave', () => {\r\n            lens.classList.add('opacity-0');\r\n            result.classList.add('opacity-0');\r\n            zoomEnabled = false;\r\n        });\r\n\r\n        container.addEventListener('mousemove', (e) => {\r\n            if (!zoomEnabled || window.innerWidth < 1024) return;\r\n\r\n            const rect = container.getBoundingClientRect();\r\n            const x = e.clientX - rect.left;\r\n            const y = e.clientY - rect.top;\r\n\r\n            // Position lens\r\n            const lensX = x - lens.offsetWidth / 2;\r\n            const lensY = y - lens.offsetHeight / 2;\r\n            \r\n            lens.style.left = `${Math.max(0, Math.min(rect.width - lens.offsetWidth, lensX))}px`;\r\n            lens.style.top = `${Math.max(0, Math.min(rect.height - lens.offsetHeight, lensY))}px`;\r\n\r\n            // Calculate zoom\r\n            const zoomLevel = 3;\r\n            const bgX = -x * zoomLevel + result.offsetWidth / 2;\r\n            const bgY = -y * zoomLevel + result.offsetHeight / 2;\r\n            \r\n            result.style.backgroundImage = `url(${mainImage.src})`;\r\n            result.style.backgroundSize = `${rect.width * zoomLevel}px ${rect.height * zoomLevel}px`;\r\n            result.style.backgroundPosition = `${bgX}px ${bgY}px`;\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Size Guide Modal\r\n    // ============================================\r\n    function initSizeGuideModal() {\r\n        const sizeGuideBtn = document.getElementById('size-guide-btn');\r\n        if (!sizeGuideBtn) return;\r\n\r\n        sizeGuideBtn.addEventListener('click', () => {\r\n            const modal = document.createElement('div');\r\n            modal.id = 'size-guide-modal';\r\n            modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\r\n            modal.innerHTML = `\r\n                <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('size-guide-modal').remove()\"></div>\r\n                <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-auto\">\r\n                    <div class=\"sticky top-0 bg-white dark:bg-stone-800 border-b border-stone-200 dark:border-stone-700 p-4 flex items-center justify-between\">\r\n                        <h2 class=\"text-xl font-bold text-stone-900 dark:text-white\">Size Guide</h2>\r\n                        <button onclick=\"document.getElementById('size-guide-modal').remove()\" class=\"w-10 h-10 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\">\r\n                            <svg class=\"w-5 h-5 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                        </button>\r\n                    </div>\r\n                    <div class=\"p-6\">\r\n                        <div class=\"mb-6\">\r\n                            <h3 class=\"text-lg font-semibold text-stone-900 dark:text-white mb-2\">How to Measure</h3>\r\n                            <p class=\"text-stone-600 dark:text-stone-400 text-sm\">Use a flexible measuring tape for accurate measurements. Measure over your undergarments for best results.</p>\r\n                        </div>\r\n                        <div class=\"overflow-x-auto\">\r\n                            <table class=\"w-full text-sm\">\r\n                                <thead>\r\n                                    <tr class=\"bg-stone-50 dark:bg-stone-700\">\r\n                                        <th class=\"px-4 py-3 text-left font-semibold text-stone-900 dark:text-white\">Size</th>\r\n                                        <th class=\"px-4 py-3 text-center font-semibold text-stone-900 dark:text-white\">Chest (in)</th>\r\n                                        <th class=\"px-4 py-3 text-center font-semibold text-stone-900 dark:text-white\">Waist (in)</th>\r\n                                        <th class=\"px-4 py-3 text-center font-semibold text-stone-900 dark:text-white\">Length (in)</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr class=\"border-b border-stone-100 dark:border-stone-600\">\r\n                                        <td class=\"px-4 py-3 font-medium text-stone-900 dark:text-white\">XS</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">32-34</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">26-28</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">26</td>\r\n                                    </tr>\r\n                                    <tr class=\"border-b border-stone-100 dark:border-stone-600\">\r\n                                        <td class=\"px-4 py-3 font-medium text-stone-900 dark:text-white\">S</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">35-37</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">29-31</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">27</td>\r\n                                    </tr>\r\n                                    <tr class=\"border-b border-stone-100 dark:border-stone-600\">\r\n                                        <td class=\"px-4 py-3 font-medium text-stone-900 dark:text-white\">M</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">38-40</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">32-34</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">28</td>\r\n                                    </tr>\r\n                                    <tr class=\"border-b border-stone-100 dark:border-stone-600\">\r\n                                        <td class=\"px-4 py-3 font-medium text-stone-900 dark:text-white\">L</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">41-43</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">35-37</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">29</td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td class=\"px-4 py-3 font-medium text-stone-900 dark:text-white\">XL</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">44-46</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">38-40</td>\r\n                                        <td class=\"px-4 py-3 text-center text-stone-600 dark:text-stone-400\">30</td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                        <div class=\"mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl\">\r\n                            <p class=\"text-sm text-amber-800 dark:text-amber-200\">\uD83D\uDCA1 <strong>Tip:</strong> If you're between sizes, we recommend sizing up for a more comfortable fit.</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n            document.body.appendChild(modal);\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Stock Alerts\r\n    // ============================================\r\n    function initStockAlerts() {\r\n        const stockAlertBtn = document.getElementById('stock-alert-btn');\r\n        if (!stockAlertBtn) return;\r\n\r\n        stockAlertBtn.addEventListener('click', () => {\r\n            const productId = document.getElementById('product-detail')?.dataset.productId;\r\n            if (!productId) return;\r\n\r\n            const modal = document.createElement('div');\r\n            modal.id = 'stock-alert-modal';\r\n            modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\r\n            modal.innerHTML = `\r\n                <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('stock-alert-modal').remove()\"></div>\r\n                <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-md w-full p-6\">\r\n                    <button onclick=\"document.getElementById('stock-alert-modal').remove()\" class=\"absolute top-4 right-4 w-8 h-8 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-600 transition-colors\">\r\n                        <svg class=\"w-4 h-4 text-stone-600 dark:text-stone-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                    </button>\r\n                    <div class=\"text-center mb-6\">\r\n                        <div class=\"w-16 h-16 bg-primary-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                            <svg class=\"w-8 h-8 text-primary-600 dark:text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"/></svg>\r\n                        </div>\r\n                        <h3 class=\"text-xl font-bold text-stone-900 dark:text-white mb-2\">Notify Me When Available</h3>\r\n                        <p class=\"text-stone-600 dark:text-stone-400 text-sm\">We'll email you when this product is back in stock.</p>\r\n                    </div>\r\n                    <form id=\"stock-alert-form\" class=\"space-y-4\">\r\n                        <input type=\"email\" id=\"stock-alert-email\" placeholder=\"Enter your email\" required class=\"w-full px-4 py-3 border border-stone-300 dark:border-stone-600 rounded-xl bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-primary-500 dark:focus:ring-amber-500\">\r\n                        <button type=\"submit\" class=\"w-full py-3 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-xl hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\r\n                            Notify Me\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            `;\r\n            document.body.appendChild(modal);\r\n\r\n            document.getElementById('stock-alert-form')?.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                const email = document.getElementById('stock-alert-email')?.value;\r\n                if (!email) return;\r\n\r\n                try {\r\n                    // In production, call API\r\n                    // await ProductsApi.subscribeStockAlert(productId, email);\r\n                    stockAlertEmail = email;\r\n                    Toast.success('You will be notified when this product is back in stock!');\r\n                    modal.remove();\r\n                } catch (error) {\r\n                    Toast.error('Failed to subscribe. Please try again.');\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Social Sharing\r\n    // ============================================\r\n    function initSocialSharing() {\r\n        document.querySelectorAll('.share-btn').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const platform = btn.dataset.platform;\r\n                const url = encodeURIComponent(window.location.href);\r\n                const title = encodeURIComponent(document.title);\r\n                const productName = document.querySelector('h1')?.textContent || '';\r\n\r\n                const shareUrls = {\r\n                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,\r\n                    twitter: `https://twitter.com/intent/tweet?url=${url}&text=${encodeURIComponent(productName)}`,\r\n                    pinterest: `https://pinterest.com/pin/create/button/?url=${url}&description=${encodeURIComponent(productName)}`,\r\n                    whatsapp: `https://api.whatsapp.com/send?text=${encodeURIComponent(productName + ' ' + window.location.href)}`,\r\n                    copy: null\r\n                };\r\n\r\n                if (platform === 'copy') {\r\n                    navigator.clipboard.writeText(window.location.href).then(() => {\r\n                        Toast.success('Link copied to clipboard!');\r\n                    }).catch(() => {\r\n                        Toast.error('Failed to copy link');\r\n                    });\r\n                } else if (shareUrls[platform]) {\r\n                    window.open(shareUrls[platform], '_blank', 'width=600,height=400');\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Q&A Section\r\n    // ============================================\r\n    function initQASection() {\r\n        const qaContainer = document.getElementById('qa-section');\r\n        if (!qaContainer) return;\r\n\r\n        const productId = document.getElementById('product-detail')?.dataset.productId;\r\n        if (!productId) return;\r\n\r\n        // Load existing Q&As (mock data for now)\r\n        const mockQAs = [\r\n            { question: 'Is this product machine washable?', answer: 'Yes, we recommend washing on a gentle cycle with cold water.', askedBy: 'John D.', date: '2 days ago' },\r\n            { question: 'What materials is this made from?', answer: 'This product is crafted from 100% organic cotton sourced from sustainable farms.', askedBy: 'Sarah M.', date: '1 week ago' },\r\n        ];\r\n\r\n        qaContainer.innerHTML = `\r\n            <div class=\"space-y-6\">\r\n                <div class=\"flex items-center justify-between\">\r\n                    <h3 class=\"text-lg font-semibold text-stone-900 dark:text-white\">Questions & Answers</h3>\r\n                    <button id=\"ask-question-btn\" class=\"text-sm font-medium text-primary-600 dark:text-amber-400 hover:underline\">Ask a Question</button>\r\n                </div>\r\n                <div id=\"qa-list\" class=\"space-y-4\">\r\n                    ${mockQAs.map(qa => `\r\n                        <div class=\"bg-stone-50 dark:bg-stone-700/50 rounded-xl p-4\">\r\n                            <div class=\"flex items-start gap-3 mb-2\">\r\n                                <span class=\"text-primary-600 dark:text-amber-400 font-bold\">Q:</span>\r\n                                <div>\r\n                                    <p class=\"text-stone-900 dark:text-white font-medium\">${Templates.escapeHtml(qa.question)}</p>\r\n                                    <p class=\"text-xs text-stone-500 dark:text-stone-400 mt-1\">${qa.askedBy} \u2022 ${qa.date}</p>\r\n                                </div>\r\n                            </div>\r\n                            ${qa.answer ? `\r\n                                <div class=\"flex items-start gap-3 mt-3 pl-6\">\r\n                                    <span class=\"text-emerald-600 dark:text-emerald-400 font-bold\">A:</span>\r\n                                    <p class=\"text-stone-600 dark:text-stone-300\">${Templates.escapeHtml(qa.answer)}</p>\r\n                                </div>\r\n                            ` : ''}\r\n                        </div>\r\n                    `).join('')}\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        document.getElementById('ask-question-btn')?.addEventListener('click', () => {\r\n            const modal = document.createElement('div');\r\n            modal.id = 'ask-question-modal';\r\n            modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';\r\n            modal.innerHTML = `\r\n                <div class=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onclick=\"document.getElementById('ask-question-modal').remove()\"></div>\r\n                <div class=\"relative bg-white dark:bg-stone-800 rounded-2xl shadow-2xl max-w-md w-full p-6\">\r\n                    <button onclick=\"document.getElementById('ask-question-modal').remove()\" class=\"absolute top-4 right-4 w-8 h-8 bg-stone-100 dark:bg-stone-700 rounded-full flex items-center justify-center\">\r\n                        <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                    </button>\r\n                    <h3 class=\"text-xl font-bold text-stone-900 dark:text-white mb-4\">Ask a Question</h3>\r\n                    <form id=\"question-form\" class=\"space-y-4\">\r\n                        <textarea id=\"question-input\" rows=\"4\" placeholder=\"Type your question here...\" required class=\"w-full px-4 py-3 border border-stone-300 dark:border-stone-600 rounded-xl bg-white dark:bg-stone-700 text-stone-900 dark:text-white resize-none focus:ring-2 focus:ring-primary-500\"></textarea>\r\n                        <button type=\"submit\" class=\"w-full py-3 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-xl hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\r\n                            Submit Question\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            `;\r\n            document.body.appendChild(modal);\r\n\r\n            document.getElementById('question-form')?.addEventListener('submit', (e) => {\r\n                e.preventDefault();\r\n                Toast.success('Your question has been submitted!');\r\n                modal.remove();\r\n            });\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Delivery Estimate\r\n    // ============================================\r\n    function initDeliveryEstimate() {\r\n        const deliveryContainer = document.getElementById('delivery-estimate');\r\n        if (!deliveryContainer) return;\r\n\r\n        // Calculate estimated delivery (mock)\r\n        const today = new Date();\r\n        const minDays = 3;\r\n        const maxDays = 7;\r\n        const minDate = new Date(today.getTime() + minDays * 24 * 60 * 60 * 1000);\r\n        const maxDate = new Date(today.getTime() + maxDays * 24 * 60 * 60 * 1000);\r\n\r\n        const formatDate = (date) => date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });\r\n\r\n        deliveryContainer.innerHTML = `\r\n            <div class=\"flex items-start gap-3 p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl\">\r\n                <svg class=\"w-5 h-5 text-emerald-600 dark:text-emerald-400 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4\"/>\r\n                </svg>\r\n                <div>\r\n                    <p class=\"text-sm font-medium text-emerald-700 dark:text-emerald-300\">Estimated Delivery</p>\r\n                    <p class=\"text-emerald-600 dark:text-emerald-400 font-semibold\">${formatDate(minDate)} - ${formatDate(maxDate)}</p>\r\n                    <p class=\"text-xs text-emerald-600 dark:text-emerald-400 mt-1\">Free shipping on orders over $50</p>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Recently Viewed Tracking\r\n    // ============================================\r\n    function initRecentlyViewedTracking() {\r\n        const productId = document.getElementById('product-detail')?.dataset.productId;\r\n        const productSlug = document.getElementById('product-detail')?.dataset.productSlug;\r\n        const productName = document.querySelector('h1')?.textContent;\r\n        const productImage = document.getElementById('main-product-image')?.src || document.getElementById('main-image')?.src;\r\n        const productPrice = document.getElementById('product-price')?.textContent;\r\n\r\n        if (!productId) return;\r\n\r\n        const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');\r\n        \r\n        // Remove if already exists\r\n        const existingIndex = recentlyViewed.findIndex(p => p.id === productId);\r\n        if (existingIndex > -1) {\r\n            recentlyViewed.splice(existingIndex, 1);\r\n        }\r\n\r\n        // Add to front\r\n        recentlyViewed.unshift({\r\n            id: productId,\r\n            slug: productSlug,\r\n            name: productName,\r\n            image: productImage,\r\n            price: productPrice,\r\n            viewedAt: new Date().toISOString()\r\n        });\r\n\r\n        // Keep only last 20 items\r\n        localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed.slice(0, 20)));\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Sticky Add to Cart (Mobile)\r\n    // ============================================\r\n    function initStickyAddToCart() {\r\n        const existingSticky = document.getElementById('mobile-sticky-atc') || document.getElementById('mobile-sticky-atc-js');\r\n        if (existingSticky || window.innerWidth >= 1024) return;\r\n\r\n        const product = currentProduct;\r\n        if (!product) return;\r\n\r\n        const sticky = document.createElement('div');\r\n        sticky.id = 'mobile-sticky-atc-enhanced';\r\n        sticky.className = 'fixed bottom-0 inset-x-0 z-40 lg:hidden bg-white dark:bg-stone-800 border-t border-stone-200 dark:border-stone-700 shadow-2xl p-3 transform translate-y-full transition-transform duration-300';\r\n        sticky.innerHTML = `\r\n            <div class=\"flex items-center gap-3\">\r\n                <div class=\"flex-1 min-w-0\">\r\n                    <p class=\"text-xs text-stone-500 dark:text-stone-400 truncate\">${product.name || ''}</p>\r\n                    <p class=\"font-bold text-stone-900 dark:text-white\">${product.sale_price ? Templates.formatPrice(product.sale_price) : Templates.formatPrice(product.price || 0)}</p>\r\n                </div>\r\n                <button id=\"sticky-add-to-cart\" class=\"px-6 py-3 bg-primary-600 dark:bg-amber-600 text-white font-semibold rounded-xl hover:bg-primary-700 dark:hover:bg-amber-700 transition-colors\">\r\n                    Add to Cart\r\n                </button>\r\n            </div>\r\n        `;\r\n        document.body.appendChild(sticky);\r\n\r\n        // Show on scroll past add to cart button\r\n        const mainAddBtn = document.getElementById('add-to-cart-btn');\r\n        if (mainAddBtn) {\r\n            const observer = new IntersectionObserver((entries) => {\r\n                entries.forEach(entry => {\r\n                    if (entry.isIntersecting) {\r\n                        sticky.classList.add('translate-y-full');\r\n                    } else {\r\n                        sticky.classList.remove('translate-y-full');\r\n                    }\r\n                });\r\n            }, { threshold: 0 });\r\n\r\n            observer.observe(mainAddBtn);\r\n        }\r\n\r\n        document.getElementById('sticky-add-to-cart')?.addEventListener('click', () => {\r\n            document.getElementById('add-to-cart-btn')?.click();\r\n        });\r\n    }\r\n\r\n    // ============================================\r\n    // ENHANCED FEATURE: Product Video Player\r\n    // ============================================\r\n    function initProductVideoPlayer() {\r\n        const videoThumbnails = document.querySelectorAll('[data-video-url]');\r\n        \r\n        videoThumbnails.forEach(thumb => {\r\n            thumb.addEventListener('click', () => {\r\n                const videoUrl = thumb.dataset.videoUrl;\r\n                if (!videoUrl) return;\r\n\r\n                const modal = document.createElement('div');\r\n                modal.id = 'video-player-modal';\r\n                modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black/90';\r\n                modal.innerHTML = `\r\n                    <button onclick=\"document.getElementById('video-player-modal').remove()\" class=\"absolute top-4 right-4 w-12 h-12 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors\">\r\n                        <svg class=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>\r\n                    </button>\r\n                    <video controls autoplay class=\"max-w-full max-h-[90vh] rounded-xl\">\r\n                        <source src=\"${videoUrl}\" type=\"video/mp4\">\r\n                        Your browser does not support video playback.\r\n                    </video>\r\n                `;\r\n                document.body.appendChild(modal);\r\n            });\r\n        });\r\n    }\r\n\r\n    function bindExistingEvents() {\r\n        // Bind quantity controls\r\n        initQuantityControls();\r\n        // Bind add to cart\r\n        initAddToCartFromExisting();\r\n        // Bind wishlist\r\n        initWishlistFromExisting();\r\n        markWishlistButtonIfNeeded();\r\n            async function markWishlistButtonIfNeeded() {\r\n                const btn = document.getElementById('add-to-wishlist-btn');\r\n                if (!btn) return;\r\n                const productId = document.getElementById('product-detail')?.dataset.productId;\r\n                if (!productId) return;\r\n                if (typeof WishlistApi === 'undefined') return;\r\n                try {\r\n                    const resp = await WishlistApi.getWishlist({ pageSize: 100 });\r\n                    if (resp.success && resp.data?.items) {\r\n                        const found = resp.data.items.some(item => item.product_id === productId || item.product === productId);\r\n                        if (found) {\r\n                            btn.querySelector('svg')?.setAttribute('fill', 'currentColor');\r\n                            btn.classList.add('text-red-500');\r\n                        } else {\r\n                            btn.querySelector('svg')?.setAttribute('fill', 'none');\r\n                            btn.classList.remove('text-red-500');\r\n                        }\r\n                    }\r\n                } catch (e) {}\r\n            }\r\n        // Bind variant selection\r\n        initVariantSelectionFromExisting();\r\n        // Bind image gallery\r\n        initGalleryFromExisting();\r\n        // Bind compare (server-rendered path)\r\n        initCompareFromExisting();\r\n        // Bind tabs\r\n        initTabsFromExisting();\r\n    }\r\n\r\n    function initTabsFromExisting() {\r\n        const tabButtons = document.querySelectorAll('.tab-btn');\r\n        const tabContents = document.querySelectorAll('.tab-content');\r\n        \r\n        tabButtons.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const tabName = btn.dataset.tab;\r\n                \r\n                // Update button styles\r\n                tabButtons.forEach(b => {\r\n                    b.classList.remove('border-primary-500', 'text-primary-600');\r\n                    b.classList.add('border-transparent', 'text-gray-500');\r\n                });\r\n                btn.classList.add('border-primary-500', 'text-primary-600');\r\n                btn.classList.remove('border-transparent', 'text-gray-500');\r\n                \r\n                // Show/hide content\r\n                tabContents.forEach(content => {\r\n                    if (content.id === `${tabName}-tab`) {\r\n                        content.classList.remove('hidden');\r\n                    } else {\r\n                        content.classList.add('hidden');\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    function initQuantityControls() {\r\n        const decreaseBtn = document.getElementById('decrease-qty');\r\n        const increaseBtn = document.getElementById('increase-qty');\r\n        const qtyInput = document.getElementById('quantity');\r\n\r\n        decreaseBtn?.addEventListener('click', () => {\r\n            const current = parseInt(qtyInput?.value) || 1;\r\n            if (current > 1) qtyInput.value = current - 1;\r\n        });\r\n\r\n        increaseBtn?.addEventListener('click', () => {\r\n            const current = parseInt(qtyInput?.value) || 1;\r\n            const max = parseInt(qtyInput?.max) || 99;\r\n            if (current < max) qtyInput.value = current + 1;\r\n        });\r\n    }\r\n\r\n    function initAddToCartFromExisting() {\r\n        const btn = document.getElementById('add-to-cart-btn');\r\n        if (!btn) return;\r\n\r\n        btn.addEventListener('click', async () => {\r\n            const productId = document.getElementById('product-detail')?.dataset.productId;\r\n            const quantity = parseInt(document.getElementById('quantity')?.value) || 1;\r\n            const variantInput = document.querySelector('input[name=\"variant\"]');\r\n            const hasVariants = !!variantInput;\r\n            const variantId = document.querySelector('input[name=\"variant\"]:checked')?.value;\r\n\r\n            if (!productId) return;\r\n\r\n            // If product has variants, enforce selection\r\n            if (hasVariants && !variantId) {\r\n                Toast.warning('Please select a variant before adding to cart.');\r\n                return;\r\n            }\r\n\r\n            btn.disabled = true;\r\n            const originalHtml = btn.innerHTML;\r\n            btn.innerHTML = '<svg class=\"animate-spin h-5 w-5 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\r\n\r\n\r\n\r\n            try {\r\n\r\n                await CartApi.addItem(productId, quantity, variantId || null);\r\n\r\n                Toast.success('Added to cart!');\r\n                document.dispatchEvent(new CustomEvent('cart:updated'));\r\n            } catch (error) {\r\n                Toast.error(error.message || 'Failed to add to cart.');\r\n            } finally {\r\n                btn.disabled = false;\r\n                btn.innerHTML = originalHtml;\r\n            }\r\n        });\r\n    }\r\n\r\n    function initWishlistFromExisting() {\r\n        const btn = document.getElementById('add-to-wishlist-btn');\r\n        if (!btn) return;\r\n\r\n        btn.addEventListener('click', async () => {\r\n            const productId = document.getElementById('product-detail')?.dataset.productId;\r\n            if (!productId) return;\r\n\r\n            if (typeof AuthApi !== 'undefined' && !AuthApi.isAuthenticated()) {\r\n                Toast.warning('Please login to add items to your wishlist.');\r\n                window.location.href = '/account/login/?next=' + encodeURIComponent(window.location.pathname);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Check if already in wishlist\r\n                let inWishlist = false;\r\n                if (typeof WishlistApi !== 'undefined') {\r\n                    const resp = await WishlistApi.getWishlist({ pageSize: 100 });\r\n                    if (resp.success && resp.data?.items) {\r\n                        inWishlist = resp.data.items.some(item => item.product_id === productId || item.product === productId);\r\n                    }\r\n                }\r\n                if (inWishlist) {\r\n                    // Remove from wishlist\r\n                    // Find the wishlist item id\r\n                    const resp = await WishlistApi.getWishlist({ pageSize: 100 });\r\n                    const item = resp.data.items.find(item => item.product_id === productId || item.product === productId);\r\n                    if (item) {\r\n                        await WishlistApi.removeItem(item.id);\r\n                        Toast.success('Removed from wishlist!');\r\n                        btn.querySelector('svg')?.setAttribute('fill', 'none');\r\n                        btn.classList.remove('text-red-500');\r\n                        btn.setAttribute('aria-pressed', 'false');\r\n                    }\r\n                } else {\r\n                    // Add to wishlist\r\n                    await WishlistApi.addItem(productId);\r\n                    Toast.success('Added to wishlist!');\r\n                    btn.querySelector('svg')?.setAttribute('fill', 'currentColor');\r\n                    btn.classList.add('text-red-500');\r\n                    btn.setAttribute('aria-pressed', 'true');\r\n                }\r\n            } catch (error) {\r\n                Toast.error(error.message || 'Wishlist action failed.');\r\n            }\r\n        });\r\n    }\r\n\r\n    function initVariantSelectionFromExisting() {\r\n        const variantInputs = document.querySelectorAll('input[name=\"variant\"]');\r\n        variantInputs.forEach(input => {\r\n            input.addEventListener('change', () => {\r\n                selectedVariant = input.value;\r\n                // Update price if variant has different price\r\n                const price = input.dataset.price;\r\n                const stock = parseInt(input.dataset.stock || '0');\r\n                if (price) {\r\n                    const priceEl = document.getElementById('product-price');\r\n                    if (priceEl && window.Templates?.formatPrice) {\r\n                        priceEl.textContent = window.Templates.formatPrice(parseFloat(price));\r\n                    }\r\n                }\r\n                // Update stock display\r\n                const stockEl = document.getElementById('stock-status');\r\n                const addBtn = document.getElementById('add-to-cart-btn');\r\n                const mobileStock = document.getElementById('mobile-stock');\r\n                const mobileBtn = document.getElementById('mobile-add-to-cart');\r\n                if (stockEl) {\r\n                    if (stock > 10) stockEl.innerHTML = '<span class=\"text-green-600\">In Stock</span>';\r\n                    else if (stock > 0) stockEl.innerHTML = `<span class=\"text-orange-500\">Only ${stock} left</span>`;\r\n                    else stockEl.innerHTML = `<span class=\"text-red-600\">Out of Stock</span>`;\r\n                }\r\n                if (addBtn) addBtn.disabled = stock <= 0;\r\n                if (mobileBtn) mobileBtn.disabled = stock <= 0;\r\n                if (mobileStock) mobileStock.textContent = stock > 0 ? (stock > 10 ? 'In stock' : `${stock} available`) : 'Out of stock';\r\n            });\r\n        });\r\n    }\r\n\r\n    function initGalleryFromExisting() {\r\n        // Image change is handled via onclick in template\r\n        // Just setup zoom functionality if needed\r\n        const mainImage = document.getElementById('main-image');\r\n        mainImage?.addEventListener('click', () => {\r\n            // Could open lightbox here\r\n        });\r\n    }\r\n\r\n    function getProductSlugFromUrl() {\r\n        const path = window.location.pathname;\r\n        const match = path.match(/\\/products\\/([^\\/]+)/);\r\n        return match ? match[1] : null;\r\n    }\r\n\r\n    async function loadProduct(slug) {\r\n        const container = document.getElementById('product-detail');\r\n        if (!container) return;\r\n\r\n        Loader.show(container, 'skeleton');\r\n\r\n        try {\r\n            const response = await ProductsApi.getProduct(slug);\r\n            currentProduct = response.data;\r\n\r\n            if (!currentProduct) {\r\n                window.location.href = '/404/';\r\n                return;\r\n            }\r\n\r\n            document.title = `${currentProduct.name} | Bunoraa`;\r\n            \r\n            renderProduct(currentProduct);\r\n\r\n            // Update SEO/meta for SPA flows\r\n            updateMetaTags(currentProduct);\r\n            updateStructuredData(currentProduct);\r\n\r\n            // Load related data in parallel but also lazily for non-critical sections\r\n            await Promise.all([\r\n                loadBreadcrumbs(currentProduct),\r\n                loadRelatedProducts(currentProduct),\r\n                loadReviews(currentProduct),\r\n                loadRecommendations(currentProduct)\r\n            ]);\r\n\r\n            // Setup lazy-loading for below-the-fold sections\r\n            initLazySections();\r\n\r\n            trackProductView(currentProduct);\r\n        } catch (error) {\r\n            console.error('Failed to load product:', error);\r\n            container.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load product. Please try again.</p>';\r\n        }\r\n    }\r\n\r\n    // Refresh product when currency changes (support SPA flows)\r\n    document.addEventListener('currency:changed', async (e) => {\r\n        try {\r\n            if (!serverRendered && currentProduct && currentProduct.slug) {\r\n                await loadProduct(currentProduct.slug);\r\n            } else {\r\n                // For server-rendered pages, perform a full reload to pick up server-side formatting\r\n                location.reload();\r\n            }\r\n        } catch (err) {\r\n        }\r\n    });\r\n\r\n    function renderProduct(product) {\r\n        const container = document.getElementById('product-detail');\r\n        if (!container) return;\r\n\r\n        const images = product.images || [];\r\n        const mainImage = product.image || images[0]?.image || '';\r\n        const hasVariants = product.variants && product.variants.length > 0;\r\n        const inStock = product.stock_quantity > 0 || product.in_stock;\r\n        const onSale = product.sale_price && product.sale_price < product.price;\r\n\r\n        container.innerHTML = `\r\n            <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12\">\r\n                <!-- Gallery -->\r\n                <div id=\"product-gallery\" class=\"product-gallery\">\r\n                    <div class=\"main-image-container relative rounded-xl overflow-hidden bg-gray-100\" style=\"aspect-ratio: ${product?.aspect?.css || '1/1'};\">\r\n                        <img \r\n                            src=\"${mainImage}\" \r\n                            alt=\"${Templates.escapeHtml(product.name)}\"\r\n                            loading=\"lazy\"\r\n                            decoding=\"async\"\r\n                            class=\"main-image w-full h-full object-cover cursor-zoom-in\"\r\n                            id=\"main-product-image\"\r\n                        >\r\n                        ${onSale ? `\r\n                            <span class=\"absolute top-4 left-4 px-3 py-1 bg-red-500 text-white text-sm font-medium rounded-full\">\r\n                                Sale\r\n                            </span>\r\n                        ` : ''}\r\n                        ${!inStock ? `\r\n                            <span class=\"absolute top-4 right-4 px-3 py-1 bg-gray-900 text-white text-sm font-medium rounded-full\">\r\n                                Out of Stock\r\n                            </span>\r\n                        ` : ''}\r\n                    </div>\r\n                    ${images.length > 1 ? `\r\n                        <div class=\"thumbnails flex gap-2 mt-4 overflow-x-auto pb-2\">\r\n                            ${images.map((img, index) => `\r\n                                <button \r\n                                    class=\"thumbnail flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 ${index === 0 ? 'border-primary-500' : 'border-transparent'} hover:border-primary-500 transition-colors\"\r\n                                    data-image=\"${img.image}\"\r\n                                    data-index=\"${index}\"\r\n                                >\r\n                                    <img src=\"${img.image}\" alt=\"\" loading=\"lazy\" decoding=\"async\" class=\"w-full h-full object-cover\">\r\n                                </button>\r\n                            `).join('')}\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n\r\n                <!-- Product Info -->\r\n                <div class=\"product-info\">\r\n                    <!-- Brand -->\r\n                    ${product.brand ? `\r\n                        <a href=\"/products/?brand=${product.brand.id}\" class=\"text-sm text-primary-600 hover:text-primary-700 font-medium\">\r\n                            ${Templates.escapeHtml(product.brand.name)}\r\n                        </a>\r\n                    ` : ''}\r\n\r\n                    <!-- Title -->\r\n                    <h1 class=\"text-2xl md:text-3xl font-bold text-gray-900 mt-2\">\r\n                        ${Templates.escapeHtml(product.name)}\r\n                    </h1>\r\n\r\n                    <!-- Rating -->\r\n                    ${product.average_rating ? `\r\n                        <div class=\"flex items-center gap-2 mt-3\">\r\n                            <div class=\"flex items-center\">\r\n                                ${Templates.renderStars(product.average_rating)}\r\n                            </div>\r\n                            <span class=\"text-sm text-gray-600\">\r\n                                ${product.average_rating.toFixed(1)} (${product.review_count || 0} reviews)\r\n                            </span>\r\n                            <a href=\"#reviews\" class=\"text-sm text-primary-600 hover:text-primary-700\">\r\n                                Read reviews\r\n                            </a>\r\n                        </div>\r\n                    ` : ''}\r\n\r\n                    <!-- Price -->\r\n                    <div class=\"mt-4\">\r\n                        ${Price.render({\r\n                            price: product.current_price ?? product.price_converted ?? product.price,\r\n                            salePrice: product.sale_price_converted ?? product.sale_price,\r\n                            size: 'large'\r\n                        })}\r\n                    </div>\r\n\r\n                    <!-- Short Description -->\r\n                    ${product.short_description ? `\r\n                        <p class=\"mt-4 text-gray-600\">${Templates.escapeHtml(product.short_description)}</p>\r\n                    ` : ''}\r\n\r\n                    <!-- Variants -->\r\n                    ${hasVariants ? renderVariants(product.variants) : ''}\r\n\r\n                    <!-- Quantity & Add to Cart -->\r\n                    <div class=\"mt-6 space-y-4\">\r\n                        <div class=\"flex items-center gap-4\">\r\n                            <label class=\"text-sm font-medium text-gray-700\">Quantity:</label>\r\n                            <div class=\"flex items-center border border-gray-300 rounded-lg\">\r\n                                <button \r\n                                    class=\"qty-decrease px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors\"\r\n                                    aria-label=\"Decrease quantity\"\r\n                                >\r\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 12H4\"/>\r\n                                    </svg>\r\n                                </button>\r\n                                <input \r\n                                    type=\"number\" \r\n                                    id=\"product-quantity\"\r\n                                    value=\"1\" \r\n                                    min=\"1\" \r\n                                    max=\"${product.stock_quantity || 99}\"\r\n                                    class=\"w-16 text-center border-0 focus:ring-0\"\r\n                                >\r\n                                <button \r\n                                    class=\"qty-increase px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors\"\r\n                                    aria-label=\"Increase quantity\"\r\n                                >\r\n                                    <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n                                    </svg>\r\n                                </button>\r\n                            </div>\r\n                            ${product.stock_quantity ? `\r\n                                <div id=\"stock-status\" class=\"text-sm text-gray-500\">${product.stock_quantity > 10 ? 'In stock' : product.stock_quantity + ' available'}</div>\r\n                            ` : `<div id=\"stock-status\" class=\"text-red-600\">Out of Stock</div>`}\r\n                        </div>\r\n\r\n                        <div class=\"flex gap-3\">\r\n                            <button \r\n                                id=\"add-to-cart-btn\"\r\n                                class=\"flex-1 px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2\"\r\n                                ${!inStock ? 'disabled' : ''}\r\n                            >\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n                                </svg>\r\n                                ${inStock ? 'Add to Cart' : 'Out of Stock'}\r\n                            </button>\r\n                            <button \r\n                                id=\"add-to-wishlist-btn\"\r\n                                class=\"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                                aria-label=\"Add to wishlist\"\r\n                                data-product-id=\"${product.id}\"\r\n                            >\r\n                                <svg class=\"w-6 h-6 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Product Meta -->\r\n                    <div class=\"mt-6 pt-6 border-t border-gray-200 space-y-3 text-sm\">\r\n                        ${product.sku ? `\r\n                            <div class=\"flex\">\r\n                                <span class=\"text-gray-500 w-24\">SKU:</span>\r\n                                <span class=\"text-gray-900\">${Templates.escapeHtml(product.sku)}</span>\r\n                            </div>\r\n                        ` : ''}\r\n                        ${product.category ? `\r\n                            <div class=\"flex\">\r\n                                <span class=\"text-gray-500 w-24\">Category:</span>\r\n                                <a href=\"/categories/${product.category.slug}/\" class=\"text-primary-600 hover:text-primary-700\">\r\n                                    ${Templates.escapeHtml(product.category.name)}\r\n                                </a>\r\n                            </div>\r\n                        ` : ''}\r\n                        ${product.tags && product.tags.length ? `\r\n                            <div class=\"flex\">\r\n                                <span class=\"text-gray-500 w-24\">Tags:</span>\r\n                                <div class=\"flex flex-wrap gap-1\">\r\n                                    ${product.tags.map(tag => `\r\n                                        <a href=\"/products/?tag=${tag.slug}\" class=\"px-2 py-0.5 bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors\">\r\n                                            ${Templates.escapeHtml(tag.name)}\r\n                                        </a>\r\n                                    `).join('')}\r\n                                </div>\r\n                            </div>\r\n                        ` : ''}\r\n                    </div>\r\n\r\n                    <!-- Share -->\r\n                    <div class=\"mt-6 pt-6 border-t border-gray-200\">\r\n                        <span class=\"text-sm text-gray-500\">Share:</span>\r\n                        <div class=\"flex gap-2 mt-2\">\r\n                            <button class=\"share-btn p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors\" data-platform=\"facebook\" aria-label=\"Share on Facebook\">\r\n                                <svg class=\"w-5 h-5 text-[#1877F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"/></svg>\r\n                            </button>\r\n                            <button class=\"share-btn p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors\" data-platform=\"twitter\" aria-label=\"Share on Twitter\">\r\n                                <svg class=\"w-5 h-5 text-[#1DA1F2]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"/></svg>\r\n                            </button>\r\n                            <button class=\"share-btn p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors\" data-platform=\"pinterest\" aria-label=\"Share on Pinterest\">\r\n                                <svg class=\"w-5 h-5 text-[#E60023]\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738a.36.36 0 01.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z\"/></svg>\r\n                            </button>\r\n                            <button class=\"share-btn p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors\" data-platform=\"copy\" aria-label=\"Copy link\">\r\n                                <svg class=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3\"/>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Product Tabs -->\r\n            <div class=\"mt-12\" data-tabs data-variant=\"underline\" id=\"product-tabs\">\r\n                <div class=\"border-b border-gray-200\">\r\n                    <nav class=\"flex -mb-px\">\r\n                        <button data-tab class=\"px-6 py-4 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent\">\r\n                            Description\r\n                        </button>\r\n                        ${product.specifications && Object.keys(product.specifications).length ? `\r\n                            <button data-tab class=\"px-6 py-4 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent\">\r\n                                Specifications\r\n                            </button>\r\n                        ` : ''}\r\n                        <button data-tab class=\"px-6 py-4 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent\">\r\n                            Reviews (${product.review_count || 0})\r\n                        </button>\r\n                    </nav>\r\n                </div>\r\n                <div class=\"py-6\">\r\n                    <div data-tab-panel>\r\n                        <div class=\"prose max-w-none\">\r\n                            ${product.description || '<p class=\"text-gray-500\">No description available.</p>'}\r\n                        </div>\r\n                    </div>\r\n                    ${product.specifications && Object.keys(product.specifications).length ? `\r\n                        <div data-tab-panel>\r\n                            <table class=\"w-full\">\r\n                                <tbody>\r\n                                    ${Object.entries(product.specifications).map(([key, value]) => `\r\n                                        <tr class=\"border-b border-gray-100\">\r\n                                            <td class=\"py-3 text-sm font-medium text-gray-500 w-1/3\">${Templates.escapeHtml(key)}</td>\r\n                                            <td class=\"py-3 text-sm text-gray-900\">${Templates.escapeHtml(String(value))}</td>\r\n                                        </tr>\r\n                                    `).join('')}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    ` : ''}\r\n                    <div data-tab-panel id=\"reviews\">\r\n                        <div id=\"reviews-container\">\r\n                            <!-- Reviews loaded here -->\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        initGallery();\r\n        initQuantityControls();\r\n        initAddToCart();\r\n        initWishlist();\r\n        initCompare();\r\n        initShare();\r\n        Tabs.init();\r\n\r\n        // Ensure mobile sticky ATC exists and is in sync\r\n        createOrUpdateMobileAtc(product);\r\n    }\r\n\r\n    function createOrUpdateMobileAtc(product) {\r\n        let el = document.getElementById('mobile-sticky-atc-js');\r\n        if (!el) {\r\n            el = document.createElement('div');\r\n            el.id = 'mobile-sticky-atc-js';\r\n            el.className = 'fixed inset-x-4 bottom-4 z-40 lg:hidden';\r\n            el.innerHTML = `\r\n                <div class=\"bg-white shadow-lg rounded-xl p-3 flex items-center gap-3\">\r\n                    <div class=\"flex-1\">\r\n                        <div class=\"text-sm text-gray-500\">${product.sale_price ? 'Now' : ''}</div>\r\n                        <div class=\"font-semibold text-lg ${product.sale_price ? 'text-red-600' : ''}\">${product.sale_price ? Templates.formatPrice(product.sale_price) + ' <span class=\"text-sm line-through text-gray-400\">' + Templates.formatPrice(product.price) + '</span>' : Templates.formatPrice(product.price)}</div>\r\n                        <div id=\"mobile-stock-js\" class=\"text-xs text-gray-500\">${product.stock_quantity > 0 ? (product.stock_quantity > 10 ? 'In stock' : product.stock_quantity + ' available') : 'Out of stock'}</div>\r\n                    </div>\r\n                    ${product.stock_quantity > 0 ? `<button id=\"mobile-add-to-cart-js\" class=\"bg-primary-600 text-white px-4 py-2 rounded-lg font-semibold\">Add</button>` : `<button class=\"bg-gray-300 text-gray-500 px-4 py-2 rounded-lg font-semibold cursor-not-allowed\" disabled>Out</button>`}\r\n                </div>\r\n            `;\r\n            document.body.appendChild(el);\r\n\r\n            // Wire mobile button\r\n            const mobBtn = document.getElementById('mobile-add-to-cart-js');\r\n            if (mobBtn) mobBtn.addEventListener('click', () => document.getElementById('add-to-cart-btn')?.click());\r\n        } else {\r\n            // Update existing\r\n            const priceEl = el.querySelector('.font-semibold');\r\n            if (priceEl) priceEl.innerHTML = product.sale_price ? Templates.formatPrice(product.sale_price) + ' <span class=\"text-sm line-through text-gray-400\">' + Templates.formatPrice(product.price) + '</span>' : Templates.formatPrice(product.price);\r\n            const stockEl = document.getElementById('mobile-stock-js');\r\n            if (stockEl) stockEl.textContent = product.stock_quantity > 0 ? (product.stock_quantity > 10 ? 'In stock' : product.stock_quantity + ' available') : 'Out of stock';\r\n            const mobBtn = document.getElementById('mobile-add-to-cart-js');\r\n            if (mobBtn) mobBtn.disabled = product.stock_quantity <= 0;\r\n        }\r\n    }\r\n\r\n    function renderVariants(variants) {\r\n        const grouped = {};\r\n        variants.forEach(variant => {\r\n            if (!grouped[variant.attribute_name]) {\r\n                grouped[variant.attribute_name] = [];\r\n            }\r\n            grouped[variant.attribute_name].push(variant);\r\n        });\r\n\r\n        return Object.entries(grouped).map(([attrName, options]) => `\r\n            <div class=\"mt-6\">\r\n                <label class=\"text-sm font-medium text-gray-700\">${Templates.escapeHtml(attrName)}:</label>\r\n                <div class=\"flex flex-wrap gap-2 mt-2\" role=\"radiogroup\" aria-label=\"${Templates.escapeHtml(attrName)}\">\r\n                    ${options.map((opt, index) => `\r\n                        <button \r\n                            class=\"variant-btn px-4 py-2 border rounded-lg text-sm transition-colors ${index === 0 ? 'border-primary-500 bg-primary-50 text-primary-700' : 'border-gray-300 hover:border-gray-400'}\"\r\n                            role=\"radio\"\r\n                            aria-checked=\"${index === 0 ? 'true' : 'false'}\"\r\n                            data-variant-id=\"${opt.id}\"\r\n                            data-price=\"${opt.price_converted ?? opt.price ?? ''}\"\r\n                            data-stock=\"${opt.stock_quantity || 0}\"\r\n                            tabindex=\"0\"\r\n                        >\r\n                            ${Templates.escapeHtml(opt.value)}\r\n                            ${((opt.price_converted ?? opt.price) && (opt.price !== currentProduct.price)) ? `\r\n                                <span class=\"text-xs text-gray-500\">(${Templates.formatPrice(opt.price_converted ?? opt.price)})</span>\r\n                            ` : ''}\r\n                        </button>\r\n                    `).join('')}\r\n                </div>\r\n            </div>\r\n        `).join('');\r\n    }\r\n\r\n    function initGallery() {\r\n        const thumbnails = document.querySelectorAll('.thumbnail');\r\n        const mainImage = document.getElementById('main-product-image');\r\n\r\n        // Keyboard navigation for thumbnails\r\n        let focusedIndex = 0;\r\n        thumbnails.forEach((thumb, idx) => {\r\n            thumb.setAttribute('tabindex', '0');\r\n            thumb.addEventListener('click', () => {\r\n                thumbnails.forEach(t => t.classList.remove('border-primary-500'));\r\n                thumb.classList.add('border-primary-500');\r\n                mainImage.src = thumb.dataset.image || thumb.dataset.src;\r\n                focusedIndex = idx;\r\n            });\r\n            thumb.addEventListener('keydown', (ev) => {\r\n                if (ev.key === 'Enter' || ev.key === ' ') {\r\n                    ev.preventDefault();\r\n                    thumb.click();\r\n                } else if (ev.key === 'ArrowRight') {\r\n                    ev.preventDefault();\r\n                    const next = thumbnails[(idx + 1) % thumbnails.length];\r\n                    next.focus();\r\n                    next.click();\r\n                } else if (ev.key === 'ArrowLeft') {\r\n                    ev.preventDefault();\r\n                    const prev = thumbnails[(idx - 1 + thumbnails.length) % thumbnails.length];\r\n                    prev.focus();\r\n                    prev.click();\r\n                }\r\n            });\r\n        });\r\n\r\n        // Lightbox via Modal (supports images, video, model-viewer)\r\n        mainImage?.addEventListener('click', () => {\r\n            const images = currentProduct.images?.map(img => img.image) || [currentProduct.image];\r\n            const currentIndex = parseInt(document.querySelector('.thumbnail.border-primary-500')?.dataset.index) || 0;\r\n\r\n            // Build content for lightbox - support videos and 3D models if present\r\n            const slides = (currentProduct.images || []).map(img => {\r\n                return {\r\n                    type: img.type || (img.video_url ? 'video' : 'image'),\r\n                    src: img.video_url || img.model_url || img.image\r\n                };\r\n            });\r\n\r\n            // Fallback simple image carousel in Modal\r\n            const content = slides.map(s => {\r\n                if (s.type === 'video') {\r\n                    return `<div class=\"w-full h-full max-h-[70vh]\"><video controls class=\"w-full h-full object-contain\"><source src=\"${s.src}\" type=\"video/mp4\">Your browser does not support video.</video></div>`;\r\n                }\r\n                if (s.type === 'model') {\r\n                    // Lazy load model-viewer\r\n                    if (!window.customElements || !window['model-viewer']) {\r\n                        const script = document.createElement('script');\r\n                        script.type = 'module';\r\n                        script.src = 'https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js';\r\n                        document.head.appendChild(script);\r\n                    }\r\n                    return `<div class=\"w-full h-full max-h-[70vh]\"><model-viewer src=\"${s.src}\" camera-controls ar ar-modes=\"webxr scene-viewer quick-look\" class=\"w-full h-full\"></model-viewer></div>`;\r\n                }\r\n                return `<div class=\"w-full h-full max-h-[70vh] flex items-center justify-center\"><img src=\"${s.src}\" class=\"max-w-full max-h-[70vh] object-contain\" alt=\"${Templates.escapeHtml(currentProduct.name)}\"></div>`;\r\n            }).join('');\r\n\r\n            Modal.open({\r\n                title: Templates.escapeHtml(currentProduct.name),\r\n                content: `<div class=\"space-y-2\">${content}</div>`,\r\n                size: 'xl'\r\n            });\r\n        });\r\n    }\r\n\r\n    function initQuantityControls() {\r\n        const qtyInput = document.getElementById('product-quantity');\r\n        const decreaseBtn = document.querySelector('.qty-decrease');\r\n        const increaseBtn = document.querySelector('.qty-increase');\r\n\r\n        decreaseBtn?.addEventListener('click', () => {\r\n            const current = parseInt(qtyInput.value) || 1;\r\n            if (current > 1) {\r\n                qtyInput.value = current - 1;\r\n            }\r\n        });\r\n\r\n        increaseBtn?.addEventListener('click', () => {\r\n            const current = parseInt(qtyInput.value) || 1;\r\n            const max = parseInt(qtyInput.max) || 99;\r\n            if (current < max) {\r\n                qtyInput.value = current + 1;\r\n            }\r\n        });\r\n\r\n        const variantBtns = document.querySelectorAll('.variant-btn');\r\n        variantBtns.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                variantBtns.forEach(b => {\r\n                    b.classList.remove('border-primary-500', 'bg-primary-50', 'text-primary-700');\r\n                    b.classList.add('border-gray-300');\r\n                    b.setAttribute('aria-checked', 'false');\r\n                });\r\n                btn.classList.add('border-primary-500', 'bg-primary-50', 'text-primary-700');\r\n                btn.classList.remove('border-gray-300');\r\n                btn.setAttribute('aria-checked', 'true');\r\n\r\n                selectedVariant = btn.dataset.variantId;\r\n\r\n                // Update price if variant has custom price\r\n                if (btn.dataset.price) {\r\n                    const priceContainer = document.querySelector('.product-info .mt-4');\r\n                    if (priceContainer) {\r\n                        priceContainer.innerHTML = Price.render({\r\n                            price: parseFloat(btn.dataset.price),\r\n                            size: 'large'\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Update stock info\r\n                const stock = parseInt(btn.dataset.stock || '0');\r\n                const stockEl = document.getElementById('stock-status');\r\n                const addToCartBtn = document.getElementById('add-to-cart-btn');\r\n                const mobileStock = document.getElementById('mobile-stock');\r\n                const mobileATC = document.getElementById('mobile-add-to-cart');\r\n\r\n                if (stockEl) {\r\n                    if (stock > 10) {\r\n                        stockEl.innerHTML = `<span class=\"text-green-600 flex items-center\"><svg class=\"w-5 h-5 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path></svg>In Stock</span>`;\r\n                    } else if (stock > 0) {\r\n                        stockEl.innerHTML = `<span class=\"text-orange-500 flex items-center\"><svg class=\"w-5 h-5 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"></path></svg>Only ${stock} left</span>`;\r\n                    } else {\r\n                        stockEl.innerHTML = `<span class=\"text-red-600 flex items-center\"><svg class=\"w-5 h-5 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\"></path></svg>Out of Stock</span>`;\r\n                    }\r\n                }\r\n\r\n                if (qtyInput) {\r\n                    qtyInput.max = Math.max(stock, 1);\r\n                    if (parseInt(qtyInput.value) > parseInt(qtyInput.max)) qtyInput.value = qtyInput.max;\r\n                }\r\n\r\n                if (mobileStock) {\r\n                    mobileStock.textContent = stock > 0 ? (stock > 10 ? 'In stock' : `${stock} available`) : 'Out of stock';\r\n                }\r\n\r\n                if (addToCartBtn) {\r\n                    addToCartBtn.disabled = stock <= 0;\r\n                }\r\n                if (mobileATC) {\r\n                    mobileATC.disabled = stock <= 0;\r\n                }\r\n            });\r\n        });\r\n\r\n        if (variantBtns.length > 0) {\r\n            const first = variantBtns[0];\r\n            first.setAttribute('aria-checked', 'true');\r\n            selectedVariant = first.dataset.variantId;\r\n        }\r\n    }\r\n\r\n    function initAddToCart() {\r\n        const btn = document.getElementById('add-to-cart-btn');\r\n        const mobileBtn = document.getElementById('mobile-add-to-cart');\r\n        if (!btn && !mobileBtn) return;\r\n\r\n        const performAddToCart = async (triggerBtn) => {\r\n            const quantity = parseInt(document.getElementById('product-quantity')?.value) || 1;\r\n            const stockEl = document.getElementById('stock-status');\r\n            // Validate variant selection if product has variants\r\n            const hasVariants = !!document.querySelector('.variant-btn');\r\n            if (hasVariants && !selectedVariant) {\r\n                Toast.warning('Please select a variant before adding to cart.');\r\n                return;\r\n            }\r\n\r\n            triggerBtn.disabled = true;\r\n            const originalHtml = triggerBtn.innerHTML;\r\n            triggerBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\r\n\r\n            try {\r\n                // If variant selected, verify stock (optimistic)\r\n                const variantBtn = document.querySelector(`.variant-btn[data-variant-id=\"${selectedVariant}\"]`);\r\n                const stock = variantBtn ? parseInt(variantBtn.dataset.stock || '0') : (currentProduct.stock_quantity || 0);\r\n                if (stock <= 0) {\r\n                    Toast.error('This variant is out of stock.');\r\n                    return;\r\n                }\r\n\r\n                await CartApi.addItem(currentProduct.id, quantity, selectedVariant || null);\r\n                Toast.success('Added to cart!');\r\n                document.dispatchEvent(new CustomEvent('cart:updated'));\r\n            } catch (error) {\r\n                Toast.error(error.message || 'Failed to add to cart.');\r\n            } finally {\r\n                triggerBtn.disabled = false;\r\n                triggerBtn.innerHTML = originalHtml;\r\n            }\r\n        };\r\n\r\n        btn?.addEventListener('click', () => performAddToCart(btn));\r\n        mobileBtn?.addEventListener('click', () => performAddToCart(mobileBtn));\r\n    }\r\n\r\n    function initWishlist() {\r\n        const btn = document.getElementById('add-to-wishlist-btn');\r\n        if (!btn) return;\r\n\r\n        btn.addEventListener('click', async () => {\r\n            if (!AuthApi.isAuthenticated()) {\r\n                Toast.warning('Please login to add items to your wishlist.');\r\n                window.location.href = '/account/login/?next=' + encodeURIComponent(window.location.pathname);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                await WishlistApi.addItem(currentProduct.id);\r\n                Toast.success('Added to wishlist!');\r\n                \r\n                btn.querySelector('svg').setAttribute('fill', 'currentColor');\r\n                btn.classList.add('text-red-500');\r\n                btn.setAttribute('aria-pressed', 'true');\r\n            } catch (error) {\r\n                if (error.message?.includes('already')) {\r\n                    Toast.info('This item is already in your wishlist.');\r\n                } else {\r\n                    Toast.error(error.message || 'Failed to add to wishlist.');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function initShare() {\r\n        const shareBtns = document.querySelectorAll('.share-btn');\r\n        const url = encodeURIComponent(window.location.href);\r\n        const title = encodeURIComponent(currentProduct?.name || document.title);\r\n\r\n        shareBtns.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                const platform = btn.dataset.platform;\r\n                let shareUrl = '';\r\n\r\n                switch (platform) {\r\n                    case 'facebook':\r\n                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;\r\n                        break;\r\n                    case 'twitter':\r\n                        shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;\r\n                        break;\r\n                    case 'pinterest':\r\n                        const image = encodeURIComponent(currentProduct?.image || '');\r\n                        shareUrl = `https://pinterest.com/pin/create/button/?url=${url}&media=${image}&description=${title}`;\r\n                        break;\r\n                    case 'copy':\r\n                        navigator.clipboard.writeText(window.location.href)\r\n                            .then(() => Toast.success('Link copied to clipboard!'))\r\n                            .catch(() => Toast.error('Failed to copy link.'));\r\n                        return;\r\n                }\r\n\r\n                if (shareUrl) {\r\n                    window.open(shareUrl, '_blank', 'width=600,height=400');\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    function initCompare() {\r\n        const btn = document.getElementById('add-to-compare-btn');\r\n        if (!btn) return;\r\n\r\n        btn.addEventListener('click', async () => {\r\n            if (typeof AuthApi !== 'undefined' && !AuthApi.isAuthenticated()) {\r\n                Toast.warning('Please login to compare products.');\r\n                window.location.href = '/account/login/?next=' + encodeURIComponent(window.location.pathname);\r\n                return;\r\n            }\r\n\r\n            const productId = currentProduct?.id || document.getElementById('product-detail')?.dataset.productId;\r\n            if (!productId) return;\r\n\r\n            try {\r\n                const resp = await ApiClient.post('/compare/', { product_id: productId }, { requiresAuth: true });\r\n                if (resp.success) {\r\n                    Toast.success(resp.message || 'Added to compare');\r\n                    btn.setAttribute('aria-pressed', 'true');\r\n                    btn.classList.add('text-primary-600');\r\n                    btn.querySelector('svg')?.setAttribute('fill', 'currentColor');\r\n                } else {\r\n                    Toast.error(resp.message || 'Failed to add to compare');\r\n                }\r\n            } catch (err) {\r\n                // Fallback: store locally if compare endpoint not available\r\n                try {\r\n                    const key = 'b_compare';\r\n                    const list = JSON.parse(localStorage.getItem(key) || '[]');\r\n                    if (!list.includes(productId)) {\r\n                        list.push(productId);\r\n                        localStorage.setItem(key, JSON.stringify(list));\r\n                        Toast.success('Added to compare (local)');\r\n                        btn.setAttribute('aria-pressed', 'true');\r\n                        btn.classList.add('text-primary-600');\r\n                        return;\r\n                    }\r\n                    Toast.info('Already in compare list');\r\n                } catch (e) {\r\n                    Toast.error(err.message || 'Failed to add to compare');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Bind compare button when page content is server-rendered (existing DOM)\r\n    function initCompareFromExisting() {\r\n        const btn = document.getElementById('add-to-compare-btn');\r\n        if (!btn) return;\r\n        btn.addEventListener('click', async (e) => {\r\n            e.preventDefault();\r\n            // Ensure we have a product id in scope for both try and catch paths\r\n            const productId = document.getElementById('product-detail')?.dataset.productId;\r\n            if (!productId) return;\r\n\r\n            try {\r\n                if (typeof AuthApi !== 'undefined' && !AuthApi.isAuthenticated()) {\r\n                    Toast.warning('Please login to compare products.');\r\n                    window.location.href = '/account/login/?next=' + encodeURIComponent(window.location.pathname);\r\n                    return;\r\n                }\r\n\r\n                // Try API call directly\r\n                const resp = await ApiClient.post('/compare/', { product_id: productId }, { requiresAuth: true });\r\n                if (resp.success) {\r\n                    Toast.success(resp.message || 'Added to compare');\r\n                    btn.setAttribute('aria-pressed', 'true');\r\n                    btn.classList.add('text-primary-600');\r\n                    btn.querySelector('svg')?.setAttribute('fill', 'currentColor');\r\n                } else {\r\n                    Toast.error(resp.message || 'Failed to add to compare');\r\n                }\r\n            } catch (err) {\r\n                // Local fallback\r\n                try {\r\n                    const key = 'b_compare';\r\n                    const list = JSON.parse(localStorage.getItem(key) || '[]');\r\n                    if (!list.includes(productId)) {\r\n                        list.push(productId);\r\n                        localStorage.setItem(key, JSON.stringify(list));\r\n                        Toast.success('Added to compare (local)');\r\n                        btn.setAttribute('aria-pressed', 'true');\r\n                        btn.classList.add('text-primary-600');\r\n                        return;\r\n                    }\r\n                    Toast.info('Already in compare list');\r\n                } catch (e) {\r\n                    Toast.error(err.message || 'Failed to add to compare');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    async function loadBreadcrumbs(product) {\r\n        const container = document.getElementById('breadcrumbs');\r\n        if (!container) return;\r\n\r\n        const items = [\r\n            { label: 'Home', url: '/' },\r\n            { label: 'Products', url: '/products/' }\r\n        ];\r\n\r\n        if (product.category) {\r\n            try {\r\n                const response = await CategoriesAPI.getBreadcrumbs(product.category.id);\r\n                const categoryBreadcrumbs = response.data || [];\r\n                categoryBreadcrumbs.forEach(cat => {\r\n                    items.push({ label: cat.name, url: `/categories/${cat.slug}/` });\r\n                });\r\n            } catch (error) {\r\n                items.push({ label: product.category.name, url: `/categories/${product.category.slug}/` });\r\n            }\r\n        }\r\n\r\n        items.push({ label: product.name });\r\n\r\n        container.innerHTML = Breadcrumb.render(items);\r\n    }\r\n\r\n    async function loadRelatedProducts(product) {\r\n        const container = document.getElementById('related-products');\r\n        if (!container) return;\r\n\r\n        try {\r\n            const response = await ProductsAPI.getRelated(product.id, { limit: 4 });\r\n            const products = response.data || [];\r\n\r\n            if (products.length === 0) {\r\n                container.innerHTML = '';\r\n                return;\r\n            }\r\n\r\n            container.innerHTML = `\r\n                <h2 class=\"text-2xl font-bold text-gray-900 mb-6\">You may also like</h2>\r\n                <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6\">\r\n                    ${products.map(p => ProductCard.render(p)).join('')}\r\n                </div>\r\n            `;\r\n\r\n            ProductCard.bindEvents(container);\r\n        } catch (error) {\r\n            console.error('Failed to load related products:', error);\r\n            container.innerHTML = '';\r\n        }\r\n    }\r\n\r\n    async function loadReviews(product) {\r\n        const container = document.getElementById('reviews-container');\r\n        if (!container) return;\r\n\r\n        Loader.show(container, 'spinner');\r\n\r\n        try {\r\n            const response = await ProductsAPI.getReviews(product.id);\r\n            const reviews = response.data || [];\r\n\r\n            container.innerHTML = `\r\n                <!-- Review Summary -->\r\n                <div class=\"flex flex-col md:flex-row gap-8 mb-8 pb-8 border-b border-gray-200\">\r\n                    <div class=\"text-center\">\r\n                        <div class=\"text-5xl font-bold text-gray-900\">${product.average_rating?.toFixed(1) || '0.0'}</div>\r\n                        <div class=\"flex justify-center mt-2\">\r\n                            ${Templates.renderStars(product.average_rating || 0)}\r\n                        </div>\r\n                        <div class=\"text-sm text-gray-500 mt-1\">${product.review_count || 0} reviews</div>\r\n                    </div>\r\n                    ${AuthAPI.isAuthenticated() ? `\r\n                        <div class=\"flex-1\">\r\n                            <button id=\"write-review-btn\" class=\"px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors\">\r\n                                Write a Review\r\n                            </button>\r\n                        </div>\r\n                    ` : `\r\n                        <div class=\"flex-1\">\r\n                            <p class=\"text-gray-600\">\r\n                                <a href=\"/account/login/?next=${encodeURIComponent(window.location.pathname)}\" class=\"text-primary-600 hover:text-primary-700\">Sign in</a> \r\n                                to write a review.\r\n                            </p>\r\n                        </div>\r\n                    `}\r\n                </div>\r\n\r\n                <!-- Reviews List -->\r\n                ${reviews.length > 0 ? `\r\n                    <div class=\"space-y-6\">\r\n                        ${reviews.map(review => `\r\n                            <div class=\"border-b border-gray-100 pb-6\">\r\n                                <div class=\"flex items-start gap-4\">\r\n                                    <div class=\"flex-shrink-0 w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center\">\r\n                                        <span class=\"text-gray-600 font-medium\">${(review.user?.first_name?.[0] || review.user?.email?.[0] || 'U').toUpperCase()}</span>\r\n                                    </div>\r\n                                    <div class=\"flex-1\">\r\n                                        <div class=\"flex items-center gap-2\">\r\n                                            <span class=\"font-medium text-gray-900\">${Templates.escapeHtml(review.user?.first_name || 'Anonymous')}</span>\r\n                                            ${review.verified_purchase ? `\r\n                                                <span class=\"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded\">Verified Purchase</span>\r\n                                            ` : ''}\r\n                                        </div>\r\n                                        <div class=\"flex items-center gap-2 mt-1\">\r\n                                            ${Templates.renderStars(review.rating)}\r\n                                            <span class=\"text-sm text-gray-500\">${Templates.formatDate(review.created_at)}</span>\r\n                                        </div>\r\n                                        ${review.title ? `<h4 class=\"font-medium text-gray-900 mt-2\">${Templates.escapeHtml(review.title)}</h4>` : ''}\r\n                                        <p class=\"text-gray-600 mt-2\">${Templates.escapeHtml(review.comment)}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        `).join('')}\r\n                    </div>\r\n                ` : `\r\n                    <p class=\"text-gray-500 text-center py-8\">No reviews yet. Be the first to review this product!</p>\r\n                `}\r\n            `;\r\n\r\n            document.getElementById('write-review-btn')?.addEventListener('click', () => {\r\n                showReviewForm(product);\r\n            });\r\n        } catch (error) {\r\n            console.error('Failed to load reviews:', error);\r\n            container.innerHTML = '<p class=\"text-red-500\">Failed to load reviews.</p>';\r\n        }\r\n    }\r\n\r\n    function showReviewForm(product) {\r\n        Modal.open({\r\n            title: 'Write a Review',\r\n            content: `\r\n                <form id=\"review-form\" class=\"space-y-4\">\r\n                    <div>\r\n                        <label class=\"block text-sm font-medium text-gray-700 mb-2\">Rating</label>\r\n                        <div class=\"flex gap-1\" id=\"rating-stars\">\r\n                            ${[1, 2, 3, 4, 5].map(i => `\r\n                                <button type=\"button\" class=\"rating-star text-gray-300 hover:text-yellow-400\" data-rating=\"${i}\">\r\n                                    <svg class=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                        <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n                                    </svg>\r\n                                </button>\r\n                            `).join('')}\r\n                        </div>\r\n                        <input type=\"hidden\" id=\"review-rating\" value=\"0\">\r\n                    </div>\r\n                    <div>\r\n                        <label for=\"review-title\" class=\"block text-sm font-medium text-gray-700 mb-1\">Title (optional)</label>\r\n                        <input type=\"text\" id=\"review-title\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\">\r\n                    </div>\r\n                    <div>\r\n                        <label for=\"review-comment\" class=\"block text-sm font-medium text-gray-700 mb-1\">Your Review</label>\r\n                        <textarea id=\"review-comment\" rows=\"4\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500\" required></textarea>\r\n                    </div>\r\n                </form>\r\n            `,\r\n            confirmText: 'Submit Review',\r\n            onConfirm: async () => {\r\n                const rating = parseInt(document.getElementById('review-rating').value);\r\n                const title = document.getElementById('review-title').value.trim();\r\n                const comment = document.getElementById('review-comment').value.trim();\r\n\r\n                if (!rating || rating < 1) {\r\n                    Toast.error('Please select a rating.');\r\n                    return false;\r\n                }\r\n\r\n                if (!comment) {\r\n                    Toast.error('Please write a review.');\r\n                    return false;\r\n                }\r\n\r\n                try {\r\n                    await ProductsAPI.createReview(product.id, { rating, title, comment });\r\n                    Toast.success('Thank you for your review!');\r\n                    loadReviews(product);\r\n                    return true;\r\n                } catch (error) {\r\n                    Toast.error(error.message || 'Failed to submit review.');\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n\r\n        const stars = document.querySelectorAll('.rating-star');\r\n        const ratingInput = document.getElementById('review-rating');\r\n\r\n        stars.forEach(star => {\r\n            star.addEventListener('click', () => {\r\n                const rating = parseInt(star.dataset.rating);\r\n                ratingInput.value = rating;\r\n                \r\n                stars.forEach((s, i) => {\r\n                    if (i < rating) {\r\n                        s.classList.remove('text-gray-300');\r\n                        s.classList.add('text-yellow-400');\r\n                    } else {\r\n                        s.classList.add('text-gray-300');\r\n                        s.classList.remove('text-yellow-400');\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    // Update meta tags dynamically for SPA\r\n    function updateMetaTags(product) {\r\n        try {\r\n            document.title = `${product.name} | Bunoraa`;\r\n            const desc = product.meta_description || product.short_description || '';\r\n            document.querySelector('meta[name=\"description\"]')?.setAttribute('content', desc);\r\n            document.querySelector('meta[property=\"og:title\"]')?.setAttribute('content', product.meta_title || product.name);\r\n            document.querySelector('meta[property=\"og:description\"]')?.setAttribute('content', desc);\r\n            const ogImage = product.images?.[0]?.image || product.image;\r\n            if (ogImage) document.querySelector('meta[property=\"og:image\"]')?.setAttribute('content', ogImage);\r\n            document.querySelector('meta[name=\"twitter:title\"]')?.setAttribute('content', product.meta_title || product.name);\r\n            document.querySelector('meta[name=\"twitter:description\"]')?.setAttribute('content', desc);\r\n        } catch (e) {}\r\n    }\r\n\r\n    // Update structured JSON-LD for SPA\r\n    function updateStructuredData(product) {\r\n        try {\r\n            const productScript = document.querySelector('script[type=\"application/ld+json\"][data-ld=\"product\"]');\r\n            if (!productScript) return;\r\n            const data = {\r\n                \"@context\": \"https://schema.org\",\r\n                \"@type\": \"Product\",\r\n                name: product.name,\r\n                image: (product.images || []).map(i => (i.image || i)),\r\n                description: product.short_description || product.description || '',\r\n                sku: product.sku || '',\r\n                offers: {\r\n                    \"@type\": \"Offer\",\r\n                    url: window.location.href,\r\n                    priceCurrency: product.currency || window.BUNORAA_PRODUCT?.currency || 'BDT',\r\n                    price: product.current_price || product.price\r\n                }\r\n            };\r\n            productScript.textContent = JSON.stringify(data);\r\n        } catch (e) {}\r\n    }\r\n\r\n    // Load recommendations (frequently bought, similar, you may also like)\r\n    async function loadRecommendations(product) {\r\n        const container = document.getElementById('related-products');\r\n        if (!container) return;\r\n\r\n        try {\r\n            const [fbt, similar, liked] = await Promise.all([\r\n                ProductsApi.getRecommendations(product.id, 'frequently_bought_together', 3),\r\n                ProductsApi.getRecommendations(product.id, 'similar', 4),\r\n                ProductsApi.getRecommendations(product.id, 'you_may_also_like', 6)\r\n            ]);\r\n\r\n            // Render frequently bought together\r\n            if (fbt.success && fbt.data?.length) {\r\n                const html = `\r\n                    <section class=\"mt-8\">\r\n                        <h3 class=\"text-lg font-semibold mb-4\">Frequently Bought Together</h3>\r\n                        <div class=\"grid grid-cols-3 gap-3\">${(fbt.data || []).map(p => ProductCard.render(p)).join('')}</div>\r\n                    </section>\r\n                `;\r\n                container.insertAdjacentHTML('beforeend', html);\r\n            }\r\n\r\n            // Similar\r\n            if (similar.success && similar.data?.length) {\r\n                const html = `\r\n                    <section class=\"mt-8\">\r\n                        <h3 class=\"text-lg font-semibold mb-4\">Similar Products</h3>\r\n                        <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">${(similar.data || []).map(p => ProductCard.render(p)).join('')}</div>\r\n                    </section>\r\n                `;\r\n                container.insertAdjacentHTML('beforeend', html);\r\n            }\r\n\r\n            // You may also like\r\n            if (liked.success && liked.data?.length) {\r\n                const html = `\r\n                    <section class=\"mt-8\">\r\n                        <h3 class=\"text-lg font-semibold mb-4\">You May Also Like</h3>\r\n                        <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">${(liked.data || []).map(p => ProductCard.render(p)).join('')}</div>\r\n                    </section>\r\n                `;\r\n                container.insertAdjacentHTML('beforeend', html);\r\n            }\r\n\r\n            ProductCard.bindEvents(container);\r\n        } catch (err) {\r\n            // ignore gracefully\r\n        }\r\n    }\r\n\r\n    // Defer heavy below-the-fold sections until visible\r\n    function initLazySections() {\r\n        const container = document.getElementById('product-detail');\r\n        if (!container || typeof IntersectionObserver === 'undefined') return;\r\n\r\n        const observer = new IntersectionObserver((entries) => {\r\n            entries.forEach(entry => {\r\n                if (!entry.isIntersecting) return;\r\n                const target = entry.target;\r\n                if (target.id === 'related-products') {\r\n                    // ensure recommendations already loaded in parallel; nothing to do\r\n                }\r\n                if (target.id === 'reviews' || target.id === 'reviews-container') {\r\n                    // reviews are already loaded; nothing to do\r\n                }\r\n                observer.unobserve(target);\r\n            });\r\n        }, { rootMargin: '200px' });\r\n\r\n        document.querySelectorAll('#related-products, #reviews').forEach(el => {\r\n            observer.observe(el);\r\n        });\r\n    }\r\n\r\n    async function trackProductView(product) {\r\n        try {\r\n            await ProductsAPI.trackView(product.id);\r\n        } catch (error) {\r\n            // error logging removed\r\n        }\r\n    }\r\n\r\n    function destroy() {\r\n        currentProduct = null;\r\n        selectedVariant = null;\r\n        gallery = null;\r\n        initialized = false;\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy\r\n    };\r\n})();\r\n\r\nwindow.ProductPage = ProductPage;\r\nexport default ProductPage;\r\n", "/**\n * Search Page\n * @module pages/search\n */\n\nconst SearchPage = (function() {\n    'use strict';\n\n    let currentQuery = '';\n    let currentPage = 1;\n    let currentFilters = {};\n    let abortController = null;\n    let initialized = false;\n\n    async function init() {\n        // Prevent multiple initializations\n        if (initialized) return;\n        initialized = true;\n\n        // Check if content is already server-rendered\n        const resultsContainer = document.getElementById('search-results') || document.getElementById('products-grid');\n        const hasServerContent = resultsContainer && resultsContainer.querySelector('.product-card, [data-product-id]');\n        \n        if (hasServerContent) {\n            // Server-rendered content exists - just bind event handlers\n            initSearchForm();\n            initFilters();\n            initSorting();\n            initViewToggle();\n            return;\n        }\n\n        currentQuery = getQueryFromUrl();\n        currentFilters = getFiltersFromUrl();\n        currentPage = parseInt(new URLSearchParams(window.location.search).get('page')) || 1;\n\n        // Load products whether there's a search query or not\n        await loadProducts();\n\n        initSearchForm();\n        initFilters();\n        initSorting();\n        initViewToggle();\n    }\n\n    function initViewToggle() {\n        const gridBtn = document.getElementById('view-grid');\n        const listBtn = document.getElementById('view-list');\n        \n        gridBtn?.addEventListener('click', () => {\n            gridBtn.classList.add('bg-primary-100', 'text-primary-700');\n            gridBtn.classList.remove('text-gray-400');\n            listBtn?.classList.remove('bg-primary-100', 'text-primary-700');\n            listBtn?.classList.add('text-gray-400');\n            Storage?.set('productViewMode', 'grid');\n            loadProducts();\n        });\n        \n        listBtn?.addEventListener('click', () => {\n            listBtn.classList.add('bg-primary-100', 'text-primary-700');\n            listBtn.classList.remove('text-gray-400');\n            gridBtn?.classList.remove('bg-primary-100', 'text-primary-700');\n            gridBtn?.classList.add('text-gray-400');\n            Storage?.set('productViewMode', 'list');\n            loadProducts();\n        });\n    }\n\n    async function loadProducts() {\n        const resultsContainer = document.getElementById('search-results') || document.getElementById('products-grid');\n        const resultsCount = document.getElementById('results-count') || document.getElementById('product-count');\n        \n        if (!resultsContainer) return;\n\n        if (abortController) {\n            abortController.abort();\n        }\n        abortController = new AbortController();\n\n        Loader.show(resultsContainer, 'skeleton');\n\n        try {\n            const params = {\n                page: currentPage,\n                pageSize: 12,\n                ...currentFilters\n            };\n            \n            if (currentQuery) {\n                params.search = currentQuery;\n            }\n\n            // Check if we're on categories page\n            const path = window.location.pathname;\n            if (path === '/categories/') {\n                // Load categories instead of products\n                await loadCategories();\n                return;\n            }\n\n            const response = await ProductsApi.getProducts(params);\n            const products = Array.isArray(response) ? response : (response.data || response.results || []);\n            const meta = response.meta || {};\n\n            if (resultsCount) {\n                if (currentQuery) {\n                    resultsCount.textContent = `${meta.total || products.length} results for \"${Templates.escapeHtml(currentQuery)}\"`;\n                } else {\n                    resultsCount.textContent = `${meta.total || products.length} products`;\n                }\n            }\n\n            renderResults(products, meta);\n            await loadFilterOptions();\n        } catch (error) {\n            if (error.name === 'AbortError') return;\n            console.error('Failed to load products:', error);\n            resultsContainer.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load products. Please try again.</p>';\n        }\n    }\n\n    async function loadCategories() {\n        const resultsContainer = document.getElementById('search-results') || document.getElementById('products-grid');\n        const resultsCount = document.getElementById('results-count') || document.getElementById('product-count');\n        const pageTitle = document.getElementById('page-title');\n        \n        if (!resultsContainer) return;\n\n        try {\n            const response = await CategoriesApi.getCategories({ limit: 50 });\n            const categories = Array.isArray(response) ? response : (response.data || response.results || []);\n\n            if (pageTitle) {\n                pageTitle.textContent = 'All Categories';\n            }\n\n            if (resultsCount) {\n                resultsCount.textContent = `${categories.length} categories`;\n            }\n\n            if (categories.length === 0) {\n                resultsContainer.innerHTML = `\n                    <div class=\"text-center py-16\">\n                        <svg class=\"w-24 h-24 text-gray-300 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n                        </svg>\n                        <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">No categories found</h2>\n                        <p class=\"text-gray-600\">Check back later for new categories.</p>\n                    </div>\n                `;\n                return;\n            }\n\n            resultsContainer.innerHTML = `\n                <div class=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\">\n                    ${categories.map(cat => `\n                        <a href=\"/categories/${cat.slug}/\" class=\"group bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden\">\n                            <div class=\"relative overflow-hidden\" style=\"aspect-ratio: ${product?.aspect?.css || '1/1'};\">\n                                ${cat.image ? `\n                                    <img src=\"${cat.image}\" alt=\"${Templates.escapeHtml(cat.name)}\" class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\">\n                                ` : `\n                                    <div class=\"w-full h-full flex items-center justify-center\">\n                                        <svg class=\"w-16 h-16 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n                                        </svg>\n                                    </div>\n                                `}\n                            </div>\n                            <div class=\"p-4 text-center\">\n                                <h3 class=\"font-semibold text-gray-900 group-hover:text-primary-600 transition-colors\">${Templates.escapeHtml(cat.name)}</h3>\n                                ${cat.product_count ? `<p class=\"text-sm text-gray-500 mt-1\">${cat.product_count} products</p>` : ''}\n                            </div>\n                        </a>\n                    `).join('')}\n                </div>\n            `;\n        } catch (error) {\n            console.error('Failed to load categories:', error);\n            resultsContainer.innerHTML = '<p class=\"text-red-500 text-center py-8\">Failed to load categories. Please try again.</p>';\n        }\n    }\n\n    function getQueryFromUrl() {\n        const params = new URLSearchParams(window.location.search);\n        return params.get('q') || '';\n    }\n\n    function getFiltersFromUrl() {\n        const params = new URLSearchParams(window.location.search);\n        const filters = {};\n\n        if (params.get('category')) filters.category = params.get('category');\n        if (params.get('min_price')) filters.minPrice = params.get('min_price');\n        if (params.get('max_price')) filters.maxPrice = params.get('max_price');\n        if (params.get('ordering')) filters.ordering = params.get('ordering');\n        if (params.get('in_stock')) filters.inStock = params.get('in_stock') === 'true';\n        if (params.get('sale')) filters.onSale = params.get('sale') === 'true';\n        if (params.get('featured')) filters.featured = params.get('featured') === 'true';\n\n        return filters;\n    }\n\n    function initSearchForm() {\n        const searchForm = document.getElementById('search-form');\n        const searchInput = document.getElementById('search-input');\n\n        if (searchInput) {\n            searchInput.value = currentQuery;\n        }\n\n        searchForm?.addEventListener('submit', (e) => {\n            e.preventDefault();\n            const query = searchInput?.value.trim();\n            \n            if (query) {\n                currentQuery = query;\n                currentPage = 1;\n                updateUrl();\n                performSearch();\n            }\n        });\n\n        // Live search suggestions\n        const suggestionsContainer = document.getElementById('search-suggestions');\n        let debounceTimer = null;\n\n        searchInput?.addEventListener('input', (e) => {\n            const query = e.target.value.trim();\n            \n            clearTimeout(debounceTimer);\n\n            if (query.length < 2) {\n                if (suggestionsContainer) {\n                    suggestionsContainer.innerHTML = '';\n                    suggestionsContainer.classList.add('hidden');\n                }\n                return;\n            }\n\n            debounceTimer = setTimeout(async () => {\n                try {\n                    const response = await ProductsApi.search({ q: query, limit: 5 });\n                    const products = response.data || [];\n\n                    if (suggestionsContainer && products.length > 0) {\n                        suggestionsContainer.innerHTML = `\n                            <div class=\"py-2\">\n                                ${products.map(product => `\n                                    <a href=\"/products/${product.slug}/\" class=\"flex items-center gap-3 px-4 py-2 hover:bg-gray-50\">\n                                        ${product.image ? `<img src=\"${product.image}\" alt=\"\" class=\"w-10 h-10 object-cover rounded\" onerror=\"this.style.display='none'\">` : `<div class=\"w-10 h-10 bg-gray-100 rounded flex items-center justify-center\"><svg class=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/></svg></div>`}\n                                        <div>\n                                            <p class=\"text-sm font-medium text-gray-900\">${Templates.escapeHtml(product.name)}</p>\n                                            <p class=\"text-sm text-primary-600\">${Templates.formatPrice(product.current_price ?? product.price_converted ?? product.price)}</p>\n                                        </div>\n                                    </a>\n                                `).join('')}\n                            </div>\n                        `;\n                        suggestionsContainer.classList.remove('hidden');\n                    }\n                } catch (error) {\n                    console.error('Search suggestions failed:', error);\n                }\n            }, 300);\n        });\n\n        // Hide suggestions on blur\n        searchInput?.addEventListener('blur', () => {\n            setTimeout(() => {\n                if (suggestionsContainer) {\n                    suggestionsContainer.classList.add('hidden');\n                }\n            }, 200);\n        });\n    }\n\n    async function performSearch() {\n        // Delegate to loadProducts which handles both search and browse\n        await loadProducts();\n    }\n\n    function renderResults(products, meta) {\n    }\n\n    function renderResults(products, meta) {\n        const container = document.getElementById('search-results');\n        if (!container) return;\n\n        if (products.length === 0) {\n            container.innerHTML = `\n                <div class=\"text-center py-16\">\n                    <svg class=\"w-24 h-24 text-gray-300 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\n                    </svg>\n                    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">No results found</h2>\n                    <p class=\"text-gray-600 mb-4\">We couldn't find any products matching \"${Templates.escapeHtml(currentQuery)}\"</p>\n                    <p class=\"text-gray-500 text-sm\">Try different keywords or browse our categories</p>\n                </div>\n            `;\n            return;\n        }\n\n        const viewMode = Storage.get('productViewMode') || 'grid';\n        const gridClass = viewMode === 'list' \n            ? 'space-y-4' \n            : 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6';\n\n        container.innerHTML = `\n            <div class=\"${gridClass}\">\n                ${products.map(product => ProductCard.render(product, { layout: viewMode })).join('')}\n            </div>\n            ${meta.total_pages > 1 ? `\n                <div id=\"search-pagination\" class=\"mt-8\">${Pagination.render({\n                    currentPage: meta.current_page || currentPage,\n                    totalPages: meta.total_pages,\n                    totalItems: meta.total\n                })}</div>\n            ` : ''}\n        `;\n\n        ProductCard.bindEvents(container);\n\n        const paginationContainer = document.getElementById('search-pagination');\n        paginationContainer?.addEventListener('click', (e) => {\n            const pageBtn = e.target.closest('[data-page]');\n            if (pageBtn) {\n                currentPage = parseInt(pageBtn.dataset.page);\n                updateUrl();\n                performSearch();\n                window.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n        });\n    }\n\n    async function loadFilterOptions() {\n        const categoriesContainer = document.getElementById('filter-categories');\n        if (!categoriesContainer) return;\n\n        try {\n            const response = await CategoriesAPI.getAll({ has_products: true, limit: 20 });\n            const categories = response.data || [];\n\n            categoriesContainer.innerHTML = `\n                <div class=\"space-y-2\">\n                    <label class=\"flex items-center\">\n                        <input type=\"radio\" name=\"category\" value=\"\" ${!currentFilters.category ? 'checked' : ''} class=\"text-primary-600 focus:ring-primary-500\">\n                        <span class=\"ml-2 text-sm text-gray-600\">All Categories</span>\n                    </label>\n                    ${categories.map(cat => `\n                        <label class=\"flex items-center\">\n                            <input type=\"radio\" name=\"category\" value=\"${cat.id}\" ${currentFilters.category === String(cat.id) ? 'checked' : ''} class=\"text-primary-600 focus:ring-primary-500\">\n                            <span class=\"ml-2 text-sm text-gray-600\">${Templates.escapeHtml(cat.name)}</span>\n                        </label>\n                    `).join('')}\n                </div>\n            `;\n\n            bindCategoryFilter();\n        } catch (error) {\n            // error logging removed\n        }\n    }\n\n    function bindCategoryFilter() {\n        const categoryRadios = document.querySelectorAll('input[name=\"category\"]');\n        categoryRadios.forEach(radio => {\n            radio.addEventListener('change', (e) => {\n                if (e.target.value) {\n                    currentFilters.category = e.target.value;\n                } else {\n                    delete currentFilters.category;\n                }\n                currentPage = 1;\n                updateUrl();\n                performSearch();\n            });\n        });\n    }\n\n    function initFilters() {\n        const applyPriceBtn = document.getElementById('apply-price-filter');\n        const inStockCheckbox = document.getElementById('filter-in-stock');\n        const clearFiltersBtn = document.getElementById('clear-filters');\n\n        applyPriceBtn?.addEventListener('click', () => {\n            const minPrice = document.getElementById('filter-min-price')?.value;\n            const maxPrice = document.getElementById('filter-max-price')?.value;\n\n            if (minPrice) currentFilters.min_price = minPrice;\n            else delete currentFilters.min_price;\n            \n            if (maxPrice) currentFilters.max_price = maxPrice;\n            else delete currentFilters.max_price;\n\n            currentPage = 1;\n            updateUrl();\n            performSearch();\n        });\n\n        inStockCheckbox?.addEventListener('change', (e) => {\n            if (e.target.checked) {\n                currentFilters.in_stock = true;\n            } else {\n                delete currentFilters.in_stock;\n            }\n            currentPage = 1;\n            updateUrl();\n            performSearch();\n        });\n\n        clearFiltersBtn?.addEventListener('click', () => {\n            currentFilters = {};\n            currentPage = 1;\n            \n            document.querySelectorAll('input[name=\"category\"]').forEach(r => {\n                r.checked = r.value === '';\n            });\n            \n            const minInput = document.getElementById('filter-min-price');\n            const maxInput = document.getElementById('filter-max-price');\n            if (minInput) minInput.value = '';\n            if (maxInput) maxInput.value = '';\n            \n            if (inStockCheckbox) inStockCheckbox.checked = false;\n\n            updateUrl();\n            performSearch();\n        });\n\n        // Initialize filter values\n        const minInput = document.getElementById('filter-min-price');\n        const maxInput = document.getElementById('filter-max-price');\n        if (minInput && currentFilters.min_price) minInput.value = currentFilters.min_price;\n        if (maxInput && currentFilters.max_price) maxInput.value = currentFilters.max_price;\n        if (inStockCheckbox && currentFilters.in_stock) inStockCheckbox.checked = true;\n    }\n\n    function initSorting() {\n        const sortSelect = document.getElementById('sort-select');\n        if (!sortSelect) return;\n\n        sortSelect.value = currentFilters.ordering || '';\n\n        sortSelect.addEventListener('change', (e) => {\n            if (e.target.value) {\n                currentFilters.ordering = e.target.value;\n            } else {\n                delete currentFilters.ordering;\n            }\n            currentPage = 1;\n            updateUrl();\n            performSearch();\n        });\n    }\n\n    function updateUrl() {\n        const params = new URLSearchParams();\n        \n        if (currentQuery) params.set('q', currentQuery);\n        if (currentFilters.category) params.set('category', currentFilters.category);\n        if (currentFilters.min_price) params.set('min_price', currentFilters.min_price);\n        if (currentFilters.max_price) params.set('max_price', currentFilters.max_price);\n        if (currentFilters.ordering) params.set('ordering', currentFilters.ordering);\n        if (currentFilters.in_stock) params.set('in_stock', 'true');\n        if (currentPage > 1) params.set('page', currentPage);\n\n        const newUrl = `${window.location.pathname}?${params.toString()}`;\n        window.history.pushState({}, '', newUrl);\n    }\n\n    function destroy() {\n        if (abortController) {\n            abortController.abort();\n            abortController = null;\n        }\n        currentQuery = '';\n        currentPage = 1;\n        currentFilters = {};\n        initialized = false;\n    }\n\n    return {\n        init,\n        destroy\n    };\n})();\n\nwindow.SearchPage = SearchPage;\nexport default SearchPage;\n", "/**\r\n * Wishlist Page - Comprehensive Version\r\n * @module pages/wishlist\r\n * Features: Priority levels, price tracking, reminders, target prices, bulk operations\r\n */\r\n\r\nconst WishlistPage = (function() {\r\n    'use strict';\r\n\r\n    let currentPage = 1;\r\n    let currentSort = 'added_desc';\r\n    let currentFilter = 'all';\r\n\r\n    // Get currency configuration dynamically\r\n    function getCurrencySymbol() {\r\n        return window.BUNORAA_CURRENCY?.symbol || '\u09F3';\r\n    }\r\n\r\n    // Configuration\r\n    const CONFIG = {\r\n        get CURRENCY_SYMBOL() { return getCurrencySymbol(); },\r\n        PRIORITY_LEVELS: {\r\n            low: { label: 'Low', color: 'gray', icon: '\u25CB' },\r\n            normal: { label: 'Normal', color: 'blue', icon: '\u25D0' },\r\n            high: { label: 'High', color: 'amber', icon: '\u25CF' },\r\n            urgent: { label: 'Urgent', color: 'red', icon: '\u2605' }\r\n        }\r\n    };\r\n\r\n    async function init() {\r\n        if (!AuthGuard.protectPage()) return;\r\n\r\n        await loadWishlist();\r\n        bindGlobalEvents();\r\n    }\r\n\r\n    function resolveProductImage(item = {}) {\r\n        const product = item.product || item || {};\r\n        const candidates = [\r\n            item.product_image,\r\n            product.product_image,\r\n            product.primary_image,\r\n            product.image,\r\n            Array.isArray(product.images) ? product.images[0] : null,\r\n            product.image_url,\r\n            product.thumbnail\r\n        ];\r\n\r\n        const pick = (val) => {\r\n            if (!val) return '';\r\n            if (typeof val === 'string') return val;\r\n            if (typeof val === 'object') {\r\n                if (typeof val.image === 'string' && val.image) return val.image;\r\n                if (val.image && typeof val.image === 'object') {\r\n                    if (typeof val.image.url === 'string' && val.image.url) return val.image.url;\r\n                    if (typeof val.image.src === 'string' && val.image.src) return val.image.src;\r\n                }\r\n                if (typeof val.url === 'string' && val.url) return val.url;\r\n                if (typeof val.src === 'string' && val.src) return val.src;\r\n            }\r\n            return '';\r\n        };\r\n\r\n        for (const candidate of candidates) {\r\n            const url = pick(candidate);\r\n            if (url) return url;\r\n        }\r\n\r\n        return '';\r\n    }\r\n\r\n    function resolvePrices(item = {}) {\r\n        const product = item.product || item || {};\r\n        \r\n        const pickNumber = (val) => {\r\n            if (val === null || val === undefined) return null;\r\n            const num = Number(val);\r\n            return Number.isFinite(num) ? num : null;\r\n        };\r\n\r\n        const priceCandidates = [\r\n            item.product_price,\r\n            product.price,\r\n            item.price,\r\n            item.current_price,\r\n            item.price_at_add\r\n        ];\r\n        \r\n        let price = null;\r\n        for (const p of priceCandidates) {\r\n            price = pickNumber(p);\r\n            if (price !== null) break;\r\n        }\r\n\r\n        const saleCandidates = [\r\n            item.product_sale_price,\r\n            product.sale_price,\r\n            item.sale_price\r\n        ];\r\n        \r\n        let salePrice = null;\r\n        for (const s of saleCandidates) {\r\n            salePrice = pickNumber(s);\r\n            if (salePrice !== null) break;\r\n        }\r\n\r\n        // Price tracking\r\n        const lowestPrice = pickNumber(item.lowest_price_seen);\r\n        const highestPrice = pickNumber(item.highest_price_seen);\r\n        const targetPrice = pickNumber(item.target_price);\r\n        const priceAtAdd = pickNumber(item.price_at_add);\r\n\r\n        return {\r\n            price: price !== null ? price : 0,\r\n            salePrice: salePrice !== null ? salePrice : null,\r\n            lowestPrice,\r\n            highestPrice,\r\n            targetPrice,\r\n            priceAtAdd\r\n        };\r\n    }\r\n\r\n    async function loadWishlist() {\r\n        const container = document.getElementById('wishlist-container');\r\n        if (!container) return;\r\n\r\n        Loader.show(container, 'skeleton');\r\n\r\n        try {\r\n            const response = await WishlistApi.getWishlist({ page: currentPage, sort: currentSort });\r\n            let items = [];\r\n            let meta = {};\r\n\r\n            if (Array.isArray(response)) {\r\n                items = response;\r\n            } else if (response && typeof response === 'object') {\r\n                items = response.data || response.results || response.items || [];\r\n                if (!Array.isArray(items) && response.data && typeof response.data === 'object') {\r\n                    items = response.data.items || response.data.results || [];\r\n                    meta = response.data.meta || response.meta || {};\r\n                } else {\r\n                    meta = response.meta || {};\r\n                }\r\n            }\r\n\r\n            if (!Array.isArray(items)) {\r\n                items = items && typeof items === 'object' ? [items] : [];\r\n            }\r\n\r\n            // Apply client-side filter\r\n            let filteredItems = items;\r\n            if (currentFilter === 'on_sale') {\r\n                filteredItems = items.filter(item => {\r\n                    const prices = resolvePrices(item);\r\n                    return prices.salePrice && prices.salePrice < prices.price;\r\n                });\r\n            } else if (currentFilter === 'in_stock') {\r\n                filteredItems = items.filter(item => item.is_in_stock !== false);\r\n            } else if (currentFilter === 'price_drop') {\r\n                filteredItems = items.filter(item => {\r\n                    const prices = resolvePrices(item);\r\n                    return prices.priceAtAdd && prices.price < prices.priceAtAdd;\r\n                });\r\n            } else if (currentFilter === 'at_target') {\r\n                filteredItems = items.filter(item => {\r\n                    const prices = resolvePrices(item);\r\n                    return prices.targetPrice && prices.price <= prices.targetPrice;\r\n                });\r\n            }\r\n\r\n            renderWishlist(filteredItems, items, meta);\r\n        } catch (error) {\r\n            const msg = (error && (error.message || error.detail)) || 'Failed to load wishlist.';\r\n\r\n            if (error && error.status === 401) {\r\n                AuthGuard.redirectToLogin();\r\n                return;\r\n            }\r\n\r\n            container.innerHTML = `<p class=\"text-red-500 text-center py-8\">${Templates.escapeHtml(msg)}</p>`;\r\n        }\r\n    }\r\n\r\n    function renderWishlist(filteredItems, allItems, meta) {\r\n        const container = document.getElementById('wishlist-container');\r\n        if (!container) return;\r\n\r\n        // Calculate stats\r\n        const totalItems = allItems.length;\r\n        const onSaleCount = allItems.filter(item => {\r\n            const p = resolvePrices(item);\r\n            return p.salePrice && p.salePrice < p.price;\r\n        }).length;\r\n        const priceDropCount = allItems.filter(item => {\r\n            const p = resolvePrices(item);\r\n            return p.priceAtAdd && p.price < p.priceAtAdd;\r\n        }).length;\r\n        const atTargetCount = allItems.filter(item => {\r\n            const p = resolvePrices(item);\r\n            return p.targetPrice && p.price <= p.targetPrice;\r\n        }).length;\r\n\r\n        if (totalItems === 0) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-16\">\r\n                    <svg class=\"w-24 h-24 text-gray-300 mx-auto mb-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\r\n                    </svg>\r\n                    <h2 class=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Your wishlist is empty</h2>\r\n                    <p class=\"text-gray-600 dark:text-gray-400 mb-8\">Start adding items you love to your wishlist.</p>\r\n                    <a href=\"/products/\" class=\"inline-flex items-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors\">\r\n                        Browse Products\r\n                    </a>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <!-- Header with Stats -->\r\n            <div class=\"mb-6\">\r\n                <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n                    <div>\r\n                        <h1 class=\"text-2xl font-bold text-gray-900 dark:text-white\">My Wishlist</h1>\r\n                        <p class=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">${totalItems} items saved</p>\r\n                    </div>\r\n                    <div class=\"flex flex-wrap gap-2\">\r\n                        <button id=\"add-all-to-cart-btn\" class=\"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors flex items-center\">\r\n                            <svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n                            </svg>\r\n                            Add All to Cart\r\n                        </button>\r\n                        <button id=\"share-wishlist-btn\" class=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center\">\r\n                            <svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z\"></path>\r\n                            </svg>\r\n                            Share\r\n                        </button>\r\n                        <button id=\"clear-wishlist-btn\" class=\"px-4 py-2 text-red-600 dark:text-red-400 text-sm font-medium hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\">\r\n                            Clear All\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                \r\n                <!-- Quick Stats -->\r\n                <div class=\"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                    <div class=\"bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700\">\r\n                        <div class=\"text-2xl font-bold text-gray-900 dark:text-white\">${totalItems}</div>\r\n                        <div class=\"text-xs text-gray-500 dark:text-gray-400\">Total Items</div>\r\n                    </div>\r\n                    <div class=\"bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700 ${onSaleCount > 0 ? 'ring-2 ring-green-500' : ''}\">\r\n                        <div class=\"text-2xl font-bold text-green-600 dark:text-green-400\">${onSaleCount}</div>\r\n                        <div class=\"text-xs text-gray-500 dark:text-gray-400\">On Sale</div>\r\n                    </div>\r\n                    <div class=\"bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700 ${priceDropCount > 0 ? 'ring-2 ring-blue-500' : ''}\">\r\n                        <div class=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">${priceDropCount}</div>\r\n                        <div class=\"text-xs text-gray-500 dark:text-gray-400\">Price Dropped</div>\r\n                    </div>\r\n                    <div class=\"bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-200 dark:border-gray-700 ${atTargetCount > 0 ? 'ring-2 ring-amber-500' : ''}\">\r\n                        <div class=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">${atTargetCount}</div>\r\n                        <div class=\"text-xs text-gray-500 dark:text-gray-400\">At Target Price</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Filters and Sort -->\r\n            <div class=\"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n                <div class=\"flex flex-wrap gap-2\">\r\n                    <button class=\"filter-btn px-3 py-1.5 text-sm rounded-lg transition-colors ${currentFilter === 'all' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}\" data-filter=\"all\">All</button>\r\n                    <button class=\"filter-btn px-3 py-1.5 text-sm rounded-lg transition-colors ${currentFilter === 'on_sale' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}\" data-filter=\"on_sale\">On Sale</button>\r\n                    <button class=\"filter-btn px-3 py-1.5 text-sm rounded-lg transition-colors ${currentFilter === 'in_stock' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}\" data-filter=\"in_stock\">In Stock</button>\r\n                    <button class=\"filter-btn px-3 py-1.5 text-sm rounded-lg transition-colors ${currentFilter === 'price_drop' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}\" data-filter=\"price_drop\">Price Drop</button>\r\n                    <button class=\"filter-btn px-3 py-1.5 text-sm rounded-lg transition-colors ${currentFilter === 'at_target' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}\" data-filter=\"at_target\">At Target</button>\r\n                </div>\r\n                <div class=\"flex items-center gap-2\">\r\n                    <label class=\"text-sm text-gray-500 dark:text-gray-400\">Sort:</label>\r\n                    <select id=\"wishlist-sort\" class=\"text-sm border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 focus:ring-primary-500 focus:border-primary-500\">\r\n                        <option value=\"added_desc\" ${currentSort === 'added_desc' ? 'selected' : ''}>Newest First</option>\r\n                        <option value=\"added_asc\" ${currentSort === 'added_asc' ? 'selected' : ''}>Oldest First</option>\r\n                        <option value=\"price_asc\" ${currentSort === 'price_asc' ? 'selected' : ''}>Price: Low to High</option>\r\n                        <option value=\"price_desc\" ${currentSort === 'price_desc' ? 'selected' : ''}>Price: High to Low</option>\r\n                        <option value=\"priority\" ${currentSort === 'priority' ? 'selected' : ''}>Priority</option>\r\n                        <option value=\"name\" ${currentSort === 'name' ? 'selected' : ''}>Name A-Z</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Items Grid -->\r\n            <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n                ${filteredItems.map(item => renderWishlistItem(item)).join('')}\r\n            </div>\r\n            \r\n            ${filteredItems.length === 0 && totalItems > 0 ? `\r\n                <div class=\"text-center py-12\">\r\n                    <p class=\"text-gray-500 dark:text-gray-400\">No items match the selected filter.</p>\r\n                    <button class=\"mt-4 text-primary-600 hover:underline\" onclick=\"document.querySelector('[data-filter=all]').click()\">Show all items</button>\r\n                </div>\r\n            ` : ''}\r\n            \r\n            ${meta.total_pages > 1 ? `<div id=\"wishlist-pagination\" class=\"mt-8\"></div>` : ''}\r\n        `;\r\n\r\n        // Mount pagination\r\n        if (meta && meta.total_pages > 1) {\r\n            const mount = document.getElementById('wishlist-pagination');\r\n            if (mount && window.Pagination) {\r\n                const paginator = new window.Pagination({\r\n                    totalPages: meta.total_pages,\r\n                    currentPage: meta.current_page || currentPage,\r\n                    className: 'justify-center',\r\n                    onChange: (page) => {\r\n                        currentPage = page;\r\n                        loadWishlist();\r\n                        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n                    }\r\n                });\r\n                mount.innerHTML = '';\r\n                mount.appendChild(paginator.create());\r\n            }\r\n        }\r\n\r\n        bindEvents();\r\n    }\r\n\r\n    function renderWishlistItem(item) {\r\n        try {\r\n            const product = item.product || item || {};\r\n            const productName = item.product_name || product.name || '';\r\n            const productSlug = item.product_slug || product.slug || '';\r\n            const inStock = item.is_in_stock !== undefined ? item.is_in_stock : (product.is_in_stock !== undefined ? product.is_in_stock : (product.stock_quantity > 0));\r\n            const imageUrl = resolveProductImage(item || {});\r\n            const requiresVariants = !!item.product_has_variants;\r\n\r\n            let priceObj = { price: 0, salePrice: null, lowestPrice: null, highestPrice: null, targetPrice: null, priceAtAdd: null };\r\n            try { priceObj = resolvePrices(item || {}); } catch { priceObj = { price: 0, salePrice: null }; }\r\n            const { price, salePrice, lowestPrice, highestPrice, targetPrice, priceAtAdd } = priceObj;\r\n            \r\n            // Calculate price change\r\n            const currentPrice = salePrice || price;\r\n            const hasPriceDrop = priceAtAdd && currentPrice < priceAtAdd;\r\n            const priceChangePercent = priceAtAdd ? Math.round(((currentPrice - priceAtAdd) / priceAtAdd) * 100) : 0;\r\n            const isAtTarget = targetPrice && currentPrice <= targetPrice;\r\n            const isOnSale = salePrice && salePrice < price;\r\n            \r\n            // Priority\r\n            const priority = item.priority || 'normal';\r\n            const priorityConfig = CONFIG.PRIORITY_LEVELS[priority] || CONFIG.PRIORITY_LEVELS.normal;\r\n\r\n            const safeEscape = (s) => {\r\n                try { return Templates.escapeHtml(s || ''); } catch { return String(s || ''); }\r\n            };\r\n\r\n            const safePriceRender = (p) => {\r\n                try { return Price.render({ price: p.price, salePrice: p.salePrice }); } catch { return `<span class=\"font-bold\">${CONFIG.CURRENCY_SYMBOL}${p.price || 0}</span>`; }\r\n            };\r\n\r\n            const formatPrice = (p) => {\r\n                try { return Templates.formatPrice(p); } catch { return `${CONFIG.CURRENCY_SYMBOL}${p}`; }\r\n            };\r\n\r\n            const aspectCss = (product && product.aspect && (product.aspect.css || (product.aspect.width && product.aspect.height ? `${product.aspect.width}/${product.aspect.height}` : null))) || '1/1';\r\n\r\n            return `\r\n                <div class=\"wishlist-item relative bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden group\" \r\n                     data-item-id=\"${item && item.id ? item.id : ''}\" \r\n                     data-product-id=\"${(product && product.id) ? product.id : (item && item.product) ? item.product : ''}\" \r\n                     data-product-slug=\"${safeEscape(productSlug)}\" \r\n                     data-product-has-variants=\"${requiresVariants}\"\r\n                     data-priority=\"${priority}\">\r\n                    \r\n                    <!-- Image Section -->\r\n                    <div class=\"relative\" style=\"aspect-ratio: ${aspectCss};\">\r\n                        <!-- Badges -->\r\n                        <div class=\"absolute top-2 left-2 z-10 flex flex-col gap-1\">\r\n                            ${isOnSale ? `\r\n                                <div class=\"bg-red-500 text-white text-xs font-bold px-2 py-1 rounded\">\r\n                                    -${Math.round((1 - salePrice / price) * 100)}%\r\n                                </div>\r\n                            ` : ''}\r\n                            ${hasPriceDrop ? `\r\n                                <div class=\"bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded flex items-center\">\r\n                                    <svg class=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"></path>\r\n                                    </svg>\r\n                                    ${Math.abs(priceChangePercent)}% drop\r\n                                </div>\r\n                            ` : ''}\r\n                            ${isAtTarget ? `\r\n                                <div class=\"bg-amber-500 text-white text-xs font-bold px-2 py-1 rounded flex items-center\">\r\n                                    <svg class=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                        <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"></path>\r\n                                    </svg>\r\n                                    Target!\r\n                                </div>\r\n                            ` : ''}\r\n                            ${!inStock ? `\r\n                                <div class=\"bg-gray-800 text-white text-xs font-bold px-2 py-1 rounded\">\r\n                                    Out of Stock\r\n                                </div>\r\n                            ` : ''}\r\n                        </div>\r\n                        \r\n                        <!-- Priority Indicator -->\r\n                        <div class=\"absolute top-2 right-12 z-10\">\r\n                            <button class=\"priority-btn w-8 h-8 rounded-full bg-white dark:bg-gray-700 shadow-md flex items-center justify-center text-${priorityConfig.color}-500 hover:scale-110 transition-transform\" title=\"Priority: ${priorityConfig.label}\" data-item-id=\"${item.id}\">\r\n                                <span class=\"text-sm\">${priorityConfig.icon}</span>\r\n                            </button>\r\n                        </div>\r\n                        \r\n                        <!-- Remove Button -->\r\n                        <button class=\"remove-btn absolute top-2 right-2 z-20 w-8 h-8 bg-gray-900/80 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100\" aria-label=\"Remove from wishlist\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n                            </svg>\r\n                        </button>\r\n                        \r\n                        <!-- Product Image -->\r\n                        <a href=\"/products/${safeEscape(productSlug)}/\">\r\n                            ${imageUrl ? `\r\n                                <img \r\n                                    src=\"${imageUrl}\" \r\n                                    alt=\"${safeEscape(productName)}\"\r\n                                    class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n                                    loading=\"lazy\"\r\n                                >\r\n                            ` : `\r\n                                <div class=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-400 dark:text-gray-500 text-xs uppercase tracking-wide\">No Image</div>\r\n                            `}\r\n                        </a>\r\n                    </div>\r\n                    \r\n                    <!-- Content Section -->\r\n                    <div class=\"p-4\">\r\n                        ${product && product.category ? `\r\n                            <a href=\"/categories/${safeEscape(product.category.slug)}/\" class=\"text-xs text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400\">\r\n                                ${safeEscape(product.category.name)}\r\n                            </a>\r\n                        ` : ''}\r\n                        <h3 class=\"font-medium text-gray-900 dark:text-white mt-1 line-clamp-2\">\r\n                            <a href=\"/products/${safeEscape(productSlug)}/\" class=\"hover:text-primary-600 dark:hover:text-primary-400\">\r\n                                ${safeEscape(productName)}\r\n                            </a>\r\n                        </h3>\r\n                        \r\n                        <!-- Price Section -->\r\n                        <div class=\"mt-2\">\r\n                            ${safePriceRender({ price, salePrice })}\r\n                        </div>\r\n                        \r\n                        <!-- Price History -->\r\n                        ${lowestPrice || targetPrice ? `\r\n                            <div class=\"mt-2 text-xs space-y-1\">\r\n                                ${lowestPrice ? `\r\n                                    <div class=\"flex items-center justify-between text-gray-500 dark:text-gray-400\">\r\n                                        <span>Lowest:</span>\r\n                                        <span class=\"font-medium text-green-600 dark:text-green-400\">${formatPrice(lowestPrice)}</span>\r\n                                    </div>\r\n                                ` : ''}\r\n                                ${targetPrice ? `\r\n                                    <div class=\"flex items-center justify-between text-gray-500 dark:text-gray-400\">\r\n                                        <span>Target:</span>\r\n                                        <span class=\"font-medium text-amber-600 dark:text-amber-400\">${formatPrice(targetPrice)}</span>\r\n                                    </div>\r\n                                ` : ''}\r\n                            </div>\r\n                        ` : ''}\r\n                        \r\n                        <!-- Rating -->\r\n                        ${product && product.average_rating ? `\r\n                            <div class=\"flex items-center gap-1 mt-2\">\r\n                                ${Templates.renderStars(product.average_rating)}\r\n                                <span class=\"text-xs text-gray-500 dark:text-gray-400\">(${product.review_count || 0})</span>\r\n                            </div>\r\n                        ` : ''}\r\n                        \r\n                        <!-- Actions -->\r\n                        <div class=\"mt-4 flex gap-2\">\r\n                            <button \r\n                                class=\"add-to-cart-btn flex-1 px-3 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm flex items-center justify-center\"\r\n                                ${!inStock ? 'disabled' : ''}\r\n                            >\r\n                                <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n                                </svg>\r\n                                ${requiresVariants ? 'Options' : (inStock ? 'Add' : 'Sold Out')}\r\n                            </button>\r\n                            <button class=\"set-target-btn px-3 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm\" title=\"Set target price\" data-item-id=\"${item.id}\" data-current-price=\"${currentPrice}\">\r\n                                <svg class=\"w-4 h-4\" fill=\"${targetPrice ? 'currentColor' : 'none'}\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"></path>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <!-- Added Date -->\r\n                    ${item && item.added_at ? `\r\n                        <div class=\"px-4 pb-3 border-t border-gray-100 dark:border-gray-700 pt-3\">\r\n                            <p class=\"text-xs text-gray-400 dark:text-gray-500\">Added ${Templates.formatDate(item.added_at)}</p>\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n            `;\r\n        } catch (err) {\r\n            console.error('Failed to render wishlist item:', err);\r\n            return '<div class=\"p-4 bg-white dark:bg-gray-800 rounded shadow text-gray-500 dark:text-gray-400\">Failed to render item</div>';\r\n        }\r\n    }\r\n\r\n    function bindGlobalEvents() {\r\n        // Sort change\r\n        document.getElementById('wishlist-sort')?.addEventListener('change', (e) => {\r\n            currentSort = e.target.value;\r\n            loadWishlist();\r\n        });\r\n\r\n        // Filter buttons\r\n        document.querySelectorAll('.filter-btn').forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                currentFilter = btn.dataset.filter;\r\n                loadWishlist();\r\n            });\r\n        });\r\n    }\r\n\r\n    function bindEvents() {\r\n        const clearAllBtn = document.getElementById('clear-wishlist-btn');\r\n        const addAllBtn = document.getElementById('add-all-to-cart-btn');\r\n        const shareBtn = document.getElementById('share-wishlist-btn');\r\n        const wishlistItems = document.querySelectorAll('.wishlist-item');\r\n        const sortSelect = document.getElementById('wishlist-sort');\r\n        const filterBtns = document.querySelectorAll('.filter-btn');\r\n\r\n        // Sort change\r\n        sortSelect?.addEventListener('change', (e) => {\r\n            currentSort = e.target.value;\r\n            loadWishlist();\r\n        });\r\n\r\n        // Filter buttons\r\n        filterBtns.forEach(btn => {\r\n            btn.addEventListener('click', () => {\r\n                currentFilter = btn.dataset.filter;\r\n                loadWishlist();\r\n            });\r\n        });\r\n\r\n        // Clear all\r\n        clearAllBtn?.addEventListener('click', async () => {\r\n            const confirmed = await Modal.confirm({\r\n                title: 'Clear Wishlist',\r\n                message: 'Are you sure you want to remove all items from your wishlist?',\r\n                confirmText: 'Clear All',\r\n                cancelText: 'Cancel'\r\n            });\r\n\r\n            if (confirmed) {\r\n                try {\r\n                    await WishlistApi.clear();\r\n                    Toast.success('Wishlist cleared.');\r\n                    await loadWishlist();\r\n                } catch (error) {\r\n                    Toast.error(error.message || 'Failed to clear wishlist.');\r\n                }\r\n            }\r\n        });\r\n\r\n        // Add all to cart\r\n        addAllBtn?.addEventListener('click', async () => {\r\n            const btn = addAllBtn;\r\n            btn.disabled = true;\r\n            btn.innerHTML = '<svg class=\"animate-spin w-4 h-4 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>Adding...';\r\n            \r\n            try {\r\n                // Get all items without variants\r\n                const items = document.querySelectorAll('.wishlist-item:not([data-product-has-variants=\"true\"])');\r\n                let added = 0;\r\n                let failed = 0;\r\n                \r\n                for (const item of items) {\r\n                    const productId = item.dataset.productId;\r\n                    if (!productId) continue;\r\n                    \r\n                    try {\r\n                        await CartApi.addItem(productId, 1);\r\n                        added++;\r\n                    } catch (err) {\r\n                        failed++;\r\n                    }\r\n                }\r\n                \r\n                if (added > 0) {\r\n                    Toast.success(`Added ${added} items to cart!`);\r\n                    document.dispatchEvent(new CustomEvent('cart:updated'));\r\n                }\r\n                if (failed > 0) {\r\n                    Toast.warning(`${failed} items could not be added (may require variant selection).`);\r\n                }\r\n            } catch (error) {\r\n                Toast.error(error.message || 'Failed to add items to cart.');\r\n            } finally {\r\n                btn.disabled = false;\r\n                btn.innerHTML = '<svg class=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"></path></svg>Add All to Cart';\r\n            }\r\n        });\r\n\r\n        // Share wishlist\r\n        shareBtn?.addEventListener('click', async () => {\r\n            try {\r\n                const shareUrl = `${window.location.origin}/wishlist/share/`;\r\n                \r\n                if (navigator.share) {\r\n                    await navigator.share({\r\n                        title: 'My Wishlist',\r\n                        text: 'Check out my wishlist!',\r\n                        url: shareUrl\r\n                    });\r\n                } else {\r\n                    await navigator.clipboard.writeText(shareUrl);\r\n                    Toast.success('Wishlist link copied to clipboard!');\r\n                }\r\n            } catch (error) {\r\n                if (error.name !== 'AbortError') {\r\n                    Toast.error('Failed to share wishlist.');\r\n                }\r\n            }\r\n        });\r\n\r\n        // Item-specific events\r\n        wishlistItems.forEach(item => {\r\n            const itemId = item.dataset.itemId;\r\n            const productId = item.dataset.productId;\r\n            const productSlug = item.dataset.productSlug;\r\n\r\n            // Remove button\r\n            item.querySelector('.remove-btn')?.addEventListener('click', async () => {\r\n                try {\r\n                    await WishlistApi.removeItem(itemId);\r\n                    Toast.success('Removed from wishlist.');\r\n                    item.remove();\r\n\r\n                    const remaining = document.querySelectorAll('.wishlist-item');\r\n                    if (remaining.length === 0) {\r\n                        await loadWishlist();\r\n                    }\r\n                } catch (error) {\r\n                    Toast.error(error.message || 'Failed to remove item.');\r\n                }\r\n            });\r\n\r\n            // Priority button\r\n            item.querySelector('.priority-btn')?.addEventListener('click', async () => {\r\n                const priorities = ['low', 'normal', 'high', 'urgent'];\r\n                const currentPriority = item.dataset.priority || 'normal';\r\n                const currentIndex = priorities.indexOf(currentPriority);\r\n                const nextPriority = priorities[(currentIndex + 1) % priorities.length];\r\n                \r\n                try {\r\n                    // Update via API if available\r\n                    if (WishlistApi.updateItem) {\r\n                        await WishlistApi.updateItem(itemId, { priority: nextPriority });\r\n                    }\r\n                    \r\n                    // Update UI\r\n                    item.dataset.priority = nextPriority;\r\n                    const btn = item.querySelector('.priority-btn');\r\n                    const config = CONFIG.PRIORITY_LEVELS[nextPriority];\r\n                    btn.title = `Priority: ${config.label}`;\r\n                    btn.innerHTML = `<span class=\"text-sm\">${config.icon}</span>`;\r\n                    btn.className = `priority-btn w-8 h-8 rounded-full bg-white dark:bg-gray-700 shadow-md flex items-center justify-center text-${config.color}-500 hover:scale-110 transition-transform`;\r\n                    \r\n                    Toast.success(`Priority set to ${config.label}`);\r\n                } catch (error) {\r\n                    Toast.error('Failed to update priority.');\r\n                }\r\n            });\r\n\r\n            // Set target price button\r\n            item.querySelector('.set-target-btn')?.addEventListener('click', async () => {\r\n                const currentPrice = parseFloat(item.querySelector('.set-target-btn').dataset.currentPrice) || 0;\r\n                \r\n                const content = `\r\n                    <div class=\"space-y-4\">\r\n                        <p class=\"text-sm text-gray-600 dark:text-gray-400\">Set a target price and we'll notify you when the item drops to or below this price.</p>\r\n                        <div>\r\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Current Price</label>\r\n                            <div class=\"text-lg font-bold text-gray-900 dark:text-white\">${CONFIG.CURRENCY_SYMBOL}${currentPrice.toLocaleString()}</div>\r\n                        </div>\r\n                        <div>\r\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Target Price</label>\r\n                            <div class=\"flex items-center\">\r\n                                <span class=\"text-gray-500 mr-2\">${CONFIG.CURRENCY_SYMBOL}</span>\r\n                                <input type=\"number\" id=\"target-price-input\" value=\"${Math.round(currentPrice * 0.9)}\" min=\"1\" max=\"${currentPrice}\" class=\"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-primary-500 focus:border-primary-500\">\r\n                            </div>\r\n                            <p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">Suggested: ${CONFIG.CURRENCY_SYMBOL}${Math.round(currentPrice * 0.9).toLocaleString()} (10% off)</p>\r\n                        </div>\r\n                    </div>\r\n                `;\r\n                \r\n                const confirmed = await Modal.open({\r\n                    title: 'Set Target Price',\r\n                    content,\r\n                    confirmText: 'Set Alert',\r\n                    cancelText: 'Cancel',\r\n                    onConfirm: async () => {\r\n                        const targetPrice = parseFloat(document.getElementById('target-price-input').value);\r\n                        \r\n                        if (!targetPrice || targetPrice <= 0) {\r\n                            Toast.error('Please enter a valid target price.');\r\n                            return false;\r\n                        }\r\n                        \r\n                        try {\r\n                            if (WishlistApi.updateItem) {\r\n                                await WishlistApi.updateItem(itemId, { target_price: targetPrice });\r\n                            }\r\n                            Toast.success(`Price alert set for ${CONFIG.CURRENCY_SYMBOL}${targetPrice.toLocaleString()}`);\r\n                            await loadWishlist();\r\n                            return true;\r\n                        } catch (error) {\r\n                            Toast.error('Failed to set price alert.');\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            // Add to cart button\r\n            item.querySelector('.add-to-cart-btn')?.addEventListener('click', async (e) => {\r\n                const btn = e.target.closest('.add-to-cart-btn');\r\n                if (btn.disabled) return;\r\n\r\n                btn.disabled = true;\r\n                const originalText = btn.innerHTML;\r\n                btn.innerHTML = '<svg class=\"animate-spin w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\r\n\r\n                const requiresVariants = item.dataset.productHasVariants === 'true' || item.dataset.productHasVariants === 'True' || item.dataset.productHasVariants === '1';\r\n\r\n                if (requiresVariants) {\r\n                    showVariantPicker(item);\r\n                    btn.disabled = false;\r\n                    btn.innerHTML = originalText;\r\n                    return;\r\n                }\r\n\r\n                try {\r\n                    await CartApi.addItem(productId, 1);\r\n                    Toast.success('Added to cart!');\r\n                    document.dispatchEvent(new CustomEvent('cart:updated'));\r\n                } catch (error) {\r\n                    const hasVariantError = Boolean(\r\n                        error && (\r\n                            (error.errors && error.errors.variant_id) ||\r\n                            (error.message && typeof error.message === 'string' && error.message.toLowerCase().includes('variant'))\r\n                        )\r\n                    );\r\n\r\n                    if (hasVariantError) {\r\n                        Toast.info('This product requires selecting a variant.');\r\n                        if (productSlug) {\r\n                            window.location.href = `/products/${productSlug}/`;\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    Toast.error(error.message || 'Failed to add to cart.');\r\n                } finally {\r\n                    btn.disabled = false;\r\n                    btn.innerHTML = originalText;\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    function renderModalVariants(variants) {\r\n        const grouped = {};\r\n        variants.forEach(variant => {\r\n            if (!grouped[variant.attribute_name]) grouped[variant.attribute_name] = [];\r\n            grouped[variant.attribute_name].push(variant);\r\n        });\r\n\r\n        return Object.entries(grouped).map(([attrName, options]) => `\r\n            <div class=\"mt-4\">\r\n                <label class=\"text-sm font-medium text-gray-700\">${Templates.escapeHtml(attrName)}:</label>\r\n                <div class=\"flex flex-wrap gap-2 mt-2\" id=\"wishlist-variant-group-${Templates.slugify(attrName)}\">\r\n                    ${options.map((opt, index) => `\r\n                        <button type=\"button\" class=\"wishlist-modal-variant-btn px-3 py-2 border rounded-lg text-sm transition-colors ${index === 0 ? 'border-primary-500 bg-primary-50 text-primary-700' : 'border-gray-300 hover:border-gray-400'}\" data-variant-id=\"${opt.id}\" data-price=\"${opt.price_converted ?? opt.price ?? ''}\" data-stock=\"${opt.stock_quantity || 0}\">\r\n                            ${Templates.escapeHtml(opt.value)}\r\n                            ${(opt.price_converted ?? opt.price) ? `<span class=\"text-xs text-gray-500\"> (${Templates.formatPrice(opt.price_converted ?? opt.price)})</span>` : ''}\r\n                        </button>\r\n                    `).join('')}\r\n                </div>\r\n            </div>\r\n        `).join('');\r\n    }\r\n\r\n    async function showVariantPicker(item) {\r\n        // item: wishlist item object or DOM element dataset; prefer slug\r\n        const slug = item.product_slug || item.dataset?.productSlug || '';\r\n        const id = item.product || item.dataset?.productId || '';\r\n\r\n        try {\r\n            // Support environments where ProductsApi may not be available (fallback to ApiClient)\r\n            let res;\r\n            if (typeof ProductsApi !== 'undefined' && ProductsApi.getProduct) {\r\n                res = await ProductsApi.getProduct(slug || id);\r\n            } else {\r\n                const currency = (window.BUNORAA_CURRENCY && window.BUNORAA_CURRENCY.code) || undefined;\r\n                res = await ApiClient.get(`/catalog/products/${slug || id}/`, { currency });\r\n            }\r\n\r\n            if (!res || !res.success || !res.data) {\r\n                const msg = res && res.message ? res.message : 'Failed to load product variants.';\r\n                Toast.error(msg);\r\n                return;\r\n            }\r\n\r\n            const product = res.data;\r\n            const variants = product.variants || [];\r\n            if (!variants.length) {\r\n                // fallback to product page\r\n                window.location.href = `/products/${product.slug || slug || id}/`;\r\n                return;\r\n            }\r\n\r\n            const firstImage = product.images?.[0]?.image || product.primary_image || product.image || '';\r\n\r\n            const content = `\r\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div class=\"col-span-1\">\r\n                        ${firstImage ? `<img src=\"${firstImage}\" class=\"w-full h-48 object-cover rounded\" alt=\"${Templates.escapeHtml(product.name)}\">` : `<div class=\"w-full h-48 bg-gray-100 rounded\"></div>`}\r\n                    </div>\r\n                    <div class=\"col-span-2\">\r\n                        <h3 class=\"text-lg font-semibold\">${Templates.escapeHtml(product.name)}</h3>\r\n                        <div id=\"wishlist-variant-price\" class=\"mt-2 text-lg font-bold\">${Templates.formatPrice(variants?.[0]?.price_converted ?? variants?.[0]?.price ?? product.price)}</div>\r\n                        <div id=\"wishlist-variant-options\" class=\"mt-4\">\r\n                            ${renderModalVariants(variants)}\r\n                        </div>\r\n                        <div class=\"mt-4 flex items-center gap-2\">\r\n                            <label class=\"text-sm text-gray-700\">Qty</label>\r\n                            <input id=\"wishlist-variant-qty\" type=\"number\" value=\"1\" min=\"1\" class=\"w-20 px-3 py-2 border rounded\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n\r\n            const confirmed = await Modal.open({\r\n                title: 'Select Variant',\r\n                content,\r\n                confirmText: 'Add to Cart',\r\n                cancelText: 'Cancel',\r\n                size: 'md',\r\n                onConfirm: async () => {\r\n                    // find selected variant\r\n                    const active = document.querySelector('.wishlist-modal-variant-btn.border-primary-500');\r\n                    const btn = active || document.querySelector('.wishlist-modal-variant-btn');\r\n                    if (!btn) {\r\n                        Toast.error('Please select a variant.');\r\n                        return false;\r\n                    }\r\n                    const variantId = btn.dataset.variantId;\r\n                    const qty = parseInt(document.getElementById('wishlist-variant-qty')?.value) || 1;\r\n\r\n                    try {\r\n                        await CartApi.addItem(product.id, qty, variantId);\r\n                        Toast.success('Added to cart!');\r\n                        document.dispatchEvent(new CustomEvent('cart:updated'));\r\n                        return true;\r\n                    } catch (err) {\r\n                        Toast.error(err.message || 'Failed to add to cart.');\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // bind variant buttons to update selection and price after modal is rendered\r\n            setTimeout(() => {\r\n                const variantBtns = document.querySelectorAll('.wishlist-modal-variant-btn');\r\n                variantBtns.forEach(btn => {\r\n                    btn.addEventListener('click', () => {\r\n                        variantBtns.forEach(b => b.classList.remove('border-primary-500', 'bg-primary-50', 'text-primary-700'));\r\n                        btn.classList.add('border-primary-500', 'bg-primary-50', 'text-primary-700');\r\n\r\n                        const price = btn.dataset.price;\r\n                        if (price !== undefined) {\r\n                            const priceEl = document.getElementById('wishlist-variant-price');\r\n                            if (priceEl) priceEl.textContent = Templates.formatPrice(price);\r\n                        }\r\n                    });\r\n                });\r\n                // preselect first variant\r\n                const first = document.querySelector('.wishlist-modal-variant-btn');\r\n                if (first) first.click();\r\n            }, 20);\r\n\r\n        } catch (error) {\r\n            Toast.error('Failed to load variants.');\r\n        }\r\n    }\r\n\r\n    function destroy() {\r\n        currentPage = 1;\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy\r\n    };\r\n})();\r\n\r\nwindow.WishlistPage = WishlistPage;\r\nexport default WishlistPage;\r\n", "/**\r\n * Bunoraa - Main Application Entry Point\r\n * @module app\r\n */\r\n\r\nimport { initLazyHydration } from './utils/lazyHydrate.js';\r\n\r\nconst App = (function() {\r\n    'use strict';\r\n\r\n    // Page controllers will be loaded on-demand via dynamic import for smaller initial bundle\r\n    const pageControllers = {};\r\n\r\n    let currentPage = null;\r\n    let currentController = null;\r\n\r\n    async function loadPageController(page) {\r\n        try {\r\n            // Dynamic import with error handling and caching\r\n            const mod = await import(/* webpackChunkName: \"page-[request]\" */ `./pages/${page}.js`);\r\n            return mod.default || mod;\r\n        } catch (e) {\r\n            console.warn(`Page controller for ${page} not found:`, e);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function init() {\r\n        detectCurrentPage();\r\n        initGlobalComponents();\r\n        initCurrentPage();\r\n        initCartBadge();\r\n        initWishlistBadge();\r\n        initGlobalEventListeners();\r\n        initMobileMenu();\r\n        initLanguageSelector();\r\n        // Currency selector disabled in single-currency mode\r\n\r\n        // Mitigate unexpected initial jumps caused by JS focusing or layout shifts.\r\n        // If the navigation is a fresh navigate (not back/forward) and there's no URL hash,\r\n        // and the page is already scrolled near the bottom on initial load, reset to top.\r\n        try {\r\n            const navEntries = performance.getEntriesByType ? performance.getEntriesByType('navigation') : [];\r\n            const nav = (navEntries && navEntries[0]) || null;\r\n            if ((nav && nav.type === 'navigate') && !window.location.hash) {\r\n                setTimeout(() => {\r\n                    const doc = document.scrollingElement || document.documentElement;\r\n                    if (!doc) return;\r\n                    const scrolled = doc.scrollTop || window.pageYOffset || 0;\r\n                    const maxScroll = Math.max(0, doc.scrollHeight - window.innerHeight);\r\n                    // If already scrolled more than half the document height or very close to bottom, reset\r\n                    if (scrolled > Math.max(100, maxScroll * 0.6)) {\r\n                        window.scrollTo({ top: 0, behavior: 'auto' });\r\n                    }\r\n                }, 60);\r\n            }\r\n        } catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n    async function initWishlistBadge() {\r\n        // Update wishlist badge on page load; sync wishlist button states. Fallback to cached value if API fails\r\n        try {\r\n            // If user is not authenticated, rely on cached/local storage value and clear active states\r\n            if (!AuthApi.isAuthenticated()) {\r\n                const raw = localStorage.getItem('wishlist');\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    WishlistApi.updateBadge(parsed);\r\n                    const items = parsed.items || (parsed.data && parsed.data.items) || [];\r\n                    syncWishlistButtons(items);\r\n                } else {\r\n                    // Clear any filled buttons for anonymous users\r\n                    syncWishlistButtons([]);\r\n                }\r\n                return;\r\n            }\r\n\r\n            const response = await WishlistApi.getWishlist({ pageSize: 200 });\r\n            const payload = response.data || {};\r\n            const items = payload.items || payload.data || [];\r\n            WishlistApi.updateBadge(payload);\r\n            syncWishlistButtons(items);\r\n        } catch (error) {\r\n            try {\r\n                const raw = localStorage.getItem('wishlist');\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    WishlistApi.updateBadge(parsed);\r\n                    const items = parsed.items || (parsed.data && parsed.data.items) || [];\r\n                    syncWishlistButtons(items);\r\n                }\r\n            } catch (e) {\r\n                // ignore\r\n            }\r\n        }\r\n    }\r\n\r\n    // Keep last loaded wishlist items for re-sync (used by mutation observer)\r\n    let _lastWishlistItems = [];\r\n\r\n    // Set wishlist button states (filled/outlined) based on wishlist items array\r\n    function syncWishlistButtons(items) {\r\n        try {\r\n            _lastWishlistItems = items || [];\r\n\r\n            const mapById = {};\r\n            const mapBySlug = {};\r\n\r\n            (items || []).forEach(it => {\r\n                // Support multiple shapes: item.product (uuid/string), item.product_id, item.product.slug or item.product_slug\r\n                const pid = (it.product || it.product_id || (it.product && it.product.id) || null);\r\n                const pslug = it.product_slug || (it.product && it.product.slug) || null;\r\n                const id = it.id || it.pk || it.uuid || it.item || null;\r\n                if (pid) mapById[String(pid)] = id || true;\r\n                if (pslug) mapBySlug[String(pslug)] = id || true;\r\n            });\r\n\r\n            document.querySelectorAll('.wishlist-btn').forEach(btn => { \r\n                try {\r\n                    const svg = btn.querySelector('svg');\r\n                    const fillPath = svg?.querySelector('.heart-fill');\r\n                    const productId = btn.dataset.productId || btn.closest('[data-product-id]')?.dataset.productId;\r\n                    const productSlug = btn.dataset.productSlug || btn.closest('[data-product-slug]')?.dataset.productSlug;\r\n\r\n                    let itemId = null;\r\n                    if (productId && mapById.hasOwnProperty(String(productId))) itemId = mapById[String(productId)];\r\n                    else if (productSlug && mapBySlug.hasOwnProperty(String(productSlug))) itemId = mapBySlug[String(productSlug)];\r\n\r\n                    if (itemId) {\r\n                        btn.dataset.wishlistItemId = itemId;\r\n                        btn.classList.add('text-red-500');\r\n                        btn.setAttribute('aria-pressed', 'true');\r\n                        svg?.classList.add('fill-current');\r\n                        if (fillPath) fillPath.style.opacity = '1';\r\n                    } else {\r\n                        btn.removeAttribute('data-wishlist-item-id');\r\n                        btn.classList.remove('text-red-500');\r\n                        btn.setAttribute('aria-pressed', 'false');\r\n                        svg?.classList.remove('fill-current');\r\n                        if (fillPath) fillPath.style.opacity = '0';\r\n                    }\r\n                } catch (e) {\r\n                    // ignore per-button errors\r\n                }\r\n            });\r\n        } catch (e) {\r\n            // error logging removed\r\n        }\r\n    }\r\n\r\n    // Observe DOM additions and re-sync wishlist buttons when new product cards appear\r\n    (function() {\r\n        if (typeof MutationObserver === 'undefined') return;\r\n        let debounceTimer = null;\r\n        const observer = new MutationObserver(function(mutations) {\r\n            let found = false;\r\n            for (const m of mutations) {\r\n                if (m.addedNodes && m.addedNodes.length) {\r\n                    for (const n of m.addedNodes) {\r\n                        if (n.nodeType === 1 && (n.matches?.('.product-card') || n.querySelector?.('.product-card') || n.querySelector?.('.wishlist-btn'))) {\r\n                            found = true; break;\r\n                        }\r\n                    }\r\n                }\r\n                if (found) break;\r\n            }\r\n            if (found) {\r\n                clearTimeout(debounceTimer);\r\n                debounceTimer = setTimeout(() => {\r\n                    try { syncWishlistButtons(_lastWishlistItems); } catch (e) {}\r\n                }, 150);\r\n            }\r\n        });\r\n        observer.observe(document.body, { childList: true, subtree: true });\r\n    })();\r\n\r\n    async function initCartBadge() {\r\n        const cartBadges = document.querySelectorAll('[data-cart-count]');\r\n        if (!cartBadges.length) return;\r\n        try {\r\n            const response = await CartApi.getCart();\r\n            const count = response.data?.item_count || 0;\r\n            updateCartBadge(count);\r\n        } catch (error) {\r\n            // Fallback to cached cart in localStorage to show counts immediately\r\n            try {\r\n                const raw = localStorage.getItem('cart');\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const count = parsed?.item_count || parsed?.items?.length || 0;\r\n                    updateCartBadge(count);\r\n                }\r\n            } catch (e) {\r\n                // error logging removed\r\n            }\r\n        }\r\n    }\r\n\r\n    function detectCurrentPage() {\r\n        const path = window.location.pathname;\r\n        const body = document.body;\r\n        \r\n        // Check for data-page attribute first\r\n        if (body.dataset.page) {\r\n            currentPage = body.dataset.page;\r\n            return;\r\n        }\r\n\r\n        // Avoid initializing account controller for general /account(s)/* routes (login, register, etc.)\r\n        // Only profile pages (e.g. /account/profile or /accounts/profile) should be considered account pages\r\n        if ((path.startsWith('/accounts/') || path.startsWith('/account/')) && !(path.startsWith('/accounts/profile') || path.startsWith('/account/profile'))) {\r\n            currentPage = null;\r\n            return;\r\n        }\r\n\r\n        // Detect from URL\r\n        if (path === '/' || path === '/home/') {\r\n            currentPage = 'home';\r\n        } else if (path === '/categories/' || path === '/products/') {\r\n            currentPage = 'search';\r\n        } else if (path.startsWith('/categories/') && path !== '/categories/') {\r\n            currentPage = 'category';\r\n        } else if (path.startsWith('/products/') && path !== '/products/') {\r\n            currentPage = 'product';\r\n        } else if (path === '/search/' || path.startsWith('/search')) {\r\n            currentPage = 'search';\r\n        } else if (path.startsWith('/cart')) {\r\n            currentPage = 'cart';\r\n        } else if (path.startsWith('/checkout')) {\r\n            currentPage = 'checkout';\r\n        } else if (path === '/account' || path.startsWith('/account/') || path.startsWith('/accounts/profile')) {\r\n            currentPage = 'account';\r\n        } else if (path.startsWith('/orders')) {\r\n            currentPage = 'orders';\r\n        } else if (path.startsWith('/wishlist')) {\r\n            currentPage = 'wishlist';\r\n        } else if (path.startsWith('/contact')) {\r\n            currentPage = 'contact';\r\n        }\r\n    }\r\n\r\n    function initGlobalComponents() {\r\n        // Initialize global UI components\r\n        // Modal, Toast, and Dropdown are lazy-initialized when needed\r\n        \r\n        // Initialize tabs if present on page\r\n        if (typeof Tabs !== 'undefined' && document.querySelector('[data-tabs]')) {\r\n            Tabs.init();\r\n        }\r\n        \r\n        // Initialize any existing dropdowns on the page\r\n        if (typeof Dropdown !== 'undefined') {\r\n            document.querySelectorAll('[data-dropdown-trigger]').forEach(trigger => {\r\n                const targetId = trigger.dataset.dropdownTarget;\r\n                const target = document.getElementById(targetId);\r\n                if (target) {\r\n                    Dropdown.create(trigger, { content: target.innerHTML });\r\n                }\r\n            });\r\n        }\r\n\r\n        // Initialize lazy hydration for components marked with `data-hydrate`\r\n        try { initLazyHydration(); } catch (e) { /* ignore */ }\r\n    }\r\n\r\n    async function initCurrentPage() {\r\n        if (!currentPage) return;\r\n        // Destroy previous controller if it exposes destroy()\r\n        try {\r\n            if (currentController && typeof currentController.destroy === 'function') {\r\n                currentController.destroy();\r\n            }\r\n        } catch (e) { /* ignore */ }\r\n\r\n        const controller = await loadPageController(currentPage);\r\n        if (controller && typeof controller.init === 'function') {\r\n            currentController = controller;\r\n            try { await currentController.init(); } catch (e) { console.error('failed to init page controller', e); }\r\n        }\r\n    }\r\n\r\n    // Register service worker (if supported)\r\n    try {\r\n        if ('serviceWorker' in navigator) {\r\n            navigator.serviceWorker.register('/static/js/sw.js').catch(() => {});\r\n        }\r\n    } catch (e) { /* ignore */ }\r\n\r\n    async function initCartBadge() {\r\n        const cartBadges = document.querySelectorAll('[data-cart-count]');\r\n        if (!cartBadges.length) return;\r\n        try {\r\n            const response = await CartApi.getCart();\r\n            const count = response.data?.item_count || 0;\r\n            // Persist latest cart count for offline/failure fallback\r\n            try { localStorage.setItem('cart', JSON.stringify({ item_count: count, savedAt: Date.now() })); } catch(e) {}\r\n            updateCartBadge(count);\r\n        } catch (error) {\r\n            // Fallback to cached cart in localStorage to show counts immediately\r\n            try {\r\n                const raw = localStorage.getItem('cart');\r\n                if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    const count = parsed?.item_count || 0;\r\n                    updateCartBadge(count);\r\n                    return;\r\n                }\r\n            } catch (e) {\r\n                console.error('Failed to get cart count fallback:', e);\r\n            }\r\n            // error logging removed\r\n        }\r\n    }\r\n\r\n    async function findWishlistItemId(productId) {\r\n        try {\r\n            const response = await WishlistApi.getWishlist({ pageSize: 200 });\r\n            const payload = response.data || {};\r\n            const items = payload.items || [];\r\n            const match = items.find(item => String(item.product) === String(productId));\r\n            return match?.id || null;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function updateCartBadge(count) {\r\n        const cartBadges = document.querySelectorAll('[data-cart-count]');\r\n        cartBadges.forEach(badge => {\r\n            badge.textContent = count > 99 ? '99+' : count;\r\n            badge.classList.toggle('hidden', count === 0);\r\n        });\r\n    }\r\n\r\n    function initGlobalEventListeners() {\r\n        // Listen for cart updates\r\n        document.addEventListener('cart:updated', async () => {\r\n            await initCartBadge();\r\n        });\r\n\r\n        // Listen for wishlist updates\r\n        document.addEventListener('wishlist:updated', async () => {\r\n            await initWishlistBadge();\r\n        });\r\n\r\n        // Listen for auth state changes\r\n        document.addEventListener('auth:login', () => {\r\n            updateAuthUI(true);\r\n        });\r\n\r\n        document.addEventListener('auth:logout', () => {\r\n            updateAuthUI(false);\r\n        });\r\n\r\n        // Initialize wishlist icon fill state for existing buttons\r\n        document.querySelectorAll('.wishlist-btn').forEach(btn => {\r\n            try {\r\n                const svg = btn.querySelector('svg');\r\n                const fillPath = svg?.querySelector('.heart-fill');\r\n                if (btn.classList.contains('text-red-500')) {\r\n                    svg?.classList.add('fill-current');\r\n                    if (fillPath) fillPath.style.opacity = '1';\r\n                } else {\r\n                    if (fillPath) fillPath.style.opacity = '0';\r\n                }\r\n            } catch (e) {\r\n                // ignore\r\n            }\r\n        });\r\n\r\n        // Global quick add to cart (data-attribute and class-based)\r\n        document.addEventListener('click', async (e) => {\r\n            const quickAddBtn = e.target.closest('[data-quick-add], [data-add-to-cart], .add-to-cart-btn');\r\n            if (quickAddBtn) {\r\n                e.preventDefault();\r\n                const productId = quickAddBtn.dataset.productId || quickAddBtn.dataset.quickAdd || quickAddBtn.dataset.addToCart;\r\n                if (!productId) return;\r\n                \r\n                quickAddBtn.disabled = true;\r\n                const originalHtml = quickAddBtn.innerHTML;\r\n                quickAddBtn.innerHTML = '<svg class=\"animate-spin h-4 w-4 mx-auto\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>';\r\n\r\n                try {\r\n                    await CartApi.addItem(productId, 1);\r\n                    Toast.success('Added to cart!');\r\n                    document.dispatchEvent(new CustomEvent('cart:updated'));\r\n                } catch (error) {\r\n                    Toast.error(error.message || 'Failed to add to cart.');\r\n                } finally {\r\n                    quickAddBtn.disabled = false;\r\n                    quickAddBtn.innerHTML = originalHtml;\r\n                }\r\n            }\r\n        });\r\n\r\n        // Global quick add to wishlist (data-attribute and class-based)\r\n        document.addEventListener('click', async (e) => {\r\n            const wishlistBtn = e.target.closest('[data-wishlist-toggle], .wishlist-btn');\r\n            if (wishlistBtn) {\r\n                e.preventDefault();\r\n\r\n                if (!AuthApi.isAuthenticated()) {\r\n                    Toast.warning('Please login to add items to your wishlist.');\r\n                    window.location.href = '/account/login/?next=' + encodeURIComponent(window.location.pathname);\r\n                    return;\r\n                }\r\n\r\n                const productId = wishlistBtn.dataset.wishlistToggle || wishlistBtn.dataset.productId || wishlistBtn.closest('[data-product-id]')?.dataset.productId;\r\n                if (!productId) {\r\n                        // missing productId\r\n                }\r\n\r\n                wishlistBtn.disabled = true;\r\n                let wishlistItemId = wishlistBtn.dataset.wishlistItemId || '';\r\n\r\n                if (!wishlistItemId && wishlistBtn.classList.contains('text-red-500')) {\r\n                    wishlistItemId = await findWishlistItemId(productId) || '';\r\n                }\r\n\r\n                const isActive = wishlistBtn.classList.contains('text-red-500');\r\n                const shouldRemove = isActive && wishlistItemId;\r\n\r\n                try {\r\n                    if (shouldRemove) {\r\n                        const res = await WishlistApi.removeItem(wishlistItemId);\r\n                        wishlistBtn.classList.remove('text-red-500');\r\n                        wishlistBtn.setAttribute('aria-pressed', 'false');\r\n                        wishlistBtn.querySelector('svg')?.classList.remove('fill-current');\r\n                        const fillPath = wishlistBtn.querySelector('svg')?.querySelector('.heart-fill');\r\n                        if (fillPath) fillPath.style.opacity = '0';\r\n                        wishlistBtn.removeAttribute('data-wishlist-item-id');\r\n                        Toast.success('Removed from wishlist.');\r\n                    } else {\r\n                        const response = await WishlistApi.addItem(productId);\r\n                        const createdId = response.data?.id || response.data?.item?.id || await findWishlistItemId(productId);\r\n                        if (createdId) {\r\n                            wishlistBtn.dataset.wishlistItemId = createdId;\r\n                        }\r\n                        wishlistBtn.classList.add('text-red-500');\r\n                        wishlistBtn.setAttribute('aria-pressed', 'true');\r\n                        wishlistBtn.querySelector('svg')?.classList.add('fill-current');\r\n                        const fillPath = wishlistBtn.querySelector('svg')?.querySelector('.heart-fill');\r\n                        if (fillPath) fillPath.style.opacity = '1';\r\n                        Toast.success(response.message || 'Added to wishlist!');\r\n                    }\r\n                } catch (error) {\r\n                    console.error('wishlist:error', error);\r\n                    Toast.error(error.message || 'Failed to update wishlist.');\r\n                } finally {\r\n                    wishlistBtn.disabled = false;\r\n                }\r\n            }\r\n        });\r\n\r\n        // Quick view handler\r\n        document.addEventListener('click', (e) => {\r\n            const quickViewBtn = e.target.closest('[data-quick-view], .quick-view-btn');\r\n            if (quickViewBtn) {\r\n                e.preventDefault();\r\n                const productId = quickViewBtn.dataset.quickView || quickViewBtn.dataset.productId;\r\n                const productSlug = quickViewBtn.dataset.productSlug;\r\n                \r\n                if (productSlug) {\r\n                    window.location.href = `/products/${productSlug}/`;\r\n                } else if (productId) {\r\n                    // If we have Modal component, show quick view modal\r\n                    if (typeof Modal !== 'undefined' && Modal.showQuickView) {\r\n                        Modal.showQuickView(productId);\r\n                    } else {\r\n                        window.location.href = `/products/${productId}/`;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        // Handle logout\r\n        document.addEventListener('click', async (e) => {\r\n            const logoutBtn = e.target.closest('[data-logout]');\r\n            if (logoutBtn) {\r\n                e.preventDefault();\r\n                \r\n                try {\r\n                    await AuthApi.logout();\r\n                    Toast.success('Logged out successfully.');\r\n                    document.dispatchEvent(new CustomEvent('auth:logout'));\r\n                    window.location.href = '/';\r\n                } catch (error) {\r\n                    Toast.error('Failed to logout.');\r\n                }\r\n            }\r\n        });\r\n\r\n        // Handle back to top\r\n        const backToTopBtn = document.getElementById('back-to-top');\r\n        if (backToTopBtn) {\r\n            window.addEventListener('scroll', Debounce.throttle(() => {\r\n                if (window.scrollY > 500) {\r\n                    backToTopBtn.classList.remove('opacity-0', 'pointer-events-none');\r\n                } else {\r\n                    backToTopBtn.classList.add('opacity-0', 'pointer-events-none');\r\n                }\r\n            }, 100));\r\n\r\n            backToTopBtn.addEventListener('click', () => {\r\n                window.scrollTo({ top: 0, behavior: 'smooth' });\r\n            });\r\n        }\r\n    }\r\n\r\n    function updateAuthUI(isLoggedIn) {\r\n        const authElements = document.querySelectorAll('[data-auth-state]');\r\n        \r\n        authElements.forEach(el => {\r\n            const state = el.dataset.authState;\r\n            if (state === 'logged-in') {\r\n                el.classList.toggle('hidden', !isLoggedIn);\r\n            } else if (state === 'logged-out') {\r\n                el.classList.toggle('hidden', isLoggedIn);\r\n            }\r\n        });\r\n    }\r\n\r\n    function initMobileMenu() {\r\n        const menuBtn = document.getElementById('mobile-menu-btn');\r\n        const closeBtn = document.getElementById('close-mobile-menu');\r\n        const mobileMenu = document.getElementById('mobile-menu');\r\n        const overlay = document.getElementById('mobile-menu-overlay');\r\n\r\n        function openMenu() {\r\n            mobileMenu?.classList.remove('translate-x-full');\r\n            overlay?.classList.remove('hidden');\r\n            document.body.classList.add('overflow-hidden');\r\n        }\r\n\r\n        function closeMenu() {\r\n            mobileMenu?.classList.add('translate-x-full');\r\n            overlay?.classList.add('hidden');\r\n            document.body.classList.remove('overflow-hidden');\r\n        }\r\n\r\n        menuBtn?.addEventListener('click', openMenu);\r\n        closeBtn?.addEventListener('click', closeMenu);\r\n        overlay?.addEventListener('click', closeMenu);\r\n    }\r\n\r\n\r\n\r\n    function initLanguageSelector() {\r\n        const languageBtn = document.querySelector('[data-language-selector]');\r\n        const languageDropdown = document.getElementById('language-dropdown');\r\n\r\n        if (languageBtn && languageDropdown) {\r\n            Dropdown.create(languageBtn, languageDropdown);\r\n\r\n            languageDropdown.querySelectorAll('[data-language]').forEach(item => {\r\n                item.addEventListener('click', async () => {\r\n                    const lang = item.dataset.language;\r\n                    \r\n                    try {\r\n                        await LocalizationApi.setLanguage(lang);\r\n                        Storage.set('language', lang);\r\n                        window.location.reload();\r\n                    } catch (error) {\r\n                        Toast.error('Failed to change language.');\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    function destroy() {\r\n        if (currentController && typeof currentController.destroy === 'function') {\r\n            currentController.destroy();\r\n        }\r\n        currentPage = null;\r\n        currentController = null;\r\n    }\r\n\r\n    return {\r\n        init,\r\n        destroy,\r\n        getCurrentPage: () => currentPage,\r\n        updateCartBadge\r\n    };\r\n})();\r\n\r\n// Initialize app when DOM is ready\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', App.init);\r\n} else {\r\n    App.init();\r\n}\r\n\r\nwindow.App = App;\r\n"],
  "mappings": "wtBAgEA,SAASA,KAAQC,EAAS,CACxB,OAAOA,EACJ,KAAK,EACL,OAAOC,GAAKA,GAAK,OAAOA,GAAM,QAAQ,EACtC,KAAK,GAAG,CACb,CAKA,SAASC,EAAcC,EAAM,MAAO,CAAE,GAAAC,EAAK,GAAI,UAAAC,EAAY,GAAI,MAAAC,EAAQ,CAAC,EAAG,KAAAC,EAAO,GAAI,KAAAC,EAAO,EAAG,EAAI,CAAC,EAAG,CACtG,IAAMC,EAAK,SAAS,cAAcN,CAAG,EAErC,OAAIC,IAAIK,EAAG,GAAKL,GACZC,IAAWI,EAAG,UAAYJ,GAC1BG,IAAMC,EAAG,YAAcD,GACvBD,IAAME,EAAG,UAAYF,GAEzB,OAAO,QAAQD,CAAK,EAAE,QAAQ,CAAC,CAACI,EAAKC,CAAK,IAAM,CAC1CA,IAAU,GACZF,EAAG,aAAaC,EAAK,EAAE,EACdC,IAAU,IAASA,IAAU,MACtCF,EAAG,aAAaC,EAAKC,CAAK,CAE9B,CAAC,EAEMF,CACT,CAKA,SAASG,GAAYH,EAAII,EAAOC,EAASC,EAAU,CAAC,EAAG,CACrD,GAAKN,EACL,OAAAA,EAAG,iBAAiBI,EAAOC,EAASC,CAAO,EAEpC,IAAMN,EAAG,oBAAoBI,EAAOC,EAASC,CAAO,CAC7D,CAgDA,SAASC,GAAgBC,EAAW,CAClC,IAAMC,EAAoBD,EAAU,iBAClC,0EACF,EAEME,EAAeD,EAAkB,CAAC,EAClCE,EAAcF,EAAkBA,EAAkB,OAAS,CAAC,EAElE,MAAO,CACL,MAAO,CACLD,EAAU,iBAAiB,UAAYI,GAAM,CACvCA,EAAE,MAAQ,QAEVA,EAAE,SACA,SAAS,gBAAkBF,IAC7BE,EAAE,eAAe,EACjBD,EAAY,MAAM,GAGhB,SAAS,gBAAkBA,IAC7BC,EAAE,eAAe,EACjBF,EAAa,MAAM,GAGzB,CAAC,CACH,EACA,SAAU,CAEV,CACF,CACF,CA+CA,SAASG,IAAa,CACpB,MAAO,MAAQ,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EAAI,KAAK,IAAI,EAAE,SAAS,EAAE,CACjF,CAkBA,SAASC,GAAelB,EAAY,GAAI,CAQtC,OAPiBH,EAAc,MAAO,CACpC,UAAWH,EACT,4EACAM,CACF,EACA,MAAO,CAAE,gBAAiB,MAAO,CACnC,CAAC,CAEH,CA/PA,IAwLMmB,GAxLNC,GAAAC,GAAA,KAwLMF,GAAW,CACf,QAAUH,GAAMA,EAAE,MAAQ,QAC1B,SAAWA,GAAMA,EAAE,MAAQ,SAC3B,UAAYA,GAAMA,EAAE,MAAQ,UAC5B,YAAcA,GAAMA,EAAE,MAAQ,YAC9B,YAAcA,GAAMA,EAAE,MAAQ,YAC9B,aAAeA,GAAMA,EAAE,MAAQ,aAC/B,QAAUA,GAAMA,EAAE,MAAQ,IAC1B,MAAQA,GAAMA,EAAE,MAAQ,KAC1B,ICjMA,IAOaM,EAPbC,GAAAC,GAAA,KAKAC,KAEaH,EAAN,MAAMI,CAAc,CACzB,YAAYC,EAAU,CAAC,EAAG,CACxB,KAAK,GAAKA,EAAQ,IAAMC,GAAW,EACnC,KAAK,QAAU,KACf,KAAK,UAAY,CAAC,EAClB,KAAK,cAAgB,GACrB,KAAK,OAASD,CAChB,CAKA,OAAOE,EAAM,MAAO,CAAE,UAAAC,EAAY,GAAI,MAAAC,EAAQ,CAAC,EAAG,KAAAC,EAAO,EAAG,EAAI,CAAC,EAAG,CAClE,YAAK,QAAUC,EAAcJ,EAAK,CAChC,GAAI,KAAK,GACT,UAAAC,EACA,MAAAC,EACA,KAAAC,CACF,CAAC,EACM,KAAK,OACd,CAKA,MAAME,EAAU,CACd,GAAI,CAAC,KAAK,QACR,MAAO,GAGT,IAAMC,EAAS,OAAOD,GAAa,SAC/B,SAAS,cAAcA,CAAQ,EAC/BA,EAEJ,OAAKC,GAILA,EAAO,YAAY,KAAK,OAAO,EAC/B,KAAK,cAAgB,GACd,IALE,EAMX,CAKA,GAAGC,EAAOC,EAASV,EAAU,CAAC,EAAG,CAC/B,GAAI,CAAC,KAAK,QAAS,OAEnB,IAAMW,EAAUC,GAAY,KAAK,QAASH,EAAOC,EAASV,CAAO,EACjE,YAAK,UAAU,KAAKW,CAAO,EACpBA,CACT,CAKA,SAASJ,EAAUE,EAAOC,EAAS,CACjC,GAAI,CAAC,KAAK,QAAS,OAEnB,IAAMG,EAAYC,GAAM,CACtB,IAAMN,EAASM,EAAE,OAAO,QAAQP,CAAQ,EACpCC,GAAQE,EAAQ,KAAKF,EAAQM,CAAC,CACpC,EAEA,KAAK,QAAQ,iBAAiBL,EAAOI,CAAQ,EAC7C,KAAK,UAAU,KAAK,IAAM,KAAK,QAAQ,oBAAoBJ,EAAOI,CAAQ,CAAC,CAC7E,CAKA,YAAYE,EAAS,CACf,KAAK,SACP,KAAK,QAAQ,UAAU,IAAI,GAAGA,CAAO,CAEzC,CAKA,eAAeA,EAAS,CAClB,KAAK,SACP,KAAK,QAAQ,UAAU,OAAO,GAAGA,CAAO,CAE5C,CAKA,YAAYZ,EAAWa,EAAO,CACxB,KAAK,SACP,KAAK,QAAQ,UAAU,OAAOb,EAAWa,CAAK,CAElD,CAKA,SAASb,EAAW,CAClB,OAAO,KAAK,SAAS,UAAU,SAASA,CAAS,GAAK,EACxD,CAKA,KAAKc,EAAMC,EAAO,CAChB,GAAK,KAAK,QAEV,IAAIA,IAAU,OACZ,OAAO,KAAK,QAAQ,aAAaD,CAAI,EAGnCC,IAAU,MAAQA,IAAU,GAC9B,KAAK,QAAQ,gBAAgBD,CAAI,EACxBC,IAAU,GACnB,KAAK,QAAQ,aAAaD,EAAM,EAAE,EAElC,KAAK,QAAQ,aAAaA,EAAMC,CAAK,EAEzC,CAKA,MAAMC,EAAY,CAChB,OAAO,QAAQA,CAAU,EAAE,QAAQ,CAAC,CAACC,EAAKF,CAAK,IAAM,CACnD,KAAK,KAAKE,EAAKF,CAAK,CACtB,CAAC,CACH,CAKA,KAAKG,EAAS,CACR,KAAK,UACP,KAAK,QAAQ,YAAcA,EAE/B,CAKA,KAAKA,EAAS,CACR,KAAK,UACP,KAAK,QAAQ,UAAYA,EAE7B,CAKA,OAAOC,EAAS,CACV,KAAK,SAAWA,GAClB,KAAK,QAAQ,YAAYA,aAAmBvB,EAAgBuB,EAAQ,QAAUA,CAAO,CAEzF,CAKA,QAAQA,EAAS,CACX,KAAK,SAAWA,GAClB,KAAK,QAAQ,QAAQA,aAAmBvB,EAAgBuB,EAAQ,QAAUA,CAAO,CAErF,CAKA,MAAO,CACD,KAAK,UACP,KAAK,QAAQ,MAAM,QAAU,GAC7B,KAAK,QAAQ,gBAAgB,QAAQ,EAEzC,CAKA,MAAO,CACD,KAAK,UACP,KAAK,QAAQ,MAAM,QAAU,OAEjC,CAKA,OAAON,EAAO,CACR,KAAK,UACHA,IAAU,SACZA,EAAQ,KAAK,QAAQ,MAAM,UAAY,QAEzCA,EAAQ,KAAK,KAAK,EAAI,KAAK,KAAK,EAEpC,CAKA,SAASO,EAAU,CACjB,OAAK,KAAK,QACH,OAAO,iBAAiB,KAAK,OAAO,EAAE,iBAAiBA,CAAQ,EAD5C,IAE5B,CAKA,SAASA,EAAUL,EAAO,CACpB,KAAK,UACP,KAAK,QAAQ,MAAMK,CAAQ,EAAIL,EAEnC,CAKA,UAAUM,EAAQ,CAChB,OAAO,QAAQA,CAAM,EAAE,QAAQ,CAAC,CAACJ,EAAKF,CAAK,IAAM,CAC/C,KAAK,SAASE,EAAKF,CAAK,CAC1B,CAAC,CACH,CAOA,MAAMlB,EAAS,CACb,GAAK,KAAK,QAEV,GAAI,CACE,OAAOA,EAAY,IAErB,KAAK,QAAQ,MAAM,CAAE,cAAe,EAAK,CAAC,EAE1C,KAAK,QAAQ,MAAMA,CAAO,CAE9B,MAAc,CAEZ,GAAI,CAAE,KAAK,QAAQ,MAAM,CAAG,MAAY,CAAe,CACzD,CACF,CAKA,MAAO,CACD,KAAK,SACP,KAAK,QAAQ,KAAK,CAEtB,CAKA,aAAc,CACZ,OAAK,KAAK,QACH,KAAK,QAAQ,sBAAsB,EADhB,IAE5B,CAKA,SAAU,CAER,KAAK,UAAU,QAAQW,GAAWA,IAAU,CAAC,EAC7C,KAAK,UAAY,CAAC,EAGd,KAAK,SAAS,YAChB,KAAK,QAAQ,WAAW,YAAY,KAAK,OAAO,EAGlD,KAAK,QAAU,KACf,KAAK,cAAgB,EACvB,CAKA,MAAO,CACD,KAAK,SAAW,CAAC,KAAK,gBACxB,KAAK,cAAgB,GAEzB,CAKA,QAAS,CACP,OAAO,KAAK,OACd,CACF,IC7SA,IAAAc,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,KAAOA,EAAQ,MAAQ,UAC5B,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAa,CACjB,QAAS,CACP,GAAI,aACJ,OAAQ,kBACR,MAAO,gBACP,QAAS,gBACT,KAAM,QACR,EACA,QAAS,CACP,GAAI,cACJ,OAAQ,mBACR,MAAO,iBACP,QAAS,iBACT,KAAM,QACR,EACA,QAAS,CACP,GAAI,eACJ,OAAQ,oBACR,MAAO,kBACP,QAAS,kBACT,KAAM,QACR,EACA,MAAO,CACL,GAAI,YACJ,OAAQ,iBACR,MAAO,eACP,QAAS,eACT,KAAM,QACR,EACA,KAAM,CACJ,GAAI,aACJ,OAAQ,kBACR,MAAO,gBACP,QAAS,gBACT,KAAM,QACR,CACF,EAEMC,EAASD,EAAW,KAAK,IAAI,GAAKA,EAAW,QAG7CE,EAAe,MAAM,OAAO,MAAO,CACvC,UAAWC,EAHO,0BAGWF,EAAO,GAAIA,EAAO,OAAQ,KAAK,SAAS,EACrE,MAAO,CAAE,KAAM,OAAQ,CACzB,CAAC,EAEGG,EAAO,GAGX,OAAI,KAAK,OAAS,KAAK,QACrBA,GAAQ,6CACJ,KAAK,KACPA,GAAQ,kCAAkCH,EAAO,KAAK,KAAK,KAAK,MAAQA,EAAO,IAAI,UAEjF,KAAK,QACPG,GAAQ,4BAA4BH,EAAO,KAAK,KAAK,KAAK,KAAK,SAEjEG,GAAQ,UAIN,KAAK,UACPA,GAAQ,aAAaH,EAAO,OAAO,KAAK,KAAK,OAAO,QAIlD,KAAK,YACPG,GAAQ,mHAGVF,EAAa,UAAYE,EAErB,KAAK,WACUF,EAAa,cAAc,QAAQ,GAC1C,iBAAiB,QAAS,IAAM,CACxC,KAAK,QAAQ,CACf,CAAC,EAGIA,CACT,CAEA,WAAWG,EAAS,CAElB,GADA,KAAK,QAAUA,EACX,KAAK,QAAS,CAChB,IAAMC,EAAQ,KAAK,QAAQ,cAAc,GAAG,EACxCA,IACFA,EAAM,YAAcD,EAExB,CACF,CACF,IC/GA,IAAAE,GAAA,GAAAC,GAAAD,GAAA,iBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA0BK,CAAc,CAC7C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,YAAcA,EAAQ,aAAe,UAC1C,KAAK,WAAaA,EAAQ,YAAc,SACxC,KAAK,KAAOA,EAAQ,MAAQ,UAC5B,KAAK,UAAYA,EAAQ,WAAa,KACtC,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,KAAOA,EAAQ,MAAQ,EAC9B,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EACT,sDACA,KAAK,KAAO,GAAK,QACnB,EACA,MAAO,CACL,KAAM,cACN,aAAc,OACd,kBAAmB,GAAG,KAAK,EAAE,SAC7B,mBAAoB,GAAG,KAAK,EAAE,UAChC,CACF,CAAC,EAGKC,EAAWC,GAAe,EAChCH,EAAiB,YAAYE,CAAQ,EAGrC,IAAME,EAAgB,SAAS,cAAc,KAAK,EAClDA,EAAc,UAAY,mEAG1B,IAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,qCAEnB,IAAMC,EAAQ,SAAS,cAAc,IAAI,EACzCA,EAAM,GAAK,GAAG,KAAK,EAAE,SACrBA,EAAM,UAAY,sCAClBA,EAAM,YAAc,KAAK,MACzBD,EAAO,YAAYC,CAAK,EAExBF,EAAc,YAAYC,CAAM,EAGhC,IAAME,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,GAAK,GAAG,KAAK,EAAE,WAC1BA,EAAW,UAAY,0BACvBA,EAAW,YAAc,KAAK,QAC9BH,EAAc,YAAYG,CAAU,EAGpC,IAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,oFAEnB,IAAMC,EAAY,SAAS,cAAc,QAAQ,EACjDA,EAAU,UAAY,6GACtBA,EAAU,YAAc,KAAK,WAC7BA,EAAU,iBAAiB,QAAS,IAAM,KAAK,aAAa,CAAC,EAC7DD,EAAO,YAAYC,CAAS,EAE5B,IAAMC,EAAa,SAAS,cAAc,QAAQ,EAC5CC,EAAoB,KAAK,OAAS,SACpC,yCACA,2CACJ,OAAAD,EAAW,UAAYT,EAAK,sDAAuDU,CAAiB,EACpGD,EAAW,YAAc,KAAK,YAC9BA,EAAW,iBAAiB,QAAS,IAAM,KAAK,cAAc,CAAC,EAC/DF,EAAO,YAAYE,CAAU,EAE7BN,EAAc,YAAYI,CAAM,EAChCR,EAAiB,YAAYI,CAAa,EAE1C,KAAK,UAAYQ,GAAgBR,CAAa,EACvCJ,CACT,CAEA,MAAO,CACA,KAAK,SAAS,KAAK,OAAO,EAE/B,KAAK,KAAO,GACZ,KAAK,QAAQ,UAAU,OAAO,QAAQ,EACtC,KAAK,UAAU,KAAK,EACpB,SAAS,KAAK,MAAM,SAAW,QACjC,CAEA,OAAQ,CACN,KAAK,KAAO,GACZ,KAAK,SAAS,UAAU,IAAI,QAAQ,EACpC,SAAS,KAAK,MAAM,SAAW,EACjC,CAEA,eAAgB,CACV,KAAK,WACP,KAAK,UAAU,EAEjB,KAAK,MAAM,CACb,CAEA,cAAe,CACT,KAAK,UACP,KAAK,SAAS,EAEhB,KAAK,MAAM,CACb,CACF,ICpHA,IAAAa,GAAA,GAAAC,GAAAD,GAAA,YAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAqBK,CAAc,CACxC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,IAAMA,EAAQ,KAAO,GAC1B,KAAK,IAAMA,EAAQ,KAAO,GAC1B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,WAAaA,EAAQ,YAAc,aAC1C,CAEA,QAAS,CACP,IAAMC,EAAc,CAClB,GAAI,kBACJ,GAAI,kBACJ,GAAI,sBACJ,GAAI,oBACJ,GAAI,mBACN,EAEMC,EAAc,4FAEpB,OAAI,KAAK,IACe,MAAM,OAAO,MAAO,CACxC,UAAWC,EAAKD,EAAaD,EAAY,KAAK,IAAI,EAAG,KAAK,SAAS,EACnE,MAAO,CACL,IAAK,KAAK,IACV,IAAK,KAAK,IACV,KAAM,KACR,CACF,CAAC,EAEQ,KAAK,SACQ,MAAM,OAAO,MAAO,CACxC,UAAWE,EACTD,EACAD,EAAY,KAAK,IAAI,EACrB,aACA,KAAK,WACL,KAAK,SACP,EACA,KAAM,KAAK,SAAS,YAAY,CAClC,CAAC,EAGqB,MAAM,OAAO,MAAO,CACxC,UAAWE,EAAKD,EAAaD,EAAY,KAAK,IAAI,EAAG,cAAe,KAAK,SAAS,EAClF,KAAM,kNACR,CAAC,CAGL,CAEA,OAAOG,EAAKC,EAAM,GAAI,CACpB,KAAK,IAAMD,EACX,KAAK,IAAMC,EACP,KAAK,SAAW,KAAK,QAAQ,UAAY,QAC3C,KAAK,QAAQ,IAAMD,EACnB,KAAK,QAAQ,IAAMC,EAEvB,CAEA,YAAYC,EAAUC,EAAU,GAAI,CAGlC,GAFA,KAAK,SAAWD,EACZC,IAAS,KAAK,WAAaA,GAC3B,KAAK,UACP,KAAK,QAAQ,YAAcD,EAAS,YAAY,EAC5CC,GAAW,KAAK,QAAQ,UAAU,SAAS,KAAK,GAAG,CACrD,IAAMC,EAAU,KAAK,QAAQ,UAAU,MAAM,QAAQ,EAAE,CAAC,EACxD,KAAK,QAAQ,UAAU,OAAOA,CAAO,EACrC,KAAK,QAAQ,UAAU,IAAID,CAAO,CACpC,CAEJ,CACF,IClFA,IAAAE,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,QAC9B,KAAK,QAAUA,EAAQ,SAAW,UAClC,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAc,mEAEdC,EAAiB,CACrB,QAAS,4BACT,QAAS,4BACT,QAAS,8BACT,QAAS,gCACT,YAAa,0BACb,QAAS,sCACX,EAEMC,EAAc,CAClB,GAAI,oBACJ,GAAI,oBACJ,GAAI,qBACN,EAEMC,EAAe,MAAM,OAAO,OAAQ,CACxC,UAAWC,EACTJ,EACAC,EAAe,KAAK,OAAO,EAC3BC,EAAY,KAAK,IAAI,EACrB,KAAK,SACP,CACF,CAAC,EAED,OAAAC,EAAa,YAAc,KAAK,MACzBA,CACT,CAEA,SAASE,EAAO,CACd,KAAK,MAAQA,EACT,KAAK,UACP,KAAK,QAAQ,YAAcA,EAE/B,CACF,ICtDA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,YAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAqBK,CAAc,CACxC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,SAC9B,KAAK,QAAUA,EAAQ,SAAW,UAClC,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,QAAUA,EAAQ,SAAW,KAClC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAc,mKAEdC,EAAiB,CACrB,QAAS,8CACT,QAAS,+DACT,UAAW,kEACX,YAAa,4DACb,QAAS,0DACT,MAAO,iCACT,EAEMC,EAAc,CAClB,GAAI,oBACJ,GAAI,sBACJ,GAAI,mBACN,EAEMC,EAAgB,MAAM,OAAO,SAAU,CAC3C,UAAWC,EACTJ,EACAC,EAAe,KAAK,OAAO,EAC3BC,EAAY,KAAK,IAAI,EACrB,KAAK,SACP,EACA,MAAO,CAAE,SAAU,KAAK,QAAS,CACnC,CAAC,EAED,OAAAC,EAAc,YAAc,KAAK,MAE7B,KAAK,SACP,KAAK,GAAG,QAAS,KAAK,OAAO,EAGxBA,CACT,CAEA,SAASE,EAAO,CACd,KAAK,MAAQA,EACT,KAAK,UACP,KAAK,QAAQ,YAAcA,EAE/B,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EAChB,KAAK,KAAK,WAAYA,EAAW,GAAK,IAAI,CAC5C,CAEA,WAAWC,EAAS,CAClB,KAAK,YAAYA,CAAO,EACpBA,EACF,KAAK,KAAK,0KAA0K,EAEpL,KAAK,KAAK,KAAK,KAAK,CAExB,CACF,IC5EA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,iBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA0BK,CAAc,CAC7C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,QAAUA,EAAQ,SAAW,CAAC,EACnC,KAAK,YAAcA,EAAQ,aAAe,aAC1C,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAmB,KAAK,cAAgB,WAAa,WAAa,WAGlEC,EAAe,MAAM,OAAO,MAAO,CACvC,UAAWC,EAAK,OAAQF,EAHN,gEAGqC,KAAK,SAAS,EACrE,MAAO,CAAE,KAAM,OAAQ,CACzB,CAAC,EAED,YAAK,QAAQ,QAAQ,CAACG,EAAWC,IAAU,CACzC,IAAMC,EAAM,SAAS,cAAc,QAAQ,EAC3CA,EAAI,YAAcF,EAAU,OAAS,SACrCE,EAAI,UAAYH,EACd,sFACAE,EAAQ,EAAK,KAAK,cAAgB,WAAa,2BAA6B,2BAA8B,GAC1GD,EAAU,SAAW,gCAAkC,EACzD,EACAE,EAAI,SAAWF,EAAU,UAAY,GAEjCA,EAAU,SACZE,EAAI,iBAAiB,QAASF,EAAU,OAAO,EAGjDF,EAAa,YAAYI,CAAG,CAC9B,CAAC,EAEMJ,CACT,CAEA,UAAUK,EAAOC,EAAS,CACxB,GAAI,KAAK,QAAS,CAChB,IAAMF,EAAM,SAAS,cAAc,QAAQ,EAC3CA,EAAI,YAAcC,EAClBD,EAAI,UAAYH,EACd,8GACF,EACIK,GACFF,EAAI,iBAAiB,QAASE,CAAO,EAEvC,KAAK,QAAQ,YAAYF,CAAG,CAC9B,CACF,CACF,IC3DA,IAAAG,GAAA,GAAAC,GAAAD,GAAA,gBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAyBK,CAAc,CAC5C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CAGP,IAAMC,EAAoB,MAAM,OAAO,MAAO,CAC5C,UAAWC,EAHO,0BAGW,KAAK,SAAS,EAC3C,MAAO,CAAE,aAAc,YAAa,CACtC,CAAC,EAED,YAAK,MAAM,QAAQ,CAACC,EAAMC,IAAU,CAClC,GAAIA,EAAQ,EAAG,CACb,IAAMC,EAAYC,EAAc,OAAQ,CACtC,UAAW,qBACX,KAAM,GACR,CAAC,EACDL,EAAkB,YAAYI,CAAS,CACzC,CAEA,GAAID,IAAU,KAAK,MAAM,OAAS,EAAG,CACnC,IAAMG,EAAOD,EAAc,OAAQ,CACjC,UAAW,4BACX,KAAMH,EAAK,MACX,MAAO,CAAE,eAAgB,MAAO,CAClC,CAAC,EACDF,EAAkB,YAAYM,CAAI,CACpC,KAAO,CACL,IAAMC,EAAOF,EAAc,IAAK,CAC9B,UAAW,mFACX,KAAMH,EAAK,MACX,MAAO,CAAE,KAAMA,EAAK,MAAQ,GAAI,CAClC,CAAC,EACDF,EAAkB,YAAYO,CAAI,CACpC,CACF,CAAC,EAEMP,CACT,CAEA,QAAQQ,EAAOC,EAAO,IAAK,CACzB,GAAI,KAAK,QAAS,CAChB,GAAI,KAAK,QAAQ,SAAS,OAAS,EAAG,CACpC,IAAML,EAAYC,EAAc,OAAQ,CACtC,UAAW,qBACX,KAAM,GACR,CAAC,EACD,KAAK,QAAQ,YAAYD,CAAS,CACpC,CAEA,IAAMG,EAAOF,EAAc,IAAK,CAC9B,UAAW,mFACX,KAAMG,EACN,MAAO,CAAE,KAAAC,CAAK,CAChB,CAAC,EACD,KAAK,QAAQ,YAAYF,CAAI,EAC7B,KAAK,MAAM,KAAK,CAAE,MAAAC,EAAO,KAAAC,CAAK,CAAC,CACjC,CACF,CACF,ICvEA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,UAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAmBK,CAAc,CACtC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,OAASA,EAAQ,QAAU,GAChC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,UAAYA,EAAQ,YAAc,EACzC,CAEA,QAAS,CACP,IAAMC,EAAc,6DACdC,EAAa,KAAK,UAAY,iDAAmD,GAEjFC,EAAc,MAAM,OAAO,MAAO,CACtC,UAAWC,EAAKH,EAAaC,EAAY,KAAK,SAAS,CACzD,CAAC,EAGD,GAAI,KAAK,MAAO,CACd,IAAMG,EAAgBC,EAAc,MAAO,CACzC,UAAW,+CACb,CAAC,EAEGC,EAAO,mDAAmD,KAAK,KAAK,QACpE,KAAK,WACPA,GAAQ,yCAAyC,KAAK,QAAQ,QAGhEF,EAAc,UAAYE,EAC1BJ,EAAY,YAAYE,CAAa,CACvC,CAGA,GAAI,KAAK,QAAS,CAChB,IAAMG,EAAiBF,EAAc,MAAO,CAC1C,UAAW,YACX,KAAM,KAAK,OACb,CAAC,EACDH,EAAY,YAAYK,CAAc,CACxC,CAGA,GAAI,KAAK,OAAQ,CACf,IAAMC,EAAgBH,EAAc,MAAO,CACzC,UAAW,gDACX,KAAM,KAAK,MACb,CAAC,EACDH,EAAY,YAAYM,CAAa,CACvC,CAEA,OAAON,CACT,CAEA,WAAWO,EAAS,CAElB,GADA,KAAK,QAAUA,EACX,KAAK,QAAS,CAChB,IAAMC,EAAa,KAAK,QAAQ,cAAc,0CAA0C,EACpFA,IACFA,EAAW,UAAYD,EAE3B,CACF,CAEA,WAAWE,EAAS,CAClB,GAAI,KAAK,QAAS,CAChB,IAAMD,EAAa,KAAK,QAAQ,cAAc,0CAA0C,EACpFA,GACFA,EAAW,YAAYC,aAAmBb,EAAgBa,EAAQ,QAAUA,CAAO,CAEvF,CACF,CACF,ICjFA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,cAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAuBK,CAAc,CAC1C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,SAAWA,EAAQ,UAAY,IACpC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,aAAe,EACpB,KAAK,cAAgB,IACvB,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EAAK,sDAAuD,KAAK,SAAS,CACvF,CAAC,EAGKC,EAAgBC,EAAc,MAAO,CACzC,UAAW,sCACb,CAAC,EAED,KAAK,MAAM,QAAQ,CAACC,EAAMC,IAAU,CAClC,IAAMC,EAAQH,EAAc,MAAO,CACjC,UAAWF,EACT,mDACAI,IAAU,KAAK,aAAe,cAAgB,WAChD,CACF,CAAC,EAEKE,EAAM,SAAS,cAAc,KAAK,EAOxC,GANAA,EAAI,IAAMH,EAAK,IACfG,EAAI,IAAMH,EAAK,KAAO,GACtBG,EAAI,UAAY,6BAEhBD,EAAM,YAAYC,CAAG,EAEjBH,EAAK,MAAO,CACd,IAAMI,EAAeL,EAAc,MAAO,CACxC,UAAW,kFACX,KAAM,uCAAuCC,EAAK,KAAK,MACzD,CAAC,EACDE,EAAM,YAAYE,CAAY,CAChC,CAEAN,EAAc,YAAYI,CAAK,CACjC,CAAC,EAEDN,EAAiB,YAAYE,CAAa,EAG1C,IAAMO,EAAUN,EAAc,SAAU,CACtC,UAAW,gJACX,KAAM,QACR,CAAC,EAEDM,EAAQ,iBAAiB,QAAS,IAAM,CACtC,KAAK,SAAS,CAChB,CAAC,EAED,IAAMC,EAAUP,EAAc,SAAU,CACtC,UAAW,iJACX,KAAM,QACR,CAAC,EAEDO,EAAQ,iBAAiB,QAAS,IAAM,CACtC,KAAK,KAAK,CACZ,CAAC,EAEDV,EAAiB,YAAYS,CAAO,EACpCT,EAAiB,YAAYU,CAAO,EAGpC,IAAMC,EAAcR,EAAc,MAAO,CACvC,UAAW,uEACb,CAAC,EAED,YAAK,MAAM,QAAQ,CAAC,EAAGE,IAAU,CAC/B,IAAMO,EAAMT,EAAc,SAAU,CAClC,UAAWF,EACT,sCACAI,IAAU,KAAK,aAAe,eAAiB,aACjD,EACA,MAAO,CAAE,aAAcA,CAAM,CAC/B,CAAC,EAEDO,EAAI,iBAAiB,QAAS,IAAM,CAClC,KAAK,KAAKP,CAAK,CACjB,CAAC,EAEDM,EAAY,YAAYC,CAAG,CAC7B,CAAC,EAEDZ,EAAiB,YAAYW,CAAW,EAExC,KAAK,cAAgBT,EACrB,KAAK,YAAcS,EAEf,KAAK,UACP,KAAK,cAAc,EAGdX,CACT,CAEA,MAAO,CACL,KAAK,cAAgB,KAAK,aAAe,GAAK,KAAK,MAAM,OACzD,KAAK,aAAa,CACpB,CAEA,UAAW,CACT,KAAK,cAAgB,KAAK,aAAe,EAAI,KAAK,MAAM,QAAU,KAAK,MAAM,OAC7E,KAAK,aAAa,CACpB,CAEA,KAAKK,EAAO,CACV,KAAK,aAAeA,EACpB,KAAK,aAAa,EACd,KAAK,UACP,KAAK,cAAc,CAEvB,CAEA,cAAe,CACb,IAAMQ,EAAS,KAAK,cAAc,iBAAiB,KAAK,EAClDC,EAAO,KAAK,YAAY,iBAAiB,QAAQ,EAEvDD,EAAO,QAAQ,CAACP,EAAOD,IAAU,CAC/BC,EAAM,UAAYL,EAChB,mDACAI,IAAU,KAAK,aAAe,cAAgB,WAChD,CACF,CAAC,EAEDS,EAAK,QAAQ,CAACF,EAAKP,IAAU,CAC3BO,EAAI,UAAYX,EACd,sCACAI,IAAU,KAAK,aAAe,eAAiB,aACjD,CACF,CAAC,CACH,CAEA,eAAgB,CACd,KAAK,cAAgB,YAAY,IAAM,CACrC,KAAK,KAAK,CACZ,EAAG,KAAK,QAAQ,CAClB,CAEA,cAAe,CACT,KAAK,eACP,cAAc,KAAK,aAAa,CAEpC,CAEA,eAAgB,CACd,KAAK,aAAa,EACd,KAAK,UACP,KAAK,cAAc,CAEvB,CAEA,SAAU,CACR,KAAK,aAAa,EAClB,MAAM,QAAQ,CAChB,CACF,IC5KA,IAAAU,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,KAAOA,EAAQ,MAAQ,MAC5B,KAAK,KAAOA,EAAQ,MAAQ,CAAC,EAC7B,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,OAASA,EAAQ,QAAU,QAChC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EAAK,iDAAkD,KAAK,SAAS,CAClF,CAAC,EAGD,GAAI,KAAK,MAAO,CACd,IAAMC,EAAeC,EAAc,KAAM,CACvC,UAAW,2CACX,KAAM,KAAK,KACb,CAAC,EACDH,EAAiB,YAAYE,CAAY,CAC3C,CAGA,IAAME,EAAa,KAAK,UAAU,EAClC,OAAAJ,EAAiB,YAAYI,CAAU,EAEhCJ,CACT,CAEA,WAAY,CACV,IAAMK,EAAW,KAAK,IAAI,GAAG,KAAK,KAAK,IAAIC,GAAKA,EAAE,KAAK,CAAC,EAClDC,EAAQ,IACRC,EAAS,IACTC,EAAU,GAEVC,EAAM,SAAS,gBAAgB,6BAA8B,KAAK,EAIxE,GAHAA,EAAI,aAAa,UAAW,OAAOH,CAAK,IAAIC,CAAM,EAAE,EACpDE,EAAI,aAAa,QAAS,QAAQ,EAE9B,KAAK,OAAS,MAAO,CACvB,IAAMC,GAAYJ,EAAQE,EAAU,GAAK,KAAK,KAAK,OAEnD,KAAK,KAAK,QAAQ,CAACH,EAAGM,IAAM,CAC1B,IAAMC,EAAaP,EAAE,MAAQD,GAAaG,EAASC,EAAU,GACvDK,EAAIL,EAAUG,EAAID,EAAWA,EAAW,IACxCI,EAAIP,EAASC,EAAUI,EAEvBG,EAAO,SAAS,gBAAgB,6BAA8B,MAAM,EAC1EA,EAAK,aAAa,IAAKF,CAAC,EACxBE,EAAK,aAAa,IAAKD,CAAC,EACxBC,EAAK,aAAa,QAASL,EAAW,EAAG,EACzCK,EAAK,aAAa,SAAUH,CAAS,EACrCG,EAAK,aAAa,OAAQ,SAAS,EACnCA,EAAK,aAAa,QAAS,uCAAuC,EAElEN,EAAI,YAAYM,CAAI,EAGpB,IAAMC,EAAO,SAAS,gBAAgB,6BAA8B,MAAM,EAC1EA,EAAK,aAAa,IAAKH,EAAIH,EAAW,GAAI,EAC1CM,EAAK,aAAa,IAAKT,EAAS,EAAE,EAClCS,EAAK,aAAa,cAAe,QAAQ,EACzCA,EAAK,aAAa,YAAa,IAAI,EACnCA,EAAK,aAAa,OAAQ,SAAS,EACnCA,EAAK,YAAcX,EAAE,MACrBI,EAAI,YAAYO,CAAI,CACtB,CAAC,CACH,CAEA,OAAOP,CACT,CAEA,QAAQQ,EAAM,CAEZ,GADA,KAAK,KAAOA,EACR,KAAK,SAAW,KAAK,QAAQ,WAAY,CAC3C,IAAMC,EAAa,KAAK,OAAO,EAC/B,KAAK,QAAQ,WAAW,aAAaA,EAAY,KAAK,OAAO,EAC7D,KAAK,QAAUA,CACjB,CACF,CACF,IC1FA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,cAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAuBK,CAAc,CAC1C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CAGP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EAHO,0BAGW,KAAK,SAAS,CAC7C,CAAC,EAEKC,EAAkB,qLAElBC,EAAe,SAAS,cAAc,OAAO,EAUnD,GATAA,EAAa,KAAO,WACpBA,EAAa,UAAYD,EACzBC,EAAa,QAAU,KAAK,QAC5BA,EAAa,SAAW,KAAK,SAC7BA,EAAa,SAAW,KAAK,SACzB,KAAK,OAAMA,EAAa,KAAO,KAAK,MAExCH,EAAiB,YAAYG,CAAY,EAErC,KAAK,MAAO,CACd,IAAMC,EAAe,SAAS,cAAc,OAAO,EACnDA,EAAa,UAAY,6BACzBA,EAAa,YAAc,KAAK,MAChCJ,EAAiB,YAAYI,CAAY,EAEzCA,EAAa,iBAAiB,QAAS,IAAM,CAC3CD,EAAa,MAAM,CACrB,CAAC,CACH,CAEA,OAAI,KAAK,UACPA,EAAa,iBAAiB,SAAU,KAAK,QAAQ,EAGvD,KAAK,aAAeA,EACbH,CACT,CAEA,WAAY,CACV,OAAO,KAAK,cAAc,SAAW,EACvC,CAEA,WAAWK,EAAS,CAClB,KAAK,QAAUA,EACX,KAAK,eACP,KAAK,aAAa,QAAUA,EAEhC,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EACZ,KAAK,eACP,KAAK,aAAa,SAAWA,EAEjC,CAEA,QAAS,CACP,KAAK,WAAW,CAAC,KAAK,UAAU,CAAC,CACnC,CACF,IC/EA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,iBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA0BK,CAAc,CAC7C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EAAK,oDAAqD,KAAK,SAAS,CACrF,CAAC,EAGKC,EAAiBC,EAAc,SAAU,CAC7C,UAAWF,EACT,qDACA,2DACF,EACA,MAAO,CAAE,gBAAiB,KAAK,IAAK,CACtC,CAAC,EAEKG,EAAYD,EAAc,OAAQ,CACtC,UAAW,8BACX,KAAM,KAAK,KACb,CAAC,EAEKE,EAAUF,EAAc,OAAQ,CACpC,UAAWF,EACT,4CACA,KAAK,KAAO,aAAe,EAC7B,EACA,KAAM,QACR,CAAC,EAEDC,EAAe,YAAYE,CAAS,EACpCF,EAAe,YAAYG,CAAO,EAElCH,EAAe,iBAAiB,QAAS,IAAM,CAC7C,KAAK,OAAO,CACd,CAAC,EAEDF,EAAiB,YAAYE,CAAc,EAG3C,IAAMI,EAAiBH,EAAc,MAAO,CAC1C,UAAWF,EACT,8CACA,KAAK,KAAO,WAAa,UACzB,0BACF,CACF,CAAC,EAEKM,EAAeJ,EAAc,MAAO,CACxC,UAAW,YACX,KAAM,KAAK,OACb,CAAC,EAED,OAAAG,EAAe,YAAYC,CAAY,EACvCP,EAAiB,YAAYM,CAAc,EAE3C,KAAK,eAAiBJ,EACtB,KAAK,eAAiBI,EACtB,KAAK,QAAUD,EAERL,CACT,CAEA,QAAS,CACP,KAAK,KAAO,CAAC,KAAK,KAClB,KAAK,SAAS,EACV,KAAK,UACP,KAAK,SAAS,KAAK,IAAI,CAE3B,CAEA,MAAO,CACA,KAAK,OACR,KAAK,KAAO,GACZ,KAAK,SAAS,EACV,KAAK,UACP,KAAK,SAAS,EAAI,EAGxB,CAEA,OAAQ,CACF,KAAK,OACP,KAAK,KAAO,GACZ,KAAK,SAAS,EACV,KAAK,UACP,KAAK,SAAS,EAAK,EAGzB,CAEA,UAAW,CACT,KAAK,eAAe,aAAa,gBAAiB,KAAK,IAAI,EAC3D,KAAK,eAAe,UAAYC,EAC9B,8CACA,KAAK,KAAO,WAAa,UACzB,0BACF,EACA,KAAK,QAAQ,UAAYA,EACvB,4CACA,KAAK,KAAO,aAAe,EAC7B,CACF,CAEA,WAAWO,EAAS,CAElB,GADA,KAAK,QAAUA,EACX,KAAK,eAAgB,CACvB,IAAMC,EAAQ,KAAK,eAAe,cAAc,KAAK,EACjDA,IACFA,EAAM,UAAYD,EAEtB,CACF,CACF,IChIA,IAAAE,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAsBK,CAAc,CACzC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,SAAWA,EAAQ,UAAY,CAAC,EACrC,KAAK,YAAcA,EAAQ,aAAe,oBAC1C,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,KAAO,EACd,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EACT,kEACA,KAAK,KAAO,OAAS,EACvB,CACF,CAAC,EAGKC,EAAWC,EAAc,MAAO,CACpC,UAAW,yCACb,CAAC,EACDH,EAAiB,YAAYE,CAAQ,EAErCA,EAAS,iBAAiB,QAAS,IAAM,KAAK,MAAM,CAAC,EAGrD,IAAME,EAAiBD,EAAc,MAAO,CAC1C,UAAW,6DACb,CAAC,EAGKE,EAAe,SAAS,cAAc,OAAO,EACnDA,EAAa,KAAO,OACpBA,EAAa,YAAc,KAAK,YAChCA,EAAa,UAAY,+DACzBA,EAAa,UAAY,GAEzBD,EAAe,YAAYC,CAAY,EAGvC,IAAMC,EAAiBH,EAAc,MAAO,CAC1C,UAAW,0BACb,CAAC,EAEKI,EAAgB,CAACC,EAAQ,KAAO,CACpCF,EAAe,UAAY,GAE3B,IAAMG,EAAWD,EACb,KAAK,SAAS,OAAOE,GACnBA,EAAI,MAAM,YAAY,EAAE,SAASF,EAAM,YAAY,CAAC,CACtD,EACA,KAAK,SAET,GAAIC,EAAS,SAAW,EAAG,CACzB,IAAME,EAAYR,EAAc,MAAO,CACrC,UAAW,kCACX,KAAM,mBACR,CAAC,EACDG,EAAe,YAAYK,CAAS,EACpC,MACF,CAEA,IAAIC,EAAkB,GAEtBH,EAAS,QAAQC,GAAO,CACtB,GAAIA,EAAI,UAAYA,EAAI,WAAaE,EAAiB,CACpDA,EAAkBF,EAAI,SACtB,IAAMG,EAAiBV,EAAc,MAAO,CAC1C,UAAW,qEACX,KAAMS,CACR,CAAC,EACDN,EAAe,YAAYO,CAAc,CAC3C,CAEA,IAAMC,EAAaX,EAAc,MAAO,CACtC,UAAWF,EACT,qGACF,CACF,CAAC,EAEKc,EAAQZ,EAAc,OAAQ,CAClC,KAAMO,EAAI,MACV,UAAW,uBACb,CAAC,EAGD,GAFAI,EAAW,YAAYC,CAAK,EAExBL,EAAI,SAAU,CAChB,IAAMM,EAAWb,EAAc,OAAQ,CACrC,UAAW,kDACX,KAAMO,EAAI,QACZ,CAAC,EACDI,EAAW,YAAYE,CAAQ,CACjC,CAEAF,EAAW,iBAAiB,QAAS,IAAM,CACrCJ,EAAI,QACNA,EAAI,OAAO,EAEb,KAAK,MAAM,CACb,CAAC,EAEDJ,EAAe,YAAYQ,CAAU,CACvC,CAAC,CACH,EAEA,OAAAT,EAAa,iBAAiB,QAAUY,GAAM,CAC5CV,EAAcU,EAAE,OAAO,KAAK,CAC9B,CAAC,EAEDb,EAAe,YAAYE,CAAc,EACzCN,EAAiB,YAAYI,CAAc,EAE3CC,EAAa,iBAAiB,UAAYY,GAAM,CAC1CA,EAAE,MAAQ,UACZ,KAAK,MAAM,CAEf,CAAC,EAEDV,EAAc,EACd,KAAK,iBAAmBP,EAEjBA,CACT,CAEA,MAAO,CACA,KAAK,SAAS,KAAK,OAAO,EAC/B,KAAK,KAAO,GACZ,KAAK,QAAQ,UAAU,OAAO,QAAQ,EACtC,KAAK,QAAQ,UAAU,IAAI,MAAM,CACnC,CAEA,OAAQ,CACN,KAAK,KAAO,GACZ,KAAK,SAAS,UAAU,OAAO,MAAM,EACrC,KAAK,SAAS,UAAU,IAAI,QAAQ,CACtC,CAEA,QAAS,CACP,KAAK,KAAO,KAAK,MAAM,EAAI,KAAK,KAAK,CACvC,CACF,ICpJA,IAAAkB,GAAA,GAAAC,GAAAD,GAAA,cAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAuBK,CAAc,CAC1C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,YAAcA,EAAQ,aAAe,YAC1C,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,KAAO,EACd,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,iBACb,CAAC,EAGKC,EAAe,SAAS,cAAc,OAAO,EACnDA,EAAa,KAAO,OACpBA,EAAa,YAAc,KAAK,YAChCA,EAAa,MAAQ,KAAK,MAC1BA,EAAa,UAAYC,EACvB,qDACA,8EACF,EAGA,IAAMC,EAAcC,EAAc,MAAO,CACvC,UAAWF,EACT,yGACA,0BACF,CACF,CAAC,EAEKG,EAAa,CAACC,EAAQ,KAAO,CACjCH,EAAY,UAAY,GACxB,IAAMI,EAAW,KAAK,MAAM,OAAOC,GACjCA,EAAK,MAAM,YAAY,EAAE,SAASF,EAAM,YAAY,CAAC,CACvD,EAEA,GAAIC,EAAS,SAAW,EAAG,CACzB,IAAME,EAAYL,EAAc,MAAO,CACrC,UAAW,0BACX,KAAM,kBACR,CAAC,EACDD,EAAY,YAAYM,CAAS,EACjC,MACF,CAEAF,EAAS,QAAQC,GAAQ,CACvB,IAAME,EAASN,EAAc,MAAO,CAClC,UAAWF,EACT,8DACAM,EAAK,QAAU,KAAK,MAAQ,cAAgB,EAC9C,EACA,KAAMA,EAAK,MACX,MAAO,CAAE,aAAcA,EAAK,KAAM,CACpC,CAAC,EAEDE,EAAO,iBAAiB,QAAS,IAAM,CACrC,KAAK,MAAQF,EAAK,MAClBP,EAAa,MAAQO,EAAK,MAC1BL,EAAY,UAAU,IAAI,QAAQ,EAC9B,KAAK,UACP,KAAK,SAAS,KAAK,MAAOK,CAAI,CAElC,CAAC,EAEDL,EAAY,YAAYO,CAAM,CAChC,CAAC,CACH,EAEA,OAAAT,EAAa,iBAAiB,QAAUU,GAAM,CAC5CN,EAAWM,EAAE,OAAO,KAAK,EACzBR,EAAY,UAAU,OAAO,QAAQ,CACvC,CAAC,EAEDF,EAAa,iBAAiB,QAAS,IAAM,CAC3CI,EAAWJ,EAAa,KAAK,EAC7BE,EAAY,UAAU,OAAO,QAAQ,CACvC,CAAC,EAEDF,EAAa,iBAAiB,OAAQ,IAAM,CAC1C,WAAW,IAAM,CACfE,EAAY,UAAU,IAAI,QAAQ,CACpC,EAAG,GAAG,CACR,CAAC,EAEDH,EAAiB,YAAYC,CAAY,EACzCD,EAAiB,YAAYG,CAAW,EAExC,SAAS,iBAAiB,QAAUQ,GAAM,CACnCX,EAAiB,SAASW,EAAE,MAAM,GACrCR,EAAY,UAAU,IAAI,QAAQ,CAEtC,CAAC,EAED,KAAK,aAAeF,EACpB,KAAK,YAAcE,EACnBE,EAAW,EAEJL,CACT,CAEA,UAAW,CACT,OAAO,KAAK,KACd,CAEA,SAASY,EAAO,CACd,KAAK,MAAQA,EACb,IAAMJ,EAAO,KAAK,MAAM,KAAKK,GAAKA,EAAE,QAAUD,CAAK,EAC/CJ,GAAQ,KAAK,eACf,KAAK,aAAa,MAAQA,EAAK,MAEnC,CACF,IC3HA,IAAAM,GAAA,GAAAC,GAAAD,GAAA,iBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA0BK,CAAc,CAC7C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,QAAU,EACjB,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,8BACb,CAAC,EAGKC,EAAc,SAAS,cAAc,KAAK,EAChD,OAAAA,EAAY,UAAYC,EACtB,2FACA,KAAK,SACP,EAEA,KAAK,MAAM,QAASC,GAAS,CAC3B,IAAMC,EAAcC,EAAc,SAAU,CAC1C,UAAWH,EACT,sGACAC,EAAK,SAAW,gCAAkC,gBACpD,EACA,MAAO,CACL,SAAUA,EAAK,SAAW,GAAK,KAC/B,cAAeA,EAAK,KACtB,CACF,CAAC,EAED,GAAIA,EAAK,KAAM,CACb,IAAMG,EAAW,SAAS,cAAc,MAAM,EAC9CA,EAAS,UAAYH,EAAK,KAC1BC,EAAY,YAAYE,CAAQ,CAClC,CAEA,IAAMC,EAAY,SAAS,cAAc,MAAM,EAC/CA,EAAU,YAAcJ,EAAK,MAC7BC,EAAY,YAAYG,CAAS,EAEjCH,EAAY,iBAAiB,QAAS,IAAM,CACtC,CAACD,EAAK,UAAYA,EAAK,SACzBA,EAAK,QAAQ,EAEf,KAAK,KAAK,CACZ,CAAC,EAEDF,EAAY,YAAYG,CAAW,CACrC,CAAC,EAEDJ,EAAiB,YAAYC,CAAW,EAGxCD,EAAiB,iBAAiB,cAAgBQ,GAAM,CACtDA,EAAE,eAAe,EACjB,KAAK,OAAOA,EAAE,QAASA,EAAE,QAASP,CAAW,CAC/C,CAAC,EAGD,SAAS,iBAAiB,QAAS,IAAM,CACnC,KAAK,SACP,KAAK,KAAK,CAEd,CAAC,EAED,KAAK,YAAcA,EACZD,CACT,CAEA,OAAOS,EAAGC,EAAGT,EAAa,CACnBA,IAEL,KAAK,QAAU,GACfA,EAAY,UAAU,OAAO,QAAQ,EACrCA,EAAY,MAAM,SAAW,QAC7BA,EAAY,MAAM,KAAOQ,EAAI,KAC7BR,EAAY,MAAM,IAAMS,EAAI,KAC9B,CAEA,MAAO,CACL,KAAK,QAAU,GACX,KAAK,cACP,KAAK,YAAY,UAAU,IAAI,QAAQ,EACvC,KAAK,YAAY,MAAM,SAAW,WAEtC,CAEA,QAAQC,EAAOC,EAASC,EAAO,KAAM,CACnC,IAAMV,EAAO,CAAE,MAAAQ,EAAO,QAAAC,EAAS,KAAAC,CAAK,EAGpC,GAFA,KAAK,MAAM,KAAKV,CAAI,EAEhB,KAAK,YAAa,CACpB,IAAMC,EAAcC,EAAc,SAAU,CAC1C,UAAW,qGACb,CAAC,EAED,GAAIQ,EAAM,CACR,IAAMP,EAAW,SAAS,cAAc,MAAM,EAC9CA,EAAS,UAAYO,EACrBT,EAAY,YAAYE,CAAQ,CAClC,CAEAF,EAAY,YAAcO,EAC1BP,EAAY,iBAAiB,QAAS,IAAM,CAC1CQ,EAAQ,EACR,KAAK,KAAK,CACZ,CAAC,EAED,KAAK,YAAY,YAAYR,CAAW,CAC1C,CACF,CACF,ICzHA,IAAAU,GAAA,GAAAC,GAAAD,GAAA,gBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAyBK,CAAc,CAC5C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,YAAcA,EAAQ,aAAe,iBAC1C,KAAK,OAASA,EAAQ,QAAU,aAChC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,KAAO,EACd,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,iBACb,CAAC,EAGKC,EAAe,SAAS,cAAc,OAAO,EACnDA,EAAa,KAAO,OACpBA,EAAa,YAAc,KAAK,YAChCA,EAAa,MAAQ,KAAK,MAC1BA,EAAa,UAAYC,EACvB,qDACA,8EACF,EAEAD,EAAa,iBAAiB,QAAS,IAAM,CAC3C,KAAK,WAAW,CAClB,CAAC,EAEDA,EAAa,iBAAiB,SAAWE,GAAM,CAC7C,KAAK,MAAQA,EAAE,OAAO,MAClB,KAAK,UACP,KAAK,SAAS,KAAK,KAAK,CAE5B,CAAC,EAEDH,EAAiB,YAAYC,CAAY,EAGzC,IAAMG,EAAc,SAAS,cAAc,OAAO,EAClD,OAAAA,EAAY,KAAO,OACnBA,EAAY,MAAM,QAAU,OAC5BA,EAAY,MAAQ,KAAK,MAEzBA,EAAY,iBAAiB,SAAWD,GAAM,CAC5C,IAAME,EAAO,IAAI,KAAKF,EAAE,OAAO,KAAK,EACpC,KAAK,MAAQ,KAAK,WAAWE,CAAI,EACjCJ,EAAa,MAAQ,KAAK,MAEtB,KAAK,UACP,KAAK,SAAS,KAAK,KAAK,CAE5B,CAAC,EAEDD,EAAiB,YAAYI,CAAW,EAExC,KAAK,aAAeH,EACpB,KAAK,YAAcG,EAEZJ,CACT,CAEA,YAAa,CACX,KAAK,YAAY,MAAM,CACzB,CAEA,WAAWK,EAAM,CACf,IAAMC,EAAOD,EAAK,YAAY,EACxBE,EAAQ,OAAOF,EAAK,SAAS,EAAI,CAAC,EAAE,SAAS,EAAG,GAAG,EACnDG,EAAM,OAAOH,EAAK,QAAQ,CAAC,EAAE,SAAS,EAAG,GAAG,EAElD,OAAI,KAAK,SAAW,aACX,GAAGG,CAAG,IAAID,CAAK,IAAID,CAAI,GAEzB,GAAGA,CAAI,IAAIC,CAAK,IAAIC,CAAG,EAChC,CAEA,UAAW,CACT,OAAO,KAAK,KACd,CAEA,SAASC,EAAO,CACd,KAAK,MAAQA,EACT,KAAK,eACP,KAAK,aAAa,MAAQA,EAE9B,CACF,IChGA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,YAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAqBK,CAAc,CACxC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,QAAUA,EAAQ,SAAW,KAClC,KAAK,YAAcA,EAAQ,cAAgB,GAC3C,KAAK,gBAAkBA,EAAQ,kBAAoB,GACnD,KAAK,cAAgBA,EAAQ,gBAAkB,EACjD,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EACT,sDACA,KAAK,KAAO,GAAK,QACnB,EACA,MAAO,CACL,KAAM,SACN,aAAc,OACd,kBAAmB,GAAG,KAAK,EAAE,SAC7B,mBAAoB,GAAG,KAAK,EAAE,cAChC,CACF,CAAC,EAGKC,EAAWC,GAAe,iBAAiB,EACjDH,EAAiB,YAAYE,CAAQ,EAEjC,KAAK,iBACPA,EAAS,iBAAiB,QAAS,IAAM,KAAK,MAAM,CAAC,EAIvD,IAAME,EAAc,CAClB,GAAI,kBACJ,GAAI,kBACJ,GAAI,kBACJ,GAAI,iBACN,EAEMC,EAAgB,SAAS,cAAc,KAAK,EAQlD,GAPAA,EAAc,UAAYJ,EACxB,8CACAG,EAAY,KAAK,IAAI,EACrB,mCACF,EAGI,KAAK,MAAO,CACd,IAAME,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,uEAEnB,IAAMC,EAAQ,SAAS,cAAc,IAAI,EAMzC,GALAA,EAAM,GAAK,GAAG,KAAK,EAAE,SACrBA,EAAM,UAAY,sCAClBA,EAAM,YAAc,KAAK,MACzBD,EAAO,YAAYC,CAAK,EAEpB,KAAK,YAAa,CACpB,IAAMC,EAAW,SAAS,cAAc,QAAQ,EAChDA,EAAS,UAAY,mEACrBA,EAAS,UAAY,OACrBA,EAAS,aAAa,aAAc,OAAO,EAC3CA,EAAS,iBAAiB,QAAS,IAAM,KAAK,MAAM,CAAC,EACrDF,EAAO,YAAYE,CAAQ,CAC7B,CAEAH,EAAc,YAAYC,CAAM,CAClC,CAGA,GAAI,KAAK,QAAS,CAChB,IAAMG,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,GAAK,GAAG,KAAK,EAAE,eAC1BA,EAAW,UAAY,YACvBA,EAAW,UAAY,KAAK,QAC5BJ,EAAc,YAAYI,CAAU,CACtC,CAEA,OAAAT,EAAiB,YAAYK,CAAa,EAG1C,KAAK,GAAG,UAAYK,GAAM,CACpBC,GAAS,SAASD,CAAC,GAAK,KAAK,eAC/B,KAAK,MAAM,CAEf,EAAG,CAAE,KAAM,EAAM,CAAC,EAElB,KAAK,SAAWR,EAChB,KAAK,cAAgBG,EACrB,KAAK,UAAYO,GAAgBP,CAAa,EAEvCL,CACT,CAEA,MAAO,CACA,KAAK,SAAS,KAAK,OAAO,EAE/B,KAAK,KAAO,GACZ,KAAK,QAAQ,UAAU,OAAO,QAAQ,EACtC,KAAK,UAAU,KAAK,EACpB,SAAS,KAAK,MAAM,SAAW,QACjC,CAEA,OAAQ,CACN,KAAK,KAAO,GACZ,KAAK,SAAS,UAAU,IAAI,QAAQ,EACpC,SAAS,KAAK,MAAM,SAAW,GAE3B,KAAK,SACP,KAAK,QAAQ,CAEjB,CAEA,QAAS,CACP,KAAK,KAAO,KAAK,MAAM,EAAI,KAAK,KAAK,CACvC,CAEA,WAAWa,EAAS,CAElB,GADA,KAAK,QAAUA,EACX,KAAK,cAAe,CACtB,IAAMJ,EAAa,KAAK,cAAc,cAAc,IAAI,KAAK,EAAE,cAAc,EACzEA,IACFA,EAAW,UAAYI,EAE3B,CACF,CACF,IC1IA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,kBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA2BK,CAAc,CAC9C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,QAAUA,EAAQ,SAAW,OAClC,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,SAAWA,EAAQ,UAAY,SACpC,KAAK,MAAQA,EAAQ,OAAS,OAC9B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,KAAO,EACd,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,uBACb,CAAC,EAGKC,EAAa,SAAS,cAAc,QAAQ,EAClDA,EAAW,UAAY,uHACvBA,EAAW,UAAY,GAAG,KAAK,OAAO,iMACtCA,EAAW,iBAAiB,QAAS,IAAM,KAAK,OAAO,CAAC,EAExDD,EAAiB,YAAYC,CAAU,EAGvC,IAAMC,EAAgB,KAAK,WAAa,MAAQ,mBAAqB,gBAC/DC,EAAa,KAAK,QAAU,QAAU,UAAY,SAElDC,EAAc,SAAS,cAAc,KAAK,EAChD,OAAAA,EAAY,UAAYC,EACtB,2FACAH,EACAC,EACA,KAAK,SACP,EAEA,KAAK,MAAM,QAASG,GAAS,CAC3B,GAAIA,EAAK,QAAS,CAChB,IAAMC,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,gCACpBH,EAAY,YAAYG,CAAO,EAC/B,MACF,CAEA,IAAMC,EAAcC,EAAc,SAAU,CAC1C,UAAWJ,EACT,sGACAC,EAAK,SAAW,gCAAkC,gBACpD,EACA,MAAO,CACL,SAAUA,EAAK,SAAW,GAAK,IACjC,CACF,CAAC,EAED,GAAIA,EAAK,KAAM,CACb,IAAMI,EAAW,SAAS,cAAc,MAAM,EAC9CA,EAAS,UAAYJ,EAAK,KAC1BI,EAAS,UAAY,UACrBF,EAAY,YAAYE,CAAQ,CAClC,CAEA,IAAMC,EAAY,SAAS,cAAc,MAAM,EAC/CA,EAAU,YAAcL,EAAK,MAC7BE,EAAY,YAAYG,CAAS,EAEjCH,EAAY,iBAAiB,QAAS,IAAM,CACtC,CAACF,EAAK,UAAYA,EAAK,SACzBA,EAAK,QAAQ,EAEf,KAAK,MAAM,CACb,CAAC,EAEDF,EAAY,YAAYI,CAAW,CACrC,CAAC,EAEDR,EAAiB,YAAYI,CAAW,EAGxC,SAAS,iBAAiB,QAAUQ,GAAM,CACpC,CAACZ,EAAiB,SAASY,EAAE,MAAM,GAAK,KAAK,MAC/C,KAAK,MAAM,CAEf,CAAC,EAED,KAAK,WAAaX,EAClB,KAAK,YAAcG,EAEZJ,CACT,CAEA,QAAS,CACP,KAAK,KAAO,KAAK,MAAM,EAAI,KAAK,KAAK,CACvC,CAEA,MAAO,CACL,KAAK,KAAO,GACZ,KAAK,YAAY,UAAU,OAAO,QAAQ,CAC5C,CAEA,OAAQ,CACN,KAAK,KAAO,GACZ,KAAK,YAAY,UAAU,IAAI,QAAQ,CACzC,CAEA,QAAQa,EAAOC,EAASC,EAAO,KAAM,CACnC,IAAMT,EAAO,CAAE,MAAAO,EAAO,QAAAC,EAAS,KAAAC,CAAK,EAGpC,GAFA,KAAK,MAAM,KAAKT,CAAI,EAEhB,KAAK,YAAa,CACpB,IAAME,EAAcC,EAAc,SAAU,CAC1C,UAAW,qGACb,CAAC,EAED,GAAIM,EAAM,CACR,IAAML,EAAW,SAAS,cAAc,MAAM,EAC9CA,EAAS,UAAYK,EACrBL,EAAS,UAAY,UACrBF,EAAY,YAAYE,CAAQ,CAClC,CAEA,IAAMC,EAAY,SAAS,cAAc,MAAM,EAC/CA,EAAU,YAAcE,EACxBL,EAAY,YAAYG,CAAS,EAEjCH,EAAY,iBAAiB,QAAS,IAAM,CAC1CM,EAAQ,EACR,KAAK,MAAM,CACb,CAAC,EAED,KAAK,YAAY,YAAYN,CAAW,CAC1C,CACF,CACF,IC5IA,IAAAQ,GAAA,GAAAC,GAAAD,GAAA,YAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAqBK,CAAc,CACxC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,QACpC,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,QAAUA,EAAQ,SAAW,KAClC,KAAK,YAAcA,EAAQ,cAAgB,GAC3C,KAAK,gBAAkBA,EAAQ,kBAAoB,GACnD,KAAK,cAAgBA,EAAQ,gBAAkB,EACjD,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EACT,qBACA,KAAK,KAAO,GAAK,QACnB,CACF,CAAC,EAGKC,EAAWC,GAAe,EAChCH,EAAiB,YAAYE,CAAQ,EAEjC,KAAK,iBACPA,EAAS,iBAAiB,QAAS,IAAM,KAAK,MAAM,CAAC,EAIvD,IAAME,EAAkB,KAAK,WAAa,OAAS,SAAW,UACxDC,EAAgB,SAAS,cAAc,KAAK,EAQlD,GAPAA,EAAc,UAAYJ,EACxB,qGACAG,EACA,KAAK,KAAO,gBAAmB,KAAK,WAAa,OAAS,oBAAsB,kBAClF,EAGI,KAAK,MAAO,CACd,IAAME,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,uEAEnB,IAAMC,EAAQ,SAAS,cAAc,IAAI,EAKzC,GAJAA,EAAM,UAAY,sCAClBA,EAAM,YAAc,KAAK,MACzBD,EAAO,YAAYC,CAAK,EAEpB,KAAK,YAAa,CACpB,IAAMC,EAAW,SAAS,cAAc,QAAQ,EAChDA,EAAS,UAAY,mEACrBA,EAAS,UAAY,OACrBA,EAAS,iBAAiB,QAAS,IAAM,KAAK,MAAM,CAAC,EACrDF,EAAO,YAAYE,CAAQ,CAC7B,CAEAH,EAAc,YAAYC,CAAM,CAClC,CAGA,IAAMG,EAAa,SAAS,cAAc,KAAK,EAC/C,OAAAA,EAAW,UAAY,mCACvBA,EAAW,UAAY,KAAK,QAC5BJ,EAAc,YAAYI,CAAU,EAEpCT,EAAiB,YAAYK,CAAa,EAG1C,KAAK,GAAG,UAAYK,GAAM,CACpBC,GAAS,SAASD,CAAC,GAAK,KAAK,eAC/B,KAAK,MAAM,CAEf,EAAG,CAAE,KAAM,EAAM,CAAC,EAElB,KAAK,SAAWR,EAChB,KAAK,cAAgBG,EAEdL,CACT,CAEA,MAAO,CACA,KAAK,SAAS,KAAK,OAAO,EAE/B,KAAK,KAAO,GACZ,KAAK,QAAQ,UAAU,OAAO,QAAQ,EACtC,KAAK,cAAc,UAAU,OAAO,oBAAqB,kBAAkB,EAC3E,KAAK,cAAc,UAAU,IAAI,eAAe,EAChD,SAAS,KAAK,MAAM,SAAW,QACjC,CAEA,OAAQ,CACN,KAAK,KAAO,GACZ,IAAMY,EAAiB,KAAK,WAAa,OAAS,oBAAsB,mBACxE,KAAK,cAAc,UAAU,OAAO,eAAe,EACnD,KAAK,cAAc,UAAU,IAAIA,CAAc,EAE/C,WAAW,IAAM,CACX,KAAK,SAAS,YAChB,KAAK,QAAQ,UAAU,IAAI,QAAQ,EAErC,SAAS,KAAK,MAAM,SAAW,EACjC,EAAG,GAAG,EAEF,KAAK,SACP,KAAK,QAAQ,CAEjB,CAEA,QAAS,CACP,KAAK,KAAO,KAAK,MAAM,EAAI,KAAK,KAAK,CACvC,CACF,ICvHA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,KAAOA,EAAQ,MAAQ,YAC5B,KAAK,MAAQA,EAAQ,OAAS,UAC9B,KAAK,QAAUA,EAAQ,SAAW,8BAClC,KAAK,OAASA,EAAQ,QAAU,KAChC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EACT,4DACA,KAAK,SACP,CACF,CAAC,EAGKC,EAAcC,EAAc,MAAO,CACvC,UAAW,gBACX,KAAM,KAAK,IACb,CAAC,EACDH,EAAiB,YAAYE,CAAW,EAGxC,IAAME,EAAeD,EAAc,KAAM,CACvC,UAAW,2CACX,KAAM,KAAK,KACb,CAAC,EACDH,EAAiB,YAAYI,CAAY,EAGzC,IAAMC,EAAiBF,EAAc,IAAK,CACxC,UAAW,qBACX,KAAM,KAAK,OACb,CAAC,EAID,GAHAH,EAAiB,YAAYK,CAAc,EAGvC,KAAK,OAAQ,CACf,IAAMC,EAAYH,EAAc,SAAU,CACxC,UAAW,+EACX,KAAM,KAAK,OAAO,KACpB,CAAC,EAEDG,EAAU,iBAAiB,QAAS,KAAK,OAAO,OAAO,EACvDN,EAAiB,YAAYM,CAAS,CACxC,CAEA,OAAON,CACT,CACF,IC5DA,IAAAO,GAAA,GAAAC,GAAAD,GAAA,UAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAmBK,CAAc,CACtC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,OAASA,EAAQ,QAAU,CAAC,EACjC,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,WAAaA,EAAQ,YAAc,SACxC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CACP,IAAMC,EAAc,MAAM,OAAO,OAAQ,CACvC,UAAWC,EAAK,YAAa,KAAK,SAAS,CAC7C,CAAC,EAEDD,EAAY,iBAAiB,SAAWE,GAAM,CAC5CA,EAAE,eAAe,EACjB,KAAK,aAAa,CACpB,CAAC,EAGD,KAAK,cAAgB,CAAC,EAEtB,KAAK,OAAO,QAAQC,GAAS,CAC3B,IAAMC,EAAiBC,EAAc,MAAO,CAC1C,UAAW,WACb,CAAC,EAGD,GAAIF,EAAM,MAAO,CACf,IAAMG,EAAQD,EAAc,QAAS,CACnC,UAAW,0CACX,KAAMF,EAAM,MACZ,MAAO,CAAE,IAAKA,EAAM,IAAK,CAC3B,CAAC,EACDC,EAAe,YAAYE,CAAK,CAClC,CAGA,IAAMC,EAAQ,SAAS,cAAcJ,EAAM,OAAS,WAAa,WAAa,OAAO,EACrFI,EAAM,GAAKJ,EAAM,KACjBI,EAAM,KAAOJ,EAAM,KACnBI,EAAM,UAAYN,EAChB,qDACA,8EACF,EAEIE,EAAM,OAAS,aACjBI,EAAM,KAAOJ,EAAM,MAAQ,QAGzBA,EAAM,cAAaI,EAAM,YAAcJ,EAAM,aAC7CA,EAAM,WAAUI,EAAM,SAAW,IACjCJ,EAAM,WAAUI,EAAM,SAAW,IAErCA,EAAM,MAAQJ,EAAM,OAAS,GAE7BC,EAAe,YAAYG,CAAK,EAGhC,IAAMC,EAAWH,EAAc,MAAO,CACpC,UAAW,8BACX,MAAO,CAAE,aAAcF,EAAM,IAAK,CACpC,CAAC,EACDC,EAAe,YAAYI,CAAQ,EAEnCR,EAAY,YAAYI,CAAc,EACtC,KAAK,cAAcD,EAAM,IAAI,EAAII,CACnC,CAAC,EAGD,IAAME,EAAYJ,EAAc,SAAU,CACxC,UAAWJ,EACT,8DACA,kDACF,EACA,KAAM,KAAK,WACX,MAAO,CAAE,KAAM,QAAS,CAC1B,CAAC,EAED,OAAAD,EAAY,YAAYS,CAAS,EAE1BT,CACT,CAEA,cAAe,CACb,IAAMU,EAAW,CAAC,EAElB,OAAO,QAAQ,KAAK,aAAa,EAAE,QAAQ,CAAC,CAACC,EAAMJ,CAAK,IAAM,CAC5DG,EAASC,CAAI,EAAIJ,EAAM,KACzB,CAAC,EAEG,KAAK,UACP,KAAK,SAASG,CAAQ,CAE1B,CAEA,WAAY,CACV,IAAME,EAAS,CAAC,EAChB,cAAO,QAAQ,KAAK,aAAa,EAAE,QAAQ,CAAC,CAACD,EAAMJ,CAAK,IAAM,CAC5DK,EAAOD,CAAI,EAAIJ,EAAM,KACvB,CAAC,EACMK,CACT,CAEA,UAAUA,EAAQ,CAChB,OAAO,QAAQA,CAAM,EAAE,QAAQ,CAAC,CAACD,EAAME,CAAK,IAAM,CAC5C,KAAK,cAAcF,CAAI,IACzB,KAAK,cAAcA,CAAI,EAAE,MAAQE,EAErC,CAAC,CACH,CAEA,SAASC,EAAWC,EAAS,CAC3B,IAAMP,EAAW,KAAK,QAAQ,cAAc,gBAAgBM,CAAS,IAAI,EACrEN,IACFA,EAAS,YAAcO,EACvBP,EAAS,UAAU,OAAO,QAAQ,EAEtC,CAEA,WAAWM,EAAW,CACpB,IAAMN,EAAW,KAAK,QAAQ,cAAc,gBAAgBM,CAAS,IAAI,EACrEN,IACFA,EAAS,YAAc,GACvBA,EAAS,UAAU,IAAI,QAAQ,EAEnC,CAEA,OAAQ,CACF,KAAK,SACP,KAAK,QAAQ,MAAM,CAEvB,CACF,IC7IA,IAAAQ,GAAA,GAAAC,GAAAD,GAAA,eAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAwBK,CAAc,CAC3C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,QAAUA,EAAQ,SAAW,WAClC,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,SACpC,KAAK,MAAQA,EAAQ,OAAS,IAC9B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,QAAU,GACf,KAAK,UAAY,IACnB,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,uBACb,CAAC,EAGKC,EAAiB,SAAS,cAAc,KAAK,EACnDA,EAAe,UAAY,oFAC3BA,EAAe,YAAc,KAAK,QAElCD,EAAiB,YAAYC,CAAc,EAG3C,IAAMC,EAAc,SAAS,cAAc,KAAK,EAChD,OAAAA,EAAY,UAAYC,EACtB,gFACA,qBACA,KAAK,mBAAmB,EACxB,KAAK,SACP,EACAD,EAAY,UAAY,KAAK,QAE7BF,EAAiB,YAAYE,CAAW,EAGxCF,EAAiB,iBAAiB,aAAc,IAAM,KAAK,KAAKE,CAAW,CAAC,EAC5EF,EAAiB,iBAAiB,aAAc,IAAM,KAAK,KAAKE,CAAW,CAAC,EAE5E,KAAK,YAAcA,EAEZF,CACT,CAEA,oBAAqB,CACnB,IAAMI,EAAY,CAChB,IAAK,0BACL,OAAQ,uBACR,KAAM,wBACN,MAAO,sBACT,EACA,OAAOA,EAAU,KAAK,QAAQ,GAAKA,EAAU,MAC/C,CAEA,KAAKF,EAAc,KAAK,YAAa,CAC/B,KAAK,SAAW,CAACA,IAErB,KAAK,UAAY,WAAW,IAAM,CAChC,KAAK,QAAU,GACfA,EAAY,UAAU,OAAO,QAAQ,EACrCA,EAAY,UAAU,IAAI,cAAe,qBAAsB,cAAc,CAC/E,EAAG,KAAK,KAAK,EACf,CAEA,KAAKA,EAAc,KAAK,YAAa,CAC/B,CAAC,KAAK,SAAW,CAACA,IAEtB,aAAa,KAAK,SAAS,EAC3B,KAAK,QAAU,GACfA,EAAY,UAAU,IAAI,QAAQ,EAClCA,EAAY,UAAU,OAAO,aAAa,EAC5C,CAEA,WAAWG,EAAS,CAClB,KAAK,QAAUA,EACX,KAAK,cACP,KAAK,YAAY,UAAYA,EAEjC,CACF,ICxFA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,KAAOA,EAAQ,MAAQ,OAC5B,KAAK,YAAcA,EAAQ,aAAe,GAC1C,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CAGP,IAAMC,EAAe,MAAM,OAAO,QAAS,CACzC,UAAWC,EAHO,qPAGW,KAAK,SAAS,EAC3C,MAAO,CACL,KAAM,KAAK,KACX,YAAa,KAAK,YAClB,MAAO,KAAK,MACZ,KAAM,KAAK,KACX,SAAU,KAAK,SAAW,GAAK,KAC/B,SAAU,KAAK,SAAW,GAAK,IACjC,CACF,CAAC,EAED,OAAI,KAAK,WACP,KAAK,GAAG,SAAU,KAAK,QAAQ,EAC/B,KAAK,GAAG,QAAS,KAAK,QAAQ,GAGzBD,CACT,CAEA,UAAW,CACT,OAAO,KAAK,SAAS,OAAS,EAChC,CAEA,SAASE,EAAO,CACd,KAAK,MAAQA,EACT,KAAK,UACP,KAAK,QAAQ,MAAQA,EAEzB,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EAChB,KAAK,KAAK,WAAYA,EAAW,GAAK,IAAI,CAC5C,CAEA,eAAeC,EAAa,CAC1B,KAAK,YAAcA,EACf,KAAK,UACP,KAAK,QAAQ,YAAcA,EAE/B,CAEA,OAAQ,CACN,MAAM,MAAM,CACd,CAEA,OAAQ,CACN,KAAK,SAAS,EAAE,CAClB,CACF,IC1EA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,gBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAyBK,CAAc,CAC5C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,OAASA,EAAQ,QAAU,KAChC,KAAK,OAASA,EAAQ,QAAU,KAChC,KAAK,MAAQA,EAAQ,OAAS,KAC9B,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CAGP,IAAMC,EAAe,MAAM,OAAO,MAAO,CACvC,UAAWC,EAHO,qHAGW,KAAK,SAAS,CAC7C,CAAC,EAED,GAAI,KAAK,OAAQ,CACf,IAAMC,EAAWC,EAAc,MAAO,CACpC,UAAW,yDACX,KAAM,KAAK,MACb,CAAC,EACDH,EAAa,YAAYE,CAAQ,CACnC,CAEA,GAAI,KAAK,MAAO,CACd,IAAME,EAAU,KAAK,MAAM,SAAW,KAAK,MAAM,OAAO,EACxDA,EAAQ,UAAU,OAAO,SAAU,eAAgB,qBAAqB,EACxEJ,EAAa,YAAYI,CAAO,CAClC,CAEA,GAAI,KAAK,OAAQ,CACf,IAAMC,EAAWF,EAAc,MAAO,CACpC,UAAW,yDACX,KAAM,KAAK,MACb,CAAC,EACDH,EAAa,YAAYK,CAAQ,CACnC,CAEA,OAAOL,CACT,CACF,IChDA,IAAAM,GAAA,GAAAC,GAAAD,GAAA,cAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAuBK,CAAc,CAC1C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,OAASA,EAAQ,QAAU,EAChC,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,WAAaA,EAAQ,YAAc,IAC1C,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAWC,EAAK,aAAc,KAAK,SAAS,CAC9C,CAAC,EAED,KAAK,OAAS,CAAC,EAEf,QAASC,EAAI,EAAGA,EAAI,KAAK,OAAQA,IAAK,CACpC,IAAMC,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,KAAO,OACbA,EAAM,UAAY,IAClBA,EAAM,UAAY,UAClBA,EAAM,UAAYF,EAChB,kFACA,4EACA,gCACF,EAEI,KAAK,OAAS,KAAK,MAAMC,CAAC,IAC5BC,EAAM,MAAQ,KAAK,MAAMD,CAAC,GAG5BC,EAAM,iBAAiB,QAAUC,GAAM,CACrC,IAAMC,EAAQD,EAAE,OAAO,MACvB,GAAI,CAAC,QAAQ,KAAKC,CAAK,EAAG,CACxBD,EAAE,OAAO,MAAQ,GACjB,MACF,CAEIC,GAASH,EAAI,KAAK,OAAS,GAC7B,KAAK,OAAOA,EAAI,CAAC,EAAE,MAAM,EAG3B,KAAK,YAAY,CACnB,CAAC,EAEDC,EAAM,iBAAiB,UAAYC,GAAM,CACnCA,EAAE,MAAQ,YACR,CAACD,EAAM,OAASD,EAAI,GACtB,KAAK,OAAOA,EAAI,CAAC,EAAE,MAAM,EAElBE,EAAE,MAAQ,aAAeF,EAAI,EACtC,KAAK,OAAOA,EAAI,CAAC,EAAE,MAAM,EAChBE,EAAE,MAAQ,cAAgBF,EAAI,KAAK,OAAS,GACrD,KAAK,OAAOA,EAAI,CAAC,EAAE,MAAM,CAE7B,CAAC,EAED,KAAK,OAAO,KAAKC,CAAK,EACtBH,EAAiB,YAAYG,CAAK,CACpC,CAEA,OAAOH,CACT,CAEA,aAAc,CACZ,KAAK,MAAQ,KAAK,OAAO,IAAIG,GAASA,EAAM,KAAK,EAAE,KAAK,EAAE,EAEtD,KAAK,UACP,KAAK,SAAS,KAAK,KAAK,EAGtB,KAAK,MAAM,SAAW,KAAK,QAAU,KAAK,YAC5C,KAAK,WAAW,KAAK,KAAK,CAE9B,CAEA,UAAW,CACT,OAAO,KAAK,KACd,CAEA,SAASE,EAAO,CACd,KAAK,MAAQA,EACb,QAASH,EAAI,EAAGA,EAAI,KAAK,OAAQA,IAC/B,KAAK,OAAOA,CAAC,EAAE,MAAQG,EAAMH,CAAC,GAAK,EAEvC,CAEA,OAAQ,CACN,KAAK,OAAO,QAAQC,GAAS,CAC3BA,EAAM,MAAQ,EAChB,CAAC,EACD,KAAK,MAAQ,EACf,CAEA,OAAQ,CACF,KAAK,OAAO,OAAS,GACvB,KAAK,OAAO,CAAC,EAAE,MAAM,CAEzB,CACF,IC5GA,IAAAG,GAAA,GAAAC,GAAAD,GAAA,UAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAmBK,CAAc,CACtC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,SAAWA,EAAQ,UAAY,EACtC,CAEA,QAAS,CACP,IAAMC,EAAc,4JAEdC,EAAe,KAAK,SAAW,2BAA6B,gBAE5DC,EAAc,MAAM,OAAO,MAAO,CACtC,UAAWC,EAAKH,EAAaC,EAAc,KAAK,SAAS,EACzD,MAAO,CACL,KAAM,SACN,gBAAiB,KAAK,SACtB,SAAU,KAAK,SAAW,GAAK,KAC/B,aAAc,KAAK,KACrB,CACF,CAAC,EAEGG,EAAO,GACX,OAAI,KAAK,OACPA,GAAQ,+BAA+B,KAAK,IAAI,WAElDA,GAAQ,SAAS,KAAK,KAAK,UAE3BF,EAAY,UAAYE,EACjBF,CACT,CAEA,YAAYG,EAAU,CACpB,KAAK,SAAWA,EACZ,KAAK,UACP,KAAK,KAAK,gBAAiBA,CAAQ,EACnC,KAAK,YAAY,2BAA4BA,CAAQ,EAEzD,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EAChB,KAAK,KAAK,WAAYA,EAAW,GAAK,IAAI,CAC5C,CACF,ICxDA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAoBK,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CAGP,IAAMC,EAAe,MAAM,OAAO,QAAS,CACzC,UAAWC,EAHO,+CAGW,KAAK,SAAS,EAC3C,MAAO,CAAE,IAAK,KAAK,OAAQ,CAC7B,CAAC,EAEGC,EAAO,KAAK,KAChB,OAAI,KAAK,WACPA,GAAQ,6CAGVF,EAAa,UAAYE,EAClBF,CACT,CAEA,QAAQG,EAAM,CAEZ,GADA,KAAK,KAAOA,EACR,KAAK,QAAS,CAChB,IAAID,EAAOC,EACP,KAAK,WACPD,GAAQ,6CAEV,KAAK,QAAQ,UAAYA,CAC3B,CACF,CAEA,YAAYE,EAAU,CAEpB,GADA,KAAK,SAAWA,EACZ,KAAK,QAAS,CAChB,IAAMC,EAAe,KAAK,QAAQ,cAAc,qBAAqB,EACjED,GAAY,CAACC,EACf,KAAK,QAAQ,WAAa,4CACjB,CAACD,GAAYC,GACtBA,EAAa,OAAO,CAExB,CACF,CACF,ICxDA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,SAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAkBK,CAAc,CACrC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,IAC9B,KAAK,UAAYA,EAAQ,WAAa,EACxC,CAEA,QAAS,CAGP,IAAMC,EAAa,MAAM,OAAO,MAAO,CACrC,UAAWC,EAHO,kHAGW,KAAK,SAAS,CAC7C,CAAC,EAED,OAAAD,EAAW,YAAc,KAAK,MACvBA,CACT,CAEA,SAASE,EAAO,CACd,KAAK,MAAQA,EACT,KAAK,UACP,KAAK,QAAQ,YAAcA,EAE/B,CACF,IChCA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,kBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA2BK,CAAc,CAC9C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,YAAcA,EAAQ,aAAe,YAC1C,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,KAAOA,EAAQ,MAAQ,GAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CAGP,IAAMC,EAAgB,MAAM,OAAO,SAAU,CAC3C,UAAWC,EAHO,wQAGW,KAAK,SAAS,EAC3C,MAAO,CACL,SAAU,KAAK,SAAW,GAAK,KAC/B,SAAU,KAAK,SAAW,GAAK,KAC/B,GAAI,KAAK,MAAQ,CAAE,KAAM,KAAK,IAAK,CACrC,CACF,CAAC,EAGD,GAAI,KAAK,YAAa,CACpB,IAAMC,EAAoB,SAAS,cAAc,QAAQ,EACzDA,EAAkB,MAAQ,GAC1BA,EAAkB,YAAc,KAAK,YACrCA,EAAkB,SAAW,GAC7BF,EAAc,YAAYE,CAAiB,CAC7C,CAGA,YAAK,MAAM,QAAQC,GAAQ,CACzB,IAAMC,EAAgB,SAAS,cAAc,QAAQ,EACrDA,EAAc,MAAQD,EAAK,MAC3BC,EAAc,YAAcD,EAAK,MAC7BA,EAAK,QAAU,KAAK,WACtBC,EAAc,SAAW,IAE3BJ,EAAc,YAAYI,CAAa,CACzC,CAAC,EAEG,KAAK,UACP,KAAK,GAAG,SAAU,KAAK,QAAQ,EAG1BJ,CACT,CAEA,UAAW,CACT,OAAO,KAAK,SAAS,OAAS,EAChC,CAEA,SAASK,EAAO,CACd,KAAK,SAAWA,EACZ,KAAK,UACP,KAAK,QAAQ,MAAQA,EAEzB,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EAChB,KAAK,KAAK,WAAYA,EAAW,GAAK,IAAI,CAC5C,CAEA,QAAQC,EAAOF,EAAO,CACpB,GAAI,KAAK,QAAS,CAChB,IAAMG,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQH,EACfG,EAAO,YAAcD,EACrB,KAAK,QAAQ,YAAYC,CAAM,CACjC,CACF,CAEA,WAAWH,EAAO,CAChB,GAAI,KAAK,QAAS,CAChB,IAAMG,EAAS,KAAK,QAAQ,cAAc,iBAAiBH,CAAK,IAAI,EAChEG,GACFA,EAAO,OAAO,CAElB,CACF,CACF,IC7FA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAsBK,CAAc,CACzC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,MACpC,KAAK,MAAQA,EAAQ,OAAS,IAC9B,KAAK,QAAUA,EAAQ,SAAW,QAClC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,QAAU,GACf,KAAK,UAAY,IACnB,CAEA,QAAS,CACP,IAAMC,EAAmB,MAAM,OAAO,MAAO,CAC3C,UAAW,uBACb,CAAC,EAGKC,EAAiB,SAAS,cAAc,KAAK,EACnDA,EAAe,UAAYC,EACzB,0FACA,4CACA,KAAK,mBAAmB,EACxB,KAAK,SACP,EACAD,EAAe,YAAc,KAAK,QAGlC,IAAME,EAAQ,SAAS,cAAc,KAAK,EAC1C,OAAAA,EAAM,UAAYD,EAChB,mDACA,KAAK,gBAAgB,CACvB,EACAD,EAAe,YAAYE,CAAK,EAEhCH,EAAiB,YAAYC,CAAc,EAE3C,KAAK,eAAiBA,EAGlB,KAAK,UAAY,SACnBD,EAAiB,iBAAiB,aAAc,IAAM,KAAK,KAAK,CAAC,EACjEA,EAAiB,iBAAiB,aAAc,IAAM,KAAK,KAAK,CAAC,GACxD,KAAK,UAAY,UAC1BA,EAAiB,iBAAiB,QAAS,IAAM,KAAK,KAAK,EAAG,EAAI,EAClEA,EAAiB,iBAAiB,OAAQ,IAAM,KAAK,KAAK,EAAG,EAAI,GAG5DA,CACT,CAEA,oBAAqB,CACnB,IAAMI,EAAY,CAChB,IAAK,uDACL,OAAQ,oDACR,KAAM,qDACN,MAAO,mDACT,EACA,OAAOA,EAAU,KAAK,QAAQ,GAAKA,EAAU,GAC/C,CAEA,iBAAkB,CAChB,IAAMC,EAAiB,CACrB,IAAK,gEACL,OAAQ,kEACR,KAAM,+DACN,MAAO,gEACT,EACA,OAAOA,EAAe,KAAK,QAAQ,GAAKA,EAAe,GACzD,CAEA,MAAO,CACD,KAAK,UAET,KAAK,UAAY,WAAW,IAAM,CAChC,KAAK,QAAU,GACf,KAAK,eAAe,UAAU,OAAO,QAAQ,EAC7C,KAAK,eAAe,UAAU,IAAI,aAAa,CACjD,EAAG,KAAK,KAAK,EACf,CAEA,MAAO,CACA,KAAK,UAEV,aAAa,KAAK,SAAS,EAC3B,KAAK,QAAU,GACf,KAAK,eAAe,UAAU,OAAO,aAAa,EAClD,KAAK,eAAe,UAAU,IAAI,QAAQ,EAC5C,CAEA,WAAWC,EAAS,CAClB,KAAK,QAAUA,EACX,KAAK,iBACP,KAAK,eAAe,YAAcA,EAEtC,CACF,ICxGA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,YAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAAqBK,CAAc,CACxC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,GAC9B,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,QAAUA,EAAQ,SAAW,UAClC,KAAK,KAAOA,EAAQ,MAAQ,KAC5B,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CACP,IAAMC,EAAc,gKAEdC,EAAiB,CACrB,QAAS,KAAK,QACV,yBACA,8CACJ,QAAS,KAAK,QACV,kDACA,yDACN,EAEMC,EAAc,CAClB,GAAI,oBACJ,GAAI,sBACJ,GAAI,mBACN,EAEMC,EAAgB,MAAM,OAAO,SAAU,CAC3C,UAAWC,EACTJ,EACAC,EAAe,KAAK,OAAO,EAC3BC,EAAY,KAAK,IAAI,EACrB,KAAK,SACP,EACA,MAAO,CACL,eAAgB,KAAK,QACrB,SAAU,KAAK,SAAW,GAAK,IACjC,CACF,CAAC,EAED,OAAAC,EAAc,YAAc,KAAK,MAEjC,KAAK,GAAG,QAAS,IAAM,CACrB,KAAK,OAAO,CACd,CAAC,EAEMA,CACT,CAEA,WAAY,CACV,OAAO,KAAK,OACd,CAEA,WAAWE,EAAS,CAClB,KAAK,QAAUA,EACX,KAAK,UACP,KAAK,KAAK,eAAgBA,CAAO,EACjC,KAAK,YAAY,yBAA0BA,CAAO,EAC9C,KAAK,UACP,KAAK,SAASA,CAAO,EAG3B,CAEA,QAAS,CACP,KAAK,WAAW,CAAC,KAAK,OAAO,CAC/B,CAEA,YAAYC,EAAU,CACpB,KAAK,SAAWA,EAChB,KAAK,KAAK,WAAYA,EAAW,GAAK,IAAI,CAC5C,CACF,ICnFA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,iBAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,cAA0BK,CAAc,CAC7C,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,MAAQA,EAAQ,OAAS,CAAC,EAC/B,KAAK,SAAWA,EAAQ,UAAY,KACpC,KAAK,SAAWA,EAAQ,UAAY,GACpC,KAAK,YAAcA,EAAQ,aAAe,aAC1C,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,SAAWA,EAAQ,UAAY,IACtC,CAEA,QAAS,CACP,IAAMC,EAAmB,KAAK,cAAgB,WAAa,WAAa,WAGlEC,EAAe,MAAM,OAAO,MAAO,CACvC,UAAWC,EAAK,OAAQF,EAHN,gEAGqC,KAAK,SAAS,EACrE,MAAO,CAAE,KAAM,OAAQ,CACzB,CAAC,EAED,YAAK,cAAgB,CAAC,EAEtB,KAAK,MAAM,QAAQ,CAACG,EAAMC,IAAU,CAClC,IAAMC,EAAa,KAAK,SACnB,MAAM,QAAQ,KAAK,QAAQ,GAAK,KAAK,SAAS,SAASF,EAAK,KAAK,EAClEA,EAAK,QAAU,KAAK,SAElBG,EAAaJ,EACjB,8DACAG,EAAa,yBAA2B,0CACxCD,EAAQ,EAAK,KAAK,cAAgB,WAAa,2BAA6B,2BAA8B,EAC5G,EAEMG,EAAMC,EAAc,SAAU,CAClC,UAAWF,EACX,KAAMH,EAAK,MACX,MAAO,CACL,aAAcA,EAAK,MACnB,eAAgBE,EAChB,KAAM,QACR,CACF,CAAC,EAEDE,EAAI,iBAAiB,QAAS,IAAM,CAClC,GAAI,KAAK,SAAU,CACZ,MAAM,QAAQ,KAAK,QAAQ,IAAG,KAAK,SAAW,CAAC,GACpD,IAAMH,EAAQ,KAAK,SAAS,QAAQD,EAAK,KAAK,EAC1CC,EAAQ,GACV,KAAK,SAAS,OAAOA,EAAO,CAAC,EAE7B,KAAK,SAAS,KAAKD,EAAK,KAAK,CAEjC,MACE,KAAK,SAAWA,EAAK,MAEvB,KAAK,WAAW,EACZ,KAAK,UACP,KAAK,SAAS,KAAK,QAAQ,CAE/B,CAAC,EAEDF,EAAa,YAAYM,CAAG,EAC5B,KAAK,cAAc,KAAKA,CAAG,CAC7B,CAAC,EAEMN,CACT,CAEA,YAAa,CACX,KAAK,cAAc,QAAQM,GAAO,CAChC,IAAME,EAAQF,EAAI,aAAa,YAAY,EACrCF,EAAa,KAAK,SACnB,MAAM,QAAQ,KAAK,QAAQ,GAAK,KAAK,SAAS,SAASI,CAAK,EAC7DA,IAAU,KAAK,SAEnBF,EAAI,aAAa,eAAgBF,CAAU,EAC3CE,EAAI,UAAYL,EACd,8DACAG,EAAa,yBAA2B,yCAC1C,CACF,CAAC,CACH,CAEA,UAAW,CACT,OAAO,KAAK,QACd,CAEA,SAASI,EAAO,CACd,KAAK,SAAWA,EAChB,KAAK,WAAW,CAClB,CACF,ICnGA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,WAAAE,KAAA,IAOaA,GAPbC,GAAAC,GAAA,KAIAC,KACAC,KAEaJ,GAAN,MAAMK,UAAcC,CAAc,CACvC,YAAYC,EAAU,CAAC,EAAG,CACxB,MAAMA,CAAO,EAEb,KAAK,QAAUA,EAAQ,SAAW,GAClC,KAAK,KAAOA,EAAQ,MAAQ,UAExB,OAAOA,EAAQ,SAAa,IAC9B,KAAK,SAAWA,EAAQ,SAExB,KAAK,SAAY,OAAO,OAAW,KAAe,OAAO,WAAa,IAAO,KAAO,IAEtF,KAAK,SAAWA,EAAQ,UAAY,YACpC,KAAK,UAAYA,EAAQ,WAAa,GACtC,KAAK,QAAUA,EAAQ,SAAW,IACpC,CAEA,SAAU,CACR,GAAI,CAAC,KAAK,QAAS,OACnB,IAAMC,EAAK,KAAK,QAEhBA,EAAG,UAAU,IAAI,KAAK,sBAAsB,CAAC,EAC7C,IAAMC,EAAS,IAAM,CACnBD,EAAG,oBAAoB,eAAgBC,CAAM,EAE7C,MAAM,QAAQ,EAEd,IAAMC,EAAYL,EAAM,aAAa,KAAK,QAAQ,EAC9CK,GAAaA,EAAU,oBAAsB,GAAKA,EAAU,aAC9DA,EAAU,WAAW,YAAYA,CAAS,EACtCL,EAAM,aACR,OAAOA,EAAM,YAAY,KAAK,UAAY,WAAW,EAG3D,EACAG,EAAG,iBAAiB,eAAgBC,CAAM,EAE1C,WAAWA,EAAQ,GAAG,CACxB,CAEA,OAAO,aAAaE,EAAU,CAC5B,IAAMC,EAAMD,GAAY,YAExB,GADK,KAAK,cAAa,KAAK,YAAc,CAAC,GACvC,KAAK,YAAYC,CAAG,GAAK,SAAS,KAAK,SAAS,KAAK,YAAYA,CAAG,CAAC,EACvE,OAAO,KAAK,YAAYA,CAAG,EAE7B,IAAMF,EAAYG,EAAc,MAAO,CACrC,UAAWC,EACT,yDACA,KAAK,+BAA+BF,CAAG,CACzC,CACF,CAAC,EACD,gBAAS,KAAK,YAAYF,CAAS,EACnC,KAAK,YAAYE,CAAG,EAAIF,EACjBA,CACT,CAEA,OAAO,+BAA+BC,EAAU,CAC9C,OAAQA,EAAU,CAChB,IAAK,WACH,MAAO,2BACT,IAAK,YACH,MAAO,0BACT,IAAK,cACH,MAAO,8BACT,IAAK,eACH,MAAO,6BACT,IAAK,aACH,MAAO,yDACT,QACE,MAAO,yBACX,CACF,CAEA,QAAS,CACP,IAAMI,EAAmBV,EAAM,aAAa,KAAK,QAAQ,EAEnDW,EAAeH,EAAc,MAAO,CACxC,UAAWC,EAET,oGACA,KAAK,uBAAuB,EAC5B,KAAK,eAAe,EACpB,KAAK,SACP,CACF,CAAC,EAGKG,EAAcJ,EAAc,OAAQ,CACxC,UAAW,0BACX,KAAM,KAAK,QAAQ,CACrB,CAAC,EACDG,EAAa,YAAYC,CAAW,EAGpC,IAAMC,EAAiBL,EAAc,OAAQ,CAC3C,KAAM,KAAK,QAEX,UAAW,6BACb,CAAC,EACDG,EAAa,YAAYE,CAAc,EAGvCF,EAAa,aAAa,OAAQ,KAAK,OAAS,QAAU,QAAU,QAAQ,EAC5EA,EAAa,aAAa,YAAa,KAAK,OAAS,QAAU,YAAc,QAAQ,EAGrF,IAAMG,EAAWN,EAAc,SAAU,CACvC,UAAW,8DACX,KAAM,MACR,CAAC,EAcD,IAZAM,EAAS,aAAa,aAAc,sBAAsB,EAC1DA,EAAS,iBAAiB,QAAS,IAAM,CACvC,KAAK,QAAQ,CACf,CAAC,EAEDH,EAAa,YAAYG,CAAQ,EAGjC,KAAK,QAAUH,EACfD,EAAiB,YAAY,KAAK,OAAO,EAGlCA,EAAiB,SAAS,OAAS,GACxCA,EAAiB,YAAYA,EAAiB,iBAAiB,EAIjE,OAAI,KAAK,SAAW,GAClB,WAAW,IAAM,CACf,KAAK,QAAQ,CACf,EAAG,KAAK,QAAQ,EAGX,KAAK,OACd,CAEA,wBAAyB,CACvB,IAAMK,EAAM,KAAK,UAAY,YAC7B,OAAIA,IAAQ,aAAeA,IAAQ,eAAuB,yEACtDA,IAAQ,YAAcA,IAAQ,cAAsB,wEACjD,sEACT,CAEA,uBAAwB,CACtB,IAAMA,EAAM,KAAK,UAAY,YAC7B,OAAIA,IAAQ,aAAeA,IAAQ,eAAuB,0BACtDA,IAAQ,YAAcA,IAAQ,cAAsB,yBACjD,uBACT,CAEA,oBAAqB,CACnB,IAAMC,EAAY,CAChB,WAAY,eACZ,YAAa,gBACb,cAAe,kBACf,eAAgB,mBAChB,aAAc,2CAChB,EACA,OAAOA,EAAU,KAAK,QAAQ,GAAKA,EAAU,cAAc,CAC7D,CAEA,gBAAiB,CACf,IAAMC,EAAQ,CACZ,QAAS,yBACT,QAAS,0BACT,MAAO,wBACP,QAAS,2BACT,KAAM,wBACR,EACA,OAAOA,EAAM,KAAK,IAAI,GAAKA,EAAM,OACnC,CAEA,SAAU,CACR,IAAMC,EAAQ,CACZ,QAAS,SACT,QAAS,SACT,MAAO,SACP,QAAS,SACT,KAAM,QACR,EACA,OAAOA,EAAM,KAAK,IAAI,GAAKA,EAAM,OACnC,CAEA,OAAO,KAAKC,EAASjB,EAAU,CAAC,EAAG,CACjC,IAAMkB,EAAQ,IAAIpB,EAAM,CAAE,QAAAmB,EAAS,GAAGjB,CAAQ,CAAC,EACzCmB,EAAUD,EAAM,OAAO,EAC7B,OAAOA,CACT,CAGA,OAAO,QAAQD,EAASjB,EAAU,CAAC,EAAG,CAAE,OAAO,KAAK,KAAKiB,EAAS,CAAE,GAAGjB,EAAS,KAAM,SAAU,CAAC,CAAG,CACpG,OAAO,MAAMiB,EAASjB,EAAU,CAAC,EAAG,CAAE,OAAO,KAAK,KAAKiB,EAAS,CAAE,GAAGjB,EAAS,KAAM,QAAS,SAAUA,EAAQ,UAAY,WAAY,CAAC,CAAG,CAC3I,OAAO,KAAKiB,EAASjB,EAAU,CAAC,EAAG,CAAE,OAAO,KAAK,KAAKiB,EAAS,CAAE,GAAGjB,EAAS,KAAM,MAAO,CAAC,CAAG,CAC9F,OAAO,QAAQiB,EAASjB,EAAU,CAAC,EAAG,CAAE,OAAO,KAAK,KAAKiB,EAAS,CAAE,GAAGjB,EAAS,KAAM,SAAU,CAAC,CAAG,CACtG,EAGA,GAAI,CAAC,SAAS,cAAc,mBAAmB,EAAG,CAChD,IAAMoB,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,aAAa,aAAc,MAAM,EACvCA,EAAM,YAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAqCpB,SAAS,KAAK,YAAYA,CAAK,CACjC,IC5MO,SAASC,GAAkB,CAAC,KAAAC,EAAO,SAAU,SAAAC,EAAW,iBAAkB,UAAAC,EAAY,GAAI,EAAI,CAAC,EAAG,CACvG,GAAI,OAAO,qBAAyB,IAAa,OACjD,IAAMC,EAAW,IAAI,qBAAqB,MAAOC,EAASC,IAAQ,CAChE,QAAWC,KAASF,EAAS,CAC3B,GAAI,CAACE,EAAM,eAAgB,SAC3B,IAAMC,EAAKD,EAAM,OACXE,EAAOD,EAAG,QAAQ,SAAW,GAC7B,CAACE,EAAYC,EAAW,MAAM,EAAIF,EAAK,MAAM,GAAG,EACtD,GAAI,CAACC,EAAY,CAAEJ,EAAI,UAAUE,CAAE,EAAG,QAAU,CAChD,GAAI,CACF,IAAII,EAAM,KACJC,EAASC,GAAgBJ,CAAU,EACzC,GAAI,OAAOG,GAAW,WACpBD,EAAM,MAAMC,EAAO,MAGnB,OAAM,IAAI,MAAM,6CAA+CH,CAAU,EAE3E,IAAMK,EAAKH,EAAID,CAAQ,GAAKC,EAAI,SAAW,KAC3C,GAAI,OAAOG,GAAO,WAChB,GAAI,CAAEA,EAAGP,CAAE,CAAG,OAASQ,EAAG,CAAE,QAAQ,MAAM,sBAAuBA,CAAC,CAAG,CAEzE,OAASA,EAAG,CACV,QAAQ,MAAM,iCAAkCN,EAAYM,CAAC,CAC/D,QAAE,CACAV,EAAI,UAAUE,CAAE,CAClB,CACF,CACF,EAAG,CAAC,UAAAL,CAAS,CAAC,EACdF,EAAK,iBAAiBC,CAAQ,EAAE,QAAQM,GAAMJ,EAAS,QAAQI,CAAE,CAAC,CACpE,CAzEA,IAIMM,GAJNG,GAAAC,GAAA,KAIMJ,GAAkB,CAEtB,sBAAuB,IAAM,sCAC7B,4BAA6B,IAAM,sCACnC,uBAAwB,IAAM,sCAC9B,sBAAuB,IAAM,sCAC7B,uBAAwB,IAAM,sCAC9B,4BAA6B,IAAM,sCACnC,2BAA4B,IAAM,sCAClC,qBAAsB,IAAM,sCAC5B,yBAA0B,IAAM,sCAChC,sBAAuB,IAAM,sCAC7B,yBAA0B,IAAM,sCAChC,4BAA6B,IAAM,sCACnC,wBAAyB,IAAM,sCAC/B,yBAA0B,IAAM,sCAChC,4BAA6B,IAAM,sCACnC,2BAA4B,IAAM,sCAClC,uBAAwB,IAAM,sCAC9B,6BAA8B,IAAM,sCACpC,uBAAwB,IAAM,sCAC9B,sBAAuB,IAAM,sCAC7B,qBAAsB,IAAM,sCAC5B,0BAA2B,IAAM,sCACjC,sBAAuB,IAAM,sCAC7B,2BAA4B,IAAM,sCAClC,yBAA0B,IAAM,sCAChC,qBAAsB,IAAM,sCAC5B,sBAAuB,IAAM,sCAC7B,oBAAqB,IAAM,sCAC3B,6BAA8B,IAAM,sCACpC,wBAAyB,IAAM,sCAC/B,uBAAwB,IAAM,sCAC9B,4BAA6B,IAAM,sCACnC,sBAAuB,IAAM,qCAG/B,ICzCA,IAAAK,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAu1BCD,GA51BPE,GAAAC,GAAA,KAKMF,IAAe,UAAW,CAC5B,aAEA,IAAIG,EAAc,KAElB,eAAeC,GAAO,CAElB,GAAK,UAAU,YAAY,EAE3B,OAAMC,EAAgB,EAEtB,GAAI,CACAC,EAAoB,CACxB,MAAY,CAEZ,CACAC,EAAgB,EAChBC,EAAgB,EAChBC,EAAiB,EACjBC,EAAsB,EACtBC,EAAqB,EACzB,CAKA,SAASA,GAAuB,CAC5BC,EAAkB,EAClBC,EAAe,EACfC,EAAmB,EACnBC,EAA4B,EAC5BC,EAAiB,EACjBC,EAAyB,CAC7B,CAKA,SAASL,GAAoB,CACzB,IAAMM,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAGhB,IAAMC,EAAShB,GAAa,gBAAkB,KAAK,MAAM,KAAK,OAAO,EAAI,GAAG,EAAI,IAC1EiB,EAAOD,GAAU,IAAM,OAASA,GAAU,IAAM,SAAW,SAC3DE,EAAa,CACf,OAAQ,8BACR,OAAQ,4BACR,KAAM,+BACV,EACMC,EAAWF,IAAS,OAAS,KAAOA,IAAS,SAAW,OAAS,SACjEG,EAAiBH,IAAS,OAAS,EAAIA,IAAS,SAAW,IAAM,IACjEI,EAAWF,EAAW,KAAK,IAAI,IAAMH,EAASI,EAAkB,GAAG,EAAI,IAE7EL,EAAU,UAAY;AAAA,4CACcG,EAAWD,CAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2EASeA,CAAI;AAAA,4DACnBD,EAAO,eAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAQ7DG,EAAW;AAAA;AAAA;AAAA,wCAGOC,EAAiBJ,CAAM,cAAcG,CAAQ;AAAA,wCAC7C,KAAK,MAAME,CAAQ,CAAC;AAAA;AAAA;AAAA,mHAGuDA,CAAQ;AAAA;AAAA;AAAA,sBAGnG,sFAAgF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAUpG,CAKA,SAASX,GAAiB,CACtB,IAAMK,EAAY,SAAS,eAAe,aAAa,EACvD,GAAI,CAACA,EAAW,OAGhB,IAAMO,EAAQ,CACV,YAAatB,GAAa,cAAgB,KAAK,MAAM,KAAK,OAAO,EAAI,EAAE,EAAI,EAC3E,WAAYA,GAAa,aAAe,KAAK,MAAM,KAAK,OAAO,EAAI,GAAI,EAAI,IAC3E,cAAeA,GAAa,gBAAkB,KAAK,MAAM,KAAK,OAAO,EAAI,EAAE,EAAI,EAC/E,eAAgBA,GAAa,eAAiB,KAAK,MAAM,KAAK,OAAO,EAAI,CAAC,EAAI,CAClF,EAEAe,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2FAQ6DO,EAAM,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2FAWjB,UAAU,YAAYA,EAAM,UAAU,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2FAWvCA,EAAM,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2FAWnBA,EAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAO3G,CAKA,eAAeX,GAAqB,CAChC,IAAMI,EAAY,SAAS,eAAe,iBAAiB,EAC3D,GAAKA,EAEL,GAAI,CAGA,IAAMQ,GADW,MAAM,UAAU,OAAO,CAAE,MAAO,CAAE,CAAC,GAC5B,MAAQ,CAAC,EAEjC,GAAIA,EAAO,SAAW,EAAG,CACrBR,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,kBAKtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAORQ,EAAO,IAAIC,GAAS,CAQlB,IAAMC,EAPe,CACjB,QAAS,uCACT,WAAY,mCACZ,QAAS,uCACT,UAAW,qCACX,UAAW,gCACf,EACiCD,EAAM,MAAM,GAAK,qCAC5CE,EAAYF,EAAM,QAAQ,CAAC,EAEjC,MAAO;AAAA,mDACgBA,EAAM,EAAE;AAAA;AAAA,0CAEjBE,GAAW,SAAS,MAClB,aAAaA,EAAU,QAAQ,KAAK,+CACpC;AAAA;AAAA,mDAGJ;AAAA;AAAA;AAAA,gHAGwE,UAAU,WAAWF,EAAM,cAAgBA,EAAM,EAAE,CAAC;AAAA,4DACxGC,CAAW,KAAK,UAAU,WAAWD,EAAM,gBAAkBA,EAAM,MAAM,CAAC;AAAA;AAAA;AAAA,kGAGpC,UAAU,YAAYA,EAAM,KAAK,CAAC;AAAA,gGACpC,UAAU,WAAWA,EAAM,UAAU,CAAC;AAAA;AAAA;AAAA,6BAI9G,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,aAI3B,MAAgB,CACZT,EAAU,UAAY,EAC1B,CACJ,CAKA,SAASH,GAA8B,CACnC,IAAMG,EAAY,SAAS,eAAe,0BAA0B,EACpE,GAAI,CAACA,EAAW,OAEhB,IAAMY,EAAc,KAAK,MAAM,aAAa,QAAQ,yBAAyB,GAAK,IAAI,EAQhFC,EAAQ,CAAE,GAPK,CACjB,aAAc,GACd,WAAY,GACZ,YAAa,GACb,WAAY,GACZ,WAAY,EAChB,EACiC,GAAGD,CAAY,EAEhDZ,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+FAQiEa,EAAM,aAAe,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6FAUrCA,EAAM,WAAa,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6FAUjCA,EAAM,WAAa,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8FAUhCA,EAAM,YAAc,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,UAQxHb,EAAU,iBAAiB,kBAAkB,EAAE,QAAQc,GAAS,CAC5DA,EAAM,iBAAiB,SAAU,IAAM,CACnC,IAAMC,EAAMD,EAAM,QAAQ,KACpBF,EAAc,KAAK,MAAM,aAAa,QAAQ,yBAAyB,GAAK,IAAI,EACtFA,EAAYG,CAAG,EAAID,EAAM,QACzB,aAAa,QAAQ,0BAA2B,KAAK,UAAUF,CAAW,CAAC,EAC3E,MAAM,QAAQ,kBAAkB,CACpC,CAAC,CACL,CAAC,CACL,CAKA,SAASd,GAAmB,CACxB,IAAME,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAGhB,IAAMgB,EAAiB,KAAK,MAAM,aAAa,QAAQ,iBAAiB,GAAK,IAAI,EAEjF,GAAIA,EAAe,SAAW,EAAG,CAC7BhB,EAAU,UAAU,IAAI,QAAQ,EAChC,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,sBAIRgB,EAAe,MAAM,EAAG,CAAC,EAAE,IAAIC,GAAW;AAAA,sOACsKA,EAAQ,EAAE;AAAA;AAAA,4CAEpMA,EAAQ,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA,iIAER,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA,qBAE9I,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAMvBjB,EAAU,iBAAiB,oBAAoB,EAAE,QAAQkB,GAAO,CAC5DA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAMC,EAAYD,EAAI,QAAQ,UAC9BA,EAAI,SAAW,GAEf,GAAI,CACA,MAAM,QAAQ,QAAQC,EAAW,CAAC,EAClC,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,MAAgB,CACZ,MAAM,MAAM,uBAAuB,CACvC,QAAE,CACED,EAAI,SAAW,EACnB,CACJ,CAAC,CACL,CAAC,CACL,CAKA,SAASnB,GAA2B,CAChC,IAAMC,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAGhB,IAAIoB,EAAQ,EACNC,EAAS,CAAC,EAGVC,EAAgBrC,GAAa,iBAAmB,GAClDqC,IAAeF,GAAS,IAC5BC,EAAO,KAAK,CAAE,MAAO,iBAAkB,UAAWC,CAAc,CAAC,EAGjE,IAAMC,EAAW,CAAC,CAACtC,GAAa,MAC5BsC,IAAUH,GAAS,IACvBC,EAAO,KAAK,CAAE,MAAO,qBAAsB,UAAWE,CAAS,CAAC,EAGhE,IAAMC,EAASvC,GAAa,oBAAsB,GAC9CuC,IAAQJ,GAAS,IACrBC,EAAO,KAAK,CAAE,MAAO,4BAA6B,UAAWG,CAAO,CAAC,EAGrE,IAAMC,EAAiB,GACnBA,IAAgBL,GAAS,IAC7BC,EAAO,KAAK,CAAE,MAAO,kBAAmB,UAAWI,CAAe,CAAC,EAEnE,IAAMC,EAAaN,GAAS,GAAK,qCAAuCA,GAAS,GAAK,uCAAyC,iCACzHO,EAAgBP,GAAS,GAAK,eAAiBA,GAAS,GAAK,gBAAkB,aAErFpB,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,mCAIK0B,CAAU,eAAeN,CAAK;AAAA;AAAA;AAAA,kCAG/BO,CAAa,gEAAgEP,CAAK;AAAA;AAAA;AAAA,sBAG9FC,EAAO,IAAIO,GAAS;AAAA;AAAA,8BAEZA,EAAM,UACJ,8QACA,mJACJ;AAAA,2CACeA,EAAM,UAAY,qCAAuC,oCAAoC,KAAKA,EAAM,KAAK;AAAA;AAAA,qBAEnI,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,SAI3B,CAEA,eAAezC,GAAkB,CAC7B,GAAK,QAAQ,gBAAgB,EAI7B,GAAI,CAEAF,GADiB,MAAM,QAAQ,WAAW,GACnB,KACvB4C,EAAc,CAClB,MAAgB,CAEZ,MAAM,MAAM,yBAAyB,CACzC,CACJ,CAEA,SAASxC,GAAkB,CACvB,IAAMyC,EAAO,SAAS,iBAAiB,oBAAoB,EACrDC,EAAS,SAAS,iBAAiB,sBAAsB,EAC/D,GAAI,CAACD,EAAK,QAAU,CAACC,EAAO,OAAQ,OAEpC,IAAMC,EAAaC,GAAW,CAC1BF,EAAO,QAAQG,GAAS,CACpBA,EAAM,UAAU,OAAO,SAAUA,EAAM,QAAQ,eAAiBD,CAAM,CAC1E,CAAC,EACDH,EAAK,QAAQZ,GAAO,CAChB,IAAMiB,EAAWjB,EAAI,QAAQ,aAAee,EAC5Cf,EAAI,UAAU,OAAO,eAAgBiB,CAAQ,EAC7CjB,EAAI,UAAU,OAAO,aAAciB,CAAQ,EAC3CjB,EAAI,UAAU,OAAO,YAAaiB,CAAQ,EAC1CjB,EAAI,UAAU,OAAO,iBAAkB,CAACiB,CAAQ,EAChDjB,EAAI,UAAU,OAAO,sBAAuB,CAACiB,CAAQ,CACzD,CAAC,EACD,aAAa,QAAQ,aAAcF,CAAM,CAC7C,EAEMG,EAAU,aAAa,QAAQ,YAAY,GAAK,WACtDJ,EAAUI,CAAO,EAEjBN,EAAK,QAAQZ,GAAO,CAChBA,EAAI,iBAAiB,QAAS,IAAM,CAChCc,EAAUd,EAAI,QAAQ,UAAU,CACpC,CAAC,CACL,CAAC,CACL,CAEA,SAASW,GAAgB,CACrB,IAAM7B,EAAY,SAAS,eAAe,cAAc,EACxD,GAAI,CAACA,GAAa,CAACf,EAAa,OAEhC,IAAMoD,EAAO,GAAG,UAAU,WAAWpD,EAAY,YAAc,EAAE,CAAC,IAAI,UAAU,WAAWA,EAAY,WAAa,EAAE,CAAC,GAAG,KAAK,GAAK,UAAU,WAAWA,EAAY,OAAS,MAAM,EAC9KqD,EAAc,UAAU,WAAWrD,EAAY,YAAcA,EAAY,WAAW,EACpFsD,EAAYtD,EAAY,OAAS,iCAAiCA,EAAY,MAAM,sDAAwD;AAAA;AAAA,mBAEvIA,EAAY,aAAa,CAAC,GAAKA,EAAY,QAAQ,CAAC,GAAK,KAAK,YAAY,CAAC;AAAA,qBAGtFe,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,0BAKJuC,CAAS;AAAA;AAAA;AAAA;AAAA;AAAA,2GAKwEF,CAAI;AAAA,qFAC1B,UAAU,WAAWpD,EAAY,KAAK,CAAC;AAAA,8FAC9BqD,CAAW;AAAA;AAAA;AAAA,0BAG/ErD,EAAY,OAAS,oJAAsJ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,UAO/LG,EAAoB,CACxB,CAEA,SAASoD,GAAW,CAChB,KAAK,KAAK,CACd,CAEA,SAASlD,GAAkB,CACvB,IAAMmD,EAAO,SAAS,eAAe,cAAc,EACnD,GAAI,CAACA,GAAQ,CAACxD,EAAa,OAE3B,IAAMyD,EAAiB,SAAS,eAAe,oBAAoB,EAC7DC,EAAgB,SAAS,eAAe,mBAAmB,EAC3DC,EAAa,SAAS,eAAe,eAAe,EACpDC,EAAa,SAAS,eAAe,eAAe,EAEtDH,IAAgBA,EAAe,MAAQzD,EAAY,YAAc,IACjE0D,IAAeA,EAAc,MAAQ1D,EAAY,WAAa,IAC9D2D,IAAYA,EAAW,MAAQ3D,EAAY,OAAS,IACpD4D,IAAYA,EAAW,MAAQ5D,EAAY,OAAS,IAExDwD,EAAK,iBAAiB,SAAU,MAAOK,GAAM,CACzCA,EAAE,eAAe,EAEjB,IAAMC,EAAW,IAAI,SAASN,CAAI,EAC5BO,EAAO,CACT,WAAYD,EAAS,IAAI,YAAY,EACrC,UAAWA,EAAS,IAAI,WAAW,EACnC,MAAOA,EAAS,IAAI,OAAO,CAC/B,EAEME,EAAYR,EAAK,cAAc,uBAAuB,EAC5DQ,EAAU,SAAW,GACrBA,EAAU,YAAc,YAExB,GAAI,CACA,MAAM,QAAQ,cAAcD,CAAI,EAChC,MAAM,QAAQ,+BAA+B,EAC7C,MAAM7D,EAAgB,CAC1B,OAAS+D,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,2BAA2B,CAC5D,QAAE,CACED,EAAU,SAAW,GACrBA,EAAU,YAAc,cAC5B,CACJ,CAAC,CACL,CAEA,SAAS7D,GAAsB,CAC3B,IAAI+D,EAAc,SAAS,eAAe,cAAc,EAClDC,EAAY,SAAS,eAAe,mBAAmB,EACvDC,EAAY,SAAS,eAAe,mBAAmB,EAGxDF,IACDA,EAAc,SAAS,cAAc,OAAO,EAC5CA,EAAY,KAAO,OACnBA,EAAY,GAAK,eACjBA,EAAY,KAAO,SACnBA,EAAY,OAAS,UACrBA,EAAY,UAAY,SACxB,SAAS,KAAK,YAAYA,CAAW,GAItB,SAAS,iBAAiB,oBAAoB,EACtD,QAAQjC,GAAOA,EAAI,iBAAiB,QAAS,IAAMiC,EAAY,MAAM,CAAC,CAAC,EAG/D,SAAS,iBAAiB,oBAAoB,EACtD,QAAQjC,GAAOA,EAAI,iBAAiB,QAAS,IAAM,CACtD,OAAO,OAAO,cAAiB,YAC/B,OAAO,aAAa,CAE5B,CAAC,CAAC,EAGFiC,EAAY,sBAAsB,SAAU,OAAO,oBAAoB,EACvE,OAAO,qBAAuB,eAAgBL,EAAG,CAC7C,IAAMQ,EAAOR,EAAE,OAAO,QAAQ,CAAC,EAC/B,GAAKQ,EAEL,IAAI,CAACA,EAAK,KAAK,WAAW,QAAQ,EAAG,CACjC,MAAM,MAAM,8BAA8B,EAC1C,MACJ,CAEA,GAAIA,EAAK,KAAO,QAAiB,CAC7B,MAAM,MAAM,iCAAiC,EAC7C,MACJ,CAEA,GAAI,CACA,MAAM,QAAQ,aAAaA,CAAI,EAC/B,MAAM,QAAQ,iBAAiB,EAC/B,MAAMnE,EAAgB,CAC1B,OAAS+D,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,0BAA0B,CAC3D,EACJ,EAEAC,EAAY,iBAAiB,SAAU,OAAO,oBAAoB,CACtE,CAEA,SAAS5D,GAAmB,CACxB,IAAMkD,EAAO,SAAS,eAAe,eAAe,EAC/CA,GAELA,EAAK,iBAAiB,SAAU,MAAOK,GAAM,CACzCA,EAAE,eAAe,EAEjB,IAAMC,EAAW,IAAI,SAASN,CAAI,EAC5Bc,EAAkBR,EAAS,IAAI,kBAAkB,EACjDS,EAAcT,EAAS,IAAI,cAAc,EACzCU,EAAkBV,EAAS,IAAI,kBAAkB,EAEvD,GAAIS,IAAgBC,EAAiB,CACjC,MAAM,MAAM,yBAAyB,EACrC,MACJ,CAEA,GAAID,EAAY,OAAS,EAAG,CACxB,MAAM,MAAM,yCAAyC,EACrD,MACJ,CAEA,IAAMP,EAAYR,EAAK,cAAc,uBAAuB,EAC5DQ,EAAU,SAAW,GACrBA,EAAU,YAAc,cAExB,GAAI,CACA,MAAM,QAAQ,eAAeM,EAAiBC,CAAW,EACzD,MAAM,QAAQ,gCAAgC,EAC9Cf,EAAK,MAAM,CACf,OAASS,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,4BAA4B,CAC7D,QAAE,CACED,EAAU,SAAW,GACrBA,EAAU,YAAc,iBAC5B,CACJ,CAAC,CACL,CAEA,SAASzD,GAAwB,CAC7BkE,EAAc,EAEQ,SAAS,eAAe,iBAAiB,GAChD,iBAAiB,QAAS,IAAM,CAC3CC,EAAiB,CACrB,CAAC,CACL,CAEA,eAAeD,GAAgB,CAC3B,IAAM1D,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAKA,EAEL,QAAO,KAAKA,EAAW,SAAS,EAEhC,GAAI,CAEA,IAAM4D,GADW,MAAM,QAAQ,aAAa,GACjB,MAAQ,CAAC,EAEpC,GAAIA,EAAU,SAAW,EAAG,CACxB5D,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAStB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA,sBAEZ4D,EAAU,IAAIC,GAAQ;AAAA,uGAC2DA,EAAK,EAAE;AAAA,8BAChFA,EAAK,WAAa;AAAA;AAAA,8BAEhB,EAAE;AAAA,mEACiC,UAAU,WAAWA,EAAK,WAAa,GAAGA,EAAK,UAAU,IAAIA,EAAK,SAAS,EAAE,CAAC;AAAA,oEAC7E,UAAU,WAAWA,EAAK,cAAc,CAAC;AAAA,8BAC/EA,EAAK,eAAiB,oCAAoC,UAAU,WAAWA,EAAK,cAAc,CAAC,OAAS,EAAE;AAAA,+DAC7E,UAAU,WAAWA,EAAK,IAAI,CAAC,KAAK,UAAU,WAAWA,EAAK,OAAS,EAAE,CAAC,IAAI,UAAU,WAAWA,EAAK,WAAW,CAAC;AAAA,+DACpH,UAAU,WAAWA,EAAK,OAAO,CAAC;AAAA,8BACnEA,EAAK,MAAQ,yCAAyC,UAAU,WAAWA,EAAK,KAAK,CAAC,OAAS,EAAE;AAAA;AAAA;AAAA,oIAGKA,EAAK,EAAE;AAAA,kCACxGA,EAAK,WAEJ,GAFiB;AAAA,iIAC4EA,EAAK,EAAE;AAAA,iCAClG;AAAA,8HACwFA,EAAK,EAAE;AAAA;AAAA;AAAA,qBAGhH,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAInBC,EAAkB,CACtB,OAASZ,EAAO,CACZ,QAAQ,MAAM,4BAA6BA,CAAK,EAChDlD,EAAU,UAAY,uDAC1B,EACJ,CAEA,SAAS8D,GAAoB,CACzB,SAAS,iBAAiB,mBAAmB,EAAE,QAAQ5C,GAAO,CAC1DA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAM6C,EAAY7C,EAAI,QAAQ,UAC9B,GAAI,CACA,IAAM8C,EAAW,MAAM,QAAQ,WAAWD,CAAS,EACnDJ,EAAiBK,EAAS,IAAI,CAClC,MAAgB,CACZ,MAAM,MAAM,yBAAyB,CACzC,CACJ,CAAC,CACL,CAAC,EAED,SAAS,iBAAiB,kBAAkB,EAAE,QAAQ9C,GAAO,CACzDA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAM6C,EAAY7C,EAAI,QAAQ,UAC9B,GAAI,CACA,MAAM,QAAQ,kBAAkB6C,CAAS,EACzC,MAAM,QAAQ,0BAA0B,EACxC,MAAML,EAAc,CACxB,MAAgB,CACZ,MAAM,MAAM,mCAAmC,CACnD,CACJ,CAAC,CACL,CAAC,EAED,SAAS,iBAAiB,qBAAqB,EAAE,QAAQxC,GAAO,CAC5DA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAM6C,EAAY7C,EAAI,QAAQ,UAQ9B,GAPkB,MAAM,MAAM,QAAQ,CAClC,MAAO,iBACP,QAAS,gDACT,YAAa,SACb,WAAY,QAChB,CAAC,EAGG,GAAI,CACA,MAAM,QAAQ,cAAc6C,CAAS,EACrC,MAAM,QAAQ,kBAAkB,EAChC,MAAML,EAAc,CACxB,MAAgB,CACZ,MAAM,MAAM,2BAA2B,CAC3C,CAER,CAAC,CACL,CAAC,CACL,CAEA,SAASC,EAAiBM,EAAU,KAAM,CACtC,IAAMC,EAAS,CAAC,CAACD,EAEjB,MAAM,KAAK,CACP,MAAOC,EAAS,eAAiB,kBACjC,QAAS;AAAA;AAAA;AAAA;AAAA;AAAA,0EAKqDD,GAAS,YAAc,EAAE;AAAA;AAAA;AAAA;AAAA,yEAI1BA,GAAS,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,gEAKjCA,GAAS,OAAS,EAAE;AAAA;AAAA;AAAA;AAAA,0EAIVA,GAAS,gBAAkB,EAAE;AAAA;AAAA;AAAA;AAAA,0EAI7BA,GAAS,gBAAkB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,oEAKnCA,GAAS,MAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,qEAIlBA,GAAS,OAAS,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2EAMdA,GAAS,aAAe,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAMhDA,GAAS,UAAY,KAAO,WAAa,EAAE;AAAA,qDAC3CA,GAAS,UAAY,KAAO,WAAa,EAAE;AAAA,qDAC3CA,GAAS,UAAY,KAAO,WAAa,EAAE;AAAA,qDAC3CA,GAAS,UAAY,KAAO,WAAa,EAAE;AAAA,qDAC3CA,GAAS,UAAY,KAAO,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uEAMzBA,GAAS,WAAa,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,cAM/F,YAAaC,EAAS,eAAiB,cACvC,UAAW,SAAY,CACnB,IAAMzB,EAAO,SAAS,eAAe,oBAAoB,EACnDM,EAAW,IAAI,SAASN,CAAI,EAC5BO,EAAO,CACT,WAAYD,EAAS,IAAI,YAAY,EACrC,UAAWA,EAAS,IAAI,WAAW,EACnC,MAAOA,EAAS,IAAI,OAAO,EAC3B,eAAgBA,EAAS,IAAI,gBAAgB,EAC7C,eAAgBA,EAAS,IAAI,gBAAgB,EAC7C,KAAMA,EAAS,IAAI,MAAM,EACzB,MAAOA,EAAS,IAAI,OAAO,EAC3B,YAAaA,EAAS,IAAI,aAAa,EACvC,QAASA,EAAS,IAAI,SAAS,EAC/B,WAAYA,EAAS,IAAI,YAAY,IAAM,IAC/C,EAEA,GAAI,CACA,OAAImB,GACA,MAAM,QAAQ,cAAcD,EAAQ,GAAIjB,CAAI,EAC5C,MAAM,QAAQ,kBAAkB,IAEhC,MAAM,QAAQ,WAAWA,CAAI,EAC7B,MAAM,QAAQ,gBAAgB,GAElC,MAAMU,EAAc,EACb,EACX,OAASR,EAAO,CACZ,aAAM,MAAMA,EAAM,SAAW,yBAAyB,EAC/C,EACX,CACJ,CACJ,CAAC,CACL,CAEA,SAASiB,GAAU,CACflF,EAAc,IAClB,CAEA,MAAO,CACH,KAAAC,EACA,QAAAiF,CACJ,CACJ,GAAG,EAEH,OAAO,YAAcrF,GACdD,GAAQC,KC51Bf,IAAAsF,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAqlDCD,GA1lDPE,GAAAC,GAAA,KAKMF,IAAY,UAAW,CACzB,aAEA,IAAIG,EAAO,KACPC,EAAgB,CAAC,EACjBC,EAAqB,KACrBC,EAAY,KACVC,EAAuB,IACvBC,EAAa,aAGnB,SAASC,GAAkC,CAE3C,CAEA,SAASC,EAAYC,EAAO,CACxB,GAAIA,GAAU,MAA+BA,IAAU,GAAI,MAAO,GAClE,GAAI,OAAOA,GAAU,UAAY,OAAO,SAASA,CAAK,EAAG,OAAOA,EAChE,IAAMC,EAAU,WAAWD,CAAK,EAChC,OAAO,OAAO,SAASC,CAAO,EAAIA,EAAU,CAChD,CAEA,SAASC,EAAgBF,EAAO,CAC5B,IAAMG,EAASJ,EAAYC,CAAK,EAChC,OAAO,UAAU,YAAYG,CAAM,CACvC,CAEA,SAASC,GAAsB,CAC3B,IAAMC,EAAO,OAAO,cAAc,MAAQ,CAAC,EACrCC,EAAkBD,EAAK,oBAAsB,GAC7CE,EAAiBR,EAAYM,EAAK,kBAAoBA,EAAK,gBAAkB,CAAC,EAC9EG,EAAS,CAAC,CAACH,EAAK,QAChBI,EAAWD,GAAUF,GAAmB,CAAC,CAACD,EAAK,UAC/CK,EAAeD,EAAWV,EAAYM,EAAK,gBAAkBE,CAAc,EAAI,EAErF,MAAO,CACH,QAASC,EACT,aAAcH,EAAK,cAAgB,GACnC,UAAWI,EACX,eAAgBC,EAChB,iBAAkBH,EAClB,gBAAiBF,EAAK,iBAAmB,YACzC,kBAAmBC,CACvB,CACJ,CAEA,SAASK,EAAeC,EAAY,CAAC,EAAG,CACpCjB,EAAY,CAAE,GAAIA,GAAaS,EAAoB,EAAI,GAAGQ,CAAU,EAE/DjB,EAAU,UACXA,EAAU,aAAe,GACzBA,EAAU,UAAY,GACtBA,EAAU,eAAiB,GAG1BA,EAAU,oBACXA,EAAU,UAAY,GACtBA,EAAU,eAAiB,GAG3BA,EAAU,WAAaA,EAAU,gBAAkB,IACnDA,EAAU,eAAiBI,EAAYJ,EAAU,gBAAgB,EAEzE,CAEA,SAASkB,EAASb,EAAO,CACrB,OAAOA,GAAU,MAA+BA,IAAU,EAC9D,CAEA,SAASc,GAAa,CAClB,IAAMC,EAAO,OAAO,cAAc,QAClC,OAAOhB,EAAYc,EAASE,CAAI,EAAIA,EAAO,CAAC,CAChD,CAEA,SAASC,GAA2B,CAChC,IAAMC,EAAgB,OAAO,cAAc,sBAErCC,GADe,OAAO,kBAAoB,CAAC,GACnB,yBAA2B,OAAO,kBAAkB,yBAA2B,EAC7G,OAAOnB,EAAYc,EAASI,CAAa,EAAIA,EAAgBC,CAAQ,CACzE,CAEA,IAAMC,EAAgC,0NAClCC,EAAuB,KACvBC,EAAyB,KACzBC,EAAqB,CAAE,IAAK,KAAM,MAAO,IAAK,EAElD,SAASC,GAAsB,CAE3B,OADe,SAAS,eAAe,mBAAmB,GAC1C,OAAS,SAAS,YAAY,CAClD,CAEA,SAASC,EAAoBC,EAAU,CACnC,OAAKA,EACEA,EAAS,OAAO,CAAC,EAAE,YAAY,EAAIA,EAAS,MAAM,CAAC,EADpC,OAE1B,CAEA,SAASC,GAAkB,CACvB,OAAO,OAAO,SAAS,iBAAmB,QAAQ,gBAAgB,CACtE,CAEA,SAASC,EAAyBC,EAAU,CACxC,OAAKA,EACD,MAAM,QAAQA,CAAQ,EAAUA,EAChC,MAAM,QAAQA,EAAS,IAAI,EAAUA,EAAS,KAC9C,MAAM,QAAQA,EAAS,MAAM,OAAO,EAAUA,EAAS,KAAK,QAC5D,MAAM,QAAQA,EAAS,OAAO,EAAUA,EAAS,QAC9C,CAAC,EALc,CAAC,CAM3B,CAEA,eAAeC,GAA4B,CACvC,OAAKH,EAAgB,EACjBN,IACCC,IACDA,GAA0B,SAAY,CAClC,GAAI,CACA,IAAMS,EAAO,MAAM,QAAQ,aAAa,EAClCC,EAAYJ,EAAyBG,CAAI,EAC/C,GAAI,CAACC,EAAU,OAAQ,OAAO,KAE9B,IAAMC,EAAoBD,EAAU,OAAOE,GAAQ,CAC/C,IAAMC,EAAO,OAAOD,EAAK,cAAgB,EAAE,EAAE,YAAY,EACzD,OAAOC,IAAS,YAAcA,IAAS,MAC3C,CAAC,EAED,OACIF,EAAkB,KAAKC,GAAQA,EAAK,UAAU,GAC9CD,EAAkB,CAAC,GACnBD,EAAU,KAAKE,GAAQA,EAAK,UAAU,GACtCF,EAAU,CAAC,GACX,IAER,MAAgB,CACZ,OAAO,IACX,CACJ,GAAG,GAEPX,EAAuB,MAAMC,EACtBD,GA3BwB,IA4BnC,CAEA,SAASe,EAAaC,EAAe,CACjC,IAAMrB,EAAOD,EAAW,EACxB,OAAOC,EAAO,EAAKqB,EAAgBrB,EAAO,IAAO,CACrD,CAEA,SAASsB,EAA4BC,EAAS,CAC1C,IAAMC,EAAa,SAAS,eAAe,mBAAmB,EAC9D,GAAI,CAACA,EAAY,OAEjB,GAAID,IAAYA,EAAQ,MAAQA,EAAQ,OAASA,EAAQ,SAAU,CAC/DC,EAAW,YAAcD,EAAQ,MAAQA,EAAQ,OAASA,EAAQ,QAClE,MACJ,CAEA,IAAME,EAAiB,SAAS,eAAe,mBAAmB,EAClED,EAAW,YAAcC,EAAiBhB,EAAoBD,EAAoB,CAAC,EAAI,SAC3F,CAEA,SAASkB,EAAqBH,EAASI,EAAeC,EAAWC,EAAY,CACzE,MAAO,CACH,QAASN,GAAS,SAAW,KAC7B,MAAOA,GAAS,OAASA,GAAS,MAAQ,GAC1C,YAAaA,GAAS,aAAe,GACrC,SAAUI,EACV,OAAQ,EACR,WAAYC,EACZ,YAAaC,CACjB,CACJ,CAEA,eAAeC,EAAmBC,EAAUJ,EAAeJ,EAAS,CAChE,GAAI,CAACA,EAAS,OAAO,KAErB,IAAMS,EAAQD,GAAU,OAAS,CAAC,EAC5BH,EAAYI,EAAM,OAAO,CAACC,EAAKC,KAASD,EAAM,OAAOC,GAAK,UAAY,CAAC,EAAG,CAAC,EAC3EL,EAAaG,EAAM,IAAIE,GAAQA,EAAK,SAAS,IAAMA,EAAK,UAAU,EAAE,OAAO,OAAO,EAClFC,EAAUT,EAAqBH,EAASI,EAAeC,EAAWC,CAAU,EAC5EO,EAAW,CACbb,EAAQ,IAAM,GACdY,EAAQ,QACRA,EAAQ,MACRA,EAAQ,YACRR,EACAC,EACAC,EAAW,KAAK,GAAG,CACvB,EAAE,KAAK,GAAG,EAEV,GAAItB,EAAmB,MAAQ6B,EAC3B,OAAO7B,EAAmB,MAG9B,GAAI,CACA,IAAIM,EACJ,GAAI,OAAO,aAAa,kBACpBA,EAAW,MAAM,YAAY,kBAAkBsB,CAAO,MACnD,CACH,IAAME,GAAe,OAAO,kBAAkB,KAC9CxB,EAAW,MAAM,MAAM,8BAA+B,CAClD,OAAQ,OACR,QAAS,CACL,eAAgB,mBAChB,cAAe,OAAO,YAAc,SAAS,cAAc,4BAA4B,GAAG,OAAS,GACnG,GAAIwB,GAAe,CAAE,kBAAmBA,EAAa,EAAI,CAAC,CAC9D,EACA,KAAM,KAAK,UAAUF,CAAO,CAChC,CAAC,EAAE,KAAKG,IAAOA,GAAI,KAAK,CAAC,CAC7B,CAEA,IAAMC,GAAU1B,GAAU,MAAM,SAAWA,GAAU,MAAM,MAAM,SAAWA,GAAU,SAAW,CAAC,EAClG,GAAI,CAAC,MAAM,QAAQ0B,EAAO,GAAKA,GAAQ,SAAW,EAAG,OAAO,KAE5D,IAAMC,GAAWD,GAAQ,OAAO,CAACE,GAAKC,KAAW,CAC7C,IAAMC,GAAU3D,EAAYyD,GAAI,IAAI,EAEpC,OADmBzD,EAAY0D,GAAO,IAAI,EACtBC,GAAUD,GAASD,EAC3C,EAAGF,GAAQ,CAAC,CAAC,EAEPK,GAAO5D,EAAYwD,GAAS,IAAI,EAChCK,GAAQ,CACV,KAAAD,GACA,OAAQJ,GAAS,SAAWI,IAAQ,EACpC,QAASJ,GAAS,cAAgBrD,EAAgByD,EAAI,CAC1D,EAEA,OAAArC,EAAqB,CAAE,IAAK6B,EAAU,MAAAS,EAAM,EACrCA,EACX,MAAgB,CACZ,OAAO,IACX,CACJ,CAEA,eAAeC,EAAyBnB,EAAeoB,EAAehB,EAAU,CAC5E,IAAMiB,EAAa,SAAS,eAAe,UAAU,EAC/CC,EAAQ,SAAS,eAAe,KAAK,EACrCC,EAAU,SAAS,eAAe,OAAO,EACzCC,EAAc,SAAS,eAAe,eAAe,EACrDC,EAAiB,SAAS,eAAe,gBAAgB,EAEzD/B,EAAgB,KAAK,IAAI,EAAGM,EAAgBoB,CAAa,EACzDM,GAAMjC,EAAaC,CAAa,EAChC1B,GAAef,GAAW,UAAYI,EAAYJ,EAAU,cAAc,EAAI,EAEhFqE,IAAOA,EAAM,YAAc9D,EAAgBkE,EAAG,GAC9CF,GAAeC,IACXxE,GAAW,WACXuE,EAAY,UAAU,OAAO,QAAQ,EACrCC,EAAe,YAAc,IAAIjE,EAAgBQ,EAAY,CAAC,GAC9DyD,EAAe,QAAQ,MAAQzD,KAE/BwD,EAAY,UAAU,IAAI,QAAQ,EAClCC,EAAe,YAAc,IAAIjE,EAAgB,CAAC,CAAC,GACnDiE,EAAe,QAAQ,MAAQ,IAIvC,IAAM7B,GAAU,MAAMT,EAA0B,EAChD,GAAI,CAACS,GAAS,CACNyB,IAAYA,EAAW,UAAY5C,GACnC8C,IAASA,EAAQ,YAAc/D,EAAgBkC,EAAgBgC,GAAM1D,EAAY,GACrF2B,EAA4B,IAAI,EAChC,MACJ,CAEI0B,IAAYA,EAAW,YAAc,kBACzC,IAAMH,GAAQ,MAAMf,EAAmBC,GAAYtD,EAAMkD,EAAeJ,EAAO,EAE/E,GAAI,CAACsB,GAAO,CACJG,IAAYA,EAAW,UAAY5C,GACnC8C,IAASA,EAAQ,YAAc/D,EAAgBkC,EAAgBgC,GAAM1D,EAAY,GACrF2B,EAA4BC,EAAO,EACnC,MACJ,CAEIyB,IAAYA,EAAW,YAAcH,GAAM,OAAS,OAASA,GAAM,SACnEK,IAASA,EAAQ,YAAc/D,EAAgBkC,EAAgBgC,GAAM1D,GAAekD,GAAM,IAAI,GAElGvB,EAA4BC,EAAO,CACvC,CAEA,eAAe+B,GAAO,CAClB1E,EAAYS,EAAoB,EAChCO,EAAehB,CAAS,EACxB,MAAM2E,EAAS,EACfC,GAAsB,EACtBC,GAAe,EACfC,GAAqB,CACzB,CAEA,SAASC,EAAeC,EAAQC,EAAWC,EAAa,CAC/CF,IACAA,EAAO,QAAQ,eAChBA,EAAO,QAAQ,aAAeA,EAAO,aAEzCA,EAAO,SAAWC,EAClBD,EAAO,YAAcC,EAAYC,EAAcF,EAAO,QAAQ,aAClE,CAEA,SAASG,EAAoBC,EAAO7D,EAAU,CAC1C,IAAM8D,EAAU,CACZ,kBACA,iBACA,0BACA,wBACJ,EAEMC,EAAaC,GAAQ,CACvB,GAAI,CAACA,EAAK,MAAO,GACjB,IAAMC,EAAa,OAAOD,CAAG,EAAE,KAAK,EAAE,YAAY,EAClD,OAAOF,EAAQ,SAASG,CAAU,CACtC,EAEMC,EAAkBC,GAAW,CAC/B,GAAI,CAACA,EAAQ,OAAO,KACpB,GAAI,OAAOA,GAAW,SAAU,OAAOA,EACvC,GAAI,MAAM,QAAQA,CAAM,EAAG,OAAOA,EAAO,CAAC,EAC1C,GAAI,OAAOA,GAAW,SAAU,CAC5B,IAAMC,EAAS,OAAO,OAAOD,CAAM,EAE7BE,IADYD,EAAO,KAAOA,EAAO,KAAK,EAAIA,EAAO,OAAO,CAACE,GAAKC,KAAQD,GAAI,OAAOC,EAAG,EAAG,CAAC,CAAC,GACvE,CAAC,GAAKH,EAAO,CAAC,EACtC,GAAI,OAAOC,IAAU,SAAU,OAAOA,GACtC,GAAIA,IAAS,OAAOA,IAAU,SAC1B,OAAOH,EAAeG,EAAK,CAEnC,CACA,OAAO,IACX,EAEMG,EAAa,CAAC,EACpB,OAAIX,GAAO,SAASW,EAAW,KAAKX,EAAM,OAAO,EAC7CA,GAAO,MAAM,SAASW,EAAW,KAAKX,EAAM,KAAK,OAAO,EACxDA,GAAO,MAAM,QAAQW,EAAW,KAAKX,EAAM,KAAK,MAAM,EACtDA,GAAO,MAAQ,OAAOA,EAAM,MAAS,UAAUW,EAAW,KAAKX,EAAM,IAAI,EACzEA,GAAO,QAAQW,EAAW,KAAKN,EAAeL,EAAM,MAAM,CAAC,EAC3DA,GAAO,MAAQ,OAAOA,EAAM,MAAS,UAAUW,EAAW,KAAKN,EAAeL,EAAM,IAAI,CAAC,EAEhFW,EAAW,KAAKR,GAAOA,GAAO,CAACD,EAAUC,CAAG,CAAC,GAC3ChE,CACnB,CAEA,SAASyE,GAAeC,EAAY,CAChC,IAAMC,EAAU,SAAS,eAAe,gBAAgB,EAClDC,EAAS,SAAS,eAAe,aAAa,EAC9CC,EAAO,SAAS,eAAe,aAAa,EAC5CC,EAAQ,SAAS,eAAe,aAAa,EAC7CC,EAAW,SAAS,eAAe,kBAAkB,EACrDC,EAAUF,GAAO,QAAQ,UAAU,EACnCG,EAAY,SAAS,eAAe,gBAAgB,EAE1D,GAAIP,EAAY,CACRC,GAASA,EAAQ,UAAU,OAAO,QAAQ,EAC1CC,IAAQA,EAAO,YAAcF,GAC7BG,GAAMA,EAAK,UAAU,IAAI,QAAQ,EACjC,CAACA,GAAQG,GAASA,EAAQ,UAAU,IAAI,QAAQ,EAChDD,GAAUA,EAAS,UAAU,IAAI,QAAQ,EACzCD,IAAOA,EAAM,MAAQJ,GACrBO,GAAWA,EAAU,UAAU,IAAI,QAAQ,EAC/C,MACJ,CAEIN,GAASA,EAAQ,UAAU,IAAI,QAAQ,EACvCE,GAAMA,EAAK,UAAU,OAAO,QAAQ,EACpC,CAACA,GAAQG,GAASA,EAAQ,UAAU,OAAO,QAAQ,EACnDD,GAAUA,EAAS,UAAU,OAAO,QAAQ,EAC5CD,IAAOA,EAAM,MAAQ,GAC7B,CAEA,SAASI,GAAwBC,EAAY,CACzC,IAAMC,EAAY,SAAS,eAAe,qBAAqB,EACzDC,EAAY,SAAS,eAAe,mBAAmB,EACvDC,EAAc,SAAS,eAAe,qBAAqB,EAC3DC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAe,SAAS,eAAe,eAAe,EAE5D,GAAI,CAACJ,GAAa,CAACC,GAAa,CAACC,GAAe,CAACC,GAAc,CAACC,EAAc,OAE9E,IAAMC,EAAS,MAAM,QAAQN,GAAY,MAAM,EAAIA,EAAW,OAAS,CAAC,EAClEO,EAAW,MAAM,QAAQP,GAAY,QAAQ,EAAIA,EAAW,SAAW,CAAC,EAY9E,GAVAI,EAAW,UAAYE,EAAO,IAAIE,GAEvB,wHADK,UAAU,WAAWA,GAAO,SAAW,aAAa,CACkE,cACrI,EAAE,KAAK,EAAE,EAEVH,EAAa,UAAYE,EAAS,IAAIE,GAE3B,0HADK,UAAU,WAAWA,GAAM,SAAW,SAAS,CACyE,cACvI,EAAE,KAAK,EAAE,EAEN,CAACH,EAAO,QAAU,CAACC,EAAS,OAAQ,CACpCN,EAAU,UAAU,IAAI,QAAQ,EAChCC,EAAU,UAAU,IAAI,QAAQ,EAChCC,EAAY,UAAU,IAAI,QAAQ,EAClC,MACJ,CAEAF,EAAU,UAAU,OAAO,QAAQ,EACnCC,EAAU,UAAU,OAAO,SAAUI,EAAO,SAAW,CAAC,EACxDH,EAAY,UAAU,OAAO,SAAUI,EAAS,SAAW,CAAC,EAE5DN,EAAU,eAAe,CAAE,SAAU,SAAU,MAAO,OAAQ,CAAC,CACnE,CAEA,SAAS/B,IAAwB,CAC7B,IAAMwC,EAAc,SAAS,eAAe,mBAAmB,EACzDC,EAAU,SAAS,eAAe,iBAAiB,EACnDC,EAAW,SAAS,eAAe,gBAAgB,EAErDF,GAAeA,EAAY,aAAalH,CAAU,IAAM,SACxDkH,EAAY,aAAalH,EAAY,MAAM,EAC3CkH,EAAY,iBAAiB,QAAS,SAAY,CAC9CrC,EAAeqC,EAAa,GAAM,eAAe,EACjD,GAAI,CACA,IAAMnF,EAAW,MAAM,QAAQ,aAAa,EAC5CwE,GAAwBxE,EAAS,IAAI,GAClBA,EAAS,MAAM,QAAU,CAAC,GAAG,OAAS,EAIrD,MAAM,QAAQ,qCAAqC,EAFnD,MAAM,QAAQ,kBAAkB,CAIxC,OAASmD,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,oCAAoC,CAAC,CAChF,QAAE,CACEL,EAAeqC,EAAa,EAAK,CACrC,CACJ,CAAC,GAGDC,GAAWA,EAAQ,aAAanH,CAAU,IAAM,SAChDmH,EAAQ,aAAanH,EAAY,MAAM,EACvCmH,EAAQ,iBAAiB,QAAS,SAAY,CAC1CtC,EAAesC,EAAS,GAAM,YAAY,EAC1C,GAAI,CAEA,IAAME,GADW,MAAM,QAAQ,WAAW,GACnB,MAAM,cAAgB,EAC7C,MAAM,QAAQ,qBAAqBA,CAAK,QAAQA,IAAU,EAAI,GAAK,GAAG,GAAG,EACzE,MAAM5C,EAAS,CACnB,OAASS,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,wBAAwB,CAAC,CACpE,QAAE,CACEL,EAAesC,EAAS,EAAK,CACjC,CACJ,CAAC,GAGDC,GAAYA,EAAS,aAAapH,CAAU,IAAM,SAClDoH,EAAS,aAAapH,EAAY,MAAM,EACxCoH,EAAS,iBAAiB,QAAS,SAAY,CAC3CvC,EAAeuC,EAAU,GAAM,aAAa,EAC5C,GAAI,CAEA,IAAME,GADW,MAAM,QAAQ,UAAU,CAAE,WAAY,OAAQ,aAAc,CAAE,CAAC,GACtD,MAAM,UAChC,GAAI,CAACA,EACD,MAAM,IAAI,MAAM,yBAAyB,EAGzC,UAAU,OACV,MAAM,UAAU,MAAM,CAClB,MAAO,cACP,IAAKA,CACT,CAAC,EACD,MAAM,QAAQ,mBAAmB,GAC1B,UAAU,WAAW,WAC5B,MAAM,UAAU,UAAU,UAAUA,CAAQ,EAC5C,MAAM,QAAQ,iCAAiC,GAE/C,OAAO,OAAO,qCAAsCA,CAAQ,CAEpE,OAASpC,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,8BAA8B,CAAC,CAC1E,QAAE,CACEL,EAAeuC,EAAU,EAAK,CAClC,CACJ,CAAC,EAET,CAKA,SAASxC,IAAuB,CAC5B2C,GAAkB,EAClBC,GAA0B,EAC1BC,GAAyB,EACzBC,EAAwB,EACxBC,EAAgB,CACpB,CAKA,SAASJ,IAAoB,CACzB3H,EAAgB,KAAK,MAAM,aAAa,QAAQ,eAAe,GAAK,IAAI,EACxEgI,GAAoB,CACxB,CAEA,SAASA,IAAsB,CAC3B,IAAMnB,EAAY,SAAS,eAAe,iBAAiB,EAC3D,GAAKA,EAEL,IAAI7G,EAAc,SAAW,EAAG,CAC5B6G,EAAU,UAAY,GACtBA,EAAU,UAAU,IAAI,QAAQ,EAChC,MACJ,CAEAA,EAAU,UAAU,OAAO,QAAQ,EACnCA,EAAU,UAAY;AAAA;AAAA;AAAA,uGAGyE7G,EAAc,MAAM;AAAA;AAAA;AAAA;AAAA,sBAIrGA,EAAc,IAAIwD,GAAQ;AAAA,mEACmBA,EAAK,EAAE;AAAA;AAAA,4CAE9BA,EAAK,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAK,IAAI,CAAC;AAAA;AAAA,qGAE9B,UAAU,WAAWA,EAAK,IAAI,CAAC;AAAA,oGAChC/C,EAAgB+C,EAAK,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAQ1G,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAMvBqD,EAAU,iBAAiB,mBAAmB,EAAE,QAAQoB,GAAO,CAC3DA,EAAI,iBAAiB,QAAS,SAAY,CAEtC,IAAMC,EADOD,EAAI,QAAQ,aAAa,GACd,QAAQ,UAChC,GAAKC,EAEL,GAAI,CACA,MAAM,QAAQ,QAAQA,EAAW,CAAC,EAClClI,EAAgBA,EAAc,OAAOmI,GAAKA,EAAE,KAAOD,CAAS,EAC5D,aAAa,QAAQ,gBAAiB,KAAK,UAAUlI,CAAa,CAAC,EACnE,MAAM,QAAQ,oBAAoB,EAClC,MAAM6E,EAAS,EACfmD,GAAoB,CACxB,MAAgB,CACZ,MAAM,MAAM,6BAA6B,CAC7C,CACJ,CAAC,CACL,CAAC,EAEDnB,EAAU,iBAAiB,mBAAmB,EAAE,QAAQoB,GAAO,CAC3DA,EAAI,iBAAiB,QAAS,IAAM,CAEhC,IAAMC,EADOD,EAAI,QAAQ,aAAa,GACd,QAAQ,UAC3BC,IAELlI,EAAgBA,EAAc,OAAOmI,GAAKA,EAAE,KAAOD,CAAS,EAC5D,aAAa,QAAQ,gBAAiB,KAAK,UAAUlI,CAAa,CAAC,EACnEgI,GAAoB,EACpB,MAAM,KAAK,cAAc,EAC7B,CAAC,CACL,CAAC,EAED,SAAS,eAAe,iBAAiB,GAAG,iBAAiB,QAAS,IAAM,CACxEhI,EAAgB,CAAC,EACjB,aAAa,WAAW,eAAe,EACvCgI,GAAoB,EACpB,MAAM,KAAK,qBAAqB,CACpC,CAAC,EACL,CAKA,SAASJ,IAA4B,CAEjC,IAAMQ,EAAgB,KAAK,MAAM,aAAa,QAAQ,eAAe,GAAK,MAAM,EAE5EA,GAAiBA,EAAc,OAAO,OAAS,IAAM,CAACrI,GAAQA,EAAK,OAAO,SAAW,IACrFsI,GAA0BD,CAAa,EAI3CE,GAA2B,EAG3B,OAAO,iBAAiB,eAAgB,IAAM,CACtCvI,GAAQA,EAAK,OAAO,OAAS,GAC7B,aAAa,QAAQ,gBAAiB,KAAK,UAAU,CACjD,MAAOA,EAAK,MACZ,QAAS,IAAI,KAAK,EAAE,YAAY,CACpC,CAAC,CAAC,CAEV,CAAC,CACL,CAEA,SAASuI,IAA6B,CAElC,IAAMC,EAAa,IAAM,CACjBtI,GAAoB,aAAaA,CAAkB,EACvDA,EAAqB,WAAW,IAAM,CAC9BF,GAAQA,EAAK,OAAO,OAAS,GAC7ByI,GAA0B,CAElC,EAAGrI,CAAoB,CAC3B,EAEA,CAAC,QAAS,SAAU,WAAY,WAAW,EAAE,QAAQsI,GAAS,CAC1D,SAAS,iBAAiBA,EAAOF,EAAY,CAAE,QAAS,GAAM,KAAM,EAAM,CAAC,CAC/E,CAAC,EAEDA,EAAW,CACf,CAEA,SAASF,GAA0BD,EAAe,CAC9C,IAAMM,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,uBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6EAWmDN,EAAc,MAAM,MAAM;AAAA;AAAA;AAAA,sBAGjFA,EAAc,MAAM,MAAM,EAAG,CAAC,EAAE,IAAI5E,GAAQ;AAAA;AAAA,wCAE1BA,EAAK,eAAiBA,EAAK,SAAS,OAAS,gCAAgC;AAAA;AAAA,yGAEZ,UAAU,WAAWA,EAAK,cAAgBA,EAAK,SAAS,MAAQ,SAAS,CAAC;AAAA,6FACtFA,EAAK,QAAQ;AAAA;AAAA;AAAA,qBAGrF,EAAE,KAAK,EAAE,CAAC;AAAA,sBACT4E,EAAc,MAAM,OAAS,EAAI,sEAAsEA,EAAc,MAAM,OAAS,CAAC,kBAAoB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAYzK,SAAS,KAAK,YAAYM,CAAK,CACnC,CAEA,SAASF,IAA4B,CAE7B,eAAe,QAAQ,mBAAmB,IAE9C,MAAM,KAAK,4CAA6C,CACpD,SAAU,IACV,OAAQ,CACJ,KAAM,WACN,QAAS,IAAM,OAAO,SAAS,KAAO,YAC1C,CACJ,CAAC,EAED,eAAe,QAAQ,oBAAqB,MAAM,EACtD,CAKA,SAASX,IAA2B,CAChCc,GAA2B,CAC/B,CAEA,SAASA,IAA6B,CAClC,IAAM9B,EAAY,SAAS,eAAe,wBAAwB,EAClE,GAAI,CAACA,GAAa,CAAC9G,EAAM,OAEzB,IAAM6I,EAAYtI,EAAY,OAAO,cAAc,uBAAyB,EAAE,EACxEuI,EAAWvI,EAAYP,EAAK,SAAS,UAAYA,EAAK,UAAY,CAAC,EACnE+I,EAAY,KAAK,IAAI,EAAGF,EAAYC,CAAQ,EAC5CE,EAAW,KAAK,IAAI,IAAMF,EAAWD,EAAa,GAAG,EAE3D,GAAI/B,EAAU,QAAQ,uBAAyB,MAAO,CAClD,IAAMmC,EAAW,SAAS,eAAe,sBAAsB,EACzDtC,EAAY,SAAS,eAAe,uBAAuB,EAEjEG,EAAU,MAAM,MAAQ,GAAGkC,CAAQ,IAC/BF,GAAYD,GACRI,IAAUA,EAAS,YAAc,YACjCtC,IAAWA,EAAU,YAAc,mCAEnCsC,IAAUA,EAAS,YAAc,GAAGvI,EAAgBqI,CAAS,CAAC,SAC9DpC,IAAWA,EAAU,YAAc,gCAAgCjG,EAAgBmI,CAAS,CAAC,KAErG,MACJ,CAEIC,GAAYD,EACZ/B,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,cAOtBA,EAAU,UAAY;AAAA;AAAA;AAAA,+EAG6CpG,EAAgBqI,CAAS,CAAC;AAAA,uFAClB,KAAK,MAAMC,CAAQ,CAAC;AAAA;AAAA;AAAA,+GAGIA,CAAQ;AAAA;AAAA;AAAA,aAKnH,CAKA,SAASE,IAAuB,CAC5B,IAAMpC,EAAY,SAAS,eAAe,wBAAwB,EAClE,GAAI,CAACA,EAAW,OAEhB,IAAMqC,EAAQ,IAAI,KACZC,EAAU,EACVC,EAAU,EACVC,EAAU,IAAI,KAAKH,EAAM,QAAQ,EAAIC,EAAU,GAAK,GAAK,GAAK,GAAI,EAClEG,EAAU,IAAI,KAAKJ,EAAM,QAAQ,EAAIE,EAAU,GAAK,GAAK,GAAK,GAAI,EAElEG,EAAcC,GAASA,EAAK,mBAAmB,QAAS,CAAE,QAAS,QAAS,MAAO,QAAS,IAAK,SAAU,CAAC,EAElH3C,EAAU,UAAY;AAAA;AAAA;AAAA,2FAG6D0C,EAAWF,CAAO,CAAC,MAAME,EAAWD,CAAO,CAAC;AAAA;AAAA,SAGnI,CAEA,SAASG,IAAuB,CAC5B,IAAMC,EAAS,SAAS,eAAe,mBAAmB,EAC1D,GAAI,CAACA,EAAQ,OAEb,IAAMC,EAA0B,IAAM,CAClC,IAAMC,EAAU7J,GAAM,SAAW,CAAC,EAC5BkD,EAAgB3C,EAAYsJ,EAAQ,UAAY7J,GAAM,UAAY,CAAC,EACnEsE,EAAgB/D,EAAYsJ,EAAQ,iBAAmB7J,GAAM,iBAAmB,CAAC,EAClFqE,EAAyBnB,EAAeoB,EAAetE,CAAI,CACpE,EAEA2J,EAAO,iBAAiB,SAAUC,CAAuB,EACzDA,EAAwB,CAC5B,CAKA,eAAe7B,GAA0B,CACrC,IAAMjB,EAAY,SAAS,eAAe,sBAAsB,EAChE,GAAI,GAACA,GAAa,CAAC9G,GAAQ,CAACA,EAAK,OAAO,QAExC,GAAI,CAEA,IAAMoD,EAAapD,EAAK,MAAM,IAAIyD,GAAQA,EAAK,SAAS,IAAMA,EAAK,UAAU,EAAE,OAAO,OAAO,EAC7F,GAAI,CAACL,EAAW,OAAQ,OAGxB,IAAMhB,EAAW,MAAM,YAAY,WAAWgB,EAAW,CAAC,EAAG,CAAE,MAAO,CAAE,CAAC,EACnE0G,EAAW1H,GAAU,MAAQA,GAAU,SAAW,CAAC,EAEzD,GAAI,CAAC0H,EAAS,OAAQ,OAEtBhD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,0BAIRgD,EAAS,MAAM,EAAG,CAAC,EAAE,IAAIC,GAAW;AAAA;AAAA,qDAETA,EAAQ,IAAI;AAAA,gDACjBA,EAAQ,eAAiBA,EAAQ,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA,6GAGzD,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA,iHAC9BrJ,EAAgBqJ,EAAQ,eAAiBA,EAAQ,KAAK,CAAC;AAAA,2RACmHA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,yBAK5Q,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,cAMvBjD,EAAU,iBAAiB,gBAAgB,EAAE,QAAQoB,GAAO,CACxDA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAMC,EAAYD,EAAI,QAAQ,UAC9BA,EAAI,SAAW,GACfA,EAAI,YAAc,YAElB,GAAI,CACA,MAAM,QAAQ,QAAQC,EAAW,CAAC,EAClC,MAAM,QAAQ,eAAe,EAC7B,MAAMrD,EAAS,CACnB,MAAgB,CACZ,MAAM,MAAM,oBAAoB,CACpC,QAAE,CACEoD,EAAI,SAAW,GACfA,EAAI,YAAc,eACtB,CACJ,CAAC,CACL,CAAC,CACL,OAAS3C,EAAO,CACZ,QAAQ,KAAK,kCAAmCA,CAAK,CACzD,CACJ,CAKA,SAASyC,GAAkB,CACvB,IAAMgC,EAAe,SAAS,eAAe,YAAY,EACnDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAmB,SAAS,eAAe,oBAAoB,EAC/DC,EAAmB,SAAS,eAAe,WAAW,EAE5D,GAAI,CAACJ,GAAgBA,EAAa,aAAa3J,CAAU,IAAM,OAAQ,OACvE2J,EAAa,aAAa3J,EAAY,MAAM,EAE5C,IAAMgK,EAAqB,IAAM,CACzBH,GAAeC,IACfA,EAAiB,YAAc,OAAOD,EAAY,MAAM,MAAM,EAEtE,EAEMI,EAAkB,IAAM,CACrBnK,IACDA,EAAYS,EAAoB,GAGpCoJ,EAAa,QAAU,CAAC,CAAC7J,EAAU,QAC/B8J,GACAA,EAAY,UAAU,OAAO,SAAU,CAAC9J,EAAU,OAAO,EAGzD+J,IACAA,EAAY,MAAQ/J,EAAU,cAAgB,IAG9CiK,IACAA,EAAiB,QAAU,CAAC,CAACjK,EAAU,UACvCiK,EAAiB,SAAW,CAACjK,EAAU,mBAAqB,CAACA,EAAU,SAG3EkK,EAAmB,CACvB,EAEME,EAAqBC,EAAS,SAAY,CAC5C,GAAI,CACA,IAAM9G,EAAU,CACZ,QAAS,CAAC,CAACvD,GAAW,QACtB,aAAcA,GAAW,cAAgB,GACzC,UAAW,CAAC,CAACA,GAAW,SAC5B,EAEMiC,GAAW,MAAM,QAAQ,kBAAkBsB,CAAO,EACxD,GAAItB,IAAU,UAAY,GACtB,MAAM,IAAI,MAAMA,GAAS,SAAW,gCAAgC,EAExE,IAAMqI,GAAOrI,IAAU,MAAQA,GACzBsI,GAAQD,IAAM,WAEhBC,IACAvJ,EAAe,CACX,QAASuJ,GAAM,QACf,aAAcA,GAAM,cAAgB,GACpC,UAAWA,GAAM,UACjB,eAAgBnK,EAAYmK,GAAM,cAAc,CACpD,CAAC,EAGDD,IAAM,mBAAqB,SAC3BtK,EAAU,iBAAmBI,EAAYkK,GAAK,gBAAgB,GAE9DA,IAAM,kBACNtK,EAAU,gBAAkBsK,GAAK,iBAEjCA,IAAM,oBAAsB,SAC5BtK,EAAU,kBAAoB,CAAC,CAACsK,GAAK,mBAGzCH,EAAgB,EAEhB,IAAMT,GAAU7J,GAAM,SAAW,CAAC,EAC5BkD,GAAgB3C,EAAYsJ,GAAQ,UAAY7J,GAAM,UAAY,CAAC,EACnEsE,GAAgB/D,EAAYsJ,GAAQ,iBAAmB7J,GAAM,iBAAmB,CAAC,EAClFqE,EAAyBnB,GAAeoB,GAAetE,CAAI,CACpE,OAASuF,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,gCAAgC,CAAC,CAC5E,CACJ,EAAG,GAAG,EAENyE,EAAa,iBAAiB,SAAU,IAAM,CAC1C7I,EAAe,CAAE,QAAS6I,EAAa,OAAQ,CAAC,EAE3CA,EAAa,SACd7I,EAAe,CAAE,aAAc,GAAI,UAAW,GAAO,eAAgB,CAAE,CAAC,EAG5EmJ,EAAgB,EAEhB,IAAMT,EAAU7J,GAAM,SAAW,CAAC,EAC5BkD,GAAgB3C,EAAYsJ,EAAQ,UAAY7J,GAAM,UAAY,CAAC,EACnEsE,GAAgB/D,EAAYsJ,EAAQ,iBAAmB7J,GAAM,iBAAmB,CAAC,EAClFqE,EAAyBnB,GAAeoB,GAAetE,CAAI,EAEhEuK,EAAmB,CACvB,CAAC,EAEDL,GAAa,iBAAiB,QAAS,IAAM,CACpC/J,GAAW,UAChBgB,EAAe,CAAE,aAAc+I,EAAY,MAAM,MAAM,EAAG,GAAG,CAAE,CAAC,EAChEG,EAAmB,EACnBE,EAAmB,EACvB,CAAC,EAEDH,GAAkB,iBAAiB,SAAU,IAAM,CAC/C,GAAI,CAACjK,GAAW,SAAW,CAACA,GAAW,kBAAmB,CACtDiK,EAAiB,QAAU,GAC3B,MACJ,CAEAjJ,EAAe,CAAE,UAAWiJ,EAAiB,OAAQ,CAAC,EAEtD,IAAMP,EAAU7J,GAAM,SAAW,CAAC,EAC5BkD,GAAgB3C,EAAYsJ,EAAQ,UAAY7J,GAAM,UAAY,CAAC,EACnEsE,GAAgB/D,EAAYsJ,EAAQ,iBAAmB7J,GAAM,iBAAmB,CAAC,EAClFqE,EAAyBnB,GAAeoB,GAAetE,CAAI,EAEhEuK,EAAmB,CACvB,CAAC,EAEDD,EAAgB,CACpB,CAEA,SAASE,EAASG,EAAMC,EAAM,CAC1B,IAAIC,EACJ,OAAO,YAA6BC,EAAM,CACtC,aAAaD,CAAO,EACpBA,EAAU,WAAW,IAAMF,EAAK,GAAGG,CAAI,EAAGF,CAAI,CAClD,CACJ,CAKA,SAASG,GAAsB,CAC3B,IAAMjE,EAAY,SAAS,eAAe,kBAAkB,EACvDA,IAELA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAiBtBA,EAAU,iBAAiB,kBAAkB,EAAE,QAAQoB,GAAO,CAC1DA,EAAI,iBAAiB,QAAS,IAAM,CAChC,MAAM,KAAK,+BAA+B,CAC9C,CAAC,CACL,CAAC,EACL,CAEA,eAAepD,GAAW,CACtB,IAAMgC,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAKA,EAEL,CAAIA,EAAU,QAAQ,aAAe,UACjC,OAAO,KAAKA,EAAW,UAAU,EAGrC,GAAI,CAEA9G,GADiB,MAAM,QAAQ,QAAQ,GACvB,KAEZ8G,EAAU,QAAQ,aAAe,SACjCkE,EAAkBhL,CAAI,EAEtBiL,EAAWjL,CAAI,CAEvB,OAASuF,EAAO,CACZ,QAAQ,MAAM,uBAAwBA,CAAK,EAC3CuB,EAAU,UAAY,qFAC1B,EACJ,CAEA,SAASkE,EAAkB1H,EAAU,CACjC,IAAMwD,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,IAAMvD,EAAQD,GAAU,OAAS,CAAC,EAC5BuG,EAAUvG,GAAU,SAAW,CAAC,EAEtC,GAAI,CAACC,EAAM,OAAQ,CACfuD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAYtB,MACJ,CAGA,IAAM5D,EAAgB2G,EAAQ,UAAYvG,GAAU,UAAY,EAC1DgB,EAAgB/D,EAAYsJ,EAAQ,iBAAmBvG,GAAU,eAAe,EAChF4H,EAAa,SAAS,eAAe,UAAU,EAC/CC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAa,SAAS,eAAe,UAAU,EAC/CC,GAAa,SAAS,eAAe,aAAa,EAClDC,GAAY,SAAS,eAAe,SAAS,EAYnD,GAXIJ,IAAYA,EAAW,YAAcxK,EAAgBwC,CAAa,GAElEiI,GAAeC,IACX9G,EAAgB,GAChB6G,EAAY,UAAU,OAAO,QAAQ,EACrCC,EAAW,YAAc,IAAI1K,EAAgB4D,CAAa,CAAC,IAE3D6G,EAAY,UAAU,IAAI,QAAQ,GAItCE,IAAcC,GAAW,CACzB,IAAMC,GAAehL,EAAYsJ,EAAQ,aAAa,EAClD0B,GAAe,GACfF,GAAW,UAAU,OAAO,QAAQ,EACpCC,GAAU,YAAc5K,EAAgB6K,EAAY,GAEpDF,GAAW,UAAU,IAAI,QAAQ,CAEzC,CAEKhH,EAAyBnB,EAAeoB,EAAehB,CAAQ,EACpE6C,GAAe7C,GAAU,aAAeA,GAAU,QAAQ,MAAQuG,GAAS,aAAe,EAAE,EAG5FtG,EAAM,QAAQE,IAAQ,CAClB,IAAM+H,GAAM1E,EAAU,cAAc,4BAA4BrD,GAAK,EAAE,IAAI,EAC3E,GAAI,CAAC+H,GAAK,OAEV,IAAMC,GAAWD,GAAI,cAAc,YAAY,EAC3CC,IAAYhI,GAAK,WACjBgI,GAAS,MAAQhI,GAAK,UAG1B,IAAMiI,GAAYF,GAAI,cAAc,aAAa,EAC7CE,KACAA,GAAU,YAAchL,EAAgB+C,GAAK,OAASA,GAAK,YAAc,CAAC,GAG9E,IAAMkI,GAAgBH,GAAI,cAAc,kBAAkB,EACtDG,KACAA,GAAc,YAAcjL,EAAgB+C,GAAK,YAAcA,GAAK,eAAiBA,GAAK,cAAgB,CAAC,GAG/G,IAAMmI,GAAUJ,GAAI,cAAc,KAAK,EACnCI,IAAWnI,GAAK,gBAChBmI,GAAQ,IAAMnI,GAAK,cAE3B,CAAC,EAEDoI,EAAe,EACfjD,GAA2B,CAC/B,CAEA,SAASqC,EAAW3H,EAAU,CAC1B,IAAMwD,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,IAAMvD,EAAQD,GAAU,OAAS,CAAC,EAC5BuG,EAAUvG,GAAU,SAAW,CAAC,EAChCJ,EAAgB2G,EAAQ,UAAYvG,GAAU,UAAY,EAC1DgB,EAAgB/D,EAAYsJ,EAAQ,iBAAmBvG,GAAU,eAAe,EAChFV,EAAgB,KAAK,IAAI,EAAGM,EAAgBoB,CAAa,EACzDwH,EAAWnJ,EAAaC,CAAa,EACrC1B,EAAef,GAAW,UAAYI,EAAYJ,EAAU,cAAc,EAAI,EAC9E4L,GAAanJ,EAAgBkJ,EAAW5K,EACxC8K,GAAU1K,EAAW,EACrB8E,GAAa9C,GAAU,QAAQ,MAAQA,GAAU,aAAe,GAEtE,GAAIC,EAAM,SAAW,EAAG,CACpBuD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAetB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6FAM+DvD,EAAM,MAAM;AAAA;AAAA;AAAA,8BAG3EA,EAAM,IAAIE,IAAQwI,EAAexI,EAAI,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0FAmCY/C,EAAgBwC,CAAa,CAAC;AAAA;AAAA,8BAE1FoB,EAAgB,EAAI;AAAA;AAAA;AAAA,6CAGL5D,EAAgB4D,CAAa,CAAC;AAAA;AAAA,8BAE3C,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,kFAKgDnE,GAAW,UAAY,GAAK,QAAQ;AAAA,kFACpC,UAAU,WAAWA,GAAW,iBAAmB,WAAW,CAAC;AAAA,0HACvBe,CAAY,MAAMR,EAAgBQ,CAAY,CAAC;AAAA;AAAA;AAAA,uFAGlF8K,EAAO;AAAA,mGACKtL,EAAgBoL,CAAQ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,iHAKXpL,EAAgBqL,EAAU,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAQ9G3F,GAAa;AAAA;AAAA;AAAA,sFAG2C,UAAU,WAAWA,EAAU,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAQtF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAOiB,UAAU,WAAWA,EAAU,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAMpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qNAOwLjG,GAAW,QAAU,UAAY,EAAE;AAAA;AAAA;AAAA,4DAG5LA,GAAW,QAAU,GAAK,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,0GAKY,UAAU,WAAWA,GAAW,cAAgB,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAMhHA,GAAW,UAAY,UAAY,EAAE,IAAIA,GAAW,kBAAoB,GAAK,UAAU;AAAA,kGAClC,UAAU,WAAWA,GAAW,iBAAmB,WAAW,CAAC,GAAGA,GAAW,kBAAoB,MAAMO,EAAgBP,GAAW,kBAAoBe,CAAY,CAAC,IAAM,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAMxP,OAAO,cAAgB,OAAO,aAAa,YAAc,OAAO,aAAa,YAAc,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAmClI2K,EAAe,EACf5G,GAAqB,EAChBZ,EAAyBnB,EAAeoB,EAAehB,CAAQ,CACxE,CAEA,SAAS2I,EAAexI,EAAM,CAC1B,IAAMsG,EAAUtG,EAAK,SAAW,CAAC,EAC3ByI,EAAUzI,EAAK,QACf0I,EAAcpC,EAAQ,MAAQtG,EAAK,cAAgB,IACnD2I,EAAcrC,EAAQ,MAAQtG,EAAK,cAAgB,UACnD4I,EAAe5I,EAAK,eAAiBsG,EAAQ,eAAiBA,EAAQ,MACtE5B,EAAY4B,EAAQ,IAAMtG,EAAK,YAAc,GAC7C6I,EAAa/L,EAAYkD,EAAK,YAAY,EAC1C8I,EAAehM,EAAYkD,EAAK,eAAiBA,EAAK,UAAU,EAChE+I,GAAYjM,EAAYkD,EAAK,OAASA,EAAK,UAAU,GAAK8I,GAAgB9I,EAAK,UAAY,GAC3FgJ,GAAeH,EAAaC,GAAgBA,EAAe,EAEjE,MAAO;AAAA,kEACmD9I,EAAK,EAAE,sBAAsB0E,CAAS;AAAA;AAAA,yCAE/DgE,CAAW;AAAA,0BAC1BE,EAAe;AAAA;AAAA,mCAENA,CAAY;AAAA,mCACZ,UAAU,WAAWD,CAAW,CAAC;AAAA;AAAA;AAAA,2BAGvC;AAAA;AAAA;AAAA;AAAA;AAAA,+BAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAOsBD,CAAW;AAAA,sCAC1B,UAAU,WAAWC,CAAW,CAAC;AAAA;AAAA;AAAA,8BAGzCF,GAAWzI,EAAK,aAAe;AAAA,4FAC+B,UAAU,WAAWyI,GAAS,MAAQA,GAAS,OAASzI,EAAK,YAAY,CAAC;AAAA,8BACtI,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCA8BOA,EAAK,QAAQ;AAAA;AAAA,uCAEfsG,EAAQ,gBAAkB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAYrC0C,GAAe;AAAA,uGAC0D/L,EAAgB4L,EAAa7I,EAAK,QAAQ,CAAC;AAAA,8BAClH,EAAE;AAAA,8FAC4D/C,EAAgB8L,EAAS,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,SAMpH,CAEA,SAASX,GAAiB,CACtB,IAAMa,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAe,SAAS,eAAe,gBAAgB,EACvDC,EAAkB,SAAS,eAAe,mBAAmB,EAE/DF,GAAaA,EAAU,aAAarM,CAAU,IAAM,SACpDqM,EAAU,aAAarM,EAAY,MAAM,EACzCqM,EAAU,iBAAiB,QAAS,MAAOG,GAAM,CACjD,IAAMC,EAAWD,EAAE,OAAO,QAAQ,YAAY,EAC9C,GAAI,CAACC,EAAU,OAEf,IAAMC,EAASD,EAAS,QAAQ,OAC1B3E,EAAY2E,EAAS,QAAQ,UAC7BrB,EAAWqB,EAAS,cAAc,gBAAgB,GAAKA,EAAS,cAAc,YAAY,EAEhG,GAAID,EAAE,OAAO,QAAQ,kBAAkB,EACnC,MAAMG,EAAWD,CAAM,UAChBF,EAAE,OAAO,QAAQ,qBAAqB,EAC7C,MAAMI,GAAaF,EAAQ5E,EAAW2E,CAAQ,UACvCD,EAAE,OAAO,QAAQ,eAAe,EAAG,CAC1C,IAAMK,EAAU,SAASzB,GAAU,MAAO,EAAE,GAAK,EAC7CyB,EAAU,GACV,MAAMC,EAAeJ,EAAQG,EAAU,CAAC,CAEhD,SAAWL,EAAE,OAAO,QAAQ,eAAe,EAAG,CAC1C,IAAMK,EAAU,SAASzB,GAAU,MAAO,EAAE,GAAK,EAC3C2B,GAAM,SAAS3B,GAAU,IAAK,EAAE,GAAK,GACvCyB,EAAUE,IACV,MAAMD,EAAeJ,EAAQG,EAAU,CAAC,CAEhD,CACA,CAAC,EAEDR,EAAU,iBAAiB,SAAU,MAAOG,GAAM,CAClD,GAAIA,EAAE,OAAO,UAAU,SAAS,eAAe,GAAKA,EAAE,OAAO,UAAU,SAAS,WAAW,EAAG,CAE1F,IAAME,EADWF,EAAE,OAAO,QAAQ,YAAY,GACrB,QAAQ,OAC3BQ,EAAW,SAASR,EAAE,OAAO,MAAO,EAAE,GAAK,EAE7CE,GAAUM,EAAW,GACrB,MAAMF,EAAeJ,EAAQM,CAAQ,CAE7C,CACA,CAAC,GAGDV,GAAgBA,EAAa,aAAatM,CAAU,IAAM,SAC1DsM,EAAa,aAAatM,EAAY,MAAM,EAC5CsM,EAAa,iBAAiB,QAAS,SAAY,CACjC,MAAM,MAAM,QAAQ,CAClC,MAAO,aACP,QAAS,4DACT,YAAa,aACb,WAAY,QAChB,CAAC,GAGG,MAAMW,GAAU,CAEpB,CAAC,GAGDV,GAAmBA,EAAgB,aAAavM,CAAU,IAAM,SAChEuM,EAAgB,aAAavM,EAAY,MAAM,EAC/CuM,EAAgB,iBAAiB,QAAS,SAAY,CAClD,MAAMW,GAAa,CACvB,CAAC,EAET,CAEA,eAAeJ,EAAeJ,EAAQM,EAAU,CAC5C,GAAI,CACA,MAAM,QAAQ,WAAWN,EAAQM,CAAQ,EACzC,MAAMvI,EAAS,EACf,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASS,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,4BAA4B,CAC7D,CACJ,CAEA,eAAeyH,EAAWD,EAAQ,CAC9B,GAAI,CACA,MAAM,QAAQ,WAAWA,CAAM,EAC/B,MAAM,QAAQ,yBAAyB,EACvC,MAAMjI,EAAS,EACf,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASS,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,CACJ,CAEA,eAAe0H,GAAaF,EAAQ5E,EAAWqF,EAAiB,CAC5D,GAAI,CAEA,IAAM/J,EAAOzD,GAAM,OAAO,KAAKoI,GAAK,OAAOA,EAAE,EAAE,IAAM,OAAO2E,CAAM,CAAC,EACnE,GAAI,CAACtJ,EAAM,OAEX,IAAMsG,EAAUtG,EAAK,SAAW,CAAC,EAG3BgK,EAAY,CACd,GAAItF,GAAa4B,EAAQ,IAAMtG,EAAK,WACpC,KAAMsG,EAAQ,MAAQtG,EAAK,cAAgB,UAC3C,MAAOA,EAAK,eAAiBsG,EAAQ,eAAiBA,EAAQ,OAAS,GACvE,MAAOtG,EAAK,eAAiBA,EAAK,YAAcsG,EAAQ,OAAS,CACrE,EAGsB9J,EAAc,UAAUmI,GAAKA,EAAE,KAAOD,CAAS,IAC/C,KAClBlI,EAAc,KAAKwN,CAAS,EAC5B,aAAa,QAAQ,gBAAiB,KAAK,UAAUxN,CAAa,CAAC,GAIvE,MAAM,QAAQ,WAAW8M,CAAM,EAC/B,MAAM,QAAQ,sBAAsB,EACpC,MAAMjI,EAAS,EACf,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASS,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,sBAAsB,CACvD,CACJ,CAEA,eAAe+H,IAAY,CACvB,GAAI,CACA,MAAM,QAAQ,UAAU,EACxB,MAAM,QAAQ,eAAe,EAC7B,MAAMxI,EAAS,EACf,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASS,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,uBAAuB,CACxD,CACJ,CAEA,SAASP,IAAiB,CACtB,IAAMuB,EAAO,SAAS,eAAe,aAAa,EAElDA,GAAM,iBAAiB,SAAU,MAAOsG,GAAM,CAC1CA,EAAE,eAAe,EAGjB,IAAMa,EADY,SAAS,eAAe,aAAa,GAC/B,MAAM,KAAK,EAEnC,GAAI,CAACA,EAAM,CACP,MAAM,MAAM,6BAA6B,EACzC,MACJ,CAEA,IAAMC,EAAYpH,EAAK,cAAc,uBAAuB,EAC5DoH,EAAU,SAAW,GACrBA,EAAU,YAAc,cAExB,GAAI,CACA,IAAMzK,EAAgB3C,EAAYP,GAAM,SAAS,UAAYA,GAAM,UAAY,CAAC,EAC1EoC,EAAW,MAAM,QAAQ,YAAYsL,EAAM,CAAE,SAAUxK,CAAc,CAAC,EACtE0K,EAAcxL,GAAU,MAAM,MAAM,QAAQ,MAAQA,GAAU,MAAM,MAAM,aAAesL,EAC/FvH,GAAeyH,CAAW,EAC1B,MAAM,QAAQ,iBAAiB,EAC/B,MAAM9I,EAAS,CACnB,OAASS,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,sBAAsB,CAAC,CAClE,QAAE,CACEoI,EAAU,SAAW,GACrBA,EAAU,YAAc,OAC5B,CACJ,CAAC,EAED,IAAMlH,EAAW,SAAS,eAAe,kBAAkB,EAC3DA,GAAU,iBAAiB,QAAS,SAAY,CAE5C,IAAMiH,EADY,SAAS,eAAe,aAAa,GAC/B,MAAM,KAAK,EAEnC,GAAI,CAACA,EAAM,CACP,MAAM,MAAM,6BAA6B,EACzC,MACJ,CAEAjH,EAAS,SAAW,GACpB,IAAMoH,EAAepH,EAAS,YAC9BA,EAAS,YAAc,cAEvB,GAAI,CACA,IAAMvD,EAAgB3C,EAAYP,GAAM,SAAS,UAAYA,GAAM,UAAY,CAAC,EAC1EoC,EAAW,MAAM,QAAQ,YAAYsL,EAAM,CAAE,SAAUxK,CAAc,CAAC,EACtE0K,EAAcxL,GAAU,MAAM,MAAM,QAAQ,MAAQA,GAAU,MAAM,MAAM,aAAesL,EAC/FvH,GAAeyH,CAAW,EAC1B,MAAM,QAAQ,iBAAiB,EAC/B,MAAM9I,EAAS,CACnB,OAASS,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,sBAAsB,CAAC,CAClE,QAAE,CACEkB,EAAS,SAAW,GACpBA,EAAS,YAAcoH,GAAgB,OAC3C,CACJ,CAAC,CACL,CAEA,eAAeN,IAAe,CAC1B,GAAI,CACA,MAAM,QAAQ,aAAa,EAC3BpH,GAAe,EAAE,EACjB,MAAM,QAAQ,iBAAiB,EAC/B,MAAMrB,EAAS,CACnB,OAASS,EAAO,CACZ,MAAM,MAAMD,EAAoBC,EAAO,0BAA0B,CAAC,CACtE,CACJ,CAEA,SAASuI,IAAU,CACf9N,EAAO,IACX,CAEA,MAAO,CACH,KAAA6E,EACA,QAAAiJ,EACJ,CACJ,GAAG,EAEH,OAAO,SAAWjO,GACXD,GAAQC,KC1lDf,IAAAkO,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAumCCD,GA5mCPE,GAAAC,GAAA,KAKMF,IAAgB,UAAW,CAC7B,aAEA,IAAIG,EAAiB,CAAC,EAClBC,EAAc,EACdC,EAAkB,KAClBC,EAAkB,KAClBC,EAAc,GACdC,EAAgB,GAChBC,EAAkB,GAClBC,EAAc,CAAC,EACfC,EAAc,CAAC,EACbC,EAAc,EAEpB,eAAeC,GAAO,CAElB,GAAIN,EAAa,OACjBA,EAAc,GAEd,IAAMO,EAAeC,EAAuB,EAG5C,GAAI,CAACD,EAED,OAIJ,IAAME,EAAkB,SAAS,eAAe,iBAAiB,EACjE,GAAIA,GAAmBA,EAAgB,cAAc,IAAI,EAAG,CAExDC,GAAmB,EACnBC,GAAgB,EAChBC,GAAe,EACfC,EAAqB,EACrB,MACJ,CAEAjB,EAAiBkB,EAAkB,EACnCjB,EAAc,SAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAAE,IAAI,MAAM,CAAC,GAAK,EAEnF,MAAMkB,GAAaR,CAAY,EAC/BG,GAAmB,EACnBC,GAAgB,EAChBC,GAAe,EACfC,EAAqB,CACzB,CAKA,SAASA,GAAuB,CAC5BG,EAAmB,EACnBC,EAAoB,EACpBC,EAAc,EACdC,EAAqB,EACrBC,EAAyB,EACzBC,EAAwB,CAC5B,CAKA,SAASL,GAAqB,CAC1B,IAAMM,EAAkB,SAAS,eAAe,mBAAmB,EACnE,GAAI,CAACA,EAAiB,OAEL,IAAI,qBAAsBC,GAAY,CACnDA,EAAQ,QAAQC,GAAS,CACjBA,EAAM,gBAAkB,CAACvB,GAAiBC,GAC1CuB,EAAiB,CAEzB,CAAC,CACL,EAAG,CACC,WAAY,YACZ,UAAW,GACf,CAAC,EAEQ,QAAQH,CAAe,CACpC,CAEA,eAAeG,GAAmB,CAC9B,GAAIxB,GAAiB,CAACC,GAAmB,CAACJ,EAAiB,OAE3DG,EAAgB,GAChBJ,IAEA,IAAM6B,EAAmB,SAAS,eAAe,wBAAwB,EACrEA,GACAA,EAAiB,UAAU,OAAO,QAAQ,EAG9C,GAAI,CACA,IAAMC,EAAS,CACX,SAAU7B,EAAgB,GAC1B,KAAMD,EACN,MAAO,GACP,GAAGD,CACP,EAEMgC,EAAW,MAAM,YAAY,OAAOD,CAAM,EAC1CE,EAAWD,EAAS,MAAQ,CAAC,EAC7BE,EAAOF,EAAS,MAAQ,CAAC,EAE3BC,EAAS,SAAW,EACpB3B,EAAkB,IAElBC,EAAc,CAAC,GAAGA,EAAa,GAAG0B,CAAQ,EAC1CE,EAAeF,CAAQ,EACvB3B,EAAkBL,GAAeiC,EAAK,aAAe,IAGzDE,GAAU,CACd,OAASC,EAAO,CACZ,QAAQ,MAAM,gCAAiCA,CAAK,CACxD,QAAE,CACEhC,EAAgB,GACZyB,GACAA,EAAiB,UAAU,IAAI,QAAQ,CAE/C,CACJ,CAEA,SAASK,EAAeF,EAAU,CAC9B,IAAMK,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAEhB,IAAMC,EAAW,QAAQ,IAAI,iBAAiB,GAAK,OAEnDN,EAAS,QAAQO,GAAW,CACxB,IAAMC,EAAc,YAAY,OAAOD,EAAS,CAC5C,OAAQD,EACR,YAAa,GACb,cAAe,EACnB,CAAC,EACKG,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAYD,EACpB,IAAME,EAAYD,EAAQ,kBAC1BC,EAAU,UAAU,IAAI,kBAAkB,EAC1CL,EAAU,YAAYK,CAAS,CACnC,CAAC,EAED,YAAY,WAAWL,CAAS,CACpC,CAKA,SAASjB,GAAsB,CAE3Bb,EAAc,KAAK,MAAM,aAAa,QAAQ,iBAAiB,GAAK,IAAI,EACxEoC,EAAiB,EAGjB,SAAS,iBAAiB,QAAUC,GAAM,CACtC,IAAMC,EAAaD,EAAE,OAAO,QAAQ,gBAAgB,EACpD,GAAI,CAACC,EAAY,OAEjBD,EAAE,eAAe,EACjB,IAAME,EAAY,SAASD,EAAW,QAAQ,OAAO,EACrDE,EAAcD,CAAS,CAC3B,CAAC,CACL,CAEA,SAASC,EAAcD,EAAW,CAC9B,IAAME,EAAQzC,EAAY,UAAU0C,GAAKA,EAAE,KAAOH,CAAS,EAE3D,GAAIE,EAAQ,GACRzC,EAAY,OAAOyC,EAAO,CAAC,EAC3B,MAAM,KAAK,sBAAsB,MAC9B,CACH,GAAIzC,EAAY,QAAUC,EAAa,CACnC,MAAM,QAAQ,yBAAyBA,CAAW,WAAW,EAC7D,MACJ,CAEA,IAAM+B,EAAUjC,EAAY,KAAK2C,GAAKA,EAAE,KAAOH,CAAS,EACpDP,IACAhC,EAAY,KAAK,CACb,GAAIgC,EAAQ,GACZ,KAAMA,EAAQ,KACd,MAAOA,EAAQ,eAAiBA,EAAQ,MACxC,MAAOA,EAAQ,MACf,WAAYA,EAAQ,UACxB,CAAC,EACD,MAAM,QAAQ,kBAAkB,EAExC,CAEA,aAAa,QAAQ,kBAAmB,KAAK,UAAUhC,CAAW,CAAC,EACnEoC,EAAiB,EACjBO,EAAqB,CACzB,CAEA,SAASP,GAAmB,CACxB,IAAIQ,EAAa,SAAS,eAAe,aAAa,EAEtD,GAAI5C,EAAY,SAAW,EAAG,CAC1B4C,GAAY,OAAO,EACnB,MACJ,CAEKA,IACDA,EAAa,SAAS,cAAc,KAAK,EACzCA,EAAW,GAAK,cAChBA,EAAW,UAAY,uKACvB,SAAS,KAAK,YAAYA,CAAU,GAGxCA,EAAW,UAAY;AAAA;AAAA;AAAA;AAAA,0HAI2F5C,EAAY,MAAM,IAAIC,CAAW;AAAA,0BACjID,EAAY,IAAIgC,GAAW;AAAA;AAAA,4CAETA,EAAQ,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA,+DAC1EA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,yBAIhD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,6PAG0NhC,EAAY,OAAS,EAAI,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAY7R4C,EAAW,iBAAiB,uBAAuB,EAAE,QAAQC,GAAO,CAChEA,EAAI,iBAAiB,QAAS,IAAM,CAChC,IAAMN,EAAY,SAASM,EAAI,QAAQ,aAAa,EACpDL,EAAcD,CAAS,CAC3B,CAAC,CACL,CAAC,EAED,SAAS,eAAe,iBAAiB,GAAG,iBAAiB,QAASO,CAAgB,EACtF,SAAS,eAAe,mBAAmB,GAAG,iBAAiB,QAASC,CAAY,CACxF,CAEA,SAASJ,GAAuB,CAC5B,SAAS,iBAAiB,gBAAgB,EAAE,QAAQE,GAAO,CACvD,IAAMN,EAAY,SAASM,EAAI,QAAQ,OAAO,EAC1B7C,EAAY,KAAK0C,GAAKA,EAAE,KAAOH,CAAS,GAGxDM,EAAI,UAAU,IAAI,iBAAkB,kBAAkB,EACtDA,EAAI,UAAU,OAAO,eAAgB,gBAAgB,IAErDA,EAAI,UAAU,OAAO,iBAAkB,kBAAkB,EACzDA,EAAI,UAAU,IAAI,eAAgB,gBAAgB,EAE1D,CAAC,CACL,CAEA,SAASE,GAAe,CACpB/C,EAAc,CAAC,EACf,aAAa,WAAW,iBAAiB,EACzCoC,EAAiB,EACjBO,EAAqB,EACrB,MAAM,KAAK,sBAAsB,CACrC,CAEA,eAAeG,GAAmB,CAC9B,GAAI9C,EAAY,OAAS,EAAG,OAE5B,IAAMgD,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,gBACXA,EAAM,UAAY,mCAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAeYhD,EAAY,IAAI0C,GAAK;AAAA;AAAA;AAAA,4DAGCA,EAAE,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAE,IAAI,CAAC;AAAA,qHACxB,UAAU,WAAWA,EAAE,IAAI,CAAC;AAAA;AAAA;AAAA,qCAG5G,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAMT1C,EAAY,IAAI0C,GAAK;AAAA;AAAA,8CAEbA,EAAE,WAAa;AAAA,uHAC0D,UAAU,YAAYA,EAAE,UAAU,CAAC;AAAA,yGACjD,UAAU,YAAYA,EAAE,KAAK,CAAC;AAAA,8CACvF;AAAA,iHACiE,UAAU,YAAYA,EAAE,KAAK,CAAC;AAAA,6CAClG;AAAA;AAAA,qCAER,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,sCAIT1C,EAAY,IAAI0C,GAAK;AAAA;AAAA,+EAEoBA,EAAE,EAAE;AAAA;AAAA;AAAA;AAAA,qCAI9C,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UASvC,SAAS,KAAK,YAAYM,CAAK,CACnC,CAKA,SAASlC,GAAgB,CACrB,SAAS,iBAAiB,QAAS,MAAOuB,GAAM,CAC5C,IAAMY,EAAeZ,EAAE,OAAO,QAAQ,mBAAmB,EACzD,GAAI,CAACY,EAAc,OAEnB,IAAMV,EAAYU,EAAa,QAAQ,UAClCV,IAELF,EAAE,eAAe,EACjB,MAAMa,EAAcX,CAAS,EACjC,CAAC,CACL,CAEA,eAAeW,EAAcX,EAAW,CACpC,IAAMS,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,mBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAQlB,SAAS,KAAK,YAAYA,CAAK,EAE/B,GAAI,CACA,IAAMxB,EAAW,MAAM,YAAY,WAAWe,CAAS,EACjDP,EAAUR,EAAS,MAAQA,EAE3B2B,EAAeH,EAAM,cAAc,WAAW,EACpDG,EAAa,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wCAOGnB,EAAQ,eAAiBA,EAAQ,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA,0BAEpIA,EAAQ,QAAUA,EAAQ,OAAO,OAAS,EAAI;AAAA;AAAA,kCAEtCA,EAAQ,OAAO,MAAM,EAAG,CAAC,EAAE,IAAI,CAACoB,EAAKC,KAAM;AAAA,iHACoCA,KAAM,EAAI,2CAA6C,oBAAoB,+GAA+GD,EAAI,OAASA,CAAG;AAAA,oDACvQA,EAAI,WAAaA,EAAI,OAASA,CAAG;AAAA;AAAA,iCAEpD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,0BAEf,EAAE;AAAA;AAAA;AAAA,6FAG+D,UAAU,WAAWpB,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA,kCAG7F,ibAAib,OAAO,KAAK,MAAMA,EAAQ,QAAU,CAAC,CAAC,CAAC;AAAA;AAAA,wFAElaA,EAAQ,cAAgB,CAAC;AAAA,8BACnFA,EAAQ,gBAAkB,GAAKA,EAAQ,eAAiB,EAAI;AAAA,8GACoBA,EAAQ,cAAc;AAAA,8BACpG,EAAE;AAAA;AAAA;AAAA,8BAGJA,EAAQ,YAAcA,EAAQ,iBAAmB;AAAA,wGACyB,UAAU,YAAYA,EAAQ,YAAcA,EAAQ,gBAAgB,CAAC;AAAA,yFACpF,UAAU,YAAYA,EAAQ,KAAK,CAAC;AAAA,6JACgC,KAAK,OAAO,GAAKA,EAAQ,YAAcA,EAAQ,kBAAoBA,EAAQ,OAAS,GAAG,CAAC;AAAA,8BACrN;AAAA,kGACkE,UAAU,YAAYA,EAAQ,KAAK,CAAC;AAAA,6BACzG;AAAA;AAAA,0FAE6D,UAAU,WAAWA,EAAQ,mBAAqBA,EAAQ,aAAe,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gGAOtEA,EAAQ,gBAAkB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mEAWzDA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,qDAIxBA,EAAQ,MAAQA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAUnE,IAAMsB,EAAW,SAAS,eAAe,cAAc,EACjDC,EAAW,SAAS,eAAe,cAAc,EACjDC,EAAU,SAAS,eAAe,aAAa,EAC/CC,EAAe,SAAS,eAAe,gBAAgB,EAE7DF,GAAU,iBAAiB,QAAS,IAAM,CACtC,IAAMG,EAAM,SAASJ,EAAS,KAAK,GAAK,EACpCI,EAAM,IAAGJ,EAAS,MAAQI,EAAM,EACxC,CAAC,EAEDF,GAAS,iBAAiB,QAAS,IAAM,CACrC,IAAME,EAAM,SAASJ,EAAS,KAAK,GAAK,EAClCK,GAAM,SAASL,EAAS,GAAG,GAAK,GAClCI,EAAMC,KAAKL,EAAS,MAAQI,EAAM,EAC1C,CAAC,EAEDD,GAAc,iBAAiB,QAAS,SAAY,CAChD,IAAMG,EAAM,SAASN,EAAS,KAAK,GAAK,EACxCG,EAAa,SAAW,GACxBA,EAAa,UAAY,6VAEzB,GAAI,CACA,MAAM,QAAQ,QAAQzB,EAAQ,GAAI4B,CAAG,EACrC,MAAM,QAAQ,eAAe,EAC7BZ,EAAM,OAAO,CACjB,MAAgB,CACZ,MAAM,MAAM,uBAAuB,CACvC,QAAE,CACES,EAAa,SAAW,GACxBA,EAAa,UAAY,+TAC7B,CACJ,CAAC,CACL,OAAS5B,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,EAC9CmB,EAAM,OAAO,EACb,MAAM,MAAM,gCAAgC,CAChD,CACJ,CAKA,SAASjC,GAAuB,CAE5B,GAAI,CADoB,SAAS,eAAe,oBAAoB,EAC9C,OAGtB,IAAM8C,EAAW,SAAS,eAAe,kBAAkB,EACrDC,EAAW,SAAS,eAAe,kBAAkB,EAEvD,CAACD,GAAY,CAACC,GAGlB,CAACD,EAAUC,CAAQ,EAAE,QAAQC,GAAS,CAClCA,EAAM,iBAAiB,QAAS,IAAM,CAClCC,EAAwB,CAC5B,CAAC,CACL,CAAC,CACL,CAEA,SAASA,GAA0B,CAC/B,IAAMC,EAAU,SAAS,eAAe,qBAAqB,EACvDC,EAAS,SAAS,eAAe,kBAAkB,GAAG,OAAS,EAC/DC,EAAS,SAAS,eAAe,kBAAkB,GAAG,OAAS,SAEjEF,IACAA,EAAQ,YAAc,IAAIC,CAAM,OAAOC,CAAM,GAErD,CAKA,SAASnD,GAA2B,CAChCoD,EAA2B,CAC/B,CAEA,SAASA,GAA6B,CAClC,IAAMtC,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,IAAMuC,EAAU,CAAC,EAcjB,GAZI7E,EAAe,WACf6E,EAAQ,KAAK,CAAE,IAAK,YAAa,MAAO,SAAS7E,EAAe,SAAS,EAAG,CAAC,EAE7EA,EAAe,WACf6E,EAAQ,KAAK,CAAE,IAAK,YAAa,MAAO,SAAS7E,EAAe,SAAS,EAAG,CAAC,EAE7EA,EAAe,UACf6E,EAAQ,KAAK,CAAE,IAAK,WAAY,MAAO,UAAW,CAAC,EAEnD7E,EAAe,SACf6E,EAAQ,KAAK,CAAE,IAAK,UAAW,MAAO,SAAU,CAAC,EAEjD7E,EAAe,SAAU,CACzB,IAAM8E,EAAc,CAChB,MAAS,qBACT,SAAU,qBACV,cAAe,eACf,KAAQ,MACR,cAAe,cACnB,EACAD,EAAQ,KAAK,CAAE,IAAK,WAAY,MAAOC,EAAY9E,EAAe,QAAQ,GAAKA,EAAe,QAAS,CAAC,CAC5G,CAEA,GAAI6E,EAAQ,SAAW,EAAG,CACtBvC,EAAU,UAAY,GACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA,kBAGZuC,EAAQ,IAAIE,GAAK;AAAA,kDACeA,EAAE,GAAG;AAAA,0BAC7BA,EAAE,KAAK;AAAA;AAAA;AAAA,iBAGhB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAKnBzC,EAAU,iBAAiB,sBAAsB,EAAE,QAAQe,GAAO,CAC9DA,EAAI,iBAAiB,QAAS,IAAM,CAChC,IAAM2B,EAAM3B,EAAI,QAAQ,aACxB,OAAOrD,EAAegF,CAAG,EACzBC,GAAa,CACjB,CAAC,CACL,CAAC,EAED,SAAS,eAAe,0BAA0B,GAAG,iBAAiB,QAAS,IAAM,CACjFjF,EAAiB,CAAC,EAClBiF,GAAa,CACjB,CAAC,CACL,CAKA,SAASxD,GAA0B,CAC/ByD,EAAmB,CACvB,CAEA,SAASA,EAAmBC,EAAQ,KAAM,CACtC,IAAMC,EAAU,SAAS,eAAe,eAAe,EAClDA,GAEDD,IAAU,OACVC,EAAQ,YAAc,GAAGD,CAAK,YAEtC,CAEA,SAASvE,GAAyB,CAE9B,IAAMyE,EADO,OAAO,SAAS,SACV,MAAM,wBAAwB,EACjD,OAAOA,EAAQA,EAAM,CAAC,EAAI,IAC9B,CAEA,SAASnE,GAAoB,CACzB,IAAMa,EAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnD8C,EAAU,CAAC,EAEb9C,EAAO,IAAI,WAAW,IAAG8C,EAAQ,UAAY9C,EAAO,IAAI,WAAW,GACnEA,EAAO,IAAI,WAAW,IAAG8C,EAAQ,UAAY9C,EAAO,IAAI,WAAW,GACnEA,EAAO,IAAI,UAAU,IAAG8C,EAAQ,SAAW9C,EAAO,IAAI,UAAU,GAChEA,EAAO,IAAI,UAAU,IAAG8C,EAAQ,SAAW9C,EAAO,IAAI,UAAU,IAAM,QACtEA,EAAO,IAAI,SAAS,IAAG8C,EAAQ,QAAU9C,EAAO,IAAI,SAAS,IAAM,QAEvE,IAAMuD,EAAavD,EAAO,OAAO,MAAM,EACvC,OAAIuD,EAAW,SAAQT,EAAQ,WAAaS,GAErCT,CACX,CAEA,eAAe1D,GAAaoE,EAAM,CAC9B,IAAM1E,EAAkB,SAAS,eAAe,iBAAiB,EAC3D2E,EAAoB,SAAS,eAAe,mBAAmB,EAC/DC,EAAmB,SAAS,eAAe,kBAAkB,EAE/D5E,GAAiB,OAAO,KAAKA,EAAiB,UAAU,EACxD2E,GAAmB,OAAO,KAAKA,EAAmB,UAAU,EAEhE,GAAI,CACA,IAAME,EAAmB,MAAM,cAAc,YAAYH,CAAI,EAG7D,GAFArF,EAAkBwF,EAAiB,MAAQA,EAEvC,CAACxF,EAAiB,CAClB,OAAO,SAAS,KAAO,QACvB,MACJ,CAEAyF,GAAqBzF,CAAe,EACpC,MAAM0F,GAAgB1F,CAAe,EACrC,MAAM2F,GAAY3F,CAAe,EACjC,MAAM4F,GAAa,EACnB,MAAMC,GAAkB7F,CAAe,CAC3C,OAASmC,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,EAC3CxB,IACAA,EAAgB,UAAY,uDAEpC,CACJ,CAEA,SAAS8E,GAAqBK,EAAU,CACpC,IAAM1D,EAAY,SAAS,eAAe,iBAAiB,EACtDA,IAEL,SAAS,MAAQ,GAAG0D,EAAS,IAAI,aAEjC1D,EAAU,UAAY;AAAA;AAAA,kBAEZ0D,EAAS,MAAQ;AAAA;AAAA,oCAECA,EAAS,KAAK;AAAA;AAAA;AAAA,kBAG9B,EAAE;AAAA;AAAA,oFAE8D,UAAU,WAAWA,EAAS,IAAI,CAAC;AAAA,sBACjGA,EAAS,YAAc;AAAA,6DACgB,UAAU,WAAWA,EAAS,WAAW,CAAC;AAAA,sBAC/E,EAAE;AAAA,sBACJA,EAAS,cAAgB;AAAA,gEACiBA,EAAS,aAAa;AAAA,sBAC9D,EAAE;AAAA;AAAA;AAAA,UAItB,CAEA,eAAeJ,GAAgBI,EAAU,CACrC,IAAM1D,EAAY,SAAS,eAAe,aAAa,EACvD,GAAKA,EAEL,GAAI,CAEA,IAAM2D,GADW,MAAM,cAAc,eAAeD,EAAS,EAAE,GAClC,MAAQ,CAAC,EAEhCE,EAAQ,CACV,CAAE,MAAO,OAAQ,IAAK,GAAI,EAC1B,CAAE,MAAO,aAAc,IAAK,cAAe,EAC3C,GAAGD,EAAY,IAAIE,IAAS,CACxB,MAAOA,EAAK,KACZ,IAAK,eAAeA,EAAK,IAAI,GACjC,EAAE,CACN,EAEA7D,EAAU,UAAY,WAAW,OAAO4D,CAAK,CACjD,OAAS7D,EAAO,CACZ,QAAQ,MAAM,8BAA+BA,CAAK,CACtD,CACJ,CAEA,eAAewD,GAAYG,EAAU,CACjC,IAAM1D,EAAY,SAAS,eAAe,kBAAkB,EAC5D,GAAKA,EAEL,GAAI,CAEA,IAAM8D,GADW,MAAM,YAAY,iBAAiB,CAAE,SAAUJ,EAAS,EAAG,CAAC,GAC9C,MAAQ,CAAC,EAExC1D,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAUOtC,EAAe,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAQ9BA,EAAe,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAiBjCA,EAAe,SAAW,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCASxCA,EAAe,QAAU,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAQvDoG,EAAc,YAAcA,EAAc,WAAW,OAAS;AAAA,0BAC1DA,EAAc,WAAW,IAAIC,GAAQ;AAAA;AAAA,uFAEwB,UAAU,WAAWA,EAAK,IAAI,CAAC;AAAA;AAAA,sCAEhFA,EAAK,OAAO,IAAIC,GAAS;AAAA;AAAA;AAAA;AAAA,6DAIFD,EAAK,IAAI;AAAA,yDACb,UAAU,WAAWC,EAAM,KAAK,CAAC;AAAA,kDACxCtG,EAAe,YAAY,SAAS,GAAGqG,EAAK,IAAI,IAAIC,EAAM,KAAK,EAAE,EAAI,UAAY,EAAE;AAAA;AAAA,kEAEnED,EAAK,IAAI;AAAA;AAAA,uFAEY,UAAU,WAAWC,EAAM,KAAK,CAAC;AAAA,8CAC1EA,EAAM,MAAQ,gDAAgDA,EAAM,KAAK,WAAa,EAAE;AAAA;AAAA,qCAEjG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,yBAGtB,EAAE,KAAK,EAAE,CAAC;AAAA,sBACX,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cASdC,GAAiB,CACrB,OAASlE,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,EAC9CC,EAAU,UAAY,EAC1B,CACJ,CAEA,SAASiE,IAAmB,CACxB,IAAMC,EAAgB,SAAS,eAAe,oBAAoB,EAC5DC,EAAkB,SAAS,eAAe,iBAAiB,EAC3DC,EAAiB,SAAS,eAAe,gBAAgB,EACzDC,EAAW,SAAS,eAAe,eAAe,EAClDC,EAAsB,SAAS,iBAAiB,mBAAmB,EAEzEJ,GAAe,iBAAiB,QAAS,IAAM,CAC3C,IAAMK,EAAW,SAAS,eAAe,kBAAkB,GAAG,MACxDC,EAAW,SAAS,eAAe,kBAAkB,GAAG,MAE1DD,EAAU7G,EAAe,UAAY6G,EACpC,OAAO7G,EAAe,UAEvB8G,EAAU9G,EAAe,UAAY8G,EACpC,OAAO9G,EAAe,UAE3BiF,GAAa,CACjB,CAAC,EAEDwB,GAAiB,iBAAiB,SAAW5D,GAAM,CAC3CA,EAAE,OAAO,QAAS7C,EAAe,SAAW,GAC3C,OAAOA,EAAe,SAC3BiF,GAAa,CACjB,CAAC,EAEDyB,GAAgB,iBAAiB,SAAW7D,GAAM,CAC1CA,EAAE,OAAO,QAAS7C,EAAe,QAAU,GAC1C,OAAOA,EAAe,QAC3BiF,GAAa,CACjB,CAAC,EAED2B,EAAoB,QAAQG,GAAY,CACpCA,EAAS,iBAAiB,SAAU,IAAM,CACtCC,GAAuB,EACvB/B,GAAa,CACjB,CAAC,CACL,CAAC,EAED0B,GAAU,iBAAiB,QAAS,IAAM,CACtC3G,EAAiB,CAAC,EAClBC,EAAc,EACdgF,GAAa,CACjB,CAAC,CACL,CAEA,SAAS+B,IAAyB,CAC9B,IAAMC,EAAa,SAAS,iBAAiB,2BAA2B,EAClE3B,EAAa,CAAC,EAEpB2B,EAAW,QAAQC,GAAM,CACrB5B,EAAW,KAAK,GAAG4B,EAAG,QAAQ,SAAS,IAAIA,EAAG,KAAK,EAAE,CACzD,CAAC,EAEG5B,EAAW,OACXtF,EAAe,WAAasF,EAE5B,OAAOtF,EAAe,UAE9B,CAEA,SAASiF,IAAe,CACpBhF,EAAc,EACdmC,GAAU,EACV0D,GAAa,CACjB,CAEA,SAAS1D,IAAY,CACjB,IAAML,EAAS,IAAI,gBAEf/B,EAAe,WAAW+B,EAAO,IAAI,YAAa/B,EAAe,SAAS,EAC1EA,EAAe,WAAW+B,EAAO,IAAI,YAAa/B,EAAe,SAAS,EAC1EA,EAAe,UAAU+B,EAAO,IAAI,WAAY/B,EAAe,QAAQ,EACvEA,EAAe,UAAU+B,EAAO,IAAI,WAAY,MAAM,EACtD/B,EAAe,SAAS+B,EAAO,IAAI,UAAW,MAAM,EACpD/B,EAAe,YACfA,EAAe,WAAW,QAAQqG,GAAQtE,EAAO,OAAO,OAAQsE,CAAI,CAAC,EAErEpG,EAAc,GAAG8B,EAAO,IAAI,OAAQ9B,CAAW,EAEnD,IAAMkH,EAAS,GAAG,OAAO,SAAS,QAAQ,GAAGpF,EAAO,SAAS,EAAI,IAAMA,EAAO,SAAS,EAAI,EAAE,GAC7F,OAAO,QAAQ,UAAU,CAAC,EAAG,GAAIoF,CAAM,CAC3C,CAEA,eAAerB,IAAe,CAC1B,IAAMxD,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAI,GAACA,GAAa,CAACpC,GAEnB,CAAIC,GACAA,EAAgB,MAAM,EAE1BA,EAAkB,IAAI,gBAEtB,OAAO,KAAKmC,EAAW,UAAU,EAEjC,GAAI,CACA,IAAMP,EAAS,CACX,SAAU7B,EAAgB,GAC1B,KAAMD,EACN,MAAO,GACP,GAAGD,CACP,EAEIA,EAAe,aACf,OAAO+B,EAAO,WACd/B,EAAe,WAAW,QAAQqG,GAAQ,CACtC,GAAM,CAACrB,EAAKsB,CAAK,EAAID,EAAK,MAAM,GAAG,EACnCtE,EAAO,QAAQiD,CAAG,EAAE,EAAIsB,CAC5B,CAAC,GAGL,IAAMtE,EAAW,MAAM,YAAY,OAAOD,CAAM,EAC1CE,EAAWD,EAAS,MAAQ,CAAC,EAC7BE,EAAOF,EAAS,MAAQ,CAAC,EAG/BzB,EAAc0B,EACd3B,EAAkBL,GAAeiC,EAAK,aAAe,GAErDkF,GAAenF,EAAUC,CAAI,EAC7B0C,EAA2B,EAC3BM,EAAmBhD,EAAK,OAASD,EAAS,MAAM,CACpD,OAASI,EAAO,CACZ,GAAIA,EAAM,OAAS,aAAc,OACjC,QAAQ,MAAM,2BAA4BA,CAAK,EAC/CC,EAAU,UAAY,yFAC1B,EACJ,CAEA,SAAS8E,GAAenF,EAAUC,EAAM,CACpC,IAAMI,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAI,CAACA,EAAW,OAEhB,IAAMC,EAAW,QAAQ,IAAI,iBAAiB,GAAK,OAC7C8E,EAAY9E,IAAa,OACzB,YACA,gEAEN,GAAIN,EAAS,SAAW,EAAG,CACvBK,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAatB,SAAS,eAAe,qBAAqB,GAAG,iBAAiB,QAAS,IAAM,CAC5EtC,EAAiB,CAAC,EAClBC,EAAc,EACdgF,GAAa,CACjB,CAAC,EACD,MACJ,CAkCA,GAhCA3C,EAAU,UAAY;AAAA;AAAA,6CAEe+E,CAAS;AAAA,kBACpCpF,EAAS,IAAIO,GAAW,YAAY,OAAOA,EAAS,CAClD,OAAQD,EACR,YAAa,GACb,cAAe,EACnB,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAadL,EAAK,YAAc,EAAI;AAAA;AAAA,cAErB,EAAE;AAAA,UAGV,YAAY,WAAWI,CAAS,EAChCsC,EAA2B,EAC3BzB,EAAqB,EAGrB/B,EAAmB,EAEfc,EAAK,YAAc,EAAG,CACtB,IAAMoF,EAAsB,SAAS,eAAe,qBAAqB,EACzEA,EAAoB,UAAY,WAAW,OAAO,CAC9C,YAAapF,EAAK,cAAgBjC,EAClC,WAAYiC,EAAK,YACjB,WAAYA,EAAK,KACrB,CAAC,EAEDoF,EAAoB,iBAAiB,QAAUzE,GAAM,CACjD,IAAM0E,EAAU1E,EAAE,OAAO,QAAQ,aAAa,EAC1C0E,IACAtH,EAAc,SAASsH,EAAQ,QAAQ,IAAI,EAC3CjH,EAAkB,GAClB8B,GAAU,EACV0D,GAAa,EACb,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,EAEtD,CAAC,CACL,CACJ,CAEA,eAAeC,GAAkBC,EAAU,CACvC,IAAM1D,EAAY,SAAS,eAAe,eAAe,EACzD,GAAKA,EAEL,GAAI,CAEA,IAAMkF,GADW,MAAM,cAAc,iBAAiBxB,EAAS,EAAE,GAClC,MAAQ,CAAC,EAExC,GAAIwB,EAAc,SAAW,EAAG,CAC5BlF,EAAU,UAAY,GACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,0BAIRkF,EAAc,IAAIC,GAAO;AAAA,mDACAA,EAAI,IAAI;AAAA,kCACzB,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA,kCAC9BA,EAAI,cAAgB,qCAAqCA,EAAI,aAAa,WAAa,EAAE;AAAA;AAAA,yBAElG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,aAI3B,OAASpF,EAAO,CACZ,QAAQ,MAAM,gCAAiCA,CAAK,EACpDC,EAAU,UAAY,EAC1B,CACJ,CAEA,SAASxB,IAAqB,CAC1B,IAAM4G,EAAkB,SAAS,eAAe,mBAAmB,EAC7DC,EAAgB,SAAS,eAAe,gBAAgB,EACxDC,EAAiB,SAAS,eAAe,kBAAkB,EAEjEF,GAAiB,iBAAiB,QAAS,IAAM,CAC7CC,GAAe,UAAU,OAAO,QAAQ,EACxC,SAAS,KAAK,UAAU,IAAI,iBAAiB,CACjD,CAAC,EAEDC,GAAgB,iBAAiB,QAAS,IAAM,CAC5CD,GAAe,UAAU,IAAI,QAAQ,EACrC,SAAS,KAAK,UAAU,OAAO,iBAAiB,CACpD,CAAC,CACL,CAEA,SAAS5G,IAAkB,CACvB,IAAM8G,EAAa,SAAS,eAAe,aAAa,EACnDA,IAELA,EAAW,MAAQ7H,EAAe,UAAY,GAE9C6H,EAAW,iBAAiB,SAAWhF,GAAM,CACrCA,EAAE,OAAO,MACT7C,EAAe,SAAW6C,EAAE,OAAO,MAEnC,OAAO7C,EAAe,SAE1BiF,GAAa,CACjB,CAAC,EACL,CAEA,SAASjE,IAAiB,CACtB,IAAM8G,EAAU,SAAS,eAAe,WAAW,EAC7CC,EAAU,SAAS,eAAe,WAAW,GAC/B,QAAQ,IAAI,iBAAiB,GAAK,UAElC,SAChBD,GAAS,UAAU,OAAO,aAAa,EACvCC,GAAS,UAAU,IAAI,aAAa,GAGxCD,GAAS,iBAAiB,QAAS,IAAM,CACrC,QAAQ,IAAI,kBAAmB,MAAM,EACrCA,EAAQ,UAAU,IAAI,aAAa,EACnCC,GAAS,UAAU,OAAO,aAAa,EACvCjC,GAAa,CACjB,CAAC,EAEDiC,GAAS,iBAAiB,QAAS,IAAM,CACrC,QAAQ,IAAI,kBAAmB,MAAM,EACrCA,EAAQ,UAAU,IAAI,aAAa,EACnCD,GAAS,UAAU,OAAO,aAAa,EACvChC,GAAa,CACjB,CAAC,CACL,CAEA,SAASkC,GAAU,CACX7H,IACAA,EAAgB,MAAM,EACtBA,EAAkB,MAEtBH,EAAiB,CAAC,EAClBC,EAAc,EACdC,EAAkB,KAClBE,EAAc,GACdC,EAAgB,GAChBC,EAAkB,GAClBC,EAAc,CAAC,EAEf,SAAS,eAAe,aAAa,GAAG,OAAO,EAE/C,SAAS,eAAe,kBAAkB,GAAG,OAAO,EAEpD,SAAS,eAAe,eAAe,GAAG,OAAO,CACrD,CAEA,MAAO,CACH,KAAAG,EACA,QAAAsH,EAEA,cAAAhF,EACA,aAAAO,CACJ,CACJ,GAAG,EAEH,OAAO,aAAe1D,GACfD,GAAQC,KC5mCf,IAAAoI,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAy1CCD,GA91CPE,GAAAC,GAAA,KAKMF,IAAgB,gBAAiB,CACnC,aAEA,IAAIG,EAAO,KACPC,EAAe,CACf,iBAAkB,KAClB,gBAAiB,KACjB,iBAAkB,GAClB,gBAAiB,KACjB,eAAgB,KAChB,MAAO,EACX,EACIC,EAAc,EACdC,EAAiB,GACjBC,EAAgB,KACdC,EAAW,CAACC,EAAOC,EAAW,IAAM,CACtC,GAAID,GAAU,MAA+BA,IAAU,GAAI,OAAOC,EAClE,IAAMC,EAAM,OAAOF,CAAK,EACxB,OAAO,OAAO,SAASE,CAAG,EAAIA,EAAMD,CACxC,EACME,EAAuB,oBACvBC,EAAqB,IAAO,GAAK,GAAK,GAAK,EAEjD,SAASC,GAAqB,CAC1B,GAAI,CACA,IAAMC,EAAM,aAAa,QAAQH,CAAoB,EACrD,GAAI,CAACG,EAAK,OAAO,KACjB,IAAMC,EAAO,KAAK,MAAMD,CAAG,EAE3B,GADI,CAACC,GAAQ,OAAOA,GAAS,UACzBA,EAAK,IAAM,KAAK,IAAI,EAAIA,EAAK,GAAKH,EAAoB,OAAO,KACjE,GAAIG,EAAK,OAAS,QAAaA,EAAK,OAAS,KAAM,CAC/C,IAAMC,EAAO,OAAOD,EAAK,IAAI,EAC7B,GAAI,CAAC,OAAO,SAASC,CAAI,EAAG,OAAO,KACnCD,EAAK,KAAOC,CAChB,CACA,OAAOD,CACX,MAAc,CACV,OAAO,IACX,CACJ,CAEA,SAASE,GAA0B,CAC/B,OAAO,SAAS,cAAc,wCAAwC,GAClE,SAAS,cAAc,uCAAuC,CACtE,CAEA,SAASC,EAAoBC,EAAWC,EAAa,CACjD,IAAMC,EAAUJ,EAAwB,EACxC,GAAII,EAAS,CACT,IAAML,EAAOT,EAASc,EAAQ,QAAQ,MAAO,GAAG,EAChD,GAAI,OAAO,SAASL,CAAI,EACpB,MAAO,CACH,KAAAA,EACA,QAASK,EAAQ,QAAQ,SAAW,KACpC,SAAUA,EAAQ,QAAQ,UAAY,KACtC,OAAQ,SACZ,CAER,CAEA,IAAMC,EAAST,EAAmB,EAClC,GAAIS,GAAU,OAAO,SAAS,OAAOA,EAAO,IAAI,CAAC,EAC7C,MAAO,CACH,KAAM,OAAOA,EAAO,IAAI,EACxB,QAASA,EAAO,SAAW,KAC3B,SAAUA,EAAO,UAAY,KAC7B,OAAQ,QACZ,EAGJ,IAAMC,EAAaJ,GAAW,cAAc,gBAAgB,GAAK,SAAS,eAAe,eAAe,EAClGK,EAAcD,GAAY,SAAS,MACzC,GAAIC,IAAgB,QAAaA,IAAgB,GAAI,CACjD,IAAMR,EAAOT,EAASiB,EAAa,GAAG,EACtC,GAAI,OAAO,SAASR,CAAI,EAAG,CACvB,IAAMS,EAAOF,GAAY,aAAa,KAAK,GAAK,GAC1CG,EAAUD,GAAQA,EAAK,YAAY,IAAM,kBAAoBA,EAAO,KAC1E,MAAO,CACH,KAAAT,EACA,QAAAU,EACA,SAAUH,GAAY,SAAS,UAAY,KAC3C,OAAQ,KACZ,CACJ,CACJ,CAEA,GAAIH,GAAeA,EAAY,gBAAkB,QAAaA,EAAY,gBAAkB,KAAM,CAC9F,IAAMJ,EAAOT,EAASa,EAAY,cAAe,GAAG,EACpD,GAAI,OAAO,SAASJ,CAAI,GAAKA,EAAO,EAChC,MAAO,CACH,KAAAA,EACA,QAAS,KACT,SAAU,KACV,OAAQ,MACZ,CAER,CAEA,OAAO,IACX,CAEA,SAASW,EAAsBC,EAAM,CACjC,MAAI,CAACA,GAAQA,EAAK,OAAS,MAAQ,OAAO,MAAMA,EAAK,IAAI,EAC9C,kBAEPA,EAAK,SAAW,OAAOA,EAAK,OAAO,EAAE,KAAK,GAAK,OAAOA,EAAK,OAAO,EAAE,YAAY,IAAM,kBAC/E,OAAOA,EAAK,OAAO,EAE1BA,EAAK,MAAQ,EAAU,OACpB,UAAU,YAAYA,EAAK,KAAMA,EAAK,UAAY,IAAI,CACjE,CAEA,SAASC,GAAoB,CACzB,IAAMC,EAAW,SAAS,cAAc,sCAAsC,EAC9E,GAAIA,EACA,MAAO,CACH,KAAMA,EAAS,QAAQ,SAAW,OAClC,OAAQvB,EAASuB,EAAS,QAAQ,UAAW,CAAC,EAC9C,QAASvB,EAASuB,EAAS,QAAQ,WAAY,CAAC,EAChD,KAAMA,EAAS,QAAQ,SAAW,EACtC,EAGJ,IAAMC,EAAU,SAAS,eAAe,eAAe,EACvD,GAAIA,EAAS,CACT,IAAMC,EAAYzB,EAASwB,EAAQ,QAAQ,WAAY,CAAC,EACxD,MAAO,CACH,KAAMC,EAAY,EAAI,OAAS,OAC/B,OAAQA,EACR,QAAS,EACT,KAAMD,EAAQ,QAAQ,iBAAmB,EAC7C,CACJ,CAEA,MAAO,CAAE,KAAM,OAAQ,OAAQ,EAAG,QAAS,EAAG,KAAM,EAAG,CAC3D,CAEA,SAASE,EAAkBC,EAAOC,EAAM,CACpC,OAAKA,EACDA,EAAK,OAAS,OAAe5B,EAAS4B,EAAK,OAAQ,CAAC,EACpDA,EAAK,OAAS,UAAkB,KAAK,IAAI,EAAGD,GAAS3B,EAAS4B,EAAK,QAAS,CAAC,EAAI,IAAI,EAClF,EAHW,CAItB,CAEA,SAASC,EAAoBC,EAAa,KAAM,CAC5C,IAAMC,EAAM,SAAS,eAAe,iBAAiB,EAC/CC,EAAW,SAAS,eAAe,oBAAoB,EACvDC,EAAU,SAAS,eAAe,mBAAmB,EAC3D,GAAI,CAACF,GAAO,CAACC,EAAU,OAEvB,IAAME,EAAU,SAAS,eAAe,aAAa,EAC/CP,EAAQG,IAAe,KAAOA,EAAa9B,EAASkC,GAAS,SAAS,OAASA,GAAS,YAAa,CAAC,EACtGN,EAAON,EAAkB,EACzBG,EAAYC,EAAkBC,EAAOC,CAAI,EAE/C,GAAI,CAACH,GAAaA,GAAa,EAAG,CAC9BM,EAAI,UAAU,IAAI,QAAQ,EAC1B,MACJ,CAEAA,EAAI,UAAU,OAAO,QAAQ,EAC7BC,EAAS,YAAc,UAAU,YAAYP,CAAS,EAClDQ,IACAA,EAAQ,YAAcL,GAAM,KAAO,sBAAsBA,EAAK,IAAI,IAAM,qBAG5E,IAAMJ,EAAU,SAAS,eAAe,eAAe,EACnDA,IACAA,EAAQ,QAAQ,WAAaC,EAC7BD,EAAQ,QAAQ,gBAAkBI,GAAM,MAAQ,GAExD,CAEA,eAAeO,GAAO,CAClB,GAAI,CAAC,QAAQ,gBAAgB,GAErB,CADoB,SAAS,eAAe,gBAAgB,EAC1C,CAClB,MAAM,KAAK,oCAAoC,EAC/C,OAAO,SAAS,KAAO,kCACvB,MACJ,CAIJ,GADA,MAAMC,EAAS,EACX,CAAAtC,EAEJ,IAAI,CAACH,GAAQ,CAACA,EAAK,OAASA,EAAK,MAAM,SAAW,EAAG,CACjD,MAAM,QAAQ,qBAAqB,EACnC,MACJ,CAEA,MAAM0C,EAAkB,EACxBC,EAAmB,EACnBC,GAAmB,EACnBC,GAAuB,EACvBC,GAAc,EAClB,CAEA,eAAeL,GAAW,CACtB,GAAI,CACA,IAAMM,EAAW,MAAM,QAAQ,QAAQ,EACvC,GAAI,CAACA,GAAYA,EAAS,UAAY,GAClC,KAAM,CAAE,QAASA,GAAU,SAAW,sBAAuB,KAAMA,GAAU,IAAK,EAEtF/C,EAAO+C,EAAS,KAChBC,EAAmB,EACnB7C,EAAiB,GACjBC,EAAgB,IACpB,OAAS6C,EAAO,CACZ,QAAQ,MAAM,uBAAwBA,CAAK,EAC3C9C,EAAiB,GACjBC,EAAgB6C,EAChB,MAAM,MAAMC,EAAoBD,EAAO,sBAAsB,CAAC,CAClE,CACJ,CAEA,SAASC,EAAoBD,EAAO1C,EAAU,CAC1C,IAAM4C,EAAU,CACZ,kBACA,iBACA,0BACA,wBACJ,EAEMC,EAAaC,GAAQ,CACvB,GAAI,CAACA,EAAK,MAAO,GACjB,IAAMC,EAAa,OAAOD,CAAG,EAAE,KAAK,EAAE,YAAY,EAClD,OAAOF,EAAQ,SAASG,CAAU,CACtC,EAEMC,EAAkBC,GAAW,CAC/B,GAAI,CAACA,EAAQ,OAAO,KACpB,GAAI,OAAOA,GAAW,SAAU,OAAOA,EACvC,GAAI,MAAM,QAAQA,CAAM,EAAG,OAAOA,EAAO,CAAC,EAC1C,GAAI,OAAOA,GAAW,SAAU,CAC5B,IAAMC,EAAS,OAAO,OAAOD,CAAM,EAE7BE,GADYD,EAAO,KAAOA,EAAO,KAAK,EAAIA,EAAO,OAAO,CAACE,GAAKC,KAAQD,GAAI,OAAOC,EAAG,EAAG,CAAC,CAAC,GACvE,CAAC,GAAKH,EAAO,CAAC,EACtC,GAAI,OAAOC,GAAU,SAAU,OAAOA,EACtC,GAAIA,GAAS,OAAOA,GAAU,SAC1B,OAAOH,EAAeG,CAAK,CAEnC,CACA,OAAO,IACX,EAEMG,EAAa,CAAC,EACpB,OAAIZ,GAAO,SAASY,EAAW,KAAKZ,EAAM,OAAO,EAC7CA,GAAO,MAAM,SAASY,EAAW,KAAKZ,EAAM,KAAK,OAAO,EACxDA,GAAO,MAAM,QAAQY,EAAW,KAAKZ,EAAM,KAAK,MAAM,EACtDA,GAAO,MAAQ,OAAOA,EAAM,MAAS,UAAUY,EAAW,KAAKZ,EAAM,IAAI,EACzEA,GAAO,QAAQY,EAAW,KAAKN,EAAeN,EAAM,MAAM,CAAC,EAC3DA,GAAO,MAAQ,OAAOA,EAAM,MAAS,UAAUY,EAAW,KAAKN,EAAeN,EAAM,IAAI,CAAC,EAEhFY,EAAW,KAAKR,GAAOA,GAAO,CAACD,EAAUC,CAAG,CAAC,GAC3C9C,CACnB,CAEA,SAASuD,EAAYC,EAAM,CACvB,GAAI,CAACA,EAAM,MAAO,CAAC,EACnB,IAAMC,EAASD,EAAK,cAAc,uBAAuB,EACnDE,EAASF,EAAK,cAAc,WAAW,GAAKA,EAAK,cAAc,cAAc,EAC7EG,EAAYH,EAAK,cAAc,cAAc,GAAKA,EAAK,cAAc,UAAU,EAC/EI,EAAUJ,EAAK,cAAc,aAAa,EAC1CK,EAAcH,EAASA,EAAO,YAAcD,EAASA,EAAO,YAAc,GAChF,MAAO,CAAE,OAAAA,EAAQ,OAAAC,EAAQ,UAAAC,EAAW,QAAAC,EAAS,YAAAC,CAAY,CAC7D,CAEA,SAASC,EAAiBC,EAAIC,EAASC,EAAc,gBAAiB,CAC7DF,IACDA,EAAG,SAAQA,EAAG,OAAO,SAAWC,GAChCD,EAAG,SAAQA,EAAG,OAAO,YAAcC,EAAUC,EAAcF,EAAG,aAC9DA,EAAG,WAAWA,EAAG,UAAU,UAAU,OAAO,SAAU,CAACC,CAAO,EAC9DD,EAAG,SAASA,EAAG,QAAQ,UAAU,OAAO,SAAUC,CAAO,EACjE,CAEA,eAAeE,EAAmBV,EAAMW,EAAU,CAAC,EAAG,CAClD,GAAI,CAACX,GAAQA,EAAK,QAAQ,aAAe,OAAQ,OACjD,GAAI5D,EAAgB,CAChB,MAAM,MAAM+C,EAAoB9C,EAAe,sBAAsB,CAAC,EACtE,MACJ,CAEA,IAAMuE,EAAWD,EAAQ,SACzB,GAAI,OAAOC,GAAa,YAEhB,CADY,MAAMA,EAAS,EACjB,OAGlB,IAAML,EAAKR,EAAYC,CAAI,EAC3BM,EAAiBC,EAAI,GAAMI,EAAQ,aAAe,eAAe,EACjEX,EAAK,QAAQ,WAAa,OAE1B,GAAI,CACA,IAAMhB,EAAW,MAAM,MAAMgB,EAAK,QAAU,OAAO,SAAS,KAAM,CAC9D,QAASA,EAAK,QAAU,QAAQ,YAAY,EAC5C,KAAM,IAAI,SAASA,CAAI,EACvB,QAAS,CACL,mBAAoB,gBACxB,EACA,YAAa,aACjB,CAAC,EAEGlD,EAAO,KACX,GAAI,CACAA,EAAO,MAAMkC,EAAS,KAAK,CAC/B,MAAY,CACRlC,EAAO,IACX,CAEA,GAAI,CAACkC,EAAS,IAAOlC,GAAQA,EAAK,UAAY,GAC1C,KAAM,CAAE,QAASA,GAAM,SAAWkC,EAAS,YAAc,kBAAmB,KAAAlC,CAAK,EAGrF,IAAM+D,EAAc/D,GAAM,cAAgB6D,EAAQ,YAClD,GAAIE,EAAa,CACb,OAAO,SAAS,KAAOA,EACvB,MACJ,CAEI,OAAOF,EAAQ,WAAc,YAC7BA,EAAQ,UAAU7D,CAAI,CAE9B,OAASoC,EAAO,CACZ,MAAM,MAAMC,EAAoBD,EAAOyB,EAAQ,cAAgB,iBAAiB,CAAC,EAC7E,OAAOA,EAAQ,SAAY,YAC3BA,EAAQ,QAAQzB,CAAK,CAE7B,QAAE,CACEc,EAAK,QAAQ,WAAa,QAC1BM,EAAiBC,EAAI,GAAOI,EAAQ,aAAe,eAAe,CACtE,CACJ,CAEA,SAAS1B,GAAqB,CAC1B,IAAM/B,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,GAAa,CAACjB,EAAM,OAEzB,IAAM6E,EAAQ,MAAM,QAAQ7E,EAAK,KAAK,EAAIA,EAAK,MAAQ,CAAC,EAClD8E,EAAY,OAAO9E,EAAK,YAAc6E,EAAM,QAAU,CAAC,EACvDE,EAAY,GAAGD,CAAS,QAAQA,IAAc,EAAI,GAAK,GAAG,GAEhE,SAAS,iBAAiB,0BAA0B,EAAE,QAAQE,IAAM,CAChEA,GAAG,YAAcD,CACrB,CAAC,EAED,IAAME,EAAc3E,IAAU,CAC1B,IAAME,GAAM,OAAOF,EAAK,EACxB,OAAO,OAAO,SAASE,EAAG,EAAIA,GAAM,CACxC,EAEM0E,EAAa,IAAM,CACrB,IAAMF,GAAK,SAAS,eAAe,eAAe,GAAK,SAAS,cAAc,iBAAiB,EAC/F,GAAI,CAACA,GAAI,MAAO,GAChB,IAAMpE,GAAMoE,GAAG,SAAS,SAAWA,GAAG,aAAe,GAC/CpB,GAAM,WAAWhD,EAAG,EAC1B,OAAO,OAAO,SAASgD,EAAG,EAAIA,GAAM,CACxC,EAEMuB,EAAUvB,IAAQ,UAAU,WAAW,OAAOA,IAAO,EAAE,CAAC,EAExDwB,EAAc,IACXP,EAAM,OAIJA,EAAM,IAAI,CAACQ,GAAMC,KAAQ,CAC5B,IAAMC,GAAcF,GAAK,SAAS,MAAQA,GAAK,cAAgBA,GAAK,MAAQ,OACtEG,GAAeH,GAAK,SAAS,OAASA,GAAK,eAAiBA,GAAK,OAAS,KAC1EI,GAAcJ,GAAK,SAAS,MAAQA,GAAK,SAAS,OAASA,GAAK,cAAgB,GAChFK,GAAWT,EAAWI,GAAK,UAAY,CAAC,EACxCM,GAAYV,EAAWI,GAAK,OAASA,GAAK,YAAcA,GAAK,WAAaA,GAAK,cAAgB,CAAC,EAChGO,GAAYX,EAAWI,GAAK,OAAUM,GAAYD,EAAS,EAGjE,MAAO;AAAA,kEAFaJ,KAAQT,EAAM,OAAS,EAAI,gDAAkD,EAGpC;AAAA;AAAA,8BAE/CW,GAAe;AAAA,4CACDA,EAAY,UAAUL,EAAOI,EAAW,CAAC;AAAA,8BACrD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAMH;AAAA;AAAA,kCAEKG,EAAQ;AAAA;AAAA;AAAA;AAAA,oGAI0DP,EAAOI,EAAW,CAAC;AAAA,8BACzFE,GAAc,uDAAuDN,EAAOM,EAAW,CAAC,OAAS,EAAE;AAAA;AAAA,uFAE1C,UAAU,YAAYG,EAAS,CAAC;AAAA;AAAA,iBAG3G,CAAC,EAAE,KAAK,EAAE,EAnCC,sFAsCTC,EAAWZ,EAAWjF,EAAK,QAAQ,EACnC8F,EAAWb,EAAWjF,EAAK,eAAe,EAC1C+F,EAAY/F,EAAK,QAAU,QAAaA,EAAK,QAAU,KACvDiF,EAAWjF,EAAK,KAAK,EACrB,KAAK,IAAI,EAAG6F,EAAWC,CAAQ,EAE/BE,GAAehF,EAAoBC,EAAWjB,CAAI,EAElDiG,GAAUf,EAAW,EAErBgB,IADQjF,EAAU,cAAc,aAAa,GAAK,SAAS,eAAe,YAAY,IAC9D,SAAS,MACjCkF,GAAcD,KAAmB,QAAaA,KAAmB,GAAKjB,EAAWiB,EAAc,EAAI,KACnGE,EAAYpG,EAAK,aAAe,QAAaA,EAAK,aAAe,KACjEiF,EAAWjF,EAAK,UAAU,EACzBmG,KAAgB,KAAOA,GAAeF,GAAU,EAAKF,EAAYE,GAAU,IAAO,EAEnFI,EAAcpF,EAAU,cAAc,gBAAgB,GAAK,SAAS,eAAe,eAAe,EAClGqF,EAAiBrF,EAAU,cAAc,iBAAiB,GAAK,SAAS,eAAe,gBAAgB,EACvGsF,EAAgBF,GAAa,cAAc,MAAM,GAAG,aAAa,KAAK,GAAK,gBAC3EG,EAAkBF,GAAgB,SAAS,OAASA,GAAgB,aAAerF,EAAU,SAAS,cAAgB,EACtHwF,EAAiBxB,EAAWhE,EAAU,SAAS,gBAAkB,CAAC,EAElEyF,EAAmB,CAAC,CADH,SAAS,eAAe,WAAW,GACf,SAAYL,GAAeA,EAAY,MAAM,UAAY,QAAU,CAACA,EAAY,UAAU,SAAS,QAAQ,EAClJM,EAAe1B,EAAWuB,CAAe,EACzCE,GAAoBC,GAAgB,GAAKF,EAAiB,IAC1DE,EAAeF,GAEnB,IAAMG,GAAkBF,GAAoBC,EAAe,EAErDE,GAAcb,IAAgBA,GAAa,OAAS,MAAQ,CAAC,OAAO,MAAMA,GAAa,IAAI,EAC3FhE,GAAQ+D,GAAac,GAAcb,GAAa,KAAO,IAAMI,GAAa,IAAMQ,GAAkBD,EAAe,GACjHG,GAAkBD,GAAcpF,EAAsBuE,EAAY,EAAI,kBACtEe,GAAuBf,IAAc,SAAW,mBAAmBb,EAAOa,GAAa,QAAQ,CAAC,IAAM,GACtGgB,GAAUrF,EAAkB,EAC5BsF,GAAalF,EAAkBC,GAAOgF,EAAO,EAC/C/F,IACAA,EAAU,QAAQ,WAAagG,GAC3BD,IAAS,OAAM/F,EAAU,QAAQ,gBAAkB+F,GAAQ,MAC/D/F,EAAU,QAAQ,aAAe0F,EACjC1F,EAAU,QAAQ,eAAiBwF,GAGvC,IAAMS,GAAY;AAAA;AAAA,kBAER9B,EAAY,CAAC;AAAA;AAAA,UAIjB+B,GAAa;AAAA,6GACkFF,GAAa,EAAI,GAAK,QAAQ;AAAA,gEAC3ED,IAAS,KAAO,KAAK7B,EAAO6B,GAAQ,IAAI,CAAC,IAAM,EAAE;AAAA,gDACjE,UAAU,YAAYC,EAAU,CAAC;AAAA;AAAA,UAGnEG,GAAkB;AAAA,4HAC4FR,GAAkB,OAAS,MAAM;AAAA,wBACrIzB,EAAOoB,CAAa,CAAC;AAAA,wDACWI,CAAY,MAAM,UAAU,YAAYA,CAAY,CAAC;AAAA;AAAA,UAI/FU,GAAa;AAAA;AAAA;AAAA;AAAA,sDAI2BxB,CAAQ,KAAK,UAAU,YAAYA,CAAQ,CAAC;AAAA;AAAA,4FAENC,EAAW,EAAI,GAAK,QAAQ;AAAA;AAAA,6DAE3DA,CAAQ,MAAM,UAAU,YAAYA,CAAQ,CAAC;AAAA,qEACrCA,CAAQ,MAAM,UAAU,YAAYA,CAAQ,CAAC;AAAA;AAAA;AAAA;AAAA,2DAIvDe,GAAcb,GAAa,KAAO,EAAE,IAAIe,EAAoB;AAAA,0BAC7FF,GAAc1B,EAAO2B,EAAe,EAAI,iBAAiB;AAAA;AAAA;AAAA,kBAGjEM,EAAe;AAAA,kBACfD,EAAU;AAAA,4FACgElB,GAAU,GAAKG,EAAY,EAAI,GAAK,QAAQ;AAAA,+BACzGH,GAAU,EAAI,KAAKA,EAAO,KAAO,EAAE;AAAA,wDACVG,CAAS,KAAK,UAAU,YAAYA,CAAS,CAAC;AAAA;AAAA;AAAA;AAAA,yDAI7CpE,EAAK,KAAK,UAAU,YAAYA,EAAK,CAAC;AAAA;AAAA;AAAA,UAKjFsF,GAAcrG,EAAU,cAAc,oBAAoB,EAC1DsG,GAAetG,EAAU,cAAc,qBAAqB,EAElE,GAAIqG,IAAeC,GAAc,CACzBD,KAAaA,GAAY,UAAYJ,IACrCK,KAAcA,GAAa,UAAYF,IAC3CnF,EAAoBF,EAAK,EACzB,MACJ,CAEAf,EAAU,UAAYiG,GAAYG,GAClCnF,EAAoBF,EAAK,CAC7B,CAEA,eAAeU,GAAoB,CAC/B,GAAK,QAAQ,gBAAgB,EAE7B,GAAI,CAEA,IAAM8E,GADW,MAAM,QAAQ,aAAa,GACjB,MAAQ,CAAC,EAE9BC,EAAoB,SAAS,eAAe,iBAAiB,EAC7DC,EAAeD,IAAsBA,EAAkB,QAAQ,WAAa,QAAUA,EAAkB,SAAS,SAAW,GAC9HA,GAAqBD,EAAU,OAAS,IACpCE,IACAD,EAAkB,UAAY;AAAA;AAAA;AAAA;AAAA,8BAIpBD,EAAU,IAAIG,GAAQ;AAAA;AAAA,sFAEkCA,EAAK,EAAE;AAAA;AAAA,+EAEd,UAAU,WAAWA,EAAK,WAAa,GAAGA,EAAK,UAAU,IAAIA,EAAK,SAAS,EAAE,CAAC;AAAA,2EAClF,UAAU,WAAWA,EAAK,cAAc,CAAC;AAAA,0CAC1EA,EAAK,eAAiB,oCAAoC,UAAU,WAAWA,EAAK,cAAc,CAAC,OAAS,EAAE;AAAA,2EAC7E,UAAU,WAAWA,EAAK,IAAI,CAAC,KAAK,UAAU,WAAWA,EAAK,OAAS,EAAE,CAAC,IAAI,UAAU,WAAWA,EAAK,WAAW,CAAC;AAAA,2EACpH,UAAU,WAAWA,EAAK,OAAO,CAAC;AAAA,0CACnEA,EAAK,WAAa,6GAA+G,EAAE;AAAA;AAAA;AAAA,6BAGhJ,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAUvBC,EAAqB,EAE7B,OAAS3E,EAAO,CACZ,QAAQ,MAAM,4BAA6BA,CAAK,CACpD,CACJ,CAEA,SAAS2E,GAAuB,CAC5B,IAAMC,EAAgB,SAAS,iBAAiB,6BAA6B,EACvEC,EAAiB,SAAS,eAAe,kBAAkB,EAEjED,EAAc,QAAQE,GAAS,CAC3BA,EAAM,iBAAiB,SAAWC,GAAM,CAChCA,EAAE,OAAO,QAAU,MACnBF,GAAgB,UAAU,OAAO,QAAQ,GAEzCA,GAAgB,UAAU,IAAI,QAAQ,EACtC7H,EAAa,iBAAmB+H,EAAE,OAAO,MAEjD,CAAC,CACL,CAAC,CACL,CAEA,SAASrF,GAAqB,CAC1B,IAAMsF,EAAQ,SAAS,iBAAiB,aAAa,EAC/CC,EAAiB,SAAS,iBAAiB,uBAAuB,EAClEC,EAAW,SAAS,iBAAiB,kBAAkB,EACvDC,EAAW,SAAS,iBAAiB,kBAAkB,EAE7D,SAASC,EAASC,EAAY,CAC1BL,EAAM,QAAQM,GAAQ,CAClBA,EAAK,UAAU,OAAO,SAAU,SAASA,EAAK,QAAQ,IAAI,IAAMD,CAAU,CAC9E,CAAC,EAEDJ,EAAe,QAAQM,GAAa,CAChC,IAAMC,EAAgB,SAASD,EAAU,QAAQ,aAAa,EAC9DA,EAAU,UAAU,OAAO,iBAAkBC,GAAiBH,CAAU,EACxEE,EAAU,UAAU,OAAO,aAAcC,GAAiBH,CAAU,EACpEE,EAAU,UAAU,OAAO,cAAeC,EAAgBH,CAAU,EACpEE,EAAU,UAAU,OAAO,gBAAiBC,EAAgBH,CAAU,CAC1E,CAAC,EAEDpI,EAAcoI,CAClB,CAEAH,EAAS,QAAQO,GAAO,CACpBA,EAAI,iBAAiB,QAAS,SAAY,CACxB,MAAMC,EAAoB,IAEhCzI,IAAgB,GAChB,MAAM0I,EAAoB,EAE9BP,EAASnI,EAAc,CAAC,EACxB,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,EAEtD,CAAC,CACL,CAAC,EAEDkI,EAAS,QAAQM,GAAO,CACpBA,EAAI,iBAAiB,QAAS,IAAM,CAChCL,EAASnI,EAAc,CAAC,EACxB,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,CAClD,CAAC,CACL,CAAC,EAEDmI,EAAS,CAAC,CACd,CAEA,eAAeM,GAAsB,CACjC,OAAQzI,EAAa,CACjB,IAAK,GACD,OAAO2I,EAAwB,EACnC,IAAK,GACD,OAAOC,GAAuB,EAClC,IAAK,GACD,OAAOC,GAAsB,EACjC,QACI,MAAO,EACf,CACJ,CAGA,SAASC,EAAgB/H,EAAW,CAC3BA,IACLA,EAAU,iBAAiB,kBAAkB,EAAE,QAAQ+D,GAAMA,EAAG,OAAO,CAAC,EAExE/D,EAAU,iBAAiB,4BAA4B,EAAE,QAAQ+D,GAAMA,EAAG,UAAU,OAAO,iBAAiB,CAAC,EACjH,CAEA,SAASiE,EAAgBC,EAASC,EAAS,CACvC,GAAI,CAACD,EAAS,OAEd,IAAME,EAAOF,EAAQ,aAAa,MAAM,GAAKA,EAAQ,IAAM,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,EAC1FG,EAAWH,EAAQ,QAAQ,MAAM,GAAG,cAAc,oBAAoBE,CAAI,IAAI,EAChFC,GAAUA,EAAS,OAAO,EAE9B,IAAMhG,EAAM,SAAS,cAAc,GAAG,EACtCA,EAAI,UAAY,4BAChBA,EAAI,aAAa,iBAAkB+F,CAAI,EACvC/F,EAAI,YAAc8F,EAGlBD,EAAQ,UAAU,IAAI,iBAAiB,EAGnCA,EAAQ,YACRA,EAAQ,WAAW,aAAa7F,EAAK6F,EAAQ,WAAW,EAExDA,EAAQ,WAAW,YAAY7F,CAAG,CAE1C,CAEA,SAASiG,EAAkBrI,EAAW,CAClC,GAAI,CAACA,EAAW,OAChB,IAAMyC,EAAQzC,EAAU,cAAc,kBAAkB,EACxD,GAAI,CAACyC,EAAO,OAEZ,IAAM0F,EAAO1F,EAAM,aAAa,gBAAgB,EAC1C6F,EAAQtI,EAAU,cAAc,UAAUmI,CAAI,IAAI,GAAKnI,EAAU,cAAc,IAAImI,CAAI,EAAE,GAAK1F,EAAM,uBAC1G,GAAI6F,GAAS,OAAOA,EAAM,OAAU,WAChC,GAAI,CACAA,EAAM,MAAM,CAAE,cAAe,EAAK,CAAC,CACvC,MAAY,CAERA,EAAM,MAAM,CAChB,CAER,CAEA,SAASV,GAA0B,CAE/B,IAAMW,EAAoB,SAAS,cAAc,qCAAqC,EAEtF,GAAIA,GAAqBA,EAAkB,QAAU,MACjD,OAAAR,EAAgB,SAAS,eAAe,kBAAkB,GAAK,SAAS,eAAe,kBAAkB,CAAC,EAC1G/I,EAAa,iBAAmBuJ,EAAkB,MAC3C,GAGX,IAAMzF,EAAO,SAAS,eAAe,uBAAuB,GAAK,SAAS,eAAe,kBAAkB,GAAK,SAAS,eAAe,kBAAkB,EAC1J,GAAI,CAACA,EAAM,MAAO,GAElBiF,EAAgBjF,CAAI,EAEpB,IAAM0F,EAAW,IAAI,SAAS1F,CAAI,EAC5B2F,EAAU,CACZ,WAAYD,EAAS,IAAI,YAAY,GAAKA,EAAS,IAAI,WAAW,GAAG,MAAM,GAAG,IAAI,CAAC,EACnF,UAAWA,EAAS,IAAI,WAAW,IAAMA,EAAS,IAAI,WAAW,EAAIA,EAAS,IAAI,WAAW,EAAE,MAAM,GAAG,EAAE,MAAM,CAAC,EAAE,KAAK,GAAG,EAAI,IAC/H,MAAOA,EAAS,IAAI,OAAO,EAC3B,MAAOA,EAAS,IAAI,OAAO,EAC3B,eAAgBA,EAAS,IAAI,eAAe,GAAKA,EAAS,IAAI,gBAAgB,EAC9E,eAAgBA,EAAS,IAAI,eAAe,GAAKA,EAAS,IAAI,gBAAgB,EAC9E,KAAMA,EAAS,IAAI,MAAM,EACzB,MAAOA,EAAS,IAAI,OAAO,EAC3B,YAAaA,EAAS,IAAI,aAAa,EACvC,QAASA,EAAS,IAAI,SAAS,CACnC,EAIME,EADW,CAAC,QAAS,aAAc,iBAAkB,OAAQ,aAAa,EACvD,OAAOC,GAAS,CAACF,EAAQE,CAAK,CAAC,EAExD,GAAID,EAAQ,OAAS,EAEjB,OAAAA,EAAQ,QAAQC,GAAS,CAErB,IAAIC,EAAW,UAAUD,CAAK,KAC1BA,IAAU,mBAAkBC,EAAW,kDAC3C,IAAMX,EAAUnF,EAAK,cAAc8F,CAAQ,EAC3CZ,EAAgBC,GAAWnF,EAAM6F,EAAM,QAAQ,IAAK,GAAG,EAAE,QAAQ,QAASE,GAAKA,EAAE,YAAY,CAAC,EAAI,eAAe,CACrH,CAAC,EAEDR,EAAkBvF,CAAI,EACf,GAIX,GAAI2F,EAAQ,OAAS,CAAC,6BAA6B,KAAKA,EAAQ,KAAK,EAAG,CACpE,IAAMK,EAAUhG,EAAK,cAAc,gBAAgB,EACnD,OAAAkF,EAAgBc,GAAWhG,EAAM,qCAAqC,EACtEuF,EAAkBvF,CAAI,EACf,EACX,CAEA,OAAA9D,EAAa,iBAAmByJ,EACzB,EACX,CAEA,eAAed,GAAsB,CACjC,IAAM3H,EAAY,SAAS,eAAe,kBAAkB,EAC5D,GAAKA,EAEL,QAAO,KAAKA,EAAW,SAAS,EAEhC,GAAI,CACA,IAAMyI,EAAUzJ,EAAa,iBAE7B,GAAI,CAACyJ,EAAS,CAEVzI,EAAU,UAAY,2FACtB,MACJ,CAEA,IAAM+I,EAAS,OAAON,GAAY,SAAW,CACzC,QAASA,EAAQ,QACjB,YAAaA,EAAQ,YACrB,KAAMA,EAAQ,IAClB,EAAI,CAAE,WAAYA,CAAQ,EAGpBO,GADW,MAAM,YAAY,SAASD,CAAM,GACzB,MAAQ,CAAC,EAElC,GAAIC,EAAQ,SAAW,EAAG,CACtBhJ,EAAU,UAAY,gFACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA,sBAEZgJ,EAAQ,IAAI,CAACC,EAAQC,IAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAMRD,EAAO,EAAE;AAAA,sCAChBC,IAAU,EAAI,UAAY,EAAE;AAAA;AAAA,kDAEhBD,EAAO,KAAK;AAAA;AAAA;AAAA,2EAGa,UAAU,WAAWA,EAAO,IAAI,CAAC;AAAA,sCACtEA,EAAO,YAAc,oCAAoC,UAAU,WAAWA,EAAO,WAAW,CAAC,OAAS,EAAE;AAAA,sCAC5GA,EAAO,eAAiB,gDAAgDA,EAAO,cAAc,YAAc,EAAE;AAAA;AAAA;AAAA,wEAG3EA,EAAO,MAAQ,EAAI,UAAU,YAAYA,EAAO,KAAK,EAAI,MAAM;AAAA;AAAA,qBAElH,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAInB,IAAME,EAAiBnJ,EAAU,iBAAiB,+BAA+B,EAqBjF,GApBAmJ,EAAe,QAAQ,CAACrC,EAAOzC,IAAQ,CACnC,IAAM4E,EAASD,EAAQ3E,CAAG,GAAK,CAAC,EAC1B+E,EAAQ,OAAOH,EAAO,OAASA,EAAO,MAAQ,CAAC,GAAK,EACpD1I,EAAU0I,EAAO,eAAiBA,EAAO,eAAiBG,EAAQ,EAAI,UAAU,YAAYA,CAAK,EAAI,QAC3GtC,EAAM,QAAUsC,EAChBtC,EAAM,QAAQ,QAAUvG,EACpB0I,EAAO,UAAYA,EAAO,SAAS,OACnCnC,EAAM,QAAQ,SAAWmC,EAAO,SAAS,MAE7CnC,EAAM,iBAAiB,SAAU,IAAM,CACnCuC,GAAmB,WAAWvC,EAAM,OAAO,GAAK,EAAG,CAC/C,OAAQA,EAAM,MACd,QAASA,EAAM,QAAQ,QACvB,SAAUA,EAAM,QAAQ,UAAY,KACpC,QAAS,GACT,KAAM,UACV,CAAC,CACL,CAAC,CACL,CAAC,EAEGkC,EAAQ,OAAS,EAAG,CACpBhK,EAAa,gBAAkBgK,EAAQ,CAAC,EAAE,GAC1C,IAAMvG,EAAQuG,EAAQ,CAAC,GAAK,CAAC,EACvBI,EAAQ,OAAO3G,EAAM,OAASA,EAAM,MAAQ,CAAC,GAAK,EAClDlC,EAAUkC,EAAM,eAAiBA,EAAM,eAAiB2G,EAAQ,EAAI,UAAU,YAAYA,CAAK,EAAI,QACzGC,GAAmBD,EAAO,CACtB,OAAQD,EAAe,CAAC,GAAG,OAAS1G,EAAM,GAC1C,QAAAlC,EACA,SAAU4I,EAAe,CAAC,GAAG,SAAS,UAAY,KAClD,QAAS,GACT,KAAM,UACV,CAAC,CACL,CACJ,OACOnH,EAAO,CACV,QAAQ,MAAM,mCAAoCA,CAAK,EACvDhC,EAAU,UAAY,gFAC1B,EACJ,CAKA,SAASsJ,GAA2BC,EAAa,CAC7C,IAAMC,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAa,SAAS,eAAe,aAAa,EACpD,CAACD,GAAgB,CAACC,IAEtBD,EAAa,SAAW,CAACD,EACzBE,EAAW,YAAcF,EAAc,qBAAuB,+BAClE,CAEA,eAAeG,IAAgC,CAC3C,IAAM1J,EAAY,SAAS,eAAe,2BAA2B,EACrE,GAAKA,EAEL,GAAI,CACA,IAAM+I,EAAS,IAAI,gBAEf,OAAO,QAAU,OAAO,cAAgB,OAAO,aAAa,aAAaA,EAAO,IAAI,UAAW,OAAO,aAAa,WAAW,EAC9HhK,IAASA,EAAK,OAASA,EAAK,QAAU,IAAIgK,EAAO,IAAI,SAAUhK,EAAK,KAAK,EAK7E,IAAMa,EAAO,MAHA,MAAM,MAAM,wCAAwCmJ,EAAO,SAAS,CAAC,GAAI,CAClF,YAAa,aACjB,CAAC,GACuB,KAAK,EAEvBY,EAAY/J,GAAQA,EAAK,MAAS,CAAC,EAGnCwI,EAAWpI,EAAU,iBAAiB,iBAAiB,EAC7D,GAAIoI,GAAYA,EAAS,OAAS,EAAG,CACjC,GAAI,CACA,IAAMwB,EAAgB,MAAM,KAAKxB,CAAQ,EAAE,IAAIrE,GAAMA,EAAG,QAAQ,OAAO,EAAE,OAAO,OAAO,EACjF8F,GAAeF,GAAY,CAAC,GAAG,IAAIG,GAAKA,EAAE,IAAI,EAIxD,GADaF,EAAc,SAAWC,EAAY,QAAUD,EAAc,MAAM,CAACG,EAAGC,KAAMD,IAAMF,EAAYG,EAAC,CAAC,EACpG,CACNrI,GAAmB,EACnB2H,GAA2BM,EAAc,OAAS,CAAC,EACnD,MACJ,CACJ,OAASK,EAAK,CAEV,QAAQ,KAAK,+CAAgDA,CAAG,CACpE,CAGA,GAAIN,EAAS,SAAW,EAAG,CACvBL,GAA2BlB,EAAS,OAAS,CAAC,EAC9C,MACJ,CACJ,CAGA,GAAI,CAACuB,GAAYA,EAAS,SAAW,EAAG,CACpC3J,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQtBsJ,GAA2B,EAAK,EAChC,MACJ,CAGI,IAAMY,EAAO,SAAS,uBAAuB,EAC7CP,EAAS,QAAQ,CAACG,EAAGzF,IAAQ,CACzB,IAAM8F,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,mFACpBA,EAAQ,QAAQ,QAAUL,EAAE,KAG5BK,EAAQ,MAAM,UAAY,6BAC1BA,EAAQ,MAAM,eAAiB,GAAG9F,EAAM,EAAE,KAE1C,IAAMiE,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,KAAO,QACbA,EAAM,KAAO,iBACbA,EAAM,MAAQwB,EAAE,KAChBxB,EAAM,GAAK,WAAWwB,EAAE,IAAI,GAC5BxB,EAAM,UAAY,eAClBA,EAAM,QAAQ,QAAUwB,EAAE,UAAY,OACtCxB,EAAM,QAAQ,UAAawB,EAAE,sBAAwBA,EAAE,YAAc,EACrExB,EAAM,QAAQ,WAAawB,EAAE,YAAc,EAC3CxB,EAAM,QAAQ,QAAUwB,EAAE,MAAQ,GAC9BzF,IAAQ,IAAGiE,EAAM,QAAU,IAE/B,IAAM8B,GAAQ,SAAS,cAAc,OAAO,EAC5CA,GAAM,aAAa,MAAO9B,EAAM,EAAE,EAClC8B,GAAM,UAAY,6IAElBA,GAAM,UAAY;AAAA;AAAA;AAAA,8BAGJN,EAAE,SAAW,aAAaA,EAAE,QAAQ,sBAAsBA,EAAE,IAAI,KAAO,2BAA2BA,EAAE,KAAK,YAAY,CAAC,SAAS;AAAA;AAAA;AAAA,mFAG1E,UAAU,WAAWA,EAAE,IAAI,CAAC;AAAA,kFAC7B,UAAU,WAAWA,EAAE,aAAe,EAAE,CAAC;AAAA,8BAC7FA,EAAE,SAAW,8DAA8D,UAAU,WAAWA,EAAE,QAAQ,CAAC,OAAS,EAAE;AAAA,8BACtHA,EAAE,aAAe,4DAA4DA,EAAE,YAAY,OAAS,EAAE;AAAA;AAAA;AAAA,kBAKpHK,EAAQ,YAAY7B,CAAK,EACzB6B,EAAQ,YAAYC,EAAK,EAGzB,IAAM7C,GAAY,SAAS,cAAc,KAAK,EAC9CA,GAAU,UAAY,4FACtBA,GAAU,UAAY,8NACtB4C,EAAQ,YAAY5C,EAAS,EAE7B2C,EAAK,YAAYC,CAAO,EAGpBL,EAAE,YAAcA,EAAE,iBAClBO,GAAqBP,EAAE,UAAU,EAAE,MAAMG,IAAO,QAAQ,MAAM,yBAA0BA,EAAG,CAAC,CAEpG,CAAC,EAGLjK,EAAU,gBAAgBkK,CAAI,EAG9BvI,GAAmB,EACnB2H,GAA2BK,EAAS,OAAS,CAAC,EAC9C1I,EAAoB,CAExB,OAASe,EAAO,CACZ,QAAQ,MAAM,mCAAoCA,CAAK,CAC3D,CACA,CAEA,SAASqI,GAAqBC,EAAgB,CAC1C,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACpC,GAAI,OAAO,QAAU,OAAO,yBAA2BF,EAAgB,CAEnEC,EAAQ,EACR,MACJ,CAMA,GAHA,OAAO,uBAAyBD,EAG5B,OAAO,OAAQ,CACfG,GAAmBH,CAAc,EACjCC,EAAQ,EACR,MACJ,CAEA,IAAMG,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,IAAM,4BACbA,EAAO,MAAQ,GACfA,EAAO,OAAS,IAAM,CAClB,GAAI,CACAD,GAAmBH,CAAc,EACjCC,EAAQ,CACZ,OAASN,EAAK,CACVO,EAAOP,CAAG,CACd,CACJ,EACAS,EAAO,QAAW3D,GAAMyD,EAAOzD,CAAC,EAChC,SAAS,KAAK,YAAY2D,CAAM,CACpC,CAAC,CACL,CAEA,SAASD,GAAmBH,EAAgB,CACxC,GAAI,OAAO,OAAW,IAAa,MAAM,IAAI,MAAM,0BAA0B,EAE7E,GAAI,CACA,IAAMK,EAAS,OAAOL,CAAc,EAE9BM,EADWD,EAAO,SAAS,EACT,OAAO,MAAM,EAC/BE,EAAa,SAAS,eAAe,cAAc,EACrDA,IAEAA,EAAW,UAAY,GACvBD,EAAO,MAAM,eAAe,EAG5BA,EAAO,GAAG,SAAW7D,GAAM,CACvB,IAAM+D,EAAe,SAAS,eAAe,aAAa,EACtDA,IAAcA,EAAa,YAAc/D,EAAE,MAAQA,EAAE,MAAM,QAAU,GAC7E,CAAC,EAGD,OAAO,eAAiB4D,EACxB,OAAO,WAAaC,EAE5B,OAASX,EAAK,CACV,cAAQ,MAAM,sCAAuCA,CAAG,EAClDA,CACV,CACJ,EAGC,UAA4B,CAEzB,SAAS,iBAAiB,mBAAoB,IAAM,CAChD,WAAW,IAAM,CACbP,GAA8B,CAClC,EAAG,EAAE,CACT,CAAC,CACL,GAAG,EAIH,SAASL,GAAmBxJ,EAAMmB,EAAO,CAAC,EAAG,CACzC,IAAM+J,EAAiB,SAAS,eAAe,eAAe,EACxDC,EAAe,SAAS,eAAe,aAAa,EACpDC,EAAc7L,EAASS,EAAM,CAAC,EAC9BU,EAAUS,EAAK,UAAYiK,EAAc,EAAI,UAAU,YAAYA,EAAajK,EAAK,UAAY,IAAI,EAAI,QAQ/G,GANI+J,IACAA,EAAe,YAAcxK,EAC7BwK,EAAe,QAAQ,MAAQ,OAAOE,CAAW,EAC7CjK,EAAK,WAAU+J,EAAe,QAAQ,SAAW/J,EAAK,WAG1DA,EAAK,QACL,GAAI,CACA,aAAa,QAAQxB,EAAsB,KAAK,UAAU,CACtD,KAAMwB,EAAK,MAAQ,WACnB,OAAQA,EAAK,QAAU,KACvB,KAAMiK,EACN,QAAS1K,GAAW,GACpB,SAAUS,EAAK,UAAY,KAC3B,GAAI,KAAK,IAAI,CACjB,CAAC,CAAC,CACN,MAAc,CAEd,CAGJ,GAAIgK,GAAgBjM,EAAM,CACtB,IAAMgC,GAAShC,EAAK,OAAS,GAAKkM,EAClCD,EAAa,YAAc,UAAU,YAAYjK,CAAK,EACtDiK,EAAa,QAAQ,MAAQjK,CACjC,CACJ,CAEA,SAAS8G,IAAyB,CAC9B,IAAMlH,EAAW,SAAS,cAAc,uCAAuC,EAC/E,OAAKA,GAIL3B,EAAa,gBAAkB2B,EAAS,MACjC,KAJH,MAAM,MAAM,kCAAkC,EACvC,GAIf,CAEA,SAASiB,IAAyB,CAC9B,IAAMsJ,EAAS,SAAS,eAAe,sBAAsB,EACvDC,EAAQ,SAAS,eAAe,qBAAqB,EAC3D,GAAI,CAACD,GAAU,CAACC,EAAO,OAEvBD,EAAO,iBAAiB,QAAS,IAAM,CACnC,IAAME,EAASD,EAAM,UAAU,OAAO,QAAQ,EAC9CD,EAAO,aAAa,iBAAkB,CAACE,GAAQ,SAAS,CAAC,EACzD,IAAMC,EAAUH,EAAO,cAAc,KAAK,EACtCG,GAASA,EAAQ,UAAU,OAAO,aAAc,CAACD,CAAM,CAC/D,CAAC,EAGD,IAAME,EAAW,OAAO,iBAAiBH,CAAK,EAAE,UAAY,QAAUA,EAAM,UAAU,SAAS,QAAQ,EACvGD,EAAO,aAAa,iBAAkB,CAACI,GAAU,SAAS,CAAC,CAC/D,CAEA,SAASxD,IAAwB,CAC7B,IAAMnH,EAAW,SAAS,cAAc,sCAAsC,EACxEmC,EAAO,SAAS,eAAe,cAAc,EAGnD,GAFAiF,EAAgBjF,CAAI,EAEhB,CAACnC,EAAU,CAEX,IAAMX,EAAY,SAAS,eAAe,2BAA2B,GAAK8C,EAC1E,OAAAkF,EAAgBhI,EAAW,iCAAiC,EAC5DqI,EAAkBrI,CAAS,EACpB,EACX,CAEA,IAAMuL,EAAO5K,EAAS,MAGtB,GAAI4K,IAAS,SAAU,CACnB,IAAMC,EAAS,SAAS,eAAe,iBAAiB,EACxD,GAAI,CAACA,GAAU,CAACA,EAAO,MAAM,KAAK,EAC9B,OAAAxD,EAAgBwD,GAAU1I,EAAM,8BAA8B,EAC9DuF,EAAkBvF,CAAI,EACf,GAGX,GAAI,CAAC,OAAO,WACR,OAAAkF,EAAgB,SAAS,eAAe,cAAc,GAAKlF,EAAM,kDAAkD,EAC5G,EAEf,CAEA,GAAIyI,IAAS,QAAS,CAClB,IAAMxH,EAAK,SAAS,eAAe,cAAc,EACjD,GAAI,CAACA,GAAM,CAACA,EAAG,MAAM,KAAK,EACtB,OAAAiE,EAAgBjE,GAAMjB,EAAM,kCAAkC,EAC9DuF,EAAkBvF,CAAI,EACf,EAEf,CAEA,GAAIyI,IAAS,QAAS,CAClB,IAAMxH,EAAK,SAAS,eAAe,cAAc,EACjD,GAAI,CAACA,GAAM,CAACA,EAAG,MAAM,KAAK,EACtB,OAAAiE,EAAgBjE,GAAMjB,EAAM,kCAAkC,EAC9DuF,EAAkBvF,CAAI,EACf,EAEf,CAGA,OAAA9D,EAAa,eAAiBuM,EACvB,EACX,CAEA,SAAS5J,IAAqB,CAC1B,IAAM8J,EAAwB,SAAS,eAAe,kBAAkB,EAClEC,EAAqB,SAAS,eAAe,sBAAsB,EAEzED,GAAuB,iBAAiB,SAAW1E,GAAM,CACrD/H,EAAa,iBAAmB+H,EAAE,OAAO,QACzC2E,GAAoB,UAAU,OAAO,SAAU3E,EAAE,OAAO,OAAO,CACnE,CAAC,EAEsB,SAAS,iBAAiB,8BAA8B,EAChE,QAAQkC,GAAU,CAC7B,IAAM0C,EAAW5E,GAAM,CAEnB,SAAS,iBAAiB,qBAAqB,EAAE,QAAQjE,GAAQ,CAC7DA,EAAK,UAAU,IAAI,QAAQ,CAC/B,CAAC,EAGD,IAAMyI,EAAOxE,EAAE,OAASA,EAAE,OAAO,MAASkC,EAAO,OAAS,KAC1D,GAAI,CAACsC,EAAM,OAEX,IAAIK,EAAa,SAAS,cAAc,uBAAuBL,CAAI,IAAI,EAClEK,IACDA,EAAa,SAAS,eAAe,GAAGL,CAAI,OAAO,GAGrDK,GAAY,UAAU,OAAO,QAAQ,EACrC3K,EAAoB,CACxB,EAEFgI,EAAO,iBAAiB,SAAU0C,CAAO,EAGrC1C,EAAO,SACP0C,EAAQ,CAAE,OAAQ1C,CAAO,CAAC,CAElC,CAAC,EAID,IAAM4C,EAAgB,SAAS,eAAe,iBAAiB,EACzDC,EAAiB,SAAS,eAAe,kBAAkB,EAG7DD,IAAkB,CAACC,GAAkB,CAACA,EAAe,QAAUA,EAAe,OAAO,SAAS,YAAY,IAC1GD,EAAc,iBAAiB,QAAS,MAAO9E,GAAM,CACjDA,EAAE,eAAe,EACjB,MAAMgF,GAAW,CACrB,CAAC,CAET,CAEA,SAASlK,IAAgB,CACrB,IAAMmK,EAAW,SAAS,eAAe,kBAAkB,EACvDA,GAAYA,EAAS,QAAQ,YAAc,SAC3CA,EAAS,QAAQ,UAAY,OAC7BA,EAAS,iBAAiB,SAAWjF,GAAM,CACvCA,EAAE,eAAe,EACjBA,EAAE,yBAAyB,EAC3BvD,EAAmBwI,EAAU,CACzB,SAAUpE,EACV,YAAa,sBACb,YAAa,eACjB,CAAC,CACL,EAAG,EAAI,GAGX,IAAMqE,EAAe,SAAS,eAAe,eAAe,EACxDA,GAAgBA,EAAa,QAAQ,YAAc,SACnDA,EAAa,QAAQ,UAAY,OACjCA,EAAa,iBAAiB,SAAWlF,GAAM,CAI3C,GAHAA,EAAE,eAAe,EACjBA,EAAE,yBAAyB,GACN,SAAS,eAAe,eAAe,GAAG,OAAS,cACnD,UAEjB,GAAI,CADmB,SAAS,cAAc,uCAAuC,EAChE,CACjB,MAAM,MAAM,kCAAkC,EAC9C,MACJ,UAII,EAFiB,SAAS,cAAc,wCAAwC,GAChF,SAAS,cAAc,uCAAuC,GAC/C,CACf,MAAM,MAAM,kCAAkC,EAC9C,MACJ,CAGJvD,EAAmByI,EAAc,CAC7B,YAAa,qBACb,YAAa,eACjB,CAAC,CACL,EAAG,EAAI,EAEf,CAEA,eAAeF,IAAa,CACxB,GAAI,CAACjE,GAAsB,EAAG,OAE9B,IAAM+D,EAAgB,SAAS,eAAe,iBAAiB,EAC/DA,EAAc,SAAW,GACzBA,EAAc,UAAY,6VAE1B,GAAI,CACA,IAAMK,EAAa,SAAS,eAAe,aAAa,GAAG,MAG3D,GAFAlN,EAAa,MAAQkN,GAAc,GAE/B,CAAClN,EAAa,iBAAkB,CAChC,IAAMmN,EAAc,SAAS,eAAe,sBAAsB,EAClE,GAAIA,EAAa,CACb,IAAM3D,EAAW,IAAI,SAAS2D,CAAW,EACzCnN,EAAa,gBAAkB,CAC3B,WAAYwJ,EAAS,IAAI,oBAAoB,EAC7C,UAAWA,EAAS,IAAI,mBAAmB,EAC3C,eAAgBA,EAAS,IAAI,wBAAwB,EACrD,eAAgBA,EAAS,IAAI,wBAAwB,EACrD,KAAMA,EAAS,IAAI,cAAc,EACjC,MAAOA,EAAS,IAAI,eAAe,EACnC,YAAaA,EAAS,IAAI,qBAAqB,EAC/C,QAASA,EAAS,IAAI,iBAAiB,CAC3C,CACJ,CACJ,CAGA,IAAM4D,GADW,MAAM,YAAY,YAAYpN,CAAY,GACpC,KAEnBA,EAAa,iBAAmB,UAAYA,EAAa,iBAAmB,OAC5E,MAAMqN,GAAqBD,CAAK,EACzBpN,EAAa,iBAAmB,SACvC,MAAMsN,GAAqBF,CAAK,EAEhC,OAAO,SAAS,KAAO,WAAWA,EAAM,EAAE,gBAElD,OAASpK,EAAO,CACZ,QAAQ,MAAM,yBAA0BA,CAAK,EAC7C,MAAM,MAAMA,EAAM,SAAW,0CAA0C,EAEvE6J,EAAc,SAAW,GACzBA,EAAc,YAAc,aAChC,CACJ,CAEA,eAAeQ,GAAqBD,EAAO,CACvC,GAAI,CACA,IAAMtK,EAAW,MAAM,YAAY,oBAAoBsK,EAAM,EAAE,EACzD,CAAE,cAAAG,CAAc,EAAIzK,EAAS,KAC7B0K,EAAkB1K,EAAS,KAAK,iBAAmB,OAAO,yBAA2B,OAAO,eAAiB,OAAO,uBAAyB,MAEnJ,GAAI,OAAO,OAAW,KAAe,CAAC,OAAO,eACzC,MAAM,IAAI,MAAM,uBAAuB,EAI3C,IAAM2K,EAAS,MADA,OAAO,gBAAkB,OAAOD,CAAe,GAClC,mBAAmBD,EAAe,CAC1D,eAAgB,CACZ,KAAM,OAAO,WACb,gBAAiB,CACb,KAAM,GAAGvN,EAAa,iBAAiB,UAAU,IAAIA,EAAa,iBAAiB,SAAS,EAChG,CACJ,CACJ,CAAC,EAED,GAAIyN,EAAO,MACP,MAAM,IAAI,MAAMA,EAAO,MAAM,OAAO,EAGxC,OAAO,SAAS,KAAO,WAAWL,EAAM,EAAE,gBAC9C,OAASpK,EAAO,CACZ,QAAQ,MAAM,yBAA0BA,CAAK,EAC7C,MAAM,MAAMA,EAAM,SAAW,mCAAmC,EAEhE,IAAM6J,EAAgB,SAAS,eAAe,iBAAiB,EAC/DA,EAAc,SAAW,GACzBA,EAAc,YAAc,aAChC,CACJ,CAEA,eAAeS,GAAqBF,EAAO,CACvC,GAAI,CACA,IAAMtK,EAAW,MAAM,YAAY,kBAAkBsK,EAAM,EAAE,EACvD,CAAE,aAAAM,CAAa,EAAI5K,EAAS,KAClC,OAAO,SAAS,KAAO4K,CAC3B,OAAS1K,EAAO,CACZ,QAAQ,MAAM,yBAA0BA,CAAK,EAC7C,MAAM,MAAMA,EAAM,SAAW,mCAAmC,EAEhE,IAAM6J,EAAgB,SAAS,eAAe,iBAAiB,EAC/DA,EAAc,SAAW,GACzBA,EAAc,YAAc,aAChC,CACJ,CAEA,SAASc,IAAU,CACf5N,EAAO,KACPC,EAAe,CACX,iBAAkB,KAClB,gBAAiB,KACjB,iBAAkB,GAClB,gBAAiB,KACjB,eAAgB,KAChB,MAAO,EACX,EACAC,EAAc,CAClB,CAEA,MAAO,CACH,KAAAsC,EACA,QAAAoL,EACJ,CACJ,GAAE,EAEF,OAAO,aAAe/N,GACfD,GAAQC,KC91Cf,IAAAgO,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAsbCD,GA3bPE,GAAAC,GAAA,KAKMF,IAAe,UAAW,CAC5B,aAEA,eAAeG,GAAO,CAClBC,EAAgB,EAChB,MAAMC,EAAgB,EACtBC,EAAqB,CACzB,CAKA,SAASA,GAAuB,CAC5BC,EAAmB,EACnBC,EAAmB,EACnBC,EAAwB,EACxBC,EAAe,EACfC,EAAsB,CAC1B,CAKA,SAASJ,GAAqB,CAC1B,IAAMK,EAAe,SAAS,eAAe,aAAa,EAC1D,GAAI,CAACA,EAAc,OAGnB,IAAMC,EAAMD,EAAa,QAAQ,KAAO,IAClCE,EAAMF,EAAa,QAAQ,KAAO,IAClCG,EAAUH,EAAa,QAAQ,SAAW,eAGhDA,EAAa,UAAY;AAAA;AAAA;AAAA,sGAGqEE,CAAG,MAAMD,CAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4EAOtC,mBAAmBE,CAAO,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAUnG,CAKA,SAASP,GAAqB,CAC1B,IAAMQ,EAAY,SAAS,eAAe,eAAe,EACpDA,IAELA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAqBtB,SAAS,eAAe,gBAAgB,GAAG,iBAAiB,QAAS,IAAM,CAEvE,SAAS,cAAc,IAAI,YAAY,WAAW,CAAC,CACvD,CAAC,EACL,CAKA,SAASP,GAA0B,CAC/B,IAAMO,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAEhB,IAAMC,EAAU,CACZ,CAAE,KAAM,QAAS,MAAO,UAAW,OAAQ,OAAQ,MAAO,SAAU,EACpE,CAAE,KAAM,WAAY,MAAO,WAAY,OAAQ,iBAAkB,MAAO,OAAQ,EAChF,CAAE,KAAM,QAAS,MAAO,QAAS,OAAQ,UAAW,MAAO,MAAO,CACtE,EAEAD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAsB1B,CAKA,SAASN,GAAiB,CACtB,IAAMM,EAAY,SAAS,eAAe,aAAa,EACvD,GAAI,CAACA,EAAW,OAEhB,IAAME,EAAO,CACT,CAAE,EAAG,+BAAgC,EAAG,uFAAwF,EAChI,CAAE,EAAG,8BAA+B,EAAG,wFAAyF,EAChI,CAAE,EAAG,+BAAgC,EAAG,+CAAgD,CAC5F,EAEAF,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAORE,EAAK,IAAI,CAACC,EAAKC,IAAU;AAAA,4DACaA,CAAK;AAAA;AAAA,gGAE+B,UAAU,WAAWD,EAAI,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,kCAIzF,UAAU,WAAWA,EAAI,CAAC,CAAC;AAAA;AAAA;AAAA,qBAGxC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAMvBH,EAAU,iBAAiB,cAAc,EAAE,QAAQK,GAAW,CAC1DA,EAAQ,iBAAiB,QAAS,IAAM,CACpC,IAAMC,EAAOD,EAAQ,QAAQ,WAAW,EAClCE,EAASD,EAAK,cAAc,aAAa,EACzCE,EAAOF,EAAK,cAAc,WAAW,EACrCG,EAAS,CAACF,EAAO,UAAU,SAAS,QAAQ,EAGlDP,EAAU,iBAAiB,WAAW,EAAE,QAAQU,GAAa,CACrDA,IAAcJ,IACdI,EAAU,cAAc,aAAa,EAAE,UAAU,IAAI,QAAQ,EAC7DA,EAAU,cAAc,WAAW,EAAE,UAAU,OAAO,YAAY,EAE1E,CAAC,EAGDH,EAAO,UAAU,OAAO,QAAQ,EAChCC,EAAK,UAAU,OAAO,YAAY,CACtC,CAAC,CACL,CAAC,CACL,CAKA,SAASb,GAAwB,CAC7B,IAAMK,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAGhB,IAAMW,EAAc,CAChB,MAAO,EACP,IAAK,GACL,SAAU,mBACV,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,CAAC,CACxB,EAEA,SAASC,GAAe,CACpB,IAAMC,EAAM,IAAI,KACVC,EAAMD,EAAI,OAAO,EACjBE,EAAOF,EAAI,SAAS,EAEpBJ,EADYE,EAAY,KAAK,SAASG,CAAG,GACnBC,GAAQJ,EAAY,OAASI,EAAOJ,EAAY,IAE5EX,EAAU,UAAY;AAAA,qEACmCS,EAAS,yFAA2F,8EAA8E;AAAA;AAAA,0BAE7NA,EACE;AAAA,6GAEA,8EACJ;AAAA;AAAA;AAAA,gDAGwBA,EAAS,yCAA2C,oCAAoC;AAAA,8BAC1GA,EAAS,cAAiB,kBAAkB;AAAA;AAAA,4CAE9BA,EAAS,yCAA2C,oCAAoC;AAAA,8BACtGA,EAAS,qCAAuC,yBAAyBE,EAAY,KAAK,QAAQA,EAAY,IAAM,GAAMA,EAAY,IAAM,GAAM,KAAOA,EAAY,IAAM,IAAI,EAAE;AAAA;AAAA;AAAA;AAAA,aAKvM,CAEAC,EAAa,EAEb,YAAYA,EAAc,GAAK,CACnC,CAEA,SAASxB,GAAkB,CACvB,IAAM4B,EAAO,SAAS,eAAe,cAAc,EACnD,GAAI,CAACA,EAAM,OAEX,IAAMC,EAAY,cAAc,OAAOD,EAAM,CACzC,KAAM,CACF,SAAU,GACV,UAAW,EACX,UAAW,GACf,EACA,MAAO,CACH,SAAU,GACV,MAAO,EACX,EACA,QAAS,CACL,SAAU,GACV,UAAW,EACX,UAAW,GACf,EACA,QAAS,CACL,SAAU,GACV,UAAW,GACX,UAAW,GACf,CACJ,CAAC,EAEDA,EAAK,iBAAiB,SAAU,MAAOE,GAAM,CAGzC,GAFAA,EAAE,eAAe,EAEb,CAACD,EAAU,SAAS,EAAG,CACvB,MAAM,MAAM,+CAA+C,EAC3D,MACJ,CAEA,IAAME,EAAYH,EAAK,cAAc,uBAAuB,EACtDI,EAAeD,EAAU,YAC/BA,EAAU,SAAW,GACrBA,EAAU,UAAY,6VAEtB,GAAI,CACA,IAAME,EAAW,IAAI,SAASL,CAAI,EAC5BM,EAAO,CACT,KAAMD,EAAS,IAAI,MAAM,EACzB,MAAOA,EAAS,IAAI,OAAO,EAC3B,MAAOA,EAAS,IAAI,OAAO,EAC3B,QAASA,EAAS,IAAI,SAAS,EAC/B,QAASA,EAAS,IAAI,SAAS,CACnC,EAEA,MAAM,WAAW,kBAAkBC,CAAI,EAEvC,MAAM,QAAQ,yDAA0D,EACxEN,EAAK,MAAM,EACXC,EAAU,YAAY,EAEtBM,EAAiB,CACrB,OAASC,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,2CAA2C,CAC5E,QAAE,CACEL,EAAU,SAAW,GACrBA,EAAU,YAAcC,CAC5B,CACJ,CAAC,CACL,CAEA,SAASG,GAAmB,CACxB,IAAMP,EAAO,SAAS,eAAe,cAAc,EAC7CS,EAAmB,SAAS,eAAe,iBAAiB,EAE9DT,GAAQS,IACRT,EAAK,UAAU,IAAI,QAAQ,EAC3BS,EAAiB,UAAU,OAAO,QAAQ,EAC1CA,EAAiB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAe7B,SAAS,eAAe,kBAAkB,GAAG,iBAAiB,QAAS,IAAM,CACzET,EAAK,UAAU,OAAO,QAAQ,EAC9BS,EAAiB,UAAU,IAAI,QAAQ,CAC3C,CAAC,EAET,CAEA,eAAepC,GAAkB,CAC7B,IAAMW,EAAY,SAAS,eAAe,cAAc,EACxD,GAAKA,EAEL,GAAI,CAEA,IAAM0B,GADW,MAAM,SAAS,eAAe,GACzB,KAEtB,GAAI,CAACA,EAAM,OAEX1B,EAAU,UAAY;AAAA;AAAA,sBAEZ0B,EAAK,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2DAUsB,UAAU,WAAWA,EAAK,OAAO,CAAC;AAAA;AAAA;AAAA,sBAGrE,EAAE;AAAA;AAAA,sBAEJA,EAAK,MAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CASYA,EAAK,KAAK,kDAAkD,UAAU,WAAWA,EAAK,KAAK,CAAC;AAAA;AAAA;AAAA,sBAGnH,EAAE;AAAA;AAAA,sBAEJA,EAAK,MAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDASeA,EAAK,KAAK,kDAAkD,UAAU,WAAWA,EAAK,KAAK,CAAC;AAAA;AAAA;AAAA,sBAGtH,EAAE;AAAA;AAAA,sBAEJA,EAAK,eAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2DASe,UAAU,WAAWA,EAAK,cAAc,CAAC;AAAA;AAAA;AAAA,sBAG5E,EAAE;AAAA;AAAA,sBAEJA,EAAK,cAAgB,OAAO,KAAKA,EAAK,YAAY,EAAE,OAAS,EAAI;AAAA;AAAA;AAAA;AAAA,kCAIrDA,EAAK,aAAa,SAAW;AAAA,+CAChBA,EAAK,aAAa,QAAQ;AAAA;AAAA;AAAA,kCAGrC,EAAE;AAAA,kCACJA,EAAK,aAAa,UAAY;AAAA,+CACjBA,EAAK,aAAa,SAAS;AAAA;AAAA;AAAA,kCAGtC,EAAE;AAAA,kCACJA,EAAK,aAAa,QAAU;AAAA,+CACfA,EAAK,aAAa,OAAO;AAAA;AAAA;AAAA,kCAGpC,EAAE;AAAA,kCACJA,EAAK,aAAa,QAAU;AAAA,+CACfA,EAAK,aAAa,OAAO;AAAA;AAAA;AAAA,kCAGpC,EAAE;AAAA;AAAA;AAAA,sBAGd,EAAE;AAAA;AAAA,aAGlB,OAASF,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,CACvD,CACJ,CAEA,SAASG,GAAU,CAAC,CAEpB,MAAO,CACH,KAAAxC,EACA,QAAAwC,CACJ,CACJ,GAAG,EAEH,OAAO,YAAc3C,GACdD,GAAQC,KC3bf,IAAA4C,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAktBCD,GAvtBPE,GAAAC,GAAA,KAKMF,IAAW,UAAW,CACxB,aAEA,IAAIG,EAAa,CAAC,EACdC,EAAU,CAAC,EAEf,eAAeC,GAAO,CAElB,IAAMC,EAAkB,SAAS,eAAe,UAAU,EACtDA,GAAmBA,EAAgB,cAAc,WAAW,EAE5DC,EAA0B,EAG1B,MAAMC,EAAS,EAEnBC,EAAW,EACXC,EAAqB,CACzB,CAKA,SAASA,GAAuB,CAC5BC,EAAgB,EAChBC,EAAc,EACdC,EAAiB,EACjBC,EAAqB,EACrBC,EAAkB,EAClBC,EAAuB,EACvBC,EAAkB,CACtB,CAKA,SAASN,GAAkB,CAEvB,GAAI,CADoB,SAAS,cAAc,uBAAuB,GAC9C,EAAE,4BAA6B,QAAU,sBAAuB,QAAS,OAEjG,IAAMO,EAAoB,OAAO,mBAAqB,OAAO,wBACvDC,EAAc,IAAID,EACxBC,EAAY,WAAa,GACzBA,EAAY,KAAO,QAGnB,IAAMC,EAAW,SAAS,cAAc,QAAQ,EAChDA,EAAS,GAAK,mBACdA,EAAS,KAAO,SAChBA,EAAS,UAAY,mIACrBA,EAAS,UAAY;AAAA;AAAA,UAIrB,IAAMC,EAAc,SAAS,eAAe,YAAY,EACpDA,GAAeA,EAAY,gBAC3BA,EAAY,cAAc,MAAM,SAAW,WAC3CA,EAAY,cAAc,YAAYD,CAAQ,GAGlD,IAAIE,EAAc,GAElBF,EAAS,iBAAiB,QAAS,IAAM,CACjCE,EACAH,EAAY,KAAK,GAEjBA,EAAY,MAAM,EAClBC,EAAS,UAAU,IAAI,eAAgB,eAAe,GAE1DE,EAAc,CAACA,CACnB,CAAC,EAEDH,EAAY,SAAYI,GAAU,CAC9B,IAAMC,EAAaD,EAAM,QAAQ,CAAC,EAAE,CAAC,EAAE,WACnCF,IACAA,EAAY,MAAQG,EACpBH,EAAY,cAAc,IAAI,MAAM,OAAO,CAAC,GAEhDD,EAAS,UAAU,OAAO,eAAgB,eAAe,EACzDE,EAAc,EAClB,EAEAH,EAAY,QAAU,IAAM,CACxBC,EAAS,UAAU,OAAO,eAAgB,eAAe,EACzDE,EAAc,EAClB,CACJ,CAKA,SAASV,GAAgB,CAErB,SAAS,iBAAiB,+CAA+C,EAAE,QAAQa,GAAW,CAC1F,GAAIA,EAAQ,cAAc,aAAa,EAAG,OAG1C,IAAMC,GADUD,EAAQ,QAAQ,WAAW,GAAKA,EAAQ,QAAQ,kBAAkB,IACtD,QAAQ,IAAM,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EAE1EE,EAAa;AAAA;AAAA;AAAA;AAAA,gTAIiRD,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2RAM/BA,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAUzRD,EAAQ,mBAAmB,YAAaE,CAAU,CACtD,CAAC,EAGD,SAAS,iBAAiB,QAAUC,GAAM,CACtC,IAAMC,EAAUD,EAAE,OAAO,QAAQ,eAAe,EAChD,GAAI,CAACC,EAAS,OAEd,IAAMC,EAAUD,EAAQ,QAAQ,UAAY,MACtCH,EAAaG,EAAQ,QAAQ,SAC7BE,EAAYF,EAAQ,QAAQ,aAAa,EAGzCG,EAAU,KAAK,MAAM,aAAa,QAAQ,YAAY,GAAK,IAAI,EACrEA,EAAQN,CAAU,EAAII,EACtB,aAAa,QAAQ,aAAc,KAAK,UAAUE,CAAO,CAAC,EAG1DD,EAAU,UAAY;AAAA,8DAC4BD,EAAU,yCAA2C,oCAAoC;AAAA;AAAA;AAAA;AAAA,cAOvI,OAAO,UAAc,KACrB,UAAU,MAAM,YAAa,CAAE,WAAAJ,EAAY,QAAAI,CAAQ,CAAC,CAE5D,CAAC,CACL,CAKA,SAASjB,GAAmB,CACxB,IAAMkB,EAAY,SAAS,eAAe,mBAAmB,EACxDA,IAELA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UA2BtB,SAAS,eAAe,eAAe,GAAG,iBAAiB,QAAS,IAAM,CACtE,SAAS,cAAc,IAAI,YAAY,WAAW,CAAC,CACvD,CAAC,EACL,CAKA,SAASjB,GAAuB,CAC5B,IAAMiB,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAI,CAACA,EAAW,OAGhB,IAAMC,EAAU,KAAK,MAAM,aAAa,QAAQ,YAAY,GAAK,IAAI,EAC/DC,EAAa,OAAO,QAAQD,CAAO,EACpC,OAAO,CAAC,CAACE,EAAGJ,CAAO,IAAMA,CAAO,EAChC,MAAM,EAAG,CAAC,EACV,IAAI,CAAC,CAACK,CAAE,IAAMA,CAAE,EAGfC,EAAmB,CAAC,EAC1B,SAAS,iBAAiB,6BAA6B,EAAE,QAAQC,GAAQ,CACrE,IAAMF,EAAKE,EAAK,QAAQ,GACxB,GAAIJ,EAAW,SAASE,CAAE,GAAKC,EAAiB,OAAS,EAAG,CACxD,IAAME,EAAeD,EAAK,cAAc,qCAAqC,GAAG,aAAa,KAAK,EAC9FC,GACAF,EAAiB,KAAK,CAAE,GAAAD,EAAI,SAAUG,EAAc,QAASD,CAAK,CAAC,CAE3E,CACJ,CAAC,EAEGD,EAAiB,SAAW,IAEhCL,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAORK,EAAiB,MAAM,EAAG,CAAC,EAAE,IAAIG,GAAK;AAAA;AAAA,iJAEqFA,EAAE,EAAE;AAAA,kCACnH,UAAU,WAAWA,EAAE,QAAQ,CAAC;AAAA;AAAA;AAAA,qBAG7C,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAMvBR,EAAU,iBAAiB,iBAAiB,EAAE,QAAQS,GAAQ,CAC1DA,EAAK,iBAAiB,QAAS,IAAM,CACjC,IAAMC,EAAWD,EAAK,QAAQ,OACxBE,EAAa,SAAS,cAAc,aAAaD,CAAQ,eAAe,EAC9E,GAAIC,EAAY,CACZA,EAAW,eAAe,CAAE,SAAU,SAAU,MAAO,QAAS,CAAC,EACjE,IAAMC,EAAUD,EAAW,cAAc,iCAAiC,EACtEC,GAASA,EAAQ,MAAM,CAC/B,CACJ,CAAC,CACL,CAAC,EACL,CAKA,SAAS5B,GAAoB,CACzB,SAAS,iBAAiB,+CAA+C,EAAE,QAAQU,GAAW,CAC1F,GAAIA,EAAQ,cAAc,YAAY,EAAG,OAGzC,IAAMa,GADUb,EAAQ,QAAQ,WAAW,GAAKA,EAAQ,QAAQ,kBAAkB,IACpD,cAAc,qCAAqC,GAAG,aAAa,KAAK,EAEtG,GAAI,CAACa,EAAc,OAEnB,IAAMM,EAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qEAMuC,mBAAmB,MAAQN,CAAY,CAAC,QAAQ,mBAAmB,OAAO,SAAS,IAAI,CAAC;AAAA;AAAA;AAAA,+CAG9G,mBAAmB,QAAUA,CAAY,CAAC,SAAS,mBAAmB,OAAO,SAAS,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,cAM9Hb,EAAQ,mBAAmB,YAAamB,CAAS,CACrD,CAAC,EAGD,SAAS,iBAAiB,QAAUhB,GAAM,CACtC,IAAMiB,EAAUjB,EAAE,OAAO,QAAQ,sCAAsC,EAClEiB,GAEL,UAAU,UAAU,UAAU,OAAO,SAAS,IAAI,EAAE,KAAK,IAAM,CAC3D,IAAMC,EAAeD,EAAQ,UAC7BA,EAAQ,UAAY,+LACpB,WAAW,IAAM,CAAEA,EAAQ,UAAYC,CAAc,EAAG,GAAI,CAChE,CAAC,CACL,CAAC,CACL,CAKA,SAAS9B,GAAyB,CAC9B,IAAM+B,EAAW,SAAS,iBAAiB,6BAA6B,EACpEC,EAAe,GAEnB,SAAS,iBAAiB,UAAYpB,GAAM,CAExC,GAAK,SAAS,cAAc,2BAA2B,EAEvD,IAAIA,EAAE,MAAQ,aAAeA,EAAE,MAAQ,UAAW,CAC9CA,EAAE,eAAe,EAEbA,EAAE,MAAQ,YACVoB,EAAe,KAAK,IAAIA,EAAe,EAAGD,EAAS,OAAS,CAAC,EAE7DC,EAAe,KAAK,IAAIA,EAAe,EAAG,CAAC,EAG/C,IAAMX,EAAOU,EAASC,CAAY,EAClC,GAAIX,EAAM,CACNA,EAAK,eAAe,CAAE,SAAU,SAAU,MAAO,QAAS,CAAC,EAC3D,IAAMM,EAAUN,EAAK,cAAc,yCAAyC,EACxEM,GAASA,EAAQ,MAAM,CAC/B,CACJ,CAEA,GAAIf,EAAE,MAAQ,SAAWoB,GAAgB,EAAG,CAExC,IAAML,EADOI,EAASC,CAAY,GACZ,cAAc,iCAAiC,EACjEL,GAASA,EAAQ,MAAM,CAC/B,CAGIf,EAAE,MAAQ,KAAO,SAAS,eAAe,UAAY,UACrDA,EAAE,eAAe,EACjB,SAAS,eAAe,YAAY,GAAG,MAAM,GAErD,CAAC,CACL,CAKA,SAASX,GAAoB,CAEzB,IAAMgC,EAAW,IAAI,qBAAsBC,GAAY,CACnDA,EAAQ,QAAQC,GAAS,CACrB,GAAIA,EAAM,eAAgB,CACtB,IAAMd,EAAOc,EAAM,OACbb,EAAeD,EAAK,cAAc,qCAAqC,GAAG,aAAa,KAAK,EAG5Fe,EAAQ,KAAK,MAAM,aAAa,QAAQ,UAAU,GAAK,IAAI,EAC3DjB,EAAKE,EAAK,QAAQ,IAAMC,GAAc,UAAU,EAAG,EAAE,EACvDH,IACAiB,EAAMjB,CAAE,GAAKiB,EAAMjB,CAAE,GAAK,GAAK,EAC/B,aAAa,QAAQ,WAAY,KAAK,UAAUiB,CAAK,CAAC,EAE9D,CACJ,CAAC,CACL,EAAG,CAAE,UAAW,EAAI,CAAC,EAErB,SAAS,iBAAiB,6BAA6B,EAAE,QAAQf,GAAQ,CACrEY,EAAS,QAAQZ,CAAI,CACzB,CAAC,EAGD,SAAS,iBAAiB,QAAUT,GAAM,CACtC,IAAMe,EAAUf,EAAE,OAAO,QAAQ,iCAAiC,EAClE,GAAIe,EAAS,CACT,IAAMN,EAAOM,EAAQ,QAAQ,6BAA6B,EACpDL,EAAeK,EAAQ,cAAc,MAAM,GAAG,aAAa,KAAK,EAElE,OAAO,UAAc,KACrB,UAAU,MAAM,aAAc,CAAE,SAAUL,GAAc,UAAU,EAAG,GAAG,CAAE,CAAC,CAEnF,CACJ,CAAC,CACL,CAEA,SAAS/B,GAA4B,CAEjC,IAAM8C,EAAe,SAAS,iBAAiB,eAAe,EACxDC,EAAiB,SAAS,iBAAiB,eAAe,EAEhED,EAAa,QAAQE,GAAO,CACxBA,EAAI,iBAAiB,QAAU3B,GAAM,CACjCA,EAAE,eAAe,EAGjByB,EAAa,QAAQG,GAAK,CACtBA,EAAE,UAAU,OAAO,iBAAkB,oBAAqB,YAAY,EACtEA,EAAE,UAAU,IAAI,eAAgB,oBAAqB,iBAAkB,qBAAqB,CAChG,CAAC,EACDD,EAAI,UAAU,IAAI,iBAAkB,oBAAqB,YAAY,EACrEA,EAAI,UAAU,OAAO,eAAgB,oBAAqB,iBAAkB,qBAAqB,EAEjG,IAAME,EAAWF,EAAI,QAAQ,SAGzBE,IAAa,MACbH,EAAe,QAAQI,GAAOA,EAAI,UAAU,OAAO,QAAQ,CAAC,EAE5DJ,EAAe,QAAQI,GAAO,CAC1BA,EAAI,UAAU,OAAO,SAAUA,EAAI,QAAQ,WAAaD,CAAQ,CACpE,CAAC,EAIL,IAAMpC,EAAc,SAAS,eAAe,YAAY,EACpDA,IAAaA,EAAY,MAAQ,IACrC,SAAS,iBAAiB,WAAW,EAAE,QAAQgB,GAAQA,EAAK,UAAU,OAAO,QAAQ,CAAC,CAC1F,CAAC,CACL,CAAC,EAGwB,SAAS,iBAAiB,mBAAmB,EACrD,QAAQsB,GAAU,CAC/BA,EAAO,iBAAiB,QAAS,IAAM,CACnC,IAAMtB,EAAOsB,EAAO,QAAQ,kBAAkB,EACxClC,EAAUY,EAAK,cAAc,oBAAoB,EACjDuB,EAAOvB,EAAK,cAAc,iBAAiB,EAC3CwB,EAAS,CAACpC,EAAQ,UAAU,SAAS,QAAQ,EAGnD,SAAS,iBAAiB,kBAAkB,EAAE,QAAQqC,GAAa,CAC3DA,IAAczB,IACdyB,EAAU,cAAc,oBAAoB,GAAG,UAAU,IAAI,QAAQ,EACrEA,EAAU,cAAc,iBAAiB,GAAG,UAAU,OAAO,YAAY,EAEjF,CAAC,EAGID,GAIDpC,EAAQ,UAAU,IAAI,QAAQ,EAC9BmC,EAAK,UAAU,OAAO,YAAY,IAJlCnC,EAAQ,UAAU,OAAO,QAAQ,EACjCmC,EAAK,UAAU,IAAI,YAAY,EAKvC,CAAC,CACL,CAAC,CACL,CAEA,eAAepD,GAAW,CACtB,IAAMuB,EAAY,SAAS,eAAe,eAAe,EACzD,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CAEA,IAAMgC,GADW,MAAM,SAAS,QAAQ,GAClB,MAAQ,CAAC,EAG/B,GAFA3D,EAAU2D,EAENA,EAAK,SAAW,EAAG,CACnBhC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAQtB,MACJ,CAEA5B,EAAa6D,EAAgBD,CAAI,EACjCE,EAAW9D,CAAU,CACzB,OAAS+D,EAAO,CACZ,QAAQ,MAAM,uBAAwBA,CAAK,EAC3CnC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAQ1B,EACJ,CAEA,SAASiC,EAAgBD,EAAM,CAC3B,IAAMI,EAAU,CAAC,EAEjB,OAAAJ,EAAK,QAAQK,GAAO,CAChB,IAAMX,EAAWW,EAAI,UAAY,UAC5BD,EAAQV,CAAQ,IACjBU,EAAQV,CAAQ,EAAI,CAAC,GAEzBU,EAAQV,CAAQ,EAAE,KAAKW,CAAG,CAC9B,CAAC,EAEMD,CACX,CAEA,SAASF,EAAWI,EAAiBC,EAAa,GAAI,CAClD,IAAMvC,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAEhB,IAAMwC,EAAgB,OAAO,KAAKF,CAAe,EAEjD,GAAIE,EAAc,SAAW,EAAG,CAC5BxC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,iFAK+CuC,EAAa,SAAS,UAAU,WAAWA,CAAU,CAAC,IAAM,EAAE;AAAA;AAAA,cAGnI,MACJ,CAEAvC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAORwC,EAAc,IAAIb,GAAO;AAAA,sQACuN,UAAU,WAAWA,CAAG,CAAC;AAAA,8BACjQ,UAAU,WAAWA,CAAG,CAAC;AAAA;AAAA,qBAElC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMba,EAAc,IAAId,GAAY;AAAA,+DACe,UAAU,WAAWA,CAAQ,CAAC;AAAA,gGACG,UAAU,WAAWA,CAAQ,CAAC;AAAA;AAAA,8BAEhGY,EAAgBZ,CAAQ,EAAE,IAAIW,GAAOI,EAAcJ,EAAKE,CAAU,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,iBAG1F,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,UAInBG,EAAiB,EACjBC,EAAc,EAGd9D,EAAc,EACdG,EAAkB,CACtB,CAEA,SAASyD,EAAcJ,EAAKE,EAAa,GAAI,CACzC,IAAIK,EAAW,UAAU,WAAWP,EAAI,QAAQ,EAC5CQ,EAASR,EAAI,OAEjB,GAAIE,EAAY,CACZ,IAAMO,EAAQ,IAAI,OAAO,IAAIP,EAAW,QAAQ,sBAAuB,MAAM,CAAC,IAAK,IAAI,EACvFK,EAAWA,EAAS,QAAQE,EAAO,0DAA0D,EAC7FD,EAASA,EAAO,QAAQC,EAAO,0DAA0D,CAC7F,CAEA,MAAO;AAAA,iJACkIT,EAAI,IAAM,EAAE;AAAA;AAAA,oFAEzEO,CAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAOlEC,CAAM;AAAA;AAAA;AAAA;AAAA,SAK5B,CAEA,SAASH,GAAmB,CACxB,IAAMpB,EAAe,SAAS,iBAAiB,mBAAmB,EAC5DC,EAAiB,SAAS,iBAAiB,eAAe,EAEhED,EAAa,QAAQE,GAAO,CACxBA,EAAI,iBAAiB,QAAS,IAAM,CAChCF,EAAa,QAAQG,GAAK,CACtBA,EAAE,UAAU,OAAO,iBAAkB,oBAAqB,YAAY,EACtEA,EAAE,UAAU,IAAI,eAAgB,oBAAqB,iBAAkB,qBAAqB,CAChG,CAAC,EACDD,EAAI,UAAU,IAAI,iBAAkB,oBAAqB,YAAY,EACrEA,EAAI,UAAU,OAAO,eAAgB,oBAAqB,iBAAkB,qBAAqB,EAEjG,IAAME,EAAWF,EAAI,QAAQ,SAE7BD,EAAe,QAAQwB,GAAS,CACxBrB,IAAa,OAASqB,EAAM,QAAQ,WAAarB,EACjDqB,EAAM,UAAU,OAAO,QAAQ,EAE/BA,EAAM,UAAU,IAAI,QAAQ,CAEpC,CAAC,CACL,CAAC,CACL,CAAC,CACL,CAEA,SAASJ,GAAgB,CACJ,SAAS,iBAAiB,cAAc,EAEhD,QAAQ/B,GAAW,CACxBA,EAAQ,iBAAiB,QAAS,IAAM,CACpC,IAAMN,EAAOM,EAAQ,QAAQ,WAAW,EAClClB,EAAUY,EAAK,cAAc,cAAc,EAC3CuB,EAAOvB,EAAK,cAAc,WAAW,EACrCwB,EAAS,CAACpC,EAAQ,UAAU,SAAS,QAAQ,EAGnD,SAAS,iBAAiB,WAAW,EAAE,QAAQqC,GAAa,CACpDA,IAAczB,IACdyB,EAAU,cAAc,cAAc,GAAG,UAAU,IAAI,QAAQ,EAC/DA,EAAU,cAAc,WAAW,GAAG,UAAU,OAAO,YAAY,EAE3E,CAAC,EAGDrC,EAAQ,UAAU,OAAO,QAAQ,EACjCmC,EAAK,UAAU,OAAO,YAAY,CACtC,CAAC,CACL,CAAC,CACL,CAEA,SAASnD,GAAa,CAClB,IAAMY,EAAc,SAAS,eAAe,YAAY,EACxD,GAAI,CAACA,EAAa,OAElB,IAAI0D,EAAgB,KAEpB1D,EAAY,iBAAiB,QAAUO,GAAM,CACzC,IAAMoD,EAAQpD,EAAE,OAAO,MAAM,KAAK,EAAE,YAAY,EAEhD,aAAamD,CAAa,EAC1BA,EAAgB,WAAW,IAAM,CAI7B,GAFuB,SAAS,cAAc,mBAAmB,EAI7DE,EAAyBD,CAAK,UACvB7E,GAAc,OAAO,KAAKA,CAAU,EAAE,OAAS,EAAG,CAEzD,GAAI6E,EAAM,OAAS,EAAG,CAClBf,EAAW9D,CAAU,EACrB,MACJ,CAEA,IAAM+E,EAAW,CAAC,EAClB,OAAO,QAAQ/E,CAAU,EAAE,QAAQ,CAAC,CAACsD,EAAUM,CAAI,IAAM,CACrD,IAAMoB,EAAepB,EAAK,OAAOK,IAC7BA,GAAI,SAAS,YAAY,EAAE,SAASY,CAAK,GACzCZ,GAAI,OAAO,YAAY,EAAE,SAASY,CAAK,CAC3C,EACIG,EAAa,OAAS,IACtBD,EAASzB,CAAQ,EAAI0B,EAE7B,CAAC,EAEDlB,EAAWiB,EAAUF,CAAK,CAC9B,CACJ,EAAG,GAAG,CACV,CAAC,EAGD,IAAMI,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,UAAY,uGACjBA,EAAK,YAAc,oBACf/D,EAAY,gBACZA,EAAY,cAAc,MAAM,SAAW,WAC3CA,EAAY,cAAc,YAAY+D,CAAI,EAE1C/D,EAAY,iBAAiB,QAAS,IAAM+D,EAAK,UAAU,IAAI,QAAQ,CAAC,EACxE/D,EAAY,iBAAiB,OAAQ,IAAM+D,EAAK,UAAU,OAAO,QAAQ,CAAC,EAElF,CAEA,SAASH,EAAyBD,EAAO,CACrC,IAAMjC,EAAW,SAAS,iBAAiB,WAAW,EAChDO,EAAiB,SAAS,iBAAiB,eAAe,EAC1D+B,EAAY,SAAS,eAAe,YAAY,EAElDC,EAAe,EAEnBvC,EAAS,QAAQV,GAAQ,CACrB,IAAMkD,EAAalD,EAAK,cAAc,qCAAqC,EACrEmD,EAAYnD,EAAK,cAAc,oBAAoB,EAEnDsC,EAAWY,EAAaA,EAAW,YAAY,YAAY,EAAI,GAC/DX,EAASY,EAAYA,EAAU,YAAY,YAAY,EAAI,GAE7D,CAACR,GAASL,EAAS,SAASK,CAAK,GAAKJ,EAAO,SAASI,CAAK,GAC3D3C,EAAK,UAAU,OAAO,QAAQ,EAC9BiD,KAEAjD,EAAK,UAAU,IAAI,QAAQ,CAEnC,CAAC,EAGDiB,EAAe,QAAQI,GAAO,CAC1B,IAAM+B,EAAe/B,EAAI,iBAAiB,wBAAwB,EAClEA,EAAI,UAAU,OAAO,SAAU+B,EAAa,SAAW,CAAC,CAC5D,CAAC,EAGGJ,GACAA,EAAU,UAAU,OAAO,SAAUC,EAAe,CAAC,CAE7D,CAEA,SAASI,GAAU,CACfvF,EAAa,CAAC,EACdC,EAAU,CAAC,CACf,CAEA,MAAO,CACH,KAAAC,EACA,QAAAqF,CACJ,CACJ,GAAG,EAEH,OAAO,QAAU1F,GACVD,GAAQC,KCvtBf,IAAA2F,GAAA,GAAAC,GAAAD,GAAA,kBAAAE,KAIO,SAASA,GAAaC,EAAU,CAEnC,IAAMC,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAO,eAAeD,EAAS,IAAI,IACxCC,EAAK,UAAY,cAGjB,IAAMC,EAAY,SAAS,cAAc,KAAK,EAC9CA,EAAU,UAAY,gEAGtB,IAAIC,EAAS,GAcb,GAZI,OAAOH,EAAS,WAAc,UAAYA,EAAS,UAAWG,EAASH,EAAS,UAC3E,OAAOA,EAAS,OAAU,UAAYA,EAAS,MAAOG,EAASH,EAAS,MACxEA,EAAS,OAAS,OAAOA,EAAS,OAAU,SAAUG,EAASH,EAAS,MAAM,KAAOA,EAAS,MAAM,KAAOA,EAAS,WAAa,GACjI,OAAOA,EAAS,cAAiB,UAAYA,EAAS,aAAcG,EAASH,EAAS,aACtFA,EAAS,cAAgB,OAAOA,EAAS,cAAiB,SAAUG,EAASH,EAAS,aAAa,KAAOA,EAAS,aAAa,KAAO,GACvI,OAAOA,EAAS,YAAe,UAAYA,EAAS,WAAYG,EAASH,EAAS,WAClFA,EAAS,YAAc,OAAOA,EAAS,YAAe,SAAUG,EAASH,EAAS,WAAW,KAAOA,EAAS,WAAW,KAAO,GAC/H,OAAOA,EAAS,WAAc,UAAYA,EAAS,UAAWG,EAASH,EAAS,UAChFA,EAAS,WAAa,OAAOA,EAAS,WAAc,WAAUG,EAASH,EAAS,UAAU,KAAOA,EAAS,UAAU,KAAO,IAIhIG,EAAQ,CACR,IAAMC,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,IAAMD,EACVC,EAAI,IAAMJ,EAAS,MAAQ,GAC3BI,EAAI,UAAY,qFAChBA,EAAI,QAAU,OACdA,EAAI,SAAW,QAEfA,EAAI,QAAWC,GAAQ,CACnB,GAAI,CACAD,EAAI,OAAO,EACX,IAAME,EAAW,SAAS,cAAc,KAAK,EAC7CA,EAAS,UAAY,mGACrBA,EAAS,UAAY,ubACrBJ,EAAU,YAAYI,CAAQ,CAClC,MAAY,CAAC,CACjB,EACAJ,EAAU,YAAYE,CAAG,CAC7B,KAAO,CACH,IAAME,EAAW,SAAS,cAAc,KAAK,EAC7CA,EAAS,UAAY,mGACrBA,EAAS,UAAY,ubACrBJ,EAAU,YAAYI,CAAQ,CAClC,CAEA,IAAMC,EAAU,SAAS,cAAc,KAAK,EAE5CA,EAAQ,UAAY,oFACpBL,EAAU,YAAYK,CAAO,EAC7BN,EAAK,YAAYC,CAAS,EAE1B,IAAMM,EAAO,SAAS,cAAc,IAAI,EAKxC,GAJAA,EAAK,UAAY,qHACjBA,EAAK,YAAcR,EAAS,KAC5BC,EAAK,YAAYO,CAAI,EAEjBR,EAAS,cAAe,CACxB,IAAMS,EAAQ,SAAS,cAAc,GAAG,EACxCA,EAAM,UAAY,wDAClBA,EAAM,YAAc,GAAGT,EAAS,aAAa,YAC7CC,EAAK,YAAYQ,CAAK,CAC1B,CAEA,OAAOR,CACX,CAzEA,IAAAS,GAAAC,GAAA,QCAA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GA+hCCD,GApiCPE,GAAAC,GAAA,KAKMF,IAAY,UAAW,CACzB,aAEA,IAAIG,EAAqB,KACrBC,EAAmB,EACnBC,EAAsB,KACtBC,EAAoB,KAExB,eAAeC,GAAO,CAIlB,OAAO,SAAS,EAAG,CAAC,EAGpB,MAAM,QAAQ,IAAI,CACdC,EAAgB,EAChBC,EAAqB,EACrBC,EAAgB,CACpB,CAAC,EAGDC,EAAmB,EACnBC,EAAqB,EACrBC,EAAmB,EAInB,QAAQ,IAAI,CACRC,EAAuB,EACvBC,EAAgB,EAChBC,EAAiB,CACrB,CAAC,EAAE,MAAMC,GAAO,QAAQ,MAAM,qCAAsCA,CAAG,CAAC,EAGxE,WAAW,IAAM,CACbC,EAAuB,EACvBC,EAAsB,EACtBC,EAAmB,EACnBC,EAAuB,CAC3B,EAAG,GAAI,EAGP,GAAI,CACAC,EAAe,EACfC,EAAmB,CACvB,OAASC,EAAG,CACR,QAAQ,KAAK,iCAAkCA,CAAC,CACpD,CACJ,CAKA,SAASN,GAAyB,CAC9B,IAAMO,EAAY,SAAS,eAAe,eAAe,EACzD,GAAI,CAACA,EAAW,OAEhB,eAAeC,GAAsB,CACjC,GAAI,CAEA,IAAMC,EAAW,MAAM,OAAO,UAAU,IAAI,8BAA+B,CAAC,CAAC,EACvEC,EAAOD,EAAS,MAAQA,EAM9B,GAHAvB,EAAmBwB,EAAK,iBAAmBA,EAAK,OAAS,EAGrDxB,IAAqB,EAAG,CACxBqB,EAAU,UAAY,GACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mGAM6DrB,CAAgB;AAAA;AAAA,iBAGvG,OAASyB,EAAO,CACZ,QAAQ,KAAK,mCAAoCA,CAAK,EAEtDJ,EAAU,UAAY,EAC1B,CACJ,CAGAC,EAAoB,EACpB,YAAYA,EAAqB,GAAI,CACzC,CAKA,SAASP,GAAwB,CAE7B,IAAIW,EAAkB,CAAC,EACnBC,EAAQ,EACRC,EAAa,EACXC,EAAY,GAElB,eAAeC,GAAuB,CAClC,GAAI,CAEA,IAAMP,EAAW,MAAM,OAAO,UAAU,IAAI,+BAAgC,CAAC,CAAC,EAI9E,GAHAG,EAAkBH,EAAS,MAAQA,EAAS,WAAa,CAAC,EAGtDG,EAAgB,SAAW,EAC3B,OAIJ,WAAW,IAAM,CACbK,EAAU,EACV9B,EAAsB,YAAY,IAAM,CAChC2B,EAAaC,EAAWE,EAAU,EACjC,cAAc9B,CAAmB,CAC1C,EAAG,GAAK,CACZ,EAAG,GAAK,CACZ,OAASwB,EAAO,CACZ,QAAQ,KAAK,oCAAqCA,CAAK,CAE3D,CACJ,CAEA,SAASM,GAAY,CACjB,GAAIL,EAAgB,SAAW,GAAKE,GAAcC,EAAW,OAE7D,IAAMG,EAAQN,EAAgBC,CAAK,EACnC,GAAI,CAACK,EAAO,OAEZ,IAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,6NAGlB,IAAIC,EAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wFAM8DF,EAAM,OAAO;AAAA,qFAChBA,EAAM,QAAQ;AAAA;AAAA;AAAA,cAKvFC,EAAM,UAAY;AAAA,kBACZC,CAAO;AAAA;AAAA;AAAA;AAAA,cAMb,SAAS,KAAK,YAAYD,CAAK,EAC/BL,IAGA,sBAAsB,IAAM,CACxBK,EAAM,UAAU,OAAO,mBAAoB,WAAW,CAC1D,CAAC,EAGD,WAAW,IAAM,CACbA,EAAM,UAAU,IAAI,mBAAoB,WAAW,EACnD,WAAW,IAAMA,EAAM,OAAO,EAAG,GAAG,CACxC,EAAG,GAAI,EAEPN,GAASA,EAAQ,GAAKD,EAAgB,OAGlCE,GAAcC,GAAa5B,GAC3B,cAAcA,CAAmB,CAEzC,CAEA6B,EAAqB,CACzB,CAKA,SAASd,GAAqB,CAC1B,IAAMmB,EAAU,SAAS,eAAe,yBAAyB,EAC3Dd,EAAY,SAAS,eAAe,iBAAiB,EACrDe,EAAW,SAAS,eAAe,uBAAuB,EAEhE,GAAI,CAACD,GAAW,CAACd,EAAW,OAE5B,IAAMgB,EAAS,KAAK,MAAM,aAAa,QAAQ,gBAAgB,GAAK,IAAI,EAExE,GAAIA,EAAO,SAAW,EAAG,CACrBF,EAAQ,UAAU,IAAI,QAAQ,EAC9B,MACJ,CAEAA,EAAQ,UAAU,OAAO,QAAQ,EAEjCd,EAAU,UAAYgB,EAAO,MAAM,EAAG,CAAC,EAAE,IAAIC,GAAW,CACpD,IAAIC,EAAQ,KACZ,OAAID,EAAQ,kBAAoBA,EAAQ,iBAAmB,IACvDC,EAAQ,IAAID,EAAQ,gBAAgB,KAEjC,YAAY,OAAOA,EAAS,CAAE,UAAW,CAAC,CAACC,EAAO,MAAAA,EAAO,UAAW,OAAQ,CAAC,CACxF,CAAC,EAAE,KAAK,EAAE,EAEV,YAAY,WAAWlB,CAAS,EAEhCe,GAAU,iBAAiB,QAAS,IAAM,CACtC,aAAa,WAAW,gBAAgB,EACxCD,EAAQ,UAAU,IAAI,QAAQ,EAC9B,MAAM,QAAQ,+BAA+B,CACjD,CAAC,CACL,CAKA,SAASlB,GAAyB,CAC9B,IAAMkB,EAAU,SAAS,eAAe,oBAAoB,EACtDK,EAAY,SAAS,eAAe,sBAAsB,EAEhE,GAAI,CAACL,GAAW,CAACK,EAAW,OAK5B,GAAI,CAFgB,aAAa,QAAQ,cAAc,EAErC,CAEd,IAAMC,EAAU,IAAI,KAAK,EAAE,QAAQ,EAAK,MACxC,aAAa,QAAQ,eAAgBA,EAAQ,SAAS,CAAC,CAC3D,CAEA,IAAMA,EAAU,SAAS,aAAa,QAAQ,cAAc,CAAC,EAE7D,SAASC,GAAkB,CACvB,IAAMC,EAAM,IAAI,KAAK,EAAE,QAAQ,EACzBC,EAAWH,EAAUE,EAE3B,GAAIC,GAAY,EAAG,CACfT,EAAQ,UAAU,IAAI,QAAQ,EAC9B,cAAcjC,CAAiB,EAC/B,aAAa,WAAW,cAAc,EACtC,MACJ,CAEAiC,EAAQ,UAAU,OAAO,QAAQ,EAEjC,IAAMU,EAAQ,KAAK,MAAOD,GAAY,IAAO,GAAK,GAAK,KAAQ,IAAO,GAAK,GAAG,EACxEE,EAAU,KAAK,MAAOF,GAAY,IAAO,GAAK,KAAQ,IAAO,GAAG,EAChEG,GAAU,KAAK,MAAOH,GAAY,IAAO,IAAO,GAAI,EAE1DJ,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,0FAIwDK,EAAM,SAAS,EAAE,SAAS,EAAG,GAAG,CAAC;AAAA;AAAA,0FAEjCC,EAAQ,SAAS,EAAE,SAAS,EAAG,GAAG,CAAC;AAAA;AAAA,0FAEnCC,GAAQ,SAAS,EAAE,SAAS,EAAG,GAAG,CAAC;AAAA;AAAA;AAAA,aAIrH,CAEAL,EAAgB,EAChBxC,EAAoB,YAAYwC,EAAiB,GAAI,CACzD,CAuEA,SAASlC,GAAuB,CAC5B,IAAMwC,EAAmB,SAAS,iBAAiB,gBAAgB,EAEnE,GAAI,CAACA,EAAiB,OAAQ,OAE9B,IAAMC,EAAW,IAAI,qBAAsBC,GAAY,CACnDA,EAAQ,QAAQC,GAAS,CACrB,GAAIA,EAAM,eAAgB,CACtB,IAAMC,EAAYD,EAAM,OAAO,QAAQ,SAAW,WAClDA,EAAM,OAAO,UAAU,IAAI,WAAaC,CAAS,EACjDD,EAAM,OAAO,UAAU,OAAO,WAAW,EACzCF,EAAS,UAAUE,EAAM,MAAM,CACnC,CACJ,CAAC,CACL,EAAG,CACC,UAAW,GACX,WAAY,mBAChB,CAAC,EAEDH,EAAiB,QAAQK,GAAM,CAC3BA,EAAG,UAAU,IAAI,WAAW,EAC5BJ,EAAS,QAAQI,CAAE,CACvB,CAAC,CACL,CAKA,SAAS5C,GAAqB,CAC1B,SAAS,iBAAiB,QAAS,MAAOW,GAAM,CAC5C,IAAMkC,EAAelC,EAAE,OAAO,QAAQ,mBAAmB,EACzD,GAAI,CAACkC,EAAc,OAEnB,IAAMC,EAAYD,EAAa,QAAQ,UACvC,GAAI,CAACC,EAAW,OAEhBnC,EAAE,eAAe,EAGjB,IAAMoC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,mBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAWlB,SAAS,KAAK,YAAYA,CAAK,EAE/B,GAAI,CACA,IAAMjC,EAAW,MAAM,YAAY,WAAWgC,CAAS,EACjDjB,EAAUf,EAAS,MAAQA,EAE3BkC,EAAeD,EAAM,cAAc,WAAW,EACpDC,EAAa,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wCAMDnB,EAAQ,eAAiBA,EAAQ,OAAS,gCAAgC,UAAU,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA,iGAG7D,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA,sCAG7F,ibAAib,OAAO,KAAK,MAAMA,EAAQ,QAAU,CAAC,CAAC,CAAC;AAAA;AAAA,4FAElaA,EAAQ,cAAgB,CAAC;AAAA;AAAA;AAAA,kCAGnFA,EAAQ,YAAcA,EAAQ,iBAAmB;AAAA,4GACyB,UAAU,YAAYA,EAAQ,YAAcA,EAAQ,gBAAgB,CAAC;AAAA,6FACpF,UAAU,YAAYA,EAAQ,KAAK,CAAC;AAAA,kCAC7F;AAAA,sGACkE,UAAU,YAAYA,EAAQ,KAAK,CAAC;AAAA,iCACzG;AAAA;AAAA,8FAE6D,UAAU,WAAWA,EAAQ,mBAAqBA,EAAQ,aAAe,EAAE,CAAC;AAAA;AAAA,sLAEYA,EAAQ,EAAE;AAAA;AAAA;AAAA,qDAG3IA,EAAQ,MAAQA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAOnE,OAASb,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,EAC9C+B,EAAM,OAAO,EACb,MAAM,MAAM,gCAAgC,CAChD,CACJ,CAAC,CACL,CAGI,eAAe5C,GAAmB,CAC9B,IAAMS,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAKA,EACL,QAAO,KAAKA,EAAW,UAAU,EACjC,GAAI,CAGA,IAAIqC,EAAkB,MAAM,YAAY,WAAW,KAAM,CAAE,SAAU,EAAG,QAAS,SAAU,CAAC,EACxFC,EAAaD,GAAiB,MAAM,SAAWA,GAAiB,MAAQA,GAAiB,SAAW,CAAC,EAGzG,GADArC,EAAU,UAAY,GAClB,CAACsC,EAAW,OAAQ,CACpBtC,EAAU,UAAY,2EACtB,MACJ,CAGAsC,EAAaA,EAAW,MAAM,EAAG,CAAC,EAClCA,EAAW,QAAQC,GAAU,CACzB,IAAMC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,wEACjBA,EAAK,UAAY;AAAA;AAAA;AAAA,kCAGHD,EAAO,MAAM,aAAa,CAAC,GAAKA,EAAO,MAAM,WAAW,CAAC,GAAK,GAAG;AAAA;AAAA;AAAA,2FAGRA,EAAO,MAAM,YAAcA,EAAO,MAAM,UAAY,WAAW;AAAA,yFACjEA,EAAO,WAAa,IAAI,KAAKA,EAAO,UAAU,EAAE,mBAAmB,EAAI,EAAE;AAAA;AAAA;AAAA;AAAA,8BAIpI,gcAAgc,OAAO,KAAK,MAAMA,EAAO,QAAU,CAAC,CAAC,CAAC;AAAA;AAAA,wFAE5a,UAAU,WAAWA,EAAO,OAAS,EAAE,CAAC;AAAA,iFAC/C,UAAU,WAAWA,EAAO,SAAW,EAAE,CAAC;AAAA,sBAEvGvC,EAAU,YAAYwC,CAAI,CAC9B,CAAC,CACL,OAASpC,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,EACnDJ,EAAU,UAAY,8FAC1B,EACR,CACA,eAAeV,GAAkB,CAC7B,IAAMU,EAAY,SAAS,eAAe,cAAc,EACxD,GAAI,CAACA,EAAW,OAEhB,IAAMyC,EAAOzC,EAAU,cAAc,gBAAgB,GAAKA,EAC1D,OAAO,KAAKyC,EAAM,UAAU,EAE5B,GAAI,CAEA,IAAMvC,EAAW,MAAM,YAAY,YAAY,CAAE,WAAY,GAAM,SAAU,CAAE,CAAC,EAC1EwC,EAAWxC,EAAS,MAAM,SAAWA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAEjF,GAAIwC,EAAS,SAAW,EAAG,CACvBD,EAAK,UAAY,2EACjB,MACJ,CAEAA,EAAK,UAAYC,EAAS,IAAIzB,GAAW,CAErC,IAAIC,EAAQ,KACZ,OAAID,EAAQ,kBAAoBA,EAAQ,iBAAmB,IACvDC,EAAQ,IAAID,EAAQ,gBAAgB,KAEjC,YAAY,OAAOA,EAAS,CAAE,UAAW,CAAC,CAACC,EAAO,MAAAA,EAAO,UAAW,OAAQ,CAAC,CACxF,CAAC,EAAE,KAAK,EAAE,EACV,YAAY,WAAWuB,CAAI,CAC/B,OAASrC,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,EACnDqC,EAAK,UAAY,+FACrB,CACJ,CAEA,eAAe1D,GAAkB,CAC7B,IAAMiB,EAAY,SAAS,eAAe,aAAa,EACvD,GAAKA,EAEL,GAAI,CACA,IAAME,EAAW,MAAM,SAAS,WAAW,WAAW,EAChDyC,EAAUzC,EAAS,MAAM,SAAWA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAEhF,GAAIyC,EAAQ,SAAW,EAAG,CACtB3C,EAAU,UAAY,GACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA,0BAGR2C,EAAQ,IAAI,CAACC,EAAQtC,IAAU;AAAA,qDACJA,IAAU,EAAI,GAAK,QAAQ,+BAA+BA,CAAK;AAAA,2CACzEsC,EAAO,UAAY,GAAG;AAAA;AAAA,+CAElBA,EAAO,KAAK;AAAA,+CACZ,UAAU,WAAWA,EAAO,OAAS,EAAE,CAAC;AAAA;AAAA,mDAEpCtC,IAAU,EAAI,QAAU,MAAM;AAAA;AAAA;AAAA,sCAG3CsC,EAAO,OAASA,EAAO,SAAW;AAAA;AAAA;AAAA,kDAGtBA,EAAO,MAAQ,0EAA0E,UAAU,WAAWA,EAAO,KAAK,CAAC,QAAU,EAAE;AAAA,kDACvIA,EAAO,SAAW,oDAAoD,UAAU,WAAWA,EAAO,QAAQ,CAAC,OAAS,EAAE;AAAA,kDACrHA,EAAO,WAAaA,EAAO,YAAe;AAAA;AAAA,0DAEnC,UAAU,WAAWA,EAAO,WAAaA,EAAO,WAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,kDAKlE,EAAE;AAAA;AAAA;AAAA,sCAGd,EAAE;AAAA;AAAA;AAAA,yBAGjB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,sBAEbD,EAAQ,OAAS,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAYbA,EAAQ,IAAI,CAACE,EAAGvC,IAAU;AAAA,wFACgCA,IAAU,EAAI,6BAA+B,+EAA+E,iBAAiBA,CAAK,6BAA6BA,EAAQ,CAAC;AAAA,6BACnP,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,sBAEf,EAAE;AAAA;AAAA,cAIVqC,EAAQ,OAAS,GACjBG,EAAeH,EAAQ,MAAM,CAErC,OAASvC,EAAO,CAEZ,QAAQ,KAAK,4BAA6BA,GAAO,QAAUA,CAAK,CACpE,CACJ,CAEA,SAAS0C,EAAeC,EAAa,CACjC,IAAIC,EAAe,EACbC,EAAS,SAAS,iBAAiB,aAAa,EAChDC,EAAO,SAAS,iBAAiB,mBAAmB,EACpDC,EAAU,SAAS,cAAc,YAAY,EAC7CC,EAAU,SAAS,cAAc,YAAY,EAEnD,SAASC,EAAU/C,EAAO,CACtB2C,EAAOD,CAAY,EAAE,UAAU,IAAI,QAAQ,EAC3CE,EAAKF,CAAY,GAAG,UAAU,OAAO,cAAc,EACnDE,EAAKF,CAAY,GAAG,UAAU,IAAI,aAAa,EAE/CA,GAAgB1C,EAAQyC,GAAeA,EAEvCE,EAAOD,CAAY,EAAE,UAAU,OAAO,QAAQ,EAC9CE,EAAKF,CAAY,GAAG,UAAU,IAAI,cAAc,EAChDE,EAAKF,CAAY,GAAG,UAAU,OAAO,aAAa,CACtD,CAEAG,GAAS,iBAAiB,QAAS,IAAM,CACrCE,EAAUL,EAAe,CAAC,EAC1BM,EAAc,CAClB,CAAC,EAEDF,GAAS,iBAAiB,QAAS,IAAM,CACrCC,EAAUL,EAAe,CAAC,EAC1BM,EAAc,CAClB,CAAC,EAEDJ,EAAK,QAAQ,CAACK,EAAKjD,KAAU,CACzBiD,EAAI,iBAAiB,QAAS,IAAM,CAChCF,EAAU/C,EAAK,EACfgD,EAAc,CAClB,CAAC,CACL,CAAC,EAED,SAASA,GAAgB,CACjB5E,GACA,cAAcA,CAAkB,EAEpCA,EAAqB,YAAY,IAAM2E,EAAUL,EAAe,CAAC,EAAG,GAAI,CAC5E,CAGA,GAAI,CACA,IAAMQ,EAAkB,SAAS,cAAc,cAAc,EACzDC,GAAc,EAClBD,GAAiB,iBAAiB,aAAezD,IAAM,CACnD0D,GAAc1D,GAAE,QAAQ,CAAC,EAAE,OAC/B,EAAG,CAAE,QAAS,EAAK,CAAC,EACpByD,GAAiB,iBAAiB,WAAazD,IAAM,CAEjD,IAAM2D,GADY3D,GAAE,eAAe,CAAC,EAAE,QACf0D,GACnB,KAAK,IAAIC,EAAE,EAAI,KACXA,GAAK,EACLL,EAAUL,EAAe,CAAC,EAE1BK,EAAUL,EAAe,CAAC,EAE9BM,EAAc,EAEtB,CAAC,CACL,MAAc,CAEd,CAEAA,EAAc,CAClB,CAEA,eAAetE,GAAuB,CAClC,IAAMgB,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAI,CAACA,EAAW,OAEhB,IAAMyC,EAAOzC,EAAU,cAAc,gBAAgB,GAAKA,EAC1D,OAAO,KAAKyC,EAAM,UAAU,EAE5B,GAAI,CACA,IAAMvC,EAAW,MAAM,YAAY,YAAY,CAAC,EAC1CwC,EAAWxC,EAAS,MAAM,SAAWA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAEjF,GAAIwC,EAAS,SAAW,EAAG,CACvBD,EAAK,UAAY,gFACjB,MACJ,CAEAA,EAAK,UAAYC,EAAS,IAAIzB,GAAW,CACrC,IAAIC,EAAQ,KACZ,OAAID,EAAQ,kBAAoBA,EAAQ,iBAAmB,IACvDC,EAAQ,IAAID,EAAQ,gBAAgB,KAEjC,YAAY,OAAOA,EAAS,CAAE,UAAW,CAAC,CAACC,EAAO,MAAAA,EAAO,UAAW,OAAQ,CAAC,CACxF,CAAC,EAAE,KAAK,EAAE,EACV,YAAY,WAAWuB,CAAI,CAC/B,OAASrC,EAAO,CACZ,QAAQ,MAAM,oCAAqCA,CAAK,EACxDqC,EAAK,UAAY,+FACrB,CACJ,CAEA,eAAepD,GAAyB,CACpC,IAAMW,EAAY,SAAS,eAAe,qBAAqB,EAC/D,GAAKA,EAIL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CAEA,GAAI,CAAE,OAAO,WAAW,WAAW,6BAA6B,CAAG,MAAY,CAAC,CAChF,IAAME,EAAW,MAAM,OAAO,UAAU,IAAI,uBAAwB,CAAE,UAAW,EAAG,YAAa,EAAK,EAAG,CAAE,SAAU,EAAM,CAAC,EAEtHyD,EAAazD,EAAS,MAAM,SAAWA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAEnF,GAAIyD,EAAW,SAAW,EAAG,CACzB3D,EAAU,UAAY,GACtB,MACJ,CAGA,IAAI4D,EACJ,GAAI,CACAA,GAAgB,KAAM,wCAAyC,YACnE,OAAS7D,EAAG,CACR,QAAQ,MAAM,iCAAkCA,CAAC,EACjD,MACJ,CAEAC,EAAU,UAAY,GAEtB2D,EAAW,QAAQE,GAAY,CAC3B,IAAMrB,EAAOoB,EAAaC,CAAQ,EAElC,GAAI,CACA,IAAMC,EAAQtB,EAAK,cAAc,KAAK,EACtC,QAAQ,KAAK,wBAAyBqB,EAAS,KAAMC,EAAQA,EAAM,IAAM,UAAU,CACvF,MAAY,CAA8B,CAC1C9D,EAAU,YAAYwC,CAAI,CAC9B,CAAC,EACDxC,EAAU,UAAU,IAAI,OAAO,cAAc,iBAAiB,iBAAiB,iBAAiB,QAAQ,UAAU,CACtH,OAASI,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EACjDJ,EAAU,UAAY,EAC1B,EACJ,CAEA,eAAef,GAAkB,CAC7B,IAAMe,EAAY,SAAS,eAAe,cAAc,EACxD,GAAI,CAACA,EAAW,OAEhB,IAAMyC,EAAOzC,EAAU,cAAc,gBAAgB,GAAKA,EAC1D,OAAO,KAAKyC,EAAM,UAAU,EAE5B,GAAI,CACA,IAAMvC,EAAW,MAAM,YAAY,eAAe,CAAC,EAC7CwC,EAAWxC,EAAS,MAAM,SAAWA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAEjF,GAAIwC,EAAS,SAAW,EAAG,CACvBD,EAAK,UAAY,2EACjB,MACJ,CAEAA,EAAK,UAAYC,EAAS,IAAIzB,GAAW,CACrC,IAAIC,EAAQ,KACZ,OAAID,EAAQ,kBAAoBA,EAAQ,iBAAmB,IACvDC,EAAQ,IAAID,EAAQ,gBAAgB,KAEjC,YAAY,OAAOA,EAAS,CAAE,UAAW,CAAC,CAACC,EAAO,MAAAA,EAAO,UAAW,OAAQ,CAAC,CACxF,CAAC,EAAE,KAAK,EAAE,EACV,YAAY,WAAWuB,CAAI,CAC/B,OAASrC,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,EACnDqC,EAAK,UAAY,uEACrB,CACJ,CAEA,eAAe5C,GAAiB,CAC5B,IAAMG,EAAY,SAAS,eAAe,mBAAmB,GAAK,SAAS,eAAe,mBAAmB,EAC7G,GAAKA,EAEL,GAAI,CACA,IAAME,EAAW,MAAM,SAAS,cAAc,EAC1C6D,EAAa7D,GAAU,MAAM,SAAWA,GAAU,SAAWA,GAAU,MAAQ,CAAC,EASpF,GARK,MAAM,QAAQ6D,CAAU,IACrBA,GAAc,OAAOA,GAAe,SACpCA,EAAa,MAAM,QAAQA,EAAW,KAAK,EAAIA,EAAW,MAAQ,CAACA,CAAU,EAE7EA,EAAa,CAAC,GAIlBA,EAAW,SAAW,EAAG,CACzB/D,EAAU,UAAY,GACtB,MACJ,CAEA,IAAMgE,EAAQD,EAAW,CAAC,GAAK,CAAC,EAChC/D,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAQA,UAAU,WAAWgE,EAAM,OAASA,EAAM,MAAQ,EAAE,CAAC;AAAA;AAAA,8BAEzDA,EAAM,YAAc;AAAA,oEACkB,UAAU,WAAWA,EAAM,WAAW,CAAC;AAAA,8BAC3E,EAAE;AAAA,8BACJA,EAAM,eAAiB;AAAA;AAAA,sCAEfA,EAAM,gBAAkB,aAAe,GAAGA,EAAM,cAAc,QAAU,QAAQ,UAAU,YAAYA,EAAM,cAAc,CAAC,EAAE;AAAA;AAAA,8BAEnI,EAAE;AAAA;AAAA;AAAA,8BAGJA,EAAM,KAAO;AAAA;AAAA;AAAA,wGAG6D,UAAU,WAAWA,EAAM,IAAI,CAAC;AAAA;AAAA,8BAExG,EAAE;AAAA,4DAC0BA,EAAM,IAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAUlE,OAAS5D,EAAO,CACZ,QAAQ,KAAK,0BAA2BA,GAAO,QAAUA,CAAK,EAC9DJ,EAAU,UAAY,EAC1B,CACJ,CAEA,eAAeF,GAAqB,CAChC,IAAME,EAAY,SAAS,eAAe,kBAAkB,EAG5D,GAFI,CAACA,GAEDA,EAAU,SAAS,OAAQ,OAC/BA,EAAU,QAAQ,OAAS,IAG3BA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAYtB,IAAMiE,EAAW,OAAO,gBAAkB,CAAC,EACrCC,EAAYD,EAAS,iBAAmB,qBACxCE,EAAaF,EAAS,kBAAoB,cAEhD,GAAI,CAEA,IAAIN,EAAa,CAAC,EAClB,GAAI,OAAO,aAAiB,KAAe,aAAa,cACpD,GAAI,CACA,IAAMzD,EAAW,MAAM,aAAa,cAAc,CAAE,SAAU,GAAM,SAAU,CAAE,CAAC,EACjFyD,EAAazD,GAAU,MAAM,SAAWA,GAAU,MAAQA,GAAU,SAAW,CAAC,CACpF,OAASH,EAAG,CACR,QAAQ,KAAK,oCAAqCA,CAAC,CACvD,CAGJC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAwCJ2D,EAAW,OAAS,EAAI;AAAA;AAAA;AAAA;AAAA,0CAIZA,EAAW,MAAM,EAAG,CAAC,EAAE,IAAIS,GAAO;AAAA,uDACrBD,CAAU,YAAYC,EAAI,IAAI;AAAA,kDACnCA,EAAI,KAAO,SAASA,EAAI,IAAI,UAAY,EAAE;AAAA,kDAC1C,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA;AAAA,yCAEvC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,8BAGnB,EAAE;AAAA;AAAA,2CAESF,CAAS;AAAA;AAAA;AAAA;AAAA,2CAITC,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aA6C7C,OAAS/D,EAAO,CACZ,QAAQ,KAAK,mCAAoCA,CAAK,EAEtDJ,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,+BAIHkE,CAAS;AAAA;AAAA;AAAA;AAAA,aAKhC,CACJ,CAEA,SAAShF,GAAqB,CAE1B,IAAMmF,EAAO,SAAS,eAAe,iBAAiB,GAAK,SAAS,eAAe,sBAAsB,EACpGA,GAELA,EAAK,iBAAiB,SAAU,MAAOtE,GAAM,CACzCA,EAAE,eAAe,EAEjB,IAAMuE,EAAaD,EAAK,cAAc,qBAAqB,EACrDE,EAAYF,EAAK,cAAc,uBAAuB,EACtDG,EAAQF,GAAY,OAAO,KAAK,EAEtC,GAAI,CAACE,EAAO,CACR,MAAM,MAAM,kCAAkC,EAC9C,MACJ,CAEA,IAAMC,EAAeF,EAAU,YAC/BA,EAAU,SAAW,GACrBA,EAAU,UAAY,6VAEtB,GAAI,CACA,MAAM,WAAW,kBAAkB,CAAE,MAAAC,EAAO,KAAM,YAAa,CAAC,EAChE,MAAM,QAAQ,4BAA4B,EAC1CF,EAAW,MAAQ,EACvB,OAASlE,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wCAAwC,CACzE,QAAE,CACEmE,EAAU,SAAW,GACrBA,EAAU,YAAcE,CAC5B,CACJ,CAAC,CACL,CAEA,SAASC,GAAU,CACXhG,IACA,cAAcA,CAAkB,EAChCA,EAAqB,MAErBE,IACA,cAAcA,CAAmB,EACjCA,EAAsB,MAEtBC,IACA,cAAcA,CAAiB,EAC/BA,EAAoB,MAGxB,SAAS,eAAe,kBAAkB,GAAG,OAAO,EAEpD,SAAS,iBAAiB,qBAAqB,EAAE,QAAQmD,GAAMA,EAAG,OAAO,CAAC,CAC9E,CAEA,MAAO,CACH,KAAAlD,EACA,QAAA4F,EAEA,mBAAA/E,EACA,uBAAAC,CACJ,CACJ,GAAG,EAEH,OAAO,SAAWrB,GACXD,GAAQC,KCpiCf,IAAAoG,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAucCD,GA5cPE,GAAAC,GAAA,KAKMF,IAAc,UAAW,CAC3B,aAEA,IAAIG,EAAc,EACdC,EAAgB,MAEpB,eAAeC,GAAO,CAClB,GAAI,CAAC,UAAU,YAAY,EAAG,OAE9B,IAAMC,EAAUC,EAAkB,EAC9BD,EACA,MAAME,EAAgBF,CAAO,GAE7B,MAAMG,EAAW,EACjBC,EAAY,EAEpB,CAEA,SAASH,GAAoB,CAEzB,IAAMI,EADO,OAAO,SAAS,SACV,MAAM,oBAAoB,EAC7C,OAAOA,EAAQA,EAAM,CAAC,EAAI,IAC9B,CAEA,eAAeF,GAAa,CACxB,IAAMG,EAAY,SAAS,eAAe,aAAa,EACvD,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CACA,IAAMC,EAAS,CACX,KAAMV,EACN,MAAO,EACX,EAEIC,IAAkB,QAClBS,EAAO,OAAST,GAGpB,IAAMU,EAAW,MAAM,UAAU,OAAOD,CAAM,EACxCE,EAASD,EAAS,MAAQ,CAAC,EAC3BE,EAAOF,EAAS,MAAQ,CAAC,EAE/BG,EAAaF,EAAQC,CAAI,CAC7B,OAASE,EAAO,CACZ,QAAQ,MAAM,yBAA0BA,CAAK,EAC7CN,EAAU,UAAY,qEAC1B,EACJ,CAEA,SAASK,EAAaF,EAAQC,EAAM,CAChC,IAAMJ,EAAY,SAAS,eAAe,aAAa,EACvD,GAAI,CAACA,EAAW,OAEhB,GAAIG,EAAO,SAAW,EAAG,CACrBH,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAYtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA,kBAEZG,EAAO,IAAII,GAASC,EAAgBD,CAAK,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAExDH,EAAK,YAAc,EAAI;AAAA,2DACsB,WAAW,OAAO,CACzD,YAAaA,EAAK,cAAgBb,EAClC,WAAYa,EAAK,YACjB,WAAYA,EAAK,KACrB,CAAC,CAAC;AAAA,cACF,EAAE;AAAA,UAGkB,SAAS,eAAe,mBAAmB,GAClD,iBAAiB,QAAUK,GAAM,CAClD,IAAMC,EAAUD,EAAE,OAAO,QAAQ,aAAa,EAC1CC,IACAnB,EAAc,SAASmB,EAAQ,QAAQ,IAAI,EAC3Cb,EAAW,EACX,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,EAEtD,CAAC,CACL,CAEA,SAASW,EAAgBD,EAAO,CAU5B,IAAMI,EATgB,CAClB,QAAS,2EACT,WAAY,mEACZ,QAAS,2EACT,UAAW,uEACX,UAAW,+DACX,SAAU,+DACd,EAEkCJ,EAAM,MAAM,GAAK,gEAC7CK,EAAQL,EAAM,OAAS,CAAC,EACxBM,EAAeD,EAAM,MAAM,EAAG,CAAC,EAC/BE,EAAiBF,EAAM,OAAS,EAGhCG,EAAQ,CAAC,UAAW,aAAc,UAAW,WAAW,EACxDC,EAAmBD,EAAM,QAAQR,EAAM,MAAM,EAC7CU,EAAcV,EAAM,SAAW,aAAeA,EAAM,SAAW,WAErE,MAAO;AAAA;AAAA;AAAA;AAAA,sFAIuE,UAAU,WAAWA,EAAM,cAAgBA,EAAM,EAAE,CAAC;AAAA,yFACjD,UAAU,WAAWA,EAAM,UAAU,CAAC;AAAA;AAAA;AAAA,kFAG7CI,CAAW;AAAA,8BAC/D,UAAU,WAAWJ,EAAM,gBAAkBA,EAAM,MAAM,CAAC;AAAA;AAAA,2CAE7CA,EAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOhCU,EAeC,GAfa;AAAA;AAAA;AAAA;AAAA,gLAI+I,KAAK,IAAI,EAAID,GAAoBD,EAAM,OAAS,GAAM,GAAG,CAAC;AAAA,8BAC5MA,EAAM,IAAI,CAACG,EAAMC,IAAM;AAAA;AAAA,4HAEuEA,GAAKH,EAAmB,8CAAgD,mEAAmE;AAAA,0CAC7NG,EAAIH,EAAmB,4OAA+OG,EAAI,CAAE;AAAA;AAAA,+HAEvLD,CAAI;AAAA;AAAA,6BAEtG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,iBAGjB;AAAA;AAAA;AAAA;AAAA,0BAIIL,EAAa,IAAIO,GAAQ;AAAA;AAAA;AAAA,sCAGbA,EAAK,SAAS,MAAQ,aAAaA,EAAK,QAAQ,KAAK,yhBAA2hB,8ZAA8Z;AAAA;AAAA;AAAA,mGAGj7B,UAAU,WAAWA,EAAK,SAAS,MAAQA,EAAK,YAAY,CAAC;AAAA,gGAChEA,EAAK,QAAQ;AAAA;AAAA;AAAA,yBAGpF,EAAE,KAAK,EAAE,CAAC;AAAA,0BACTN,EAAiB,EAAI;AAAA;AAAA,2FAE4CA,CAAc;AAAA;AAAA,0BAE7E,EAAE;AAAA;AAAA;AAAA;AAAA,8BAIAF,EAAM,MAAM,IAAIA,EAAM,SAAW,EAAI,OAAS,OAAO;AAAA;AAAA,wEAEX,UAAU,YAAYL,EAAM,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA,SAKtG,CAEA,eAAeX,EAAgBF,EAAS,CACpC,IAAMM,EAAY,SAAS,eAAe,cAAc,EACxD,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CAEA,IAAMO,GADW,MAAM,UAAU,QAAQb,CAAO,GACzB,KAEvB,GAAI,CAACa,EAAO,CACR,OAAO,SAAS,KAAO,WACvB,MACJ,CAEAc,EAAkBd,CAAK,CAC3B,OAASD,EAAO,CACZ,QAAQ,MAAM,wBAAyBA,CAAK,EAC5CN,EAAU,UAAY,4EAC1B,EACJ,CAEA,SAASqB,EAAkBd,EAAO,CAC9B,IAAMP,EAAY,SAAS,eAAe,cAAc,EACxD,GAAI,CAACA,EAAW,OAWhB,IAAMW,EATgB,CAClB,QAAS,gCACT,WAAY,4BACZ,QAAS,gCACT,UAAW,8BACX,UAAW,0BACX,SAAU,2BACd,EAEkCJ,EAAM,MAAM,GAAK,4BAC7CK,EAAQL,EAAM,OAAS,CAAC,EAE9BP,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iFAcmD,UAAU,WAAWO,EAAM,cAAgBA,EAAM,EAAE,CAAC;AAAA,yEAC5D,UAAU,WAAWA,EAAM,UAAU,CAAC;AAAA;AAAA,oFAE3BI,CAAW;AAAA,8BACjE,UAAU,WAAWJ,EAAM,gBAAkBA,EAAM,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMtEA,EAAM,UAAYA,EAAM,SAAS,OAAS,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAM9BA,EAAM,SAAS,IAAI,CAACe,EAAOC,IAAU;AAAA;AAAA,2FAEoBA,IAAU,EAAI,iBAAmB,aAAa;AAAA,uFAClD,UAAU,WAAWD,EAAM,MAAM,CAAC;AAAA,2EAC9C,UAAU,WAAWA,EAAM,UAAW,CAAE,YAAa,EAAK,CAAC,CAAC;AAAA,0CAC7FA,EAAM,KAAO,yCAAyC,UAAU,WAAWA,EAAM,IAAI,CAAC,OAAS,EAAE;AAAA;AAAA,iCAE1G,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,kBAIvB,EAAE;AAAA;AAAA;AAAA,kBAGJf,EAAM,gBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA,6EAKmC,UAAU,WAAWA,EAAM,eAAe,CAAC;AAAA;AAAA,8BAE1FA,EAAM,aAAe;AAAA,2CACRA,EAAM,YAAY;AAAA;AAAA;AAAA,8BAG7B,EAAE;AAAA;AAAA;AAAA,kBAGd,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAMIK,EAAM,IAAIQ,GAAQ;AAAA;AAAA;AAAA,sCAGNA,EAAK,SAAS,MAAQ,aAAaA,EAAK,QAAQ,KAAK,mFAAqF,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,oFAK9F,UAAU,WAAWA,EAAK,SAAS,MAAQA,EAAK,YAAY,CAAC;AAAA,8CACnGA,EAAK,QAAU,oCAAoC,UAAU,WAAWA,EAAK,QAAQ,MAAQA,EAAK,YAAY,CAAC,OAAS,EAAE;AAAA,oFACpFA,EAAK,QAAQ;AAAA;AAAA,+EAElB,UAAU,YAAYA,EAAK,MAAQA,EAAK,QAAQ,CAAC;AAAA;AAAA,sCAE1FA,EAAK,SAAS,KAAO;AAAA,6DACEA,EAAK,QAAQ,IAAI;AAAA;AAAA;AAAA,sCAGtC,EAAE;AAAA;AAAA;AAAA,yBAGjB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAQTb,EAAM,iBAAmB;AAAA,+DACY,UAAU,WAAWA,EAAM,iBAAiB,WAAa,GAAGA,EAAM,iBAAiB,UAAU,IAAIA,EAAM,iBAAiB,SAAS,EAAE,CAAC;AAAA,+DACpI,UAAU,WAAWA,EAAM,iBAAiB,cAAc,CAAC;AAAA,8BAC5FA,EAAM,iBAAiB,eAAiB,oCAAoC,UAAU,WAAWA,EAAM,iBAAiB,cAAc,CAAC,OAAS,EAAE;AAAA,+DACjH,UAAU,WAAWA,EAAM,iBAAiB,IAAI,CAAC,KAAK,UAAU,WAAWA,EAAM,iBAAiB,OAAS,EAAE,CAAC,IAAI,UAAU,WAAWA,EAAM,iBAAiB,WAAW,CAAC;AAAA,+DAC1K,UAAU,WAAWA,EAAM,iBAAiB,OAAO,CAAC;AAAA,0BACvF,oDAAoD;AAAA;AAAA;AAAA;AAAA,0BAItDA,EAAM,gBAAkB;AAAA,+DACa,UAAU,WAAWA,EAAM,gBAAgB,WAAa,GAAGA,EAAM,gBAAgB,UAAU,IAAIA,EAAM,gBAAgB,SAAS,EAAE,CAAC;AAAA,+DACjI,UAAU,WAAWA,EAAM,gBAAgB,cAAc,CAAC;AAAA,8BAC3FA,EAAM,gBAAgB,eAAiB,oCAAoC,UAAU,WAAWA,EAAM,gBAAgB,cAAc,CAAC,OAAS,EAAE;AAAA,+DAC/G,UAAU,WAAWA,EAAM,gBAAgB,IAAI,CAAC,KAAK,UAAU,WAAWA,EAAM,gBAAgB,OAAS,EAAE,CAAC,IAAI,UAAU,WAAWA,EAAM,gBAAgB,WAAW,CAAC;AAAA,+DACvK,UAAU,WAAWA,EAAM,gBAAgB,OAAO,CAAC;AAAA,0BACtF,uDAAuD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAU3B,UAAU,YAAYA,EAAM,UAAY,CAAC,CAAC;AAAA;AAAA,0BAExEA,EAAM,gBAAkB;AAAA;AAAA;AAAA,yCAGT,UAAU,YAAYA,EAAM,eAAe,CAAC;AAAA;AAAA,0BAEzD,EAAE;AAAA;AAAA;AAAA,wDAG0BA,EAAM,cAAgB,EAAI,UAAU,YAAYA,EAAM,aAAa,EAAI,MAAM;AAAA;AAAA,0BAE3GA,EAAM,WAAa;AAAA;AAAA;AAAA,4DAGe,UAAU,YAAYA,EAAM,UAAU,CAAC;AAAA;AAAA,0BAEvE,EAAE;AAAA;AAAA;AAAA,oEAGsC,UAAU,YAAYA,EAAM,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAQpFA,EAAM,SAAW,YAAc;AAAA,0KACyHA,EAAM,EAAE;AAAA;AAAA;AAAA,kBAG9J,EAAE;AAAA,kBACJ,CAAC,UAAW,YAAY,EAAE,SAASA,EAAM,MAAM,EAAI;AAAA,mLAC8GA,EAAM,EAAE;AAAA;AAAA;AAAA,kBAGvK,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,UAOdiB,EAAsBjB,CAAK,CAC/B,CAEA,SAASiB,EAAsBjB,EAAO,CAClC,IAAMkB,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAY,SAAS,eAAe,kBAAkB,EACtDC,EAAW,SAAS,eAAe,mBAAmB,EAE5DF,GAAY,iBAAiB,QAAS,SAAY,CAC9C,GAAI,CACA,MAAM,UAAU,QAAQlB,EAAM,EAAE,EAChC,MAAM,QAAQ,sBAAsB,EACpC,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,EACtD,OAAO,SAAS,KAAO,QAC3B,OAASD,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,oBAAoB,CACrD,CACJ,CAAC,EAEDoB,GAAW,iBAAiB,QAAS,SAAY,CAQ7C,GAPkB,MAAM,MAAM,QAAQ,CAClC,MAAO,eACP,QAAS,4EACT,YAAa,eACb,WAAY,YAChB,CAAC,EAGG,GAAI,CACA,MAAM,UAAU,OAAOnB,EAAM,EAAE,EAC/B,MAAM,QAAQ,kBAAkB,EAChC,OAAO,SAAS,OAAO,CAC3B,OAASD,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,yBAAyB,CAC1D,CAER,CAAC,EAEDqB,GAAU,iBAAiB,QAAS,IAAM,CACtC,OAAO,MAAM,CACjB,CAAC,CACL,CAEA,SAAS7B,GAAc,CACnB,IAAM8B,EAAa,SAAS,iBAAiB,sBAAsB,EAEnEA,EAAW,QAAQC,GAAO,CACtBA,EAAI,iBAAiB,QAAS,IAAM,CAChCD,EAAW,QAAQE,GAAK,CACpBA,EAAE,UAAU,OAAO,iBAAkB,kBAAkB,EACvDA,EAAE,UAAU,IAAI,eAAe,CACnC,CAAC,EACDD,EAAI,UAAU,IAAI,iBAAkB,kBAAkB,EACtDA,EAAI,UAAU,OAAO,eAAe,EAEpCrC,EAAgBqC,EAAI,QAAQ,aAC5BtC,EAAc,EACdM,EAAW,CACf,CAAC,CACL,CAAC,CACL,CAEA,SAASkC,GAAU,CACfxC,EAAc,EACdC,EAAgB,KACpB,CAEA,MAAO,CACH,KAAAC,EACA,QAAAsC,CACJ,CACJ,GAAG,EAEH,OAAO,WAAa3C,GACbD,GAAQC,KC5cf,IAAA4C,GAAAC,GAAA,KAKA,IAAMC,IAAiB,UAAW,CAC9B,aAEA,IAAMC,EAAW,OAAO,gBAAkB,CAAC,EACrCC,EAAYD,EAAS,iBAAmB,qBACxCE,EAAaF,EAAS,kBAAoB,cAKhD,eAAeG,GAAc,CACzB,MAAM,QAAQ,IAAI,CACdC,EAAuB,EACvBC,EAAqB,EACrBC,EAAU,CACd,CAAC,CACL,CAKA,eAAeF,GAAyB,CACpC,IAAMG,EAAY,SAAS,eAAe,qBAAqB,EAC/D,GAAKA,EAEL,GAAI,CACA,IAAMC,EAAW,MAAM,aAAa,cAAc,CAAE,SAAU,GAAM,SAAU,CAAE,CAAC,EAC3EC,EAAaD,GAAU,MAAM,SAAWA,GAAU,MAAQA,GAAU,SAAW,CAAC,EAEtF,GAAIC,EAAW,SAAW,EAAG,CACzBF,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAUtB,MACJ,CAEAA,EAAU,UAAYE,EAAW,IAAIC,GAAYC,EAAmBD,CAAQ,CAAC,EAAE,KAAK,EAAE,CAC1F,OAASE,EAAO,CACZ,QAAQ,MAAM,uCAAwCA,CAAK,EAC3DL,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAS1B,CACJ,CAKA,SAASI,EAAmBD,EAAU,CAClC,IAAMG,EAAWH,EAAS,OAAO,KAAOA,EAAS,OAASA,EAAS,WAAa,GAC1EI,EAAWD,GAAYA,EAAS,OAAS,EACzCE,EAAa,WAAW,aAAgBC,GAAMA,GAC9CC,EAAc,WAAW,cAAiBC,GAAM,GAAG,OAAO,kBAAkB,QAAU,QAAG,GAAGA,CAAC,IAEnG,MAAO;AAAA,uBACQhB,CAAU,YAAYQ,EAAS,IAAI;AAAA;AAAA,kBAExCI,EAAW;AAAA;AAAA,oCAEOD,CAAQ,UAAUE,EAAWL,EAAS,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,kBAK3D;AAAA;AAAA,0BAEMA,EAAS,KAAO,0BAA0BA,EAAS,IAAI,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,yBAKpE;AAAA;AAAA,iBAER;AAAA;AAAA;AAAA;AAAA;AAAA,8BAKaK,EAAWL,EAAS,IAAI,CAAC;AAAA;AAAA,0BAE7BA,EAAS,KAAO,0BAA0BA,EAAS,IAAI,UAAY,EAAE;AAAA;AAAA;AAAA,sBAGzEA,EAAS,YAAc;AAAA;AAAA,8BAEfK,EAAWL,EAAS,WAAW,CAAC;AAAA;AAAA,sBAEtC,EAAE;AAAA;AAAA;AAAA,0BAGAA,EAAS,WAAa;AAAA;AAAA,4FAE4CO,EAAYP,EAAS,UAAU,CAAC;AAAA;AAAA,0BAEhG,eAAe;AAAA,0BACjBA,EAAS,qBAAuBA,EAAS,oBAAsB;AAAA;AAAA,kCAEvDA,EAAS,mBAAmB,IAAIA,EAAS,mBAAmB;AAAA;AAAA,0BAElE,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,8BAKAA,EAAS,gBAAkB;AAAA;AAAA;AAAA;AAAA,8BAIzB,EAAE;AAAA,8BACJA,EAAS,iBAAmB;AAAA;AAAA;AAAA;AAAA,8BAI1B,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAU9B,CAKA,eAAeL,GAAuB,CAClC,IAAME,EAAY,SAAS,eAAe,oBAAoB,EACzDA,GAILA,EAAU,QAAQ,SAAS,GAAG,UAAU,IAAI,QAAQ,CACxD,CAKA,eAAeD,GAAY,CACvB,IAAMa,EAAiB,SAAS,eAAe,gBAAgB,EAC/D,GAAI,CAACA,EAAgB,OAGrB,IAAMC,EAAQ,CACV,YAAa,OACb,eAAgB,OAChB,UAAW,KACf,EAEAD,EAAe,UAAY;AAAA;AAAA;AAAA,yFAGsDC,EAAM,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,yFAKjBA,EAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,yFAKpBA,EAAM,SAAS;AAAA;AAAA;AAAA;AAAA,SAKpG,CAKA,eAAeC,EAAmBC,EAAc,CAC5C,IAAMC,EAAmB,SAAS,eAAe,kBAAkB,EACnE,GAAI,GAACA,GAAoB,CAACD,GAE1B,GAAI,CACA,IAAMZ,EAAW,MAAM,aAAa,YAAYY,CAAY,EACtDE,EAAU,MAAM,aAAa,mBAAmBd,EAAS,EAAE,EAEjEe,EAAsBF,EAAkBC,CAAO,CACnD,OAASZ,EAAO,CACZ,QAAQ,MAAM,mCAAoCA,CAAK,CAC3D,CACJ,CAKA,SAASa,EAAsBlB,EAAWiB,EAAS,CAC/C,GAAI,CAACA,GAAWA,EAAQ,SAAW,EAAG,CAClCjB,EAAU,UAAY,mEACtB,MACJ,CAEAA,EAAU,UAAYiB,EAAQ,IAAIE,GAAU;AAAA;AAAA,+EAE2B,UAAU,WAAWA,EAAO,IAAI,CAAC;AAAA,kBAC9FA,EAAO,YAAc,4DAA4D,UAAU,WAAWA,EAAO,WAAW,CAAC,OAAS,EAAE;AAAA;AAAA,sBAEhIA,EAAO,SAAS,IAAIC,GAAU;AAAA;AAAA,2CAETD,EAAO,eAAiB,WAAa,OAAO,kBAAkBA,EAAO,EAAE,YAAYC,EAAO,EAAE;AAAA;AAAA,0FAE7C,UAAU,WAAWA,EAAO,IAAI,CAAC;AAAA,kCACzFA,EAAO,gBAAkBA,EAAO,iBAAmB,OAAS;AAAA,uGACS,UAAU,YAAYA,EAAO,cAAc,CAAC;AAAA,kCAC/G,EAAE;AAAA;AAAA;AAAA,qBAGjB,EAAE,KAAK,EAAE,GAAK,EAAE;AAAA;AAAA;AAAA,SAG5B,EAAE,KAAK,EAAE,CACd,CAKA,eAAeC,GAAkB,CAC7B,IAAMrB,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CACA,IAAMC,EAAW,MAAM,aAAa,eAAe,EAC7CqB,EAAYrB,GAAU,MAAM,SAAWA,GAAU,MAAQA,GAAU,SAAW,CAAC,EAErF,GAAIqB,EAAU,SAAW,EAAG,CACxBtB,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAOHN,CAAS;AAAA;AAAA;AAAA;AAAA;AAAA,kBAM5B,MACJ,CAEAM,EAAU,UAAYsB,EAAU,IAAIC,GAAYC,EAAmBD,CAAQ,CAAC,EAAE,KAAK,EAAE,CACzF,OAASlB,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EACjDL,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,aAK1B,EACJ,CAKA,SAASwB,EAAmBD,EAAU,CAClC,IAAME,EAAe,CACjB,QAAW,2EACX,OAAU,mEACV,SAAY,2EACZ,YAAe,2EACf,OAAU,2EACV,SAAY,mEACZ,UAAa,uEACb,UAAa,+DACb,SAAY,kEAChB,EAEMC,EAAe,CACjB,QAAW,iBACX,OAAU,aACV,SAAY,iBACZ,YAAe,cACf,OAAU,eACV,SAAY,WACZ,UAAa,YACb,UAAa,YACb,SAAY,UAChB,EAEMC,EAAcF,EAAaF,EAAS,MAAM,GAAK,4BAC/CK,EAAcF,EAAaH,EAAS,MAAM,GAAKA,EAAS,OAE9D,MAAO;AAAA,uBACQ5B,CAAU,SAAS4B,EAAS,eAAe;AAAA;AAAA;AAAA,8EAGYA,EAAS,eAAe;AAAA,0FACZ,UAAU,WAAWA,EAAS,OAASA,EAAS,UAAU,MAAQ,cAAc,CAAC;AAAA;AAAA,8EAE7FI,CAAW,KAAKC,CAAW;AAAA;AAAA,kBAEvFL,EAAS,YAAc;AAAA,4FACmD,UAAU,WAAWA,EAAS,WAAW,CAAC;AAAA,kBAClH,EAAE;AAAA;AAAA;AAAA,0BAGI,IAAI,KAAKA,EAAS,UAAU,EAAE,mBAAmB,CAAC;AAAA;AAAA,sBAEtDA,EAAS,aAAeA,EAAS,gBAAkB;AAAA;AAAA,8BAE3C,UAAU,YAAYA,EAAS,aAAeA,EAAS,eAAe,CAAC;AAAA;AAAA,sBAE7E,EAAE;AAAA;AAAA;AAAA,SAItB,CAKA,eAAeM,EAAWC,EAAgB,CACjCA,GAGL,MAAM,QAAQ,IAAI,CACdC,EAAmBD,CAAc,EACjCE,EAAgBF,CAAc,CAClC,CAAC,CACL,CAKA,eAAeC,EAAmBD,EAAgB,CAE9C,GADwB,SAAS,eAAe,iBAAiB,EAGjE,GAAI,CACA,IAAMG,EAAS,MAAM,aAAa,kBAAkBH,CAAc,CAEtE,MAAgB,CAChB,CACJ,CAKA,SAASE,EAAgBF,EAAgB,CACrC,IAAMI,EAAO,SAAS,eAAe,cAAc,EAC9CA,GAELA,EAAK,iBAAiB,SAAU,MAAOC,GAAM,CACzCA,EAAE,eAAe,EAEjB,IAAMC,EAAeF,EAAK,cAAc,0BAA0B,EAC5DG,EAAYH,EAAK,cAAc,uBAAuB,EACtDI,EAAUF,GAAc,OAAO,KAAK,EAE1C,GAAI,CAACE,EAAS,CACV,MAAM,MAAM,wBAAwB,EACpC,MACJ,CAEA,IAAMC,EAAeF,EAAU,UAC/BA,EAAU,SAAW,GACrBA,EAAU,UAAY,6VAEtB,GAAI,CACA,MAAM,aAAa,YAAYP,EAAgBQ,CAAO,EACtD,MAAM,QAAQ,2BAA2B,EACzCF,EAAa,MAAQ,GAErB,SAAS,OAAO,CACpB,OAAS/B,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,QAAE,CACEgC,EAAU,SAAW,GACrBA,EAAU,UAAYE,CAC1B,CACJ,CAAC,CACL,CAEA,MAAO,CACH,YAAA3C,EACA,mBAAAkB,EACA,gBAAAO,EACA,WAAAQ,EACA,uBAAAhC,EACA,mBAAAO,EACA,mBAAAoB,CACJ,CACJ,GAAG,EAEH,OAAO,cAAgBhC,KC1ZvB,IAAAgD,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAywDCD,GA9wDPE,GAAAC,GAAA,KAKMF,IAAe,UAAW,CAC5B,aAEA,IAAIG,EAAiB,KACjBC,EAAkB,KAClBC,EAAU,KACVC,EAAc,GACdC,EAAiB,GACjBC,EAAc,GACdC,EAAkB,KAEtB,eAAeC,GAAO,CAElB,GAAIJ,EAAa,OACjBA,EAAc,GAEd,IAAMK,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAGhB,IAAMC,EAAmBD,EAAU,cAAc,IAAI,GAAKA,EAAU,QAAQ,UAG5E,GAFAJ,EAAiB,EAAQK,EAErBA,EAAkB,CAElBT,EAAiB,CACb,GAAIQ,EAAU,QAAQ,UACtB,KAAMA,EAAU,QAAQ,WAC5B,EACAE,EAAmB,EACnBC,EAAqB,EACrB,MACJ,CAGA,IAAMC,EAAcC,EAAsB,EAC1C,GAAI,CAACD,EAAa,CACd,OAAO,SAAS,KAAO,aACvB,MACJ,CAEA,MAAME,EAAYF,CAAW,EAC7BD,EAAqB,CACzB,CAKA,SAASA,GAAuB,CAC5BI,EAAc,EACdC,EAAmB,EACnBC,EAAgB,EAChBC,EAAkB,EAClBC,EAAc,EACdC,EAAqB,EACrBC,EAA2B,EAC3BC,EAAoB,EACpBC,EAAuB,CAC3B,CAKA,SAASR,GAAgB,CACrB,IAAMS,EAAY,SAAS,eAAe,oBAAoB,GAAK,SAAS,eAAe,YAAY,EACjGhB,EAAYgB,GAAW,cAE7B,GAAI,CAACA,GAAa,CAAChB,EAAW,OAG9B,IAAMiB,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAY,0IACjBA,EAAK,MAAM,iBAAmB,YAG9B,IAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,UAAY,iPACnBA,EAAO,MAAM,iBAAmB,YAEhClB,EAAU,UAAU,IAAI,UAAU,EAClCA,EAAU,YAAYiB,CAAI,EAC1B,SAAS,KAAK,YAAYC,CAAM,EAEhClB,EAAU,iBAAiB,aAAc,IAAM,CACvC,OAAO,WAAa,OACxBiB,EAAK,UAAU,OAAO,WAAW,EACjCC,EAAO,UAAU,OAAO,WAAW,EACnCrB,EAAc,GAClB,CAAC,EAEDG,EAAU,iBAAiB,aAAc,IAAM,CAC3CiB,EAAK,UAAU,IAAI,WAAW,EAC9BC,EAAO,UAAU,IAAI,WAAW,EAChCrB,EAAc,EAClB,CAAC,EAEDG,EAAU,iBAAiB,YAAcmB,GAAM,CAC3C,GAAI,CAACtB,GAAe,OAAO,WAAa,KAAM,OAE9C,IAAMuB,EAAOpB,EAAU,sBAAsB,EACvCqB,EAAIF,EAAE,QAAUC,EAAK,KACrBE,EAAIH,EAAE,QAAUC,EAAK,IAGrBG,EAAQF,EAAIJ,EAAK,YAAc,EAC/BO,EAAQF,EAAIL,EAAK,aAAe,EAEtCA,EAAK,MAAM,KAAO,GAAG,KAAK,IAAI,EAAG,KAAK,IAAIG,EAAK,MAAQH,EAAK,YAAaM,CAAK,CAAC,CAAC,KAChFN,EAAK,MAAM,IAAM,GAAG,KAAK,IAAI,EAAG,KAAK,IAAIG,EAAK,OAASH,EAAK,aAAcO,CAAK,CAAC,CAAC,KAGjF,IAAMC,GAAY,EACZC,GAAM,CAACL,EAAII,GAAYP,EAAO,YAAc,EAC5CS,GAAM,CAACL,EAAIG,GAAYP,EAAO,aAAe,EAEnDA,EAAO,MAAM,gBAAkB,OAAOF,EAAU,GAAG,IACnDE,EAAO,MAAM,eAAiB,GAAGE,EAAK,MAAQK,EAAS,MAAML,EAAK,OAASK,EAAS,KACpFP,EAAO,MAAM,mBAAqB,GAAGQ,EAAG,MAAMC,EAAG,IACrD,CAAC,CACL,CAKA,SAASnB,GAAqB,CAC1B,IAAMoB,EAAe,SAAS,eAAe,gBAAgB,EACxDA,GAELA,EAAa,iBAAiB,QAAS,IAAM,CACzC,IAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,mBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAgElB,SAAS,KAAK,YAAYA,CAAK,CACnC,CAAC,CACL,CAKA,SAASpB,GAAkB,CACvB,IAAMqB,EAAgB,SAAS,eAAe,iBAAiB,EAC1DA,GAELA,EAAc,iBAAiB,QAAS,IAAM,CAE1C,GAAI,CADc,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UACrD,OAEhB,IAAMD,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,oBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAqBlB,SAAS,KAAK,YAAYA,CAAK,EAE/B,SAAS,eAAe,kBAAkB,GAAG,iBAAiB,SAAU,MAAOV,GAAM,CACjFA,EAAE,eAAe,EACjB,IAAMY,EAAQ,SAAS,eAAe,mBAAmB,GAAG,MAC5D,GAAKA,EAEL,GAAI,CAGAjC,EAAkBiC,EAClB,MAAM,QAAQ,0DAA0D,EACxEF,EAAM,OAAO,CACjB,MAAgB,CACZ,MAAM,MAAM,wCAAwC,CACxD,CACJ,CAAC,CACL,CAAC,CACL,CAKA,SAASnB,GAAoB,CACzB,SAAS,iBAAiB,YAAY,EAAE,QAAQsB,GAAO,CACnDA,EAAI,iBAAiB,QAAS,IAAM,CAChC,IAAMC,EAAWD,EAAI,QAAQ,SACvBE,EAAM,mBAAmB,OAAO,SAAS,IAAI,EAC7CC,EAAQ,mBAAmB,SAAS,KAAK,EACzCC,EAAc,SAAS,cAAc,IAAI,GAAG,aAAe,GAE3DC,EAAY,CACd,SAAU,gDAAgDH,CAAG,GAC7D,QAAS,wCAAwCA,CAAG,SAAS,mBAAmBE,CAAW,CAAC,GAC5F,UAAW,gDAAgDF,CAAG,gBAAgB,mBAAmBE,CAAW,CAAC,GAC7G,SAAU,sCAAsC,mBAAmBA,EAAc,IAAM,OAAO,SAAS,IAAI,CAAC,GAC5G,KAAM,IACV,EAEIH,IAAa,OACb,UAAU,UAAU,UAAU,OAAO,SAAS,IAAI,EAAE,KAAK,IAAM,CAC3D,MAAM,QAAQ,2BAA2B,CAC7C,CAAC,EAAE,MAAM,IAAM,CACX,MAAM,MAAM,qBAAqB,CACrC,CAAC,EACMI,EAAUJ,CAAQ,GACzB,OAAO,KAAKI,EAAUJ,CAAQ,EAAG,SAAU,sBAAsB,CAEzE,CAAC,CACL,CAAC,CACL,CAKA,SAAStB,GAAgB,CACrB,IAAM2B,EAAc,SAAS,eAAe,YAAY,EAIxD,GAHI,CAACA,GAGD,CADc,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UACrD,OAGhB,IAAMC,EAAU,CACZ,CAAE,SAAU,oCAAqC,OAAQ,+DAAgE,QAAS,UAAW,KAAM,YAAa,EAChK,CAAE,SAAU,oCAAqC,OAAQ,mFAAoF,QAAS,WAAY,KAAM,YAAa,CACzL,EAEAD,EAAY,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAOVC,EAAQ,IAAIC,GAAM;AAAA;AAAA;AAAA;AAAA;AAAA,4FAKoD,UAAU,WAAWA,EAAG,QAAQ,CAAC;AAAA,iGAC5BA,EAAG,OAAO,WAAMA,EAAG,IAAI;AAAA;AAAA;AAAA,8BAG1FA,EAAG,OAAS;AAAA;AAAA;AAAA,oFAG0C,UAAU,WAAWA,EAAG,MAAM,CAAC;AAAA;AAAA,8BAEnF,EAAE;AAAA;AAAA,qBAEb,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAKvB,SAAS,eAAe,kBAAkB,GAAG,iBAAiB,QAAS,IAAM,CACzE,IAAMX,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,qBACXA,EAAM,UAAY,0DAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAelB,SAAS,KAAK,YAAYA,CAAK,EAE/B,SAAS,eAAe,eAAe,GAAG,iBAAiB,SAAWV,GAAM,CACxEA,EAAE,eAAe,EACjB,MAAM,QAAQ,mCAAmC,EACjDU,EAAM,OAAO,CACjB,CAAC,CACL,CAAC,CACL,CAKA,SAASjB,GAAuB,CAC5B,IAAM6B,EAAoB,SAAS,eAAe,mBAAmB,EACrE,GAAI,CAACA,EAAmB,OAGxB,IAAMC,EAAQ,IAAI,KACZC,EAAU,EACVC,EAAU,EACVC,EAAU,IAAI,KAAKH,EAAM,QAAQ,EAAIC,EAAU,GAAK,GAAK,GAAK,GAAI,EAClEG,EAAU,IAAI,KAAKJ,EAAM,QAAQ,EAAIE,EAAU,GAAK,GAAK,GAAK,GAAI,EAElEG,EAAcC,GAASA,EAAK,mBAAmB,QAAS,CAAE,QAAS,QAAS,MAAO,QAAS,IAAK,SAAU,CAAC,EAElHP,EAAkB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sFAOgDM,EAAWF,CAAO,CAAC,MAAME,EAAWD,CAAO,CAAC;AAAA;AAAA;AAAA;AAAA,SAK9H,CAKA,SAASjC,GAA6B,CAClC,IAAMoC,EAAY,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UAC/D7C,EAAc,SAAS,eAAe,gBAAgB,GAAG,QAAQ,YACjEgC,EAAc,SAAS,cAAc,IAAI,GAAG,YAC5Cc,EAAe,SAAS,eAAe,oBAAoB,GAAG,KAAO,SAAS,eAAe,YAAY,GAAG,IAC5GC,EAAe,SAAS,eAAe,eAAe,GAAG,YAE/D,GAAI,CAACF,EAAW,OAEhB,IAAMG,EAAiB,KAAK,MAAM,aAAa,QAAQ,gBAAgB,GAAK,IAAI,EAG1EC,EAAgBD,EAAe,UAAUE,GAAKA,EAAE,KAAOL,CAAS,EAClEI,EAAgB,IAChBD,EAAe,OAAOC,EAAe,CAAC,EAI1CD,EAAe,QAAQ,CACnB,GAAIH,EACJ,KAAM7C,EACN,KAAMgC,EACN,MAAOc,EACP,MAAOC,EACP,SAAU,IAAI,KAAK,EAAE,YAAY,CACrC,CAAC,EAGD,aAAa,QAAQ,iBAAkB,KAAK,UAAUC,EAAe,MAAM,EAAG,EAAE,CAAC,CAAC,CACtF,CAKA,SAAStC,GAAsB,CAE3B,GADuB,SAAS,eAAe,mBAAmB,GAAK,SAAS,eAAe,sBAAsB,GAC/F,OAAO,YAAc,KAAM,OAEjD,IAAMyC,EAAU/D,EAChB,GAAI,CAAC+D,EAAS,OAEd,IAAMC,EAAS,SAAS,cAAc,KAAK,EAC3CA,EAAO,GAAK,6BACZA,EAAO,UAAY,iMACnBA,EAAO,UAAY;AAAA;AAAA;AAAA,qFAG0DD,EAAQ,MAAQ,EAAE;AAAA,0EAC7BA,EAAQ,WAAa,UAAU,YAAYA,EAAQ,UAAU,EAAI,UAAU,YAAYA,EAAQ,OAAS,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAO5K,SAAS,KAAK,YAAYC,CAAM,EAGhC,IAAMC,EAAa,SAAS,eAAe,iBAAiB,EACxDA,GACiB,IAAI,qBAAsBC,GAAY,CACnDA,EAAQ,QAAQC,GAAS,CACjBA,EAAM,eACNH,EAAO,UAAU,IAAI,kBAAkB,EAEvCA,EAAO,UAAU,OAAO,kBAAkB,CAElD,CAAC,CACL,EAAG,CAAE,UAAW,CAAE,CAAC,EAEV,QAAQC,CAAU,EAG/B,SAAS,eAAe,oBAAoB,GAAG,iBAAiB,QAAS,IAAM,CAC3E,SAAS,eAAe,iBAAiB,GAAG,MAAM,CACtD,CAAC,CACL,CAKA,SAAS1C,GAAyB,CACN,SAAS,iBAAiB,kBAAkB,EAEpD,QAAQ6C,GAAS,CAC7BA,EAAM,iBAAiB,QAAS,IAAM,CAClC,IAAMC,EAAWD,EAAM,QAAQ,SAC/B,GAAI,CAACC,EAAU,OAEf,IAAMhC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,qBACXA,EAAM,UAAY,kEAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,uCAKKgC,CAAQ;AAAA;AAAA;AAAA,kBAI/B,SAAS,KAAK,YAAYhC,CAAK,CACnC,CAAC,CACL,CAAC,CACL,CAEA,SAAS3B,GAAqB,CAE1B4D,EAAqB,EAErBC,EAA0B,EAE1BC,EAAyB,EACzBC,EAA2B,EACvB,eAAeA,GAA6B,CACxC,IAAMjC,EAAM,SAAS,eAAe,qBAAqB,EACzD,GAAI,CAACA,EAAK,OACV,IAAMiB,EAAY,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UACrE,GAAKA,GACD,SAAO,YAAgB,KAC3B,GAAI,CACA,IAAMiB,EAAO,MAAM,YAAY,YAAY,CAAE,SAAU,GAAI,CAAC,EACxDA,EAAK,SAAWA,EAAK,MAAM,QACbA,EAAK,KAAK,MAAM,KAAKC,GAAQA,EAAK,aAAelB,GAAakB,EAAK,UAAYlB,CAAS,GAElGjB,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,cAAc,EAC7DA,EAAI,UAAU,IAAI,cAAc,IAEhCA,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,MAAM,EACrDA,EAAI,UAAU,OAAO,cAAc,GAG/C,MAAY,CAAC,CACjB,CAEJoC,EAAiC,EAEjCC,EAAwB,EAExBC,GAAwB,EAExBC,EAAqB,CACzB,CAEA,SAASA,GAAuB,CAC5B,IAAMC,EAAa,SAAS,iBAAiB,UAAU,EACjDC,EAAc,SAAS,iBAAiB,cAAc,EAE5DD,EAAW,QAAQxC,GAAO,CACtBA,EAAI,iBAAiB,QAAS,IAAM,CAChC,IAAM0C,EAAU1C,EAAI,QAAQ,IAG5BwC,EAAW,QAAQG,GAAK,CACpBA,EAAE,UAAU,OAAO,qBAAsB,kBAAkB,EAC3DA,EAAE,UAAU,IAAI,qBAAsB,eAAe,CACzD,CAAC,EACD3C,EAAI,UAAU,IAAI,qBAAsB,kBAAkB,EAC1DA,EAAI,UAAU,OAAO,qBAAsB,eAAe,EAG1DyC,EAAY,QAAQG,GAAW,CACvBA,EAAQ,KAAO,GAAGF,CAAO,OACzBE,EAAQ,UAAU,OAAO,QAAQ,EAEjCA,EAAQ,UAAU,IAAI,QAAQ,CAEtC,CAAC,CACL,CAAC,CACL,CAAC,CACL,CAmBA,SAASb,GAA4B,CACjC,IAAM/B,EAAM,SAAS,eAAe,iBAAiB,EAChDA,GAELA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAMiB,EAAY,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UAC/D4B,EAAW,SAAS,SAAS,eAAe,UAAU,GAAG,KAAK,GAAK,EAEnEC,EAAc,CAAC,CADA,SAAS,cAAc,uBAAuB,EAE7DC,EAAY,SAAS,cAAc,+BAA+B,GAAG,MAE3E,GAAI,CAAC9B,EAAW,OAGhB,GAAI6B,GAAe,CAACC,EAAW,CAC3B,MAAM,QAAQ,gDAAgD,EAC9D,MACJ,CAEA/C,EAAI,SAAW,GACf,IAAMgD,EAAehD,EAAI,UACzBA,EAAI,UAAY,6VAIhB,GAAI,CAEA,MAAM,QAAQ,QAAQiB,EAAW4B,EAAUE,GAAa,IAAI,EAE5D,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASE,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,QAAE,CACEjD,EAAI,SAAW,GACfA,EAAI,UAAYgD,CACpB,CACJ,CAAC,CACL,CAEA,SAAShB,GAA2B,CAChC,IAAMhC,EAAM,SAAS,eAAe,qBAAqB,EACpDA,GAELA,EAAI,iBAAiB,QAAS,SAAY,CACtC,IAAMiB,EAAY,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UACrE,GAAKA,EAEL,IAAI,OAAO,QAAY,KAAe,CAAC,QAAQ,gBAAgB,EAAG,CAC9D,MAAM,QAAQ,6CAA6C,EAC3D,OAAO,SAAS,KAAO,wBAA0B,mBAAmB,OAAO,SAAS,QAAQ,EAC5F,MACJ,CAEA,GAAI,CAEA,IAAIiC,EAAa,GACjB,GAAI,OAAO,YAAgB,IAAa,CACpC,IAAMhB,EAAO,MAAM,YAAY,YAAY,CAAE,SAAU,GAAI,CAAC,EACxDA,EAAK,SAAWA,EAAK,MAAM,QAC3BgB,EAAahB,EAAK,KAAK,MAAM,KAAKC,GAAQA,EAAK,aAAelB,GAAakB,EAAK,UAAYlB,CAAS,EAE7G,CACA,GAAIiC,EAAY,CAIZ,IAAMf,GADO,MAAM,YAAY,YAAY,CAAE,SAAU,GAAI,CAAC,GAC1C,KAAK,MAAM,KAAKA,GAAQA,EAAK,aAAelB,GAAakB,EAAK,UAAYlB,CAAS,EACjGkB,IACA,MAAM,YAAY,WAAWA,EAAK,EAAE,EACpC,MAAM,QAAQ,wBAAwB,EACtCnC,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,MAAM,EACrDA,EAAI,UAAU,OAAO,cAAc,EACnCA,EAAI,aAAa,eAAgB,OAAO,EAEhD,MAEI,MAAM,YAAY,QAAQiB,CAAS,EACnC,MAAM,QAAQ,oBAAoB,EAClCjB,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,cAAc,EAC7DA,EAAI,UAAU,IAAI,cAAc,EAChCA,EAAI,aAAa,eAAgB,MAAM,CAE/C,OAASiD,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,yBAAyB,CAC1D,EACJ,CAAC,CACL,CAEA,SAASb,GAAmC,CAClB,SAAS,iBAAiB,uBAAuB,EACzD,QAAQe,GAAS,CAC3BA,EAAM,iBAAiB,SAAU,IAAM,CACnC1F,EAAkB0F,EAAM,MAExB,IAAMC,EAAQD,EAAM,QAAQ,MACtBE,EAAQ,SAASF,EAAM,QAAQ,OAAS,GAAG,EACjD,GAAIC,EAAO,CACP,IAAME,EAAU,SAAS,eAAe,eAAe,EACnDA,GAAW,OAAO,WAAW,cAC7BA,EAAQ,YAAc,OAAO,UAAU,YAAY,WAAWF,CAAK,CAAC,EAE5E,CAEA,IAAMG,EAAU,SAAS,eAAe,cAAc,EAChDC,EAAS,SAAS,eAAe,iBAAiB,EAClDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAY,SAAS,eAAe,oBAAoB,EAC1DH,IACIF,EAAQ,GAAIE,EAAQ,UAAY,+CAC3BF,EAAQ,EAAGE,EAAQ,UAAY,sCAAsCF,CAAK,eAC9EE,EAAQ,UAAY,kDAEzBC,IAAQA,EAAO,SAAWH,GAAS,GACnCK,IAAWA,EAAU,SAAWL,GAAS,GACzCI,IAAaA,EAAY,YAAcJ,EAAQ,EAAKA,EAAQ,GAAK,WAAa,GAAGA,CAAK,aAAgB,eAC9G,CAAC,CACL,CAAC,CACL,CAEA,SAAShB,GAA0B,CAGb,SAAS,eAAe,YAAY,GAC3C,iBAAiB,QAAS,IAAM,CAE3C,CAAC,CACL,CAEA,SAAShE,GAAwB,CAE7B,IAAMsF,EADO,OAAO,SAAS,SACV,MAAM,sBAAsB,EAC/C,OAAOA,EAAQA,EAAM,CAAC,EAAI,IAC9B,CAEA,eAAerF,EAAYsF,EAAM,CAC7B,IAAM5F,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CAIA,GAFAR,GADiB,MAAM,YAAY,WAAWoG,CAAI,GACxB,KAEtB,CAACpG,EAAgB,CACjB,OAAO,SAAS,KAAO,QACvB,MACJ,CAEA,SAAS,MAAQ,GAAGA,EAAe,IAAI,aAEvCqG,EAAcrG,CAAc,EAG5BsG,GAAetG,CAAc,EAC7BuG,GAAqBvG,CAAc,EAGnC,MAAM,QAAQ,IAAI,CACdwG,GAAgBxG,CAAc,EAC9ByG,GAAoBzG,CAAc,EAClC0G,GAAY1G,CAAc,EAC1B2G,GAAoB3G,CAAc,CACtC,CAAC,EAGD4G,GAAiB,EAEjBC,GAAiB7G,CAAc,CACnC,OAASyF,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,EAC9CjF,EAAU,UAAY,wFAC1B,EACJ,CAGA,SAAS,iBAAiB,mBAAoB,MAAOmB,GAAM,CACvD,GAAI,CACI,CAACvB,GAAkBJ,GAAkBA,EAAe,KACpD,MAAMc,EAAYd,EAAe,IAAI,EAGrC,SAAS,OAAO,CAExB,MAAc,CACd,CACJ,CAAC,EAED,SAASqG,EAActC,EAAS,CAC5B,IAAMvD,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,IAAMsG,EAAS/C,EAAQ,QAAU,CAAC,EAC5BvC,EAAYuC,EAAQ,OAAS+C,EAAO,CAAC,GAAG,OAAS,GACjDxB,EAAcvB,EAAQ,UAAYA,EAAQ,SAAS,OAAS,EAC5DgD,EAAUhD,EAAQ,eAAiB,GAAKA,EAAQ,SAChDiD,EAASjD,EAAQ,YAAcA,EAAQ,WAAaA,EAAQ,MAElEvD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,6HAI+FuD,GAAS,QAAQ,KAAO,KAAK;AAAA;AAAA,mCAEvHvC,CAAS;AAAA,mCACT,UAAU,WAAWuC,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAM3CiD,EAAS;AAAA;AAAA;AAAA;AAAA,0BAIP,EAAE;AAAA,0BACHD,EAIC,GAJS;AAAA;AAAA;AAAA;AAAA,yBAIP;AAAA;AAAA,sBAERD,EAAO,OAAS,EAAI;AAAA;AAAA,8BAEZA,EAAO,IAAI,CAACG,EAAKC,IAAU;AAAA;AAAA,mHAE0DA,IAAU,EAAI,qBAAuB,oBAAoB;AAAA,kDAC1HD,EAAI,KAAK;AAAA,kDACTC,CAAK;AAAA;AAAA,gDAEPD,EAAI,KAAK;AAAA;AAAA,6BAE5B,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,sBAEf,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAMJlD,EAAQ,MAAQ;AAAA,oDACcA,EAAQ,MAAM,EAAE;AAAA,8BACtC,UAAU,WAAWA,EAAQ,MAAM,IAAI,CAAC;AAAA;AAAA,sBAE9C,EAAE;AAAA;AAAA;AAAA;AAAA,0BAIA,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,sBAItCA,EAAQ,eAAiB;AAAA;AAAA;AAAA,kCAGb,UAAU,YAAYA,EAAQ,cAAc,CAAC;AAAA;AAAA;AAAA,kCAG7CA,EAAQ,eAAe,QAAQ,CAAC,CAAC,KAAKA,EAAQ,cAAgB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAMzE,EAAE;AAAA;AAAA;AAAA;AAAA,0BAIA,MAAM,OAAO,CACX,MAAOA,EAAQ,eAAiBA,EAAQ,iBAAmBA,EAAQ,MACnE,UAAWA,EAAQ,sBAAwBA,EAAQ,WACnD,KAAM,OACV,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,sBAIJA,EAAQ,kBAAoB;AAAA,wDACM,UAAU,WAAWA,EAAQ,iBAAiB,CAAC;AAAA,sBAC/E,EAAE;AAAA;AAAA;AAAA,sBAGJuB,EAAc6B,EAAepD,EAAQ,QAAQ,EAAI,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAoB9BA,EAAQ,gBAAkB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAYzCA,EAAQ,eAAiB;AAAA,uFACgCA,EAAQ,eAAiB,GAAK,WAAaA,EAAQ,eAAiB,YAAY;AAAA,8BACvI,gEAAgE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAO7DgD,EAAuB,GAAb,UAAe;AAAA;AAAA;AAAA;AAAA;AAAA,kCAK1BA,EAAU,cAAgB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAMvBhD,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAWnCA,EAAQ,IAAM;AAAA;AAAA;AAAA,8DAGsB,UAAU,WAAWA,EAAQ,GAAG,CAAC;AAAA;AAAA,0BAEnE,EAAE;AAAA,0BACJA,EAAQ,SAAW;AAAA;AAAA;AAAA,uDAGUA,EAAQ,SAAS,IAAI;AAAA,sCACtC,UAAU,WAAWA,EAAQ,SAAS,IAAI,CAAC;AAAA;AAAA;AAAA,0BAGrD,EAAE;AAAA,0BACJA,EAAQ,MAAQA,EAAQ,KAAK,OAAS;AAAA;AAAA;AAAA;AAAA,sCAI1BA,EAAQ,KAAK,IAAIqD,GAAO;AAAA,kEACIA,EAAI,IAAI;AAAA,8CAC5B,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA;AAAA,qCAEvC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,0BAGnB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAiCJrD,EAAQ,gBAAkB,OAAO,KAAKA,EAAQ,cAAc,EAAE,OAAS;AAAA;AAAA;AAAA;AAAA,0BAIrE,EAAE;AAAA;AAAA,uCAESA,EAAQ,cAAgB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAOlCA,EAAQ,aAAe,wDAAwD;AAAA;AAAA;AAAA,sBAGvFA,EAAQ,gBAAkB,OAAO,KAAKA,EAAQ,cAAc,EAAE,OAAS;AAAA;AAAA;AAAA;AAAA,sCAIvD,OAAO,QAAQA,EAAQ,cAAc,EAAE,IAAI,CAAC,CAACsD,EAAKC,CAAK,IAAM;AAAA;AAAA,uGAEI,UAAU,WAAWD,CAAG,CAAC;AAAA,qFAC3C,UAAU,WAAW,OAAOC,CAAK,CAAC,CAAC;AAAA;AAAA,qCAEnF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,sBAIvB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAUlBC,EAAY,EACZjD,EAAqB,EACrBkD,GAAc,EACdC,GAAa,EACbC,GAAY,EACZC,GAAU,EACV,KAAK,KAAK,EAGVC,EAAwB7D,CAAO,CACnC,CAEA,SAAS6D,EAAwB7D,EAAS,CACtC,IAAI8D,EAAK,SAAS,eAAe,sBAAsB,EACvD,GAAKA,EAmBE,CAEH,IAAM/B,EAAU+B,EAAG,cAAc,gBAAgB,EAC7C/B,IAASA,EAAQ,UAAY/B,EAAQ,WAAa,UAAU,YAAYA,EAAQ,UAAU,EAAI,qDAAuD,UAAU,YAAYA,EAAQ,KAAK,EAAI,UAAY,UAAU,YAAYA,EAAQ,KAAK,GAC/O,IAAMgC,EAAU,SAAS,eAAe,iBAAiB,EACrDA,IAASA,EAAQ,YAAchC,EAAQ,eAAiB,EAAKA,EAAQ,eAAiB,GAAK,WAAaA,EAAQ,eAAiB,aAAgB,gBACrJ,IAAM+D,EAAS,SAAS,eAAe,uBAAuB,EAC1DA,IAAQA,EAAO,SAAW/D,EAAQ,gBAAkB,EAC5D,KA3BS,CACL8D,EAAK,SAAS,cAAc,KAAK,EACjCA,EAAG,GAAK,uBACRA,EAAG,UAAY,0CACfA,EAAG,UAAY;AAAA;AAAA;AAAA,6DAGkC9D,EAAQ,WAAa,MAAQ,EAAE;AAAA,4DAChCA,EAAQ,WAAa,eAAiB,EAAE,KAAKA,EAAQ,WAAa,UAAU,YAAYA,EAAQ,UAAU,EAAI,qDAAuD,UAAU,YAAYA,EAAQ,KAAK,EAAI,UAAY,UAAU,YAAYA,EAAQ,KAAK,CAAC;AAAA,kFACtOA,EAAQ,eAAiB,EAAKA,EAAQ,eAAiB,GAAK,WAAaA,EAAQ,eAAiB,aAAgB,cAAc;AAAA;AAAA,sBAE5LA,EAAQ,eAAiB,EAAI,uHAAyH,uHAAuH;AAAA;AAAA,cAGvR,SAAS,KAAK,YAAY8D,CAAE,EAG5B,IAAMC,EAAS,SAAS,eAAe,uBAAuB,EAC1DA,GAAQA,EAAO,iBAAiB,QAAS,IAAM,SAAS,eAAe,iBAAiB,GAAG,MAAM,CAAC,CAC1G,CASJ,CAEA,SAASX,EAAeY,EAAU,CAC9B,IAAMC,EAAU,CAAC,EACjB,OAAAD,EAAS,QAAQE,GAAW,CACnBD,EAAQC,EAAQ,cAAc,IAC/BD,EAAQC,EAAQ,cAAc,EAAI,CAAC,GAEvCD,EAAQC,EAAQ,cAAc,EAAE,KAAKA,CAAO,CAChD,CAAC,EAEM,OAAO,QAAQD,CAAO,EAAE,IAAI,CAAC,CAACE,EAAUC,CAAO,IAAM;AAAA;AAAA,mEAED,UAAU,WAAWD,CAAQ,CAAC;AAAA,uFACV,UAAU,WAAWA,CAAQ,CAAC;AAAA,sBAC/FC,EAAQ,IAAI,CAACC,EAAKlB,IAAU;AAAA;AAAA,uGAEqDA,IAAU,EAAI,oDAAsD,uCAAuC;AAAA;AAAA,4CAEtKA,IAAU,EAAI,OAAS,OAAO;AAAA,+CAC3BkB,EAAI,EAAE;AAAA,0CACXA,EAAI,iBAAmBA,EAAI,OAAS,EAAE;AAAA,0CACtCA,EAAI,gBAAkB,CAAC;AAAA;AAAA;AAAA,8BAGnC,UAAU,WAAWA,EAAI,KAAK,CAAC;AAAA,+BAC7BA,EAAI,iBAAmBA,EAAI,QAAWA,EAAI,QAAUpI,EAAe,MAAU;AAAA,uEACtC,UAAU,YAAYoI,EAAI,iBAAmBA,EAAI,KAAK,CAAC;AAAA,8BAC9F,EAAE;AAAA;AAAA,qBAEb,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,SAGtB,EAAE,KAAK,EAAE,CACd,CAEA,SAASb,GAAc,CACnB,IAAMc,EAAa,SAAS,iBAAiB,YAAY,EACnD7G,EAAY,SAAS,eAAe,oBAAoB,EAG1D8G,EAAe,EACnBD,EAAW,QAAQ,CAACjE,EAAOmE,IAAQ,CAC/BnE,EAAM,aAAa,WAAY,GAAG,EAClCA,EAAM,iBAAiB,QAAS,IAAM,CAClCiE,EAAW,QAAQG,GAAKA,EAAE,UAAU,OAAO,oBAAoB,CAAC,EAChEpE,EAAM,UAAU,IAAI,oBAAoB,EACxC5C,EAAU,IAAM4C,EAAM,QAAQ,OAASA,EAAM,QAAQ,IACrDkE,EAAeC,CACnB,CAAC,EACDnE,EAAM,iBAAiB,UAAYqE,GAAO,CACtC,GAAIA,EAAG,MAAQ,SAAWA,EAAG,MAAQ,IACjCA,EAAG,eAAe,EAClBrE,EAAM,MAAM,UACLqE,EAAG,MAAQ,aAAc,CAChCA,EAAG,eAAe,EAClB,IAAMC,EAAOL,GAAYE,EAAM,GAAKF,EAAW,MAAM,EACrDK,EAAK,MAAM,EACXA,EAAK,MAAM,CACf,SAAWD,EAAG,MAAQ,YAAa,CAC/BA,EAAG,eAAe,EAClB,IAAME,EAAON,GAAYE,EAAM,EAAIF,EAAW,QAAUA,EAAW,MAAM,EACzEM,EAAK,MAAM,EACXA,EAAK,MAAM,CACf,CACJ,CAAC,CACL,CAAC,EAGDnH,GAAW,iBAAiB,QAAS,IAAM,CACvC,IAAMsF,EAAS9G,EAAe,QAAQ,IAAIiH,GAAOA,EAAI,KAAK,GAAK,CAACjH,EAAe,KAAK,EAC9E4I,EAAe,SAAS,SAAS,cAAc,+BAA+B,GAAG,QAAQ,KAAK,GAAK,EAWnGxD,GARUpF,EAAe,QAAU,CAAC,GAAG,IAAIiH,IACtC,CACH,KAAMA,EAAI,OAASA,EAAI,UAAY,QAAU,SAC7C,IAAKA,EAAI,WAAaA,EAAI,WAAaA,EAAI,KAC/C,EACH,EAGsB,IAAI4B,GAAK,CAC5B,GAAIA,EAAE,OAAS,QACX,MAAO,6GAA6GA,EAAE,GAAG,wEAE7H,GAAIA,EAAE,OAAS,QAAS,CAEpB,GAAI,CAAC,OAAO,gBAAkB,CAAC,OAAO,cAAc,EAAG,CACnD,IAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,KAAO,SACdA,EAAO,IAAM,kEACb,SAAS,KAAK,YAAYA,CAAM,CACpC,CACA,MAAO,8DAA8DD,EAAE,GAAG,2GAC9E,CACA,MAAO,sFAAsFA,EAAE,GAAG,yDAAyD,UAAU,WAAW7I,EAAe,IAAI,CAAC,UACxM,CAAC,EAAE,KAAK,EAAE,EAEV,MAAM,KAAK,CACP,MAAO,UAAU,WAAWA,EAAe,IAAI,EAC/C,QAAS,0BAA0BoF,CAAO,SAC1C,KAAM,IACV,CAAC,CACL,CAAC,CACL,CAEA,SAASd,GAAuB,CAC5B,IAAMyE,EAAW,SAAS,eAAe,kBAAkB,EACrDC,EAAc,SAAS,cAAc,eAAe,EACpDC,EAAc,SAAS,cAAc,eAAe,EAE1DD,GAAa,iBAAiB,QAAS,IAAM,CACzC,IAAME,EAAU,SAASH,EAAS,KAAK,GAAK,EACxCG,EAAU,IACVH,EAAS,MAAQG,EAAU,EAEnC,CAAC,EAEDD,GAAa,iBAAiB,QAAS,IAAM,CACzC,IAAMC,EAAU,SAASH,EAAS,KAAK,GAAK,EACtCI,EAAM,SAASJ,EAAS,GAAG,GAAK,GAClCG,EAAUC,IACVJ,EAAS,MAAQG,EAAU,EAEnC,CAAC,EAED,IAAME,EAAc,SAAS,iBAAiB,cAAc,EA4D5D,GA3DAA,EAAY,QAAQ5G,GAAO,CACvBA,EAAI,iBAAiB,QAAS,IAAM,CAahC,GAZA4G,EAAY,QAAQjE,IAAK,CACrBA,GAAE,UAAU,OAAO,qBAAsB,gBAAiB,kBAAkB,EAC5EA,GAAE,UAAU,IAAI,iBAAiB,EACjCA,GAAE,aAAa,eAAgB,OAAO,CAC1C,CAAC,EACD3C,EAAI,UAAU,IAAI,qBAAsB,gBAAiB,kBAAkB,EAC3EA,EAAI,UAAU,OAAO,iBAAiB,EACtCA,EAAI,aAAa,eAAgB,MAAM,EAEvCvC,EAAkBuC,EAAI,QAAQ,UAG1BA,EAAI,QAAQ,MAAO,CACnB,IAAM6G,GAAiB,SAAS,cAAc,qBAAqB,EAC/DA,KACAA,GAAe,UAAY,MAAM,OAAO,CACpC,MAAO,WAAW7G,EAAI,QAAQ,KAAK,EACnC,KAAM,OACV,CAAC,EAET,CAGA,IAAMqD,EAAQ,SAASrD,EAAI,QAAQ,OAAS,GAAG,EACzCuD,EAAU,SAAS,eAAe,cAAc,EAChDuD,EAAe,SAAS,eAAe,iBAAiB,EACxDrD,EAAc,SAAS,eAAe,cAAc,EACpDsD,EAAY,SAAS,eAAe,oBAAoB,EAE1DxD,IACIF,EAAQ,GACRE,EAAQ,UAAY,wUACbF,EAAQ,EACfE,EAAQ,UAAY,2YAA2YF,CAAK,eAEpaE,EAAQ,UAAY,6ZAIxBgD,IACAA,EAAS,IAAM,KAAK,IAAIlD,EAAO,CAAC,EAC5B,SAASkD,EAAS,KAAK,EAAI,SAASA,EAAS,GAAG,IAAGA,EAAS,MAAQA,EAAS,MAGjF9C,IACAA,EAAY,YAAcJ,EAAQ,EAAKA,EAAQ,GAAK,WAAa,GAAGA,CAAK,aAAgB,gBAGzFyD,IACAA,EAAa,SAAWzD,GAAS,GAEjC0D,IACAA,EAAU,SAAW1D,GAAS,EAEtC,CAAC,CACL,CAAC,EAEGuD,EAAY,OAAS,EAAG,CACxB,IAAMI,EAAQJ,EAAY,CAAC,EAC3BI,EAAM,aAAa,eAAgB,MAAM,EACzCvJ,EAAkBuJ,EAAM,QAAQ,SACpC,CACJ,CAEA,SAAShC,IAAgB,CACrB,IAAMhF,EAAM,SAAS,eAAe,iBAAiB,EAC/C0D,EAAY,SAAS,eAAe,oBAAoB,EAC9D,GAAI,CAAC1D,GAAO,CAAC0D,EAAW,OAExB,IAAMuD,EAAmB,MAAOC,GAAe,CAC3C,IAAMrE,EAAW,SAAS,SAAS,eAAe,kBAAkB,GAAG,KAAK,GAAK,EAC3EU,EAAU,SAAS,eAAe,cAAc,EAGtD,GADoB,CAAC,CAAC,SAAS,cAAc,cAAc,GACxC,CAAC9F,EAAiB,CACjC,MAAM,QAAQ,gDAAgD,EAC9D,MACJ,CAEAyJ,EAAW,SAAW,GACtB,IAAMlE,EAAekE,EAAW,UAChCA,EAAW,UAAY,qVAEvB,GAAI,CAEA,IAAMC,EAAa,SAAS,cAAc,iCAAiC1J,CAAe,IAAI,EAE9F,IADc0J,EAAa,SAASA,EAAW,QAAQ,OAAS,GAAG,EAAK3J,EAAe,gBAAkB,IAC5F,EAAG,CACZ,MAAM,MAAM,+BAA+B,EAC3C,MACJ,CAEA,MAAM,QAAQ,QAAQA,EAAe,GAAIqF,EAAUpF,GAAmB,IAAI,EAC1E,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASwF,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,QAAE,CACEiE,EAAW,SAAW,GACtBA,EAAW,UAAYlE,CAC3B,CACJ,EAEAhD,GAAK,iBAAiB,QAAS,IAAMiH,EAAiBjH,CAAG,CAAC,EAC1D0D,GAAW,iBAAiB,QAAS,IAAMuD,EAAiBvD,CAAS,CAAC,CAC1E,CAEA,SAASuB,IAAe,CACpB,IAAMjF,EAAM,SAAS,eAAe,qBAAqB,EACpDA,GAELA,EAAI,iBAAiB,QAAS,SAAY,CACtC,GAAI,CAAC,QAAQ,gBAAgB,EAAG,CAC5B,MAAM,QAAQ,6CAA6C,EAC3D,OAAO,SAAS,KAAO,wBAA0B,mBAAmB,OAAO,SAAS,QAAQ,EAC5F,MACJ,CAEA,GAAI,CACA,MAAM,YAAY,QAAQxC,EAAe,EAAE,EAC3C,MAAM,QAAQ,oBAAoB,EAElCwC,EAAI,cAAc,KAAK,EAAE,aAAa,OAAQ,cAAc,EAC5DA,EAAI,UAAU,IAAI,cAAc,EAChCA,EAAI,aAAa,eAAgB,MAAM,CAC3C,OAASiD,EAAO,CACRA,EAAM,SAAS,SAAS,SAAS,EACjC,MAAM,KAAK,wCAAwC,EAEnD,MAAM,MAAMA,EAAM,SAAW,4BAA4B,CAEjE,CACJ,CAAC,CACL,CAEA,SAASkC,IAAY,CACjB,IAAMiC,EAAY,SAAS,iBAAiB,YAAY,EAClDlH,EAAM,mBAAmB,OAAO,SAAS,IAAI,EAC7CC,EAAQ,mBAAmB3C,GAAgB,MAAQ,SAAS,KAAK,EAEvE4J,EAAU,QAAQpH,GAAO,CACrBA,EAAI,iBAAiB,QAAS,IAAM,CAChC,IAAMC,EAAWD,EAAI,QAAQ,SACzBqH,EAAW,GAEf,OAAQpH,EAAU,CACd,IAAK,WACDoH,EAAW,gDAAgDnH,CAAG,GAC9D,MACJ,IAAK,UACDmH,EAAW,wCAAwCnH,CAAG,SAASC,CAAK,GACpE,MACJ,IAAK,YACD,IAAMmH,EAAQ,mBAAmB9J,GAAgB,OAAS,EAAE,EAC5D6J,EAAW,gDAAgDnH,CAAG,UAAUoH,CAAK,gBAAgBnH,CAAK,GAClG,MACJ,IAAK,OACD,UAAU,UAAU,UAAU,OAAO,SAAS,IAAI,EAC7C,KAAK,IAAM,MAAM,QAAQ,2BAA2B,CAAC,EACrD,MAAM,IAAM,MAAM,MAAM,sBAAsB,CAAC,EACpD,MACR,CAEIkH,GACA,OAAO,KAAKA,EAAU,SAAU,sBAAsB,CAE9D,CAAC,CACL,CAAC,CACL,CAEA,SAASnC,IAAc,CACnB,IAAMlF,EAAM,SAAS,eAAe,oBAAoB,EACnDA,GAELA,EAAI,iBAAiB,QAAS,SAAY,CACtC,GAAI,OAAO,QAAY,KAAe,CAAC,QAAQ,gBAAgB,EAAG,CAC9D,MAAM,QAAQ,mCAAmC,EACjD,OAAO,SAAS,KAAO,wBAA0B,mBAAmB,OAAO,SAAS,QAAQ,EAC5F,MACJ,CAEA,IAAMiB,EAAYzD,GAAgB,IAAM,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UAC3F,GAAKyD,EAEL,GAAI,CACA,IAAMiB,EAAO,MAAM,UAAU,KAAK,YAAa,CAAE,WAAYjB,CAAU,EAAG,CAAE,aAAc,EAAK,CAAC,EAC5FiB,EAAK,SACL,MAAM,QAAQA,EAAK,SAAW,kBAAkB,EAChDlC,EAAI,aAAa,eAAgB,MAAM,EACvCA,EAAI,UAAU,IAAI,kBAAkB,EACpCA,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,cAAc,GAE7D,MAAM,MAAMkC,EAAK,SAAW,0BAA0B,CAE9D,OAASqF,EAAK,CAEV,GAAI,CACA,IAAM1C,EAAM,YACN2C,EAAO,KAAK,MAAM,aAAa,QAAQ3C,CAAG,GAAK,IAAI,EACzD,GAAI,CAAC2C,EAAK,SAASvG,CAAS,EAAG,CAC3BuG,EAAK,KAAKvG,CAAS,EACnB,aAAa,QAAQ4D,EAAK,KAAK,UAAU2C,CAAI,CAAC,EAC9C,MAAM,QAAQ,0BAA0B,EACxCxH,EAAI,aAAa,eAAgB,MAAM,EACvCA,EAAI,UAAU,IAAI,kBAAkB,EACpC,MACJ,CACA,MAAM,KAAK,yBAAyB,CACxC,MAAY,CACR,MAAM,MAAMuH,EAAI,SAAW,0BAA0B,CACzD,CACJ,CACJ,CAAC,CACL,CAGA,SAASjF,IAA0B,CAC/B,IAAMtC,EAAM,SAAS,eAAe,oBAAoB,EACnDA,GACLA,EAAI,iBAAiB,QAAS,MAAOb,GAAM,CACvCA,EAAE,eAAe,EAEjB,IAAM8B,EAAY,SAAS,eAAe,gBAAgB,GAAG,QAAQ,UACrE,GAAKA,EAEL,GAAI,CACA,GAAI,OAAO,QAAY,KAAe,CAAC,QAAQ,gBAAgB,EAAG,CAC9D,MAAM,QAAQ,mCAAmC,EACjD,OAAO,SAAS,KAAO,wBAA0B,mBAAmB,OAAO,SAAS,QAAQ,EAC5F,MACJ,CAGA,IAAMiB,EAAO,MAAM,UAAU,KAAK,YAAa,CAAE,WAAYjB,CAAU,EAAG,CAAE,aAAc,EAAK,CAAC,EAC5FiB,EAAK,SACL,MAAM,QAAQA,EAAK,SAAW,kBAAkB,EAChDlC,EAAI,aAAa,eAAgB,MAAM,EACvCA,EAAI,UAAU,IAAI,kBAAkB,EACpCA,EAAI,cAAc,KAAK,GAAG,aAAa,OAAQ,cAAc,GAE7D,MAAM,MAAMkC,EAAK,SAAW,0BAA0B,CAE9D,OAASqF,EAAK,CAEV,GAAI,CACA,IAAM1C,EAAM,YACN2C,EAAO,KAAK,MAAM,aAAa,QAAQ3C,CAAG,GAAK,IAAI,EACzD,GAAI,CAAC2C,EAAK,SAASvG,CAAS,EAAG,CAC3BuG,EAAK,KAAKvG,CAAS,EACnB,aAAa,QAAQ4D,EAAK,KAAK,UAAU2C,CAAI,CAAC,EAC9C,MAAM,QAAQ,0BAA0B,EACxCxH,EAAI,aAAa,eAAgB,MAAM,EACvCA,EAAI,UAAU,IAAI,kBAAkB,EACpC,MACJ,CACA,MAAM,KAAK,yBAAyB,CACxC,MAAY,CACR,MAAM,MAAMuH,EAAI,SAAW,0BAA0B,CACzD,CACJ,CACJ,CAAC,CACL,CAEA,eAAevD,GAAgBzC,EAAS,CACpC,IAAMvD,EAAY,SAAS,eAAe,aAAa,EACvD,GAAI,CAACA,EAAW,OAEhB,IAAMyJ,EAAQ,CACV,CAAE,MAAO,OAAQ,IAAK,GAAI,EAC1B,CAAE,MAAO,WAAY,IAAK,YAAa,CAC3C,EAEA,GAAIlG,EAAQ,SACR,GAAI,GACiB,MAAM,cAAc,eAAeA,EAAQ,SAAS,EAAE,GAClC,MAAQ,CAAC,GAC1B,QAAQmG,GAAO,CAC/BD,EAAM,KAAK,CAAE,MAAOC,EAAI,KAAM,IAAK,eAAeA,EAAI,IAAI,GAAI,CAAC,CACnE,CAAC,CACL,MAAgB,CACZD,EAAM,KAAK,CAAE,MAAOlG,EAAQ,SAAS,KAAM,IAAK,eAAeA,EAAQ,SAAS,IAAI,GAAI,CAAC,CAC7F,CAGJkG,EAAM,KAAK,CAAE,MAAOlG,EAAQ,IAAK,CAAC,EAElCvD,EAAU,UAAY,WAAW,OAAOyJ,CAAK,CACjD,CAEA,eAAexD,GAAoB1C,EAAS,CACxC,IAAMvD,EAAY,SAAS,eAAe,kBAAkB,EAC5D,GAAKA,EAEL,GAAI,CAEA,IAAM2J,GADW,MAAM,YAAY,WAAWpG,EAAQ,GAAI,CAAE,MAAO,CAAE,CAAC,GAC5C,MAAQ,CAAC,EAEnC,GAAIoG,EAAS,SAAW,EAAG,CACvB3J,EAAU,UAAY,GACtB,MACJ,CAEAA,EAAU,UAAY;AAAA;AAAA;AAAA,sBAGZ2J,EAAS,IAAI,GAAK,YAAY,OAAO,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAI3D,YAAY,WAAW3J,CAAS,CACpC,OAASiF,EAAO,CACZ,QAAQ,MAAM,mCAAoCA,CAAK,EACvDjF,EAAU,UAAY,EAC1B,CACJ,CAEA,eAAekG,GAAY3C,EAAS,CAChC,IAAMvD,EAAY,SAAS,eAAe,mBAAmB,EAC7D,GAAKA,EAEL,QAAO,KAAKA,EAAW,SAAS,EAEhC,GAAI,CAEA,IAAM4J,GADW,MAAM,YAAY,WAAWrG,EAAQ,EAAE,GAC/B,MAAQ,CAAC,EAElCvD,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,wEAIsCuD,EAAQ,gBAAgB,QAAQ,CAAC,GAAK,KAAK;AAAA;AAAA,8BAErF,UAAU,YAAYA,EAAQ,gBAAkB,CAAC,CAAC;AAAA;AAAA,kEAEdA,EAAQ,cAAgB,CAAC;AAAA;AAAA,sBAErE,QAAQ,gBAAgB,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAM1B;AAAA;AAAA;AAAA,gEAGwC,mBAAmB,OAAO,SAAS,QAAQ,CAAC;AAAA;AAAA;AAAA;AAAA,qBAIvF;AAAA;AAAA;AAAA;AAAA,kBAIHqG,EAAQ,OAAS,EAAI;AAAA;AAAA,0BAEbA,EAAQ,IAAIC,GAAU;AAAA;AAAA;AAAA;AAAA,mFAImCA,EAAO,MAAM,aAAa,CAAC,GAAKA,EAAO,MAAM,QAAQ,CAAC,GAAK,KAAK,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA,sFAI1E,UAAU,WAAWA,EAAO,MAAM,YAAc,WAAW,CAAC;AAAA,8CACpGA,EAAO,kBAAoB;AAAA;AAAA,8CAEzB,EAAE;AAAA;AAAA;AAAA,8CAGJ,UAAU,YAAYA,EAAO,MAAM,CAAC;AAAA,kFACA,UAAU,WAAWA,EAAO,UAAU,CAAC;AAAA;AAAA,0CAE/EA,EAAO,MAAQ,8CAA8C,UAAU,WAAWA,EAAO,KAAK,CAAC,QAAU,EAAE;AAAA,wEAC7E,UAAU,WAAWA,EAAO,OAAO,CAAC;AAAA;AAAA;AAAA;AAAA,yBAInF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,kBAEf;AAAA;AAAA,iBAEH;AAAA,cAGL,SAAS,eAAe,kBAAkB,GAAG,iBAAiB,QAAS,IAAM,CACzEC,GAAevG,CAAO,CAC1B,CAAC,CACL,OAAS0B,EAAO,CACZ,QAAQ,MAAM,0BAA2BA,CAAK,EAC9CjF,EAAU,UAAY,qDAC1B,EACJ,CAEA,SAAS8J,GAAevG,EAAS,CAC7B,MAAM,KAAK,CACP,MAAO,iBACP,QAAS;AAAA;AAAA;AAAA;AAAA;AAAA,8BAKS,CAAC,EAAG,EAAG,EAAG,EAAG,CAAC,EAAE,IAAIwG,GAAK;AAAA,6HACsEA,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,6BAKjG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAc3B,YAAa,gBACb,UAAW,SAAY,CACnB,IAAMC,EAAS,SAAS,SAAS,eAAe,eAAe,EAAE,KAAK,EAChE7H,EAAQ,SAAS,eAAe,cAAc,EAAE,MAAM,KAAK,EAC3D8H,EAAU,SAAS,eAAe,gBAAgB,EAAE,MAAM,KAAK,EAErE,GAAI,CAACD,GAAUA,EAAS,EACpB,aAAM,MAAM,yBAAyB,EAC9B,GAGX,GAAI,CAACC,EACD,aAAM,MAAM,wBAAwB,EAC7B,GAGX,GAAI,CACA,aAAM,YAAY,aAAa1G,EAAQ,GAAI,CAAE,OAAAyG,EAAQ,MAAA7H,EAAO,QAAA8H,CAAQ,CAAC,EACrE,MAAM,QAAQ,4BAA4B,EAC1C/D,GAAY3C,CAAO,EACZ,EACX,OAAS0B,EAAO,CACZ,aAAM,MAAMA,EAAM,SAAW,0BAA0B,EAChD,EACX,CACJ,CACJ,CAAC,EAED,IAAMiF,EAAQ,SAAS,iBAAiB,cAAc,EAChDC,EAAc,SAAS,eAAe,eAAe,EAE3DD,EAAM,QAAQE,GAAQ,CAClBA,EAAK,iBAAiB,QAAS,IAAM,CACjC,IAAMJ,EAAS,SAASI,EAAK,QAAQ,MAAM,EAC3CD,EAAY,MAAQH,EAEpBE,EAAM,QAAQ,CAAC7B,EAAG0B,IAAM,CAChBA,EAAIC,GACJ3B,EAAE,UAAU,OAAO,eAAe,EAClCA,EAAE,UAAU,IAAI,iBAAiB,IAEjCA,EAAE,UAAU,IAAI,eAAe,EAC/BA,EAAE,UAAU,OAAO,iBAAiB,EAE5C,CAAC,CACL,CAAC,CACL,CAAC,CACL,CAGA,SAASvC,GAAevC,EAAS,CAC7B,GAAI,CACA,SAAS,MAAQ,GAAGA,EAAQ,IAAI,aAChC,IAAM8G,EAAO9G,EAAQ,kBAAoBA,EAAQ,mBAAqB,GACtE,SAAS,cAAc,0BAA0B,GAAG,aAAa,UAAW8G,CAAI,EAChF,SAAS,cAAc,2BAA2B,GAAG,aAAa,UAAW9G,EAAQ,YAAcA,EAAQ,IAAI,EAC/G,SAAS,cAAc,iCAAiC,GAAG,aAAa,UAAW8G,CAAI,EACvF,IAAMC,EAAU/G,EAAQ,SAAS,CAAC,GAAG,OAASA,EAAQ,MAClD+G,GAAS,SAAS,cAAc,2BAA2B,GAAG,aAAa,UAAWA,CAAO,EACjG,SAAS,cAAc,4BAA4B,GAAG,aAAa,UAAW/G,EAAQ,YAAcA,EAAQ,IAAI,EAChH,SAAS,cAAc,kCAAkC,GAAG,aAAa,UAAW8G,CAAI,CAC5F,MAAY,CAAC,CACjB,CAGA,SAAStE,GAAqBxC,EAAS,CACnC,GAAI,CACA,IAAMgH,EAAgB,SAAS,cAAc,uDAAuD,EACpG,GAAI,CAACA,EAAe,OACpB,IAAMC,EAAO,CACT,WAAY,qBACZ,QAAS,UACT,KAAMjH,EAAQ,KACd,OAAQA,EAAQ,QAAU,CAAC,GAAG,IAAIwG,GAAMA,EAAE,OAASA,CAAE,EACrD,YAAaxG,EAAQ,mBAAqBA,EAAQ,aAAe,GACjE,IAAKA,EAAQ,KAAO,GACpB,OAAQ,CACJ,QAAS,QACT,IAAK,OAAO,SAAS,KACrB,cAAeA,EAAQ,UAAY,OAAO,iBAAiB,UAAY,MACvE,MAAOA,EAAQ,eAAiBA,EAAQ,KAC5C,CACJ,EACAgH,EAAc,YAAc,KAAK,UAAUC,CAAI,CACnD,MAAY,CAAC,CACjB,CAGA,eAAerE,GAAoB5C,EAAS,CACxC,IAAMvD,EAAY,SAAS,eAAe,kBAAkB,EAC5D,GAAKA,EAEL,GAAI,CACA,GAAM,CAACyK,EAAKC,EAASC,CAAK,EAAI,MAAM,QAAQ,IAAI,CAC5C,YAAY,mBAAmBpH,EAAQ,GAAI,6BAA8B,CAAC,EAC1E,YAAY,mBAAmBA,EAAQ,GAAI,UAAW,CAAC,EACvD,YAAY,mBAAmBA,EAAQ,GAAI,oBAAqB,CAAC,CACrE,CAAC,EAGD,GAAIkH,EAAI,SAAWA,EAAI,MAAM,OAAQ,CACjC,IAAMG,EAAO;AAAA;AAAA;AAAA,+DAGkCH,EAAI,MAAQ,CAAC,GAAG,IAAInH,GAAK,YAAY,OAAOA,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,kBAGvGtD,EAAU,mBAAmB,YAAa4K,CAAI,CAClD,CAGA,GAAIF,EAAQ,SAAWA,EAAQ,MAAM,OAAQ,CACzC,IAAME,EAAO;AAAA;AAAA;AAAA,8EAGiDF,EAAQ,MAAQ,CAAC,GAAG,IAAIpH,GAAK,YAAY,OAAOA,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,kBAG1HtD,EAAU,mBAAmB,YAAa4K,CAAI,CAClD,CAGA,GAAID,EAAM,SAAWA,EAAM,MAAM,OAAQ,CACrC,IAAMC,EAAO;AAAA;AAAA;AAAA,8EAGiDD,EAAM,MAAQ,CAAC,GAAG,IAAIrH,GAAK,YAAY,OAAOA,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,kBAGxHtD,EAAU,mBAAmB,YAAa4K,CAAI,CAClD,CAEA,YAAY,WAAW5K,CAAS,CACpC,MAAc,CAEd,CACJ,CAGA,SAASoG,IAAmB,CAExB,GAAI,CADc,SAAS,eAAe,gBAAgB,GACxC,OAAO,qBAAyB,IAAa,OAE/D,IAAMyE,EAAW,IAAI,qBAAsBnH,GAAY,CACnDA,EAAQ,QAAQC,GAAS,CACrB,GAAI,CAACA,EAAM,eAAgB,OAC3B,IAAMmH,EAASnH,EAAM,OACjBmH,EAAO,GAGPA,EAAO,KAAO,WAAaA,EAAO,GAGtCD,EAAS,UAAUC,CAAM,CAC7B,CAAC,CACL,EAAG,CAAE,WAAY,OAAQ,CAAC,EAE1B,SAAS,iBAAiB,6BAA6B,EAAE,QAAQzD,GAAM,CACnEwD,EAAS,QAAQxD,CAAE,CACvB,CAAC,CACL,CAEA,eAAehB,GAAiB9C,EAAS,CACrC,GAAI,CACA,MAAM,YAAY,UAAUA,EAAQ,EAAE,CAC1C,MAAgB,CAEhB,CACJ,CAEA,SAASwH,GAAU,CACfvL,EAAiB,KACjBC,EAAkB,KAClBC,EAAU,KACVC,EAAc,EAClB,CAEA,MAAO,CACH,KAAAI,EACA,QAAAgL,CACJ,CACJ,GAAG,EAEH,OAAO,YAAc1L,GACdD,GAAQC,KC9wDf,IAAA2L,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAKMC,GAmeCD,GAxePE,GAAAC,GAAA,KAKMF,IAAc,UAAW,CAC3B,aAEA,IAAIG,EAAe,GACfC,EAAc,EACdC,EAAiB,CAAC,EAClBC,EAAkB,KAClBC,EAAc,GAElB,eAAeC,GAAO,CAElB,GAAID,EAAa,OACjBA,EAAc,GAGd,IAAME,EAAmB,SAAS,eAAe,gBAAgB,GAAK,SAAS,eAAe,eAAe,EAG7G,GAFyBA,GAAoBA,EAAiB,cAAc,kCAAkC,EAExF,CAElBC,EAAe,EACfC,EAAY,EACZC,EAAY,EACZC,EAAe,EACf,MACJ,CAEAV,EAAeW,EAAgB,EAC/BT,EAAiBU,EAAkB,EACnCX,EAAc,SAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAAE,IAAI,MAAM,CAAC,GAAK,EAGnF,MAAMY,EAAa,EAEnBN,EAAe,EACfC,EAAY,EACZC,EAAY,EACZC,EAAe,CACnB,CAEA,SAASA,GAAiB,CACtB,IAAMI,EAAU,SAAS,eAAe,WAAW,EAC7CC,EAAU,SAAS,eAAe,WAAW,EAEnDD,GAAS,iBAAiB,QAAS,IAAM,CACrCA,EAAQ,UAAU,IAAI,iBAAkB,kBAAkB,EAC1DA,EAAQ,UAAU,OAAO,eAAe,EACxCC,GAAS,UAAU,OAAO,iBAAkB,kBAAkB,EAC9DA,GAAS,UAAU,IAAI,eAAe,EACtC,SAAS,IAAI,kBAAmB,MAAM,EACtCF,EAAa,CACjB,CAAC,EAEDE,GAAS,iBAAiB,QAAS,IAAM,CACrCA,EAAQ,UAAU,IAAI,iBAAkB,kBAAkB,EAC1DA,EAAQ,UAAU,OAAO,eAAe,EACxCD,GAAS,UAAU,OAAO,iBAAkB,kBAAkB,EAC9DA,GAAS,UAAU,IAAI,eAAe,EACtC,SAAS,IAAI,kBAAmB,MAAM,EACtCD,EAAa,CACjB,CAAC,CACL,CAEA,eAAeA,GAAe,CAC1B,IAAMP,EAAmB,SAAS,eAAe,gBAAgB,GAAK,SAAS,eAAe,eAAe,EACvGU,EAAe,SAAS,eAAe,eAAe,GAAK,SAAS,eAAe,eAAe,EAExG,GAAKV,EAEL,CAAIH,GACAA,EAAgB,MAAM,EAE1BA,EAAkB,IAAI,gBAEtB,OAAO,KAAKG,EAAkB,UAAU,EAExC,GAAI,CACA,IAAMW,EAAS,CACX,KAAMhB,EACN,SAAU,GACV,GAAGC,CACP,EAQA,GANIF,IACAiB,EAAO,OAASjB,GAIP,OAAO,SAAS,WAChB,eAAgB,CAEzB,MAAMkB,EAAe,EACrB,MACJ,CAEA,IAAMC,EAAW,MAAM,YAAY,YAAYF,CAAM,EAC/CG,EAAW,MAAM,QAAQD,CAAQ,EAAIA,EAAYA,EAAS,MAAQA,EAAS,SAAW,CAAC,EACvFE,EAAOF,EAAS,MAAQ,CAAC,EAE3BH,IACIhB,EACAgB,EAAa,YAAc,GAAGK,EAAK,OAASD,EAAS,MAAM,iBAAiB,UAAU,WAAWpB,CAAY,CAAC,IAE9GgB,EAAa,YAAc,GAAGK,EAAK,OAASD,EAAS,MAAM,aAInEE,EAAcF,EAAUC,CAAI,EAC5B,MAAME,EAAkB,CAC5B,OAASC,EAAO,CACZ,GAAIA,EAAM,OAAS,aAAc,OACjC,QAAQ,MAAM,2BAA4BA,CAAK,EAC/ClB,EAAiB,UAAY,yFACjC,EACJ,CAEA,eAAeY,GAAiB,CAC5B,IAAMZ,EAAmB,SAAS,eAAe,gBAAgB,GAAK,SAAS,eAAe,eAAe,EACvGU,EAAe,SAAS,eAAe,eAAe,GAAK,SAAS,eAAe,eAAe,EAClGS,EAAY,SAAS,eAAe,YAAY,EAEtD,GAAKnB,EAEL,GAAI,CACA,IAAMa,EAAW,MAAM,cAAc,cAAc,CAAE,MAAO,EAAG,CAAC,EAC1DO,EAAa,MAAM,QAAQP,CAAQ,EAAIA,EAAYA,EAAS,MAAQA,EAAS,SAAW,CAAC,EAU/F,GARIM,IACAA,EAAU,YAAc,kBAGxBT,IACAA,EAAa,YAAc,GAAGU,EAAW,MAAM,eAG/CA,EAAW,SAAW,EAAG,CACzBpB,EAAiB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAS7B,MACJ,CAEAA,EAAiB,UAAY;AAAA;AAAA,sBAEnBoB,EAAW,IAAIC,GAAO;AAAA,+CACGA,EAAI,IAAI;AAAA,yFACkC,SAAS,QAAQ,KAAO,KAAK;AAAA,kCACpFA,EAAI,MAAQ;AAAA,gDACEA,EAAI,KAAK,UAAU,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA,kCAC7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAMH;AAAA;AAAA;AAAA,yHAGwF,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA,kCACrHA,EAAI,cAAgB,yCAAyCA,EAAI,aAAa,gBAAkB,EAAE;AAAA;AAAA;AAAA,qBAG/G,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,aAGvB,OAASH,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EACjDlB,EAAiB,UAAY,2FACjC,CACJ,CAEA,SAASK,GAAkB,CAEvB,OADe,IAAI,gBAAgB,OAAO,SAAS,MAAM,EAC3C,IAAI,GAAG,GAAK,EAC9B,CAEA,SAASC,GAAoB,CACzB,IAAMK,EAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnDW,EAAU,CAAC,EAEjB,OAAIX,EAAO,IAAI,UAAU,IAAGW,EAAQ,SAAWX,EAAO,IAAI,UAAU,GAChEA,EAAO,IAAI,WAAW,IAAGW,EAAQ,SAAWX,EAAO,IAAI,WAAW,GAClEA,EAAO,IAAI,WAAW,IAAGW,EAAQ,SAAWX,EAAO,IAAI,WAAW,GAClEA,EAAO,IAAI,UAAU,IAAGW,EAAQ,SAAWX,EAAO,IAAI,UAAU,GAChEA,EAAO,IAAI,UAAU,IAAGW,EAAQ,QAAUX,EAAO,IAAI,UAAU,IAAM,QACrEA,EAAO,IAAI,MAAM,IAAGW,EAAQ,OAASX,EAAO,IAAI,MAAM,IAAM,QAC5DA,EAAO,IAAI,UAAU,IAAGW,EAAQ,SAAWX,EAAO,IAAI,UAAU,IAAM,QAEnEW,CACX,CAEA,SAASrB,GAAiB,CACtB,IAAMsB,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAc,SAAS,eAAe,cAAc,EAEtDA,IACAA,EAAY,MAAQ9B,GAGxB6B,GAAY,iBAAiB,SAAWE,GAAM,CAC1CA,EAAE,eAAe,EACjB,IAAMC,EAAQF,GAAa,MAAM,KAAK,EAElCE,IACAhC,EAAegC,EACf/B,EAAc,EACdgC,EAAU,EACVC,EAAc,EAEtB,CAAC,EAGD,IAAMC,EAAuB,SAAS,eAAe,oBAAoB,EACrEC,EAAgB,KAEpBN,GAAa,iBAAiB,QAAUC,GAAM,CAC1C,IAAMC,EAAQD,EAAE,OAAO,MAAM,KAAK,EAIlC,GAFA,aAAaK,CAAa,EAEtBJ,EAAM,OAAS,EAAG,CACdG,IACAA,EAAqB,UAAY,GACjCA,EAAqB,UAAU,IAAI,QAAQ,GAE/C,MACJ,CAEAC,EAAgB,WAAW,SAAY,CACnC,GAAI,CAEA,IAAMhB,GADW,MAAM,YAAY,OAAO,CAAE,EAAGY,EAAO,MAAO,CAAE,CAAC,GACtC,MAAQ,CAAC,EAE/BG,GAAwBf,EAAS,OAAS,IAC1Ce,EAAqB,UAAY;AAAA;AAAA,kCAEvBf,EAAS,IAAIiB,GAAW;AAAA,yDACDA,EAAQ,IAAI;AAAA,0CAC3BA,EAAQ,MAAQ,aAAaA,EAAQ,KAAK,uFAAyF,0ZAA0Z;AAAA;AAAA,2FAE5e,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA,kFAC3C,UAAU,YAAYA,EAAQ,eAAiBA,EAAQ,iBAAmBA,EAAQ,KAAK,CAAC;AAAA;AAAA;AAAA,iCAGzI,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,0BAGnBF,EAAqB,UAAU,OAAO,QAAQ,EAEtD,OAASX,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,CACrD,CACJ,EAAG,GAAG,CACV,CAAC,EAGDM,GAAa,iBAAiB,OAAQ,IAAM,CACxC,WAAW,IAAM,CACTK,GACAA,EAAqB,UAAU,IAAI,QAAQ,CAEnD,EAAG,GAAG,CACV,CAAC,CACL,CAEA,eAAeD,GAAgB,CAE3B,MAAMrB,EAAa,CACvB,CAKA,SAASS,EAAcF,EAAUC,EAAM,CACnC,IAAMiB,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,GAAIlB,EAAS,SAAW,EAAG,CACvBkB,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4FAM0D,UAAU,WAAWtC,CAAY,CAAC;AAAA;AAAA;AAAA,cAIlH,MACJ,CAEA,IAAMuC,EAAW,QAAQ,IAAI,iBAAiB,GAAK,OAC7CC,EAAYD,IAAa,OACzB,YACA,gEAEND,EAAU,UAAY;AAAA,0BACJE,CAAS;AAAA,kBACjBpB,EAAS,IAAIiB,GAAW,YAAY,OAAOA,EAAS,CAAE,OAAQE,CAAS,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAEvFlB,EAAK,YAAc,EAAI;AAAA,2DACsB,WAAW,OAAO,CACzD,YAAaA,EAAK,cAAgBpB,EAClC,WAAYoB,EAAK,YACjB,WAAYA,EAAK,KACrB,CAAC,CAAC;AAAA,cACF,EAAE;AAAA,UAGV,YAAY,WAAWiB,CAAS,EAEJ,SAAS,eAAe,mBAAmB,GAClD,iBAAiB,QAAUP,GAAM,CAClD,IAAMU,EAAUV,EAAE,OAAO,QAAQ,aAAa,EAC1CU,IACAxC,EAAc,SAASwC,EAAQ,QAAQ,IAAI,EAC3CR,EAAU,EACVC,EAAc,EACd,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,EAEtD,CAAC,CACL,CAEA,eAAeX,GAAoB,CAC/B,IAAMmB,EAAsB,SAAS,eAAe,mBAAmB,EACvE,GAAKA,EAEL,GAAI,CAEA,IAAMhB,GADW,MAAM,cAAc,OAAO,CAAE,aAAc,GAAM,MAAO,EAAG,CAAC,GACjD,MAAQ,CAAC,EAErCgB,EAAoB,UAAY;AAAA;AAAA;AAAA,uEAG4BxC,EAAe,SAAuB,GAAZ,SAAc;AAAA;AAAA;AAAA,sBAG1FwB,EAAW,IAAIC,GAAO;AAAA;AAAA,yEAE6BA,EAAI,EAAE,KAAKzB,EAAe,WAAa,OAAOyB,EAAI,EAAE,EAAI,UAAY,EAAE;AAAA,uEACxE,UAAU,WAAWA,EAAI,IAAI,CAAC;AAAA;AAAA,qBAEhF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,cAInBgB,EAAmB,CACvB,MAAgB,CAEhB,CACJ,CAEA,SAASA,GAAqB,CACH,SAAS,iBAAiB,wBAAwB,EAC1D,QAAQC,GAAS,CAC5BA,EAAM,iBAAiB,SAAWb,GAAM,CAChCA,EAAE,OAAO,MACT7B,EAAe,SAAW6B,EAAE,OAAO,MAEnC,OAAO7B,EAAe,SAE1BD,EAAc,EACdgC,EAAU,EACVC,EAAc,CAClB,CAAC,CACL,CAAC,CACL,CAEA,SAAS1B,GAAc,CACnB,IAAMqC,EAAgB,SAAS,eAAe,oBAAoB,EAC5DC,EAAkB,SAAS,eAAe,iBAAiB,EAC3DC,EAAkB,SAAS,eAAe,eAAe,EAE/DF,GAAe,iBAAiB,QAAS,IAAM,CAC3C,IAAMG,EAAW,SAAS,eAAe,kBAAkB,GAAG,MACxDC,EAAW,SAAS,eAAe,kBAAkB,GAAG,MAE1DD,EAAU9C,EAAe,UAAY8C,EACpC,OAAO9C,EAAe,UAEvB+C,EAAU/C,EAAe,UAAY+C,EACpC,OAAO/C,EAAe,UAE3BD,EAAc,EACdgC,EAAU,EACVC,EAAc,CAClB,CAAC,EAEDY,GAAiB,iBAAiB,SAAWf,GAAM,CAC3CA,EAAE,OAAO,QACT7B,EAAe,SAAW,GAE1B,OAAOA,EAAe,SAE1BD,EAAc,EACdgC,EAAU,EACVC,EAAc,CAClB,CAAC,EAEDa,GAAiB,iBAAiB,QAAS,IAAM,CAC7C7C,EAAiB,CAAC,EAClBD,EAAc,EAEd,SAAS,iBAAiB,wBAAwB,EAAE,QAAQiD,GAAK,CAC7DA,EAAE,QAAUA,EAAE,QAAU,EAC5B,CAAC,EAED,IAAMC,EAAW,SAAS,eAAe,kBAAkB,EACrDC,EAAW,SAAS,eAAe,kBAAkB,EACvDD,IAAUA,EAAS,MAAQ,IAC3BC,IAAUA,EAAS,MAAQ,IAE3BN,IAAiBA,EAAgB,QAAU,IAE/Cb,EAAU,EACVC,EAAc,CAClB,CAAC,EAGD,IAAMiB,EAAW,SAAS,eAAe,kBAAkB,EACrDC,EAAW,SAAS,eAAe,kBAAkB,EACvDD,GAAYjD,EAAe,YAAWiD,EAAS,MAAQjD,EAAe,WACtEkD,GAAYlD,EAAe,YAAWkD,EAAS,MAAQlD,EAAe,WACtE4C,GAAmB5C,EAAe,WAAU4C,EAAgB,QAAU,GAC9E,CAEA,SAASrC,GAAc,CACnB,IAAM4C,EAAa,SAAS,eAAe,aAAa,EACnDA,IAELA,EAAW,MAAQnD,EAAe,UAAY,GAE9CmD,EAAW,iBAAiB,SAAWtB,GAAM,CACrCA,EAAE,OAAO,MACT7B,EAAe,SAAW6B,EAAE,OAAO,MAEnC,OAAO7B,EAAe,SAE1BD,EAAc,EACdgC,EAAU,EACVC,EAAc,CAClB,CAAC,EACL,CAEA,SAASD,GAAY,CACjB,IAAMhB,EAAS,IAAI,gBAEfjB,GAAciB,EAAO,IAAI,IAAKjB,CAAY,EAC1CE,EAAe,UAAUe,EAAO,IAAI,WAAYf,EAAe,QAAQ,EACvEA,EAAe,WAAWe,EAAO,IAAI,YAAaf,EAAe,SAAS,EAC1EA,EAAe,WAAWe,EAAO,IAAI,YAAaf,EAAe,SAAS,EAC1EA,EAAe,UAAUe,EAAO,IAAI,WAAYf,EAAe,QAAQ,EACvEA,EAAe,UAAUe,EAAO,IAAI,WAAY,MAAM,EACtDhB,EAAc,GAAGgB,EAAO,IAAI,OAAQhB,CAAW,EAEnD,IAAMqD,EAAS,GAAG,OAAO,SAAS,QAAQ,IAAIrC,EAAO,SAAS,CAAC,GAC/D,OAAO,QAAQ,UAAU,CAAC,EAAG,GAAIqC,CAAM,CAC3C,CAEA,SAASC,GAAU,CACXpD,IACAA,EAAgB,MAAM,EACtBA,EAAkB,MAEtBH,EAAe,GACfC,EAAc,EACdC,EAAiB,CAAC,EAClBE,EAAc,EAClB,CAEA,MAAO,CACH,KAAAC,EACA,QAAAkD,CACJ,CACJ,GAAG,EAEH,OAAO,WAAa1D,GACbD,GAAQC,KCxef,IAAA2D,GAAA,GAAAC,GAAAD,GAAA,aAAAE,KAAA,IAMMC,GAy4BCD,GA/4BPE,GAAAC,GAAA,KAMMF,IAAgB,UAAW,CAC7B,aAEA,IAAIG,EAAc,EACdC,EAAc,aACdC,EAAgB,MAGpB,SAASC,GAAoB,CACzB,OAAO,OAAO,kBAAkB,QAAU,QAC9C,CAGA,IAAMC,EAAS,CACX,IAAI,iBAAkB,CAAE,OAAOD,EAAkB,CAAG,EACpD,gBAAiB,CACb,IAAK,CAAE,MAAO,MAAO,MAAO,OAAQ,KAAM,QAAI,EAC9C,OAAQ,CAAE,MAAO,SAAU,MAAO,OAAQ,KAAM,QAAI,EACpD,KAAM,CAAE,MAAO,OAAQ,MAAO,QAAS,KAAM,QAAI,EACjD,OAAQ,CAAE,MAAO,SAAU,MAAO,MAAO,KAAM,QAAI,CACvD,CACJ,EAEA,eAAeE,GAAO,CACb,UAAU,YAAY,IAE3B,MAAMC,EAAa,EACnBC,EAAiB,EACrB,CAEA,SAASC,EAAoBC,EAAO,CAAC,EAAG,CACpC,IAAMC,EAAUD,EAAK,SAAWA,GAAQ,CAAC,EACnCE,EAAa,CACfF,EAAK,cACLC,EAAQ,cACRA,EAAQ,cACRA,EAAQ,MACR,MAAM,QAAQA,EAAQ,MAAM,EAAIA,EAAQ,OAAO,CAAC,EAAI,KACpDA,EAAQ,UACRA,EAAQ,SACZ,EAEME,EAAQC,GAAQ,CAClB,GAAI,CAACA,EAAK,MAAO,GACjB,GAAI,OAAOA,GAAQ,SAAU,OAAOA,EACpC,GAAI,OAAOA,GAAQ,SAAU,CACzB,GAAI,OAAOA,EAAI,OAAU,UAAYA,EAAI,MAAO,OAAOA,EAAI,MAC3D,GAAIA,EAAI,OAAS,OAAOA,EAAI,OAAU,SAAU,CAC5C,GAAI,OAAOA,EAAI,MAAM,KAAQ,UAAYA,EAAI,MAAM,IAAK,OAAOA,EAAI,MAAM,IACzE,GAAI,OAAOA,EAAI,MAAM,KAAQ,UAAYA,EAAI,MAAM,IAAK,OAAOA,EAAI,MAAM,GAC7E,CACA,GAAI,OAAOA,EAAI,KAAQ,UAAYA,EAAI,IAAK,OAAOA,EAAI,IACvD,GAAI,OAAOA,EAAI,KAAQ,UAAYA,EAAI,IAAK,OAAOA,EAAI,GAC3D,CACA,MAAO,EACX,EAEA,QAAWC,KAAaH,EAAY,CAChC,IAAMI,EAAMH,EAAKE,CAAS,EAC1B,GAAIC,EAAK,OAAOA,CACpB,CAEA,MAAO,EACX,CAEA,SAASC,EAAcP,EAAO,CAAC,EAAG,CAC9B,IAAMC,EAAUD,EAAK,SAAWA,GAAQ,CAAC,EAEnCQ,EAAcJ,GAAQ,CACxB,GAAIA,GAAQ,KAA2B,OAAO,KAC9C,IAAMK,EAAM,OAAOL,CAAG,EACtB,OAAO,OAAO,SAASK,CAAG,EAAIA,EAAM,IACxC,EAEMC,EAAkB,CACpBV,EAAK,cACLC,EAAQ,MACRD,EAAK,MACLA,EAAK,cACLA,EAAK,YACT,EAEIW,EAAQ,KACZ,QAAWC,KAAKF,EAEZ,GADAC,EAAQH,EAAWI,CAAC,EAChBD,IAAU,KAAM,MAGxB,IAAME,EAAiB,CACnBb,EAAK,mBACLC,EAAQ,WACRD,EAAK,UACT,EAEIc,EAAY,KAChB,QAAWC,KAAKF,EAEZ,GADAC,EAAYN,EAAWO,CAAC,EACpBD,IAAc,KAAM,MAI5B,IAAME,EAAcR,EAAWR,EAAK,iBAAiB,EAC/CiB,EAAeT,EAAWR,EAAK,kBAAkB,EACjDkB,EAAcV,EAAWR,EAAK,YAAY,EAC1CmB,EAAaX,EAAWR,EAAK,YAAY,EAE/C,MAAO,CACH,MAAOW,IAAU,KAAOA,EAAQ,EAChC,UAAWG,IAAc,KAAOA,EAAY,KAC5C,YAAAE,EACA,aAAAC,EACA,YAAAC,EACA,WAAAC,CACJ,CACJ,CAEA,eAAetB,GAAe,CAC1B,IAAMuB,EAAY,SAAS,eAAe,oBAAoB,EAC9D,GAAKA,EAEL,QAAO,KAAKA,EAAW,UAAU,EAEjC,GAAI,CACA,IAAMC,EAAW,MAAM,YAAY,YAAY,CAAE,KAAM9B,EAAa,KAAMC,CAAY,CAAC,EACnF8B,EAAQ,CAAC,EACTC,EAAO,CAAC,EAER,MAAM,QAAQF,CAAQ,EACtBC,EAAQD,EACDA,GAAY,OAAOA,GAAa,WACvCC,EAAQD,EAAS,MAAQA,EAAS,SAAWA,EAAS,OAAS,CAAC,EAC5D,CAAC,MAAM,QAAQC,CAAK,GAAKD,EAAS,MAAQ,OAAOA,EAAS,MAAS,UACnEC,EAAQD,EAAS,KAAK,OAASA,EAAS,KAAK,SAAW,CAAC,EACzDE,EAAOF,EAAS,KAAK,MAAQA,EAAS,MAAQ,CAAC,GAE/CE,EAAOF,EAAS,MAAQ,CAAC,GAI5B,MAAM,QAAQC,CAAK,IACpBA,EAAQA,GAAS,OAAOA,GAAU,SAAW,CAACA,CAAK,EAAI,CAAC,GAI5D,IAAIE,EAAgBF,EAChB7B,IAAkB,UAClB+B,EAAgBF,EAAM,OAAOtB,GAAQ,CACjC,IAAMyB,EAASlB,EAAcP,CAAI,EACjC,OAAOyB,EAAO,WAAaA,EAAO,UAAYA,EAAO,KACzD,CAAC,EACMhC,IAAkB,WACzB+B,EAAgBF,EAAM,OAAOtB,GAAQA,EAAK,cAAgB,EAAK,EACxDP,IAAkB,aACzB+B,EAAgBF,EAAM,OAAOtB,GAAQ,CACjC,IAAMyB,EAASlB,EAAcP,CAAI,EACjC,OAAOyB,EAAO,YAAcA,EAAO,MAAQA,EAAO,UACtD,CAAC,EACMhC,IAAkB,cACzB+B,EAAgBF,EAAM,OAAOtB,GAAQ,CACjC,IAAMyB,EAASlB,EAAcP,CAAI,EACjC,OAAOyB,EAAO,aAAeA,EAAO,OAASA,EAAO,WACxD,CAAC,GAGLC,EAAeF,EAAeF,EAAOC,CAAI,CAC7C,OAASI,EAAO,CACZ,IAAMC,EAAOD,IAAUA,EAAM,SAAWA,EAAM,SAAY,2BAE1D,GAAIA,GAASA,EAAM,SAAW,IAAK,CAC/B,UAAU,gBAAgB,EAC1B,MACJ,CAEAP,EAAU,UAAY,4CAA4C,UAAU,WAAWQ,CAAG,CAAC,MAC/F,EACJ,CAEA,SAASF,EAAeF,EAAeK,EAAUN,EAAM,CACnD,IAAMH,EAAY,SAAS,eAAe,oBAAoB,EAC9D,GAAI,CAACA,EAAW,OAGhB,IAAMU,EAAaD,EAAS,OACtBE,EAAcF,EAAS,OAAO7B,GAAQ,CACxC,IAAMY,EAAIL,EAAcP,CAAI,EAC5B,OAAOY,EAAE,WAAaA,EAAE,UAAYA,EAAE,KAC1C,CAAC,EAAE,OACGoB,EAAiBH,EAAS,OAAO7B,GAAQ,CAC3C,IAAMY,EAAIL,EAAcP,CAAI,EAC5B,OAAOY,EAAE,YAAcA,EAAE,MAAQA,EAAE,UACvC,CAAC,EAAE,OACGqB,EAAgBJ,EAAS,OAAO7B,GAAQ,CAC1C,IAAMY,EAAIL,EAAcP,CAAI,EAC5B,OAAOY,EAAE,aAAeA,EAAE,OAASA,EAAE,WACzC,CAAC,EAAE,OAEH,GAAIkB,IAAe,EAAG,CAClBV,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAYtB,MACJ,CAwFA,GAtFAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mFAMqDU,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wFAwBLA,CAAU;AAAA;AAAA;AAAA,uHAGqBC,EAAc,EAAI,wBAA0B,EAAE;AAAA,6FACxEA,CAAW;AAAA;AAAA;AAAA,uHAGeC,EAAiB,EAAI,uBAAyB,EAAE;AAAA,2FAC5EA,CAAc;AAAA;AAAA;AAAA,uHAGcC,EAAgB,EAAI,wBAA0B,EAAE;AAAA,6FAC1EA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iGASTxC,IAAkB,MAAQ,4BAA8B,+DAA+D;AAAA,iGACvHA,IAAkB,UAAY,4BAA8B,+DAA+D;AAAA,iGAC3HA,IAAkB,WAAa,4BAA8B,+DAA+D;AAAA,iGAC5HA,IAAkB,aAAe,4BAA8B,+DAA+D;AAAA,iGAC9HA,IAAkB,YAAc,4BAA8B,+DAA+D;AAAA;AAAA;AAAA;AAAA;AAAA,qDAKzKD,IAAgB,aAAe,WAAa,EAAE;AAAA,oDAC/CA,IAAgB,YAAc,WAAa,EAAE;AAAA,oDAC7CA,IAAgB,YAAc,WAAa,EAAE;AAAA,qDAC5CA,IAAgB,aAAe,WAAa,EAAE;AAAA,mDAChDA,IAAgB,WAAa,WAAa,EAAE;AAAA,+CAChDA,IAAgB,OAAS,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOrEgC,EAAc,IAAIxB,GAAQkC,EAAmBlC,CAAI,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,cAGhEwB,EAAc,SAAW,GAAKM,EAAa,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA,cAK7C,EAAE;AAAA;AAAA,cAEJP,EAAK,YAAc,EAAI,oDAAsD,EAAE;AAAA,UAIjFA,GAAQA,EAAK,YAAc,EAAG,CAC9B,IAAMY,EAAQ,SAAS,eAAe,qBAAqB,EAC3D,GAAIA,GAAS,OAAO,WAAY,CAC5B,IAAMC,EAAY,IAAI,OAAO,WAAW,CACpC,WAAYb,EAAK,YACjB,YAAaA,EAAK,cAAgBhC,EAClC,UAAW,iBACX,SAAW8C,GAAS,CAChB9C,EAAc8C,EACdxC,EAAa,EACb,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,CAClD,CACJ,CAAC,EACDsC,EAAM,UAAY,GAClBA,EAAM,YAAYC,EAAU,OAAO,CAAC,CACxC,CACJ,CAEAE,EAAW,CACf,CAEA,SAASJ,EAAmBlC,EAAM,CAC9B,GAAI,CACA,IAAMC,EAAUD,EAAK,SAAWA,GAAQ,CAAC,EACnCuC,EAAcvC,EAAK,cAAgBC,EAAQ,MAAQ,GACnDuC,EAAcxC,EAAK,cAAgBC,EAAQ,MAAQ,GACnDwC,EAAUzC,EAAK,cAAgB,OAAYA,EAAK,YAAeC,EAAQ,cAAgB,OAAYA,EAAQ,YAAeA,EAAQ,eAAiB,EACnJyC,EAAW3C,EAAoBC,GAAQ,CAAC,CAAC,EACzC2C,EAAmB,CAAC,CAAC3C,EAAK,qBAE5B4C,EAAW,CAAE,MAAO,EAAG,UAAW,KAAM,YAAa,KAAM,aAAc,KAAM,YAAa,KAAM,WAAY,IAAK,EACvH,GAAI,CAAEA,EAAWrC,EAAcP,GAAQ,CAAC,CAAC,CAAG,MAAQ,CAAE4C,EAAW,CAAE,MAAO,EAAG,UAAW,IAAK,CAAG,CAChG,GAAM,CAAE,MAAAjC,EAAO,UAAAG,EAAW,YAAAE,EAAa,aAAAC,EAAc,YAAAC,EAAa,WAAAC,CAAW,EAAIyB,EAG3EC,EAAe/B,GAAaH,EAC5BmC,GAAe3B,GAAc0B,EAAe1B,EAC5C4B,GAAqB5B,EAAa,KAAK,OAAQ0B,EAAe1B,GAAcA,EAAc,GAAG,EAAI,EACjG6B,GAAa9B,GAAe2B,GAAgB3B,EAC5C+B,GAAWnC,GAAaA,EAAYH,EAGpCuC,GAAWlD,EAAK,UAAY,SAC5BmD,GAAiBxD,EAAO,gBAAgBuD,EAAQ,GAAKvD,EAAO,gBAAgB,OAE5EyD,GAAcrC,IAAM,CACtB,GAAI,CAAE,OAAO,UAAU,WAAWA,IAAK,EAAE,CAAG,MAAQ,CAAE,OAAO,OAAOA,IAAK,EAAE,CAAG,CAClF,EAEMsC,GAAmBzC,IAAM,CAC3B,GAAI,CAAE,OAAO,MAAM,OAAO,CAAE,MAAOA,GAAE,MAAO,UAAWA,GAAE,SAAU,CAAC,CAAG,MAAQ,CAAE,MAAO,2BAA2BjB,EAAO,eAAe,GAAGiB,GAAE,OAAS,CAAC,SAAW,CACvK,EAEM0C,GAAe1C,IAAM,CACvB,GAAI,CAAE,OAAO,UAAU,YAAYA,EAAC,CAAG,MAAQ,CAAE,MAAO,GAAGjB,EAAO,eAAe,GAAGiB,EAAC,EAAI,CAC7F,EAEM2C,GAAatD,GAAWA,EAAQ,SAAWA,EAAQ,OAAO,MAAQA,EAAQ,OAAO,OAASA,EAAQ,OAAO,OAAS,GAAGA,EAAQ,OAAO,KAAK,IAAIA,EAAQ,OAAO,MAAM,GAAK,QAAW,MAExL,MAAO;AAAA;AAAA,qCAEkBD,GAAQA,EAAK,GAAKA,EAAK,GAAK,EAAE;AAAA,wCAC1BC,GAAWA,EAAQ,GAAMA,EAAQ,GAAMD,GAAQA,EAAK,QAAWA,EAAK,QAAU,EAAE;AAAA,0CAC/EoD,GAAWZ,CAAW,CAAC;AAAA,kDACfG,CAAgB;AAAA,sCAC5BO,EAAQ;AAAA;AAAA;AAAA,iEAGmBK,EAAS;AAAA;AAAA;AAAA,8BAG5CN,GAAW;AAAA;AAAA,uCAEF,KAAK,OAAO,EAAInC,EAAYH,GAAS,GAAG,CAAC;AAAA;AAAA,8BAEhD,EAAE;AAAA,8BACJmC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA,sCAKP,KAAK,IAAIC,EAAkB,CAAC;AAAA;AAAA,8BAElC,EAAE;AAAA,8BACJC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAOX,EAAE;AAAA,8BACHP,EAIC,GAJS;AAAA;AAAA;AAAA;AAAA,6BAIP;AAAA;AAAA;AAAA;AAAA;AAAA,yJAKuHU,GAAe,KAAK,+DAA+DA,GAAe,KAAK,mBAAmBnD,EAAK,EAAE;AAAA,wDAClOmD,GAAe,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAY9BC,GAAWZ,CAAW,CAAC;AAAA,8BACtCE,EAAW;AAAA;AAAA,2CAEEA,CAAQ;AAAA,2CACRU,GAAWb,CAAW,CAAC;AAAA;AAAA;AAAA;AAAA,8BAIlC;AAAA;AAAA,6BAEH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAMHtC,GAAWA,EAAQ,SAAW;AAAA,mDACLmD,GAAWnD,EAAQ,SAAS,IAAI,CAAC;AAAA,kCAClDmD,GAAWnD,EAAQ,SAAS,IAAI,CAAC;AAAA;AAAA,0BAEvC,EAAE;AAAA;AAAA,iDAEmBmD,GAAWZ,CAAW,CAAC;AAAA,kCACtCY,GAAWb,CAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAM3Bc,GAAgB,CAAE,MAAA1C,EAAO,UAAAG,CAAU,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,0BAIzCE,GAAeE,EAAc;AAAA;AAAA,kCAErBF,EAAc;AAAA;AAAA;AAAA,uGAGuDsC,GAAYtC,CAAW,CAAC;AAAA;AAAA,kCAE3F,EAAE;AAAA,kCACJE,EAAc;AAAA;AAAA;AAAA,uGAGuDoC,GAAYpC,CAAW,CAAC;AAAA;AAAA,kCAE3F,EAAE;AAAA;AAAA,0BAEV,EAAE;AAAA;AAAA;AAAA,0BAGJjB,GAAWA,EAAQ,eAAiB;AAAA;AAAA,kCAE5B,UAAU,YAAYA,EAAQ,cAAc,CAAC;AAAA,0FACWA,EAAQ,cAAgB,CAAC;AAAA;AAAA,0BAEvF,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAMKwC,EAAuB,GAAb,UAAe;AAAA;AAAA;AAAA;AAAA;AAAA,kCAK1BE,EAAmB,UAAaF,EAAU,MAAQ,UAAW;AAAA;AAAA,wQAEyKzC,EAAK,EAAE,yBAAyB6C,CAAY;AAAA,6DACvP3B,EAAc,eAAiB,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAQ5ElB,GAAQA,EAAK,SAAW;AAAA;AAAA,wFAE0C,UAAU,WAAWA,EAAK,QAAQ,CAAC;AAAA;AAAA,sBAEnG,EAAE;AAAA;AAAA,aAGlB,OAASwD,EAAK,CACV,eAAQ,MAAM,kCAAmCA,CAAG,EAC7C,wHACX,CACJ,CAEA,SAAS1D,GAAmB,CAExB,SAAS,eAAe,eAAe,GAAG,iBAAiB,SAAW2D,GAAM,CACxEjE,EAAciE,EAAE,OAAO,MACvB5D,EAAa,CACjB,CAAC,EAGD,SAAS,iBAAiB,aAAa,EAAE,QAAQ6D,GAAO,CACpDA,EAAI,iBAAiB,QAAS,IAAM,CAChCjE,EAAgBiE,EAAI,QAAQ,OAC5B7D,EAAa,CACjB,CAAC,CACL,CAAC,CACL,CAEA,SAASyC,GAAa,CAClB,IAAMqB,EAAc,SAAS,eAAe,oBAAoB,EAC1DC,EAAY,SAAS,eAAe,qBAAqB,EACzDC,EAAW,SAAS,eAAe,oBAAoB,EACvDC,EAAgB,SAAS,iBAAiB,gBAAgB,EAC1DC,EAAa,SAAS,eAAe,eAAe,EACpDC,EAAa,SAAS,iBAAiB,aAAa,EAG1DD,GAAY,iBAAiB,SAAWN,GAAM,CAC1CjE,EAAciE,EAAE,OAAO,MACvB5D,EAAa,CACjB,CAAC,EAGDmE,EAAW,QAAQN,GAAO,CACtBA,EAAI,iBAAiB,QAAS,IAAM,CAChCjE,EAAgBiE,EAAI,QAAQ,OAC5B7D,EAAa,CACjB,CAAC,CACL,CAAC,EAGD8D,GAAa,iBAAiB,QAAS,SAAY,CAQ/C,GAPkB,MAAM,MAAM,QAAQ,CAClC,MAAO,iBACP,QAAS,gEACT,YAAa,YACb,WAAY,QAChB,CAAC,EAGG,GAAI,CACA,MAAM,YAAY,MAAM,EACxB,MAAM,QAAQ,mBAAmB,EACjC,MAAM9D,EAAa,CACvB,OAAS8B,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,2BAA2B,CAC5D,CAER,CAAC,EAGDiC,GAAW,iBAAiB,QAAS,SAAY,CAC7C,IAAMF,EAAME,EACZF,EAAI,SAAW,GACfA,EAAI,UAAY,mWAEhB,GAAI,CAEA,IAAMpC,EAAQ,SAAS,iBAAiB,wDAAwD,EAC5F2C,EAAQ,EACRC,EAAS,EAEb,QAAWlE,KAAQsB,EAAO,CACtB,IAAM6C,EAAYnE,EAAK,QAAQ,UAC/B,GAAKmE,EAEL,GAAI,CACA,MAAM,QAAQ,QAAQA,EAAW,CAAC,EAClCF,GACJ,MAAc,CACVC,GACJ,CACJ,CAEID,EAAQ,IACR,MAAM,QAAQ,SAASA,CAAK,iBAAiB,EAC7C,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,GAEtDC,EAAS,GACT,MAAM,QAAQ,GAAGA,CAAM,4DAA4D,CAE3F,OAASvC,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,8BAA8B,CAC/D,QAAE,CACE+B,EAAI,SAAW,GACfA,EAAI,UAAY,6UACpB,CACJ,CAAC,EAGDG,GAAU,iBAAiB,QAAS,SAAY,CAC5C,GAAI,CACA,IAAMO,EAAW,GAAG,OAAO,SAAS,MAAM,mBAEtC,UAAU,MACV,MAAM,UAAU,MAAM,CAClB,MAAO,cACP,KAAM,yBACN,IAAKA,CACT,CAAC,GAED,MAAM,UAAU,UAAU,UAAUA,CAAQ,EAC5C,MAAM,QAAQ,oCAAoC,EAE1D,OAASzC,EAAO,CACRA,EAAM,OAAS,cACf,MAAM,MAAM,2BAA2B,CAE/C,CACJ,CAAC,EAGDmC,EAAc,QAAQ9D,GAAQ,CAC1B,IAAMqE,EAASrE,EAAK,QAAQ,OACtBmE,EAAYnE,EAAK,QAAQ,UACzBwC,EAAcxC,EAAK,QAAQ,YAGjCA,EAAK,cAAc,aAAa,GAAG,iBAAiB,QAAS,SAAY,CACrE,GAAI,CACA,MAAM,YAAY,WAAWqE,CAAM,EACnC,MAAM,QAAQ,wBAAwB,EACtCrE,EAAK,OAAO,EAEM,SAAS,iBAAiB,gBAAgB,EAC9C,SAAW,GACrB,MAAMH,EAAa,CAE3B,OAAS8B,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,CACJ,CAAC,EAGD3B,EAAK,cAAc,eAAe,GAAG,iBAAiB,QAAS,SAAY,CACvE,IAAMsE,EAAa,CAAC,MAAO,SAAU,OAAQ,QAAQ,EAC/CC,EAAkBvE,EAAK,QAAQ,UAAY,SAC3CwE,EAAeF,EAAW,QAAQC,CAAe,EACjDE,EAAeH,GAAYE,EAAe,GAAKF,EAAW,MAAM,EAEtE,GAAI,CAEI,YAAY,YACZ,MAAM,YAAY,WAAWD,EAAQ,CAAE,SAAUI,CAAa,CAAC,EAInEzE,EAAK,QAAQ,SAAWyE,EACxB,IAAMf,EAAM1D,EAAK,cAAc,eAAe,EACxC0E,GAAS/E,EAAO,gBAAgB8E,CAAY,EAClDf,EAAI,MAAQ,aAAagB,GAAO,KAAK,GACrChB,EAAI,UAAY,yBAAyBgB,GAAO,IAAI,UACpDhB,EAAI,UAAY,+GAA+GgB,GAAO,KAAK,4CAE3I,MAAM,QAAQ,mBAAmBA,GAAO,KAAK,EAAE,CACnD,MAAgB,CACZ,MAAM,MAAM,4BAA4B,CAC5C,CACJ,CAAC,EAGD1E,EAAK,cAAc,iBAAiB,GAAG,iBAAiB,QAAS,SAAY,CACzE,IAAM6C,EAAe,WAAW7C,EAAK,cAAc,iBAAiB,EAAE,QAAQ,YAAY,GAAK,EAEzF2E,EAAU;AAAA;AAAA;AAAA;AAAA;AAAA,2FAK2DhF,EAAO,eAAe,GAAGkD,EAAa,eAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,mEAK9ElD,EAAO,eAAe;AAAA,sFACH,KAAK,MAAMkD,EAAe,EAAG,CAAC,kBAAkBA,CAAY;AAAA;AAAA,kGAEhDlD,EAAO,eAAe,GAAG,KAAK,MAAMkD,EAAe,EAAG,EAAE,eAAe,CAAC;AAAA;AAAA;AAAA,kBAKpJ+B,EAAY,MAAM,MAAM,KAAK,CAC/B,MAAO,mBACP,QAAAD,EACA,YAAa,YACb,WAAY,SACZ,UAAW,SAAY,CACnB,IAAMzD,EAAc,WAAW,SAAS,eAAe,oBAAoB,EAAE,KAAK,EAElF,GAAI,CAACA,GAAeA,GAAe,EAC/B,aAAM,MAAM,oCAAoC,EACzC,GAGX,GAAI,CACA,OAAI,YAAY,YACZ,MAAM,YAAY,WAAWmD,EAAQ,CAAE,aAAcnD,CAAY,CAAC,EAEtE,MAAM,QAAQ,uBAAuBvB,EAAO,eAAe,GAAGuB,EAAY,eAAe,CAAC,EAAE,EAC5F,MAAMrB,EAAa,EACZ,EACX,MAAgB,CACZ,aAAM,MAAM,4BAA4B,EACjC,EACX,CACJ,CACJ,CAAC,CACL,CAAC,EAGDG,EAAK,cAAc,kBAAkB,GAAG,iBAAiB,QAAS,MAAOyD,GAAM,CAC3E,IAAMC,EAAMD,EAAE,OAAO,QAAQ,kBAAkB,EAC/C,GAAIC,EAAI,SAAU,OAElBA,EAAI,SAAW,GACf,IAAMmB,EAAenB,EAAI,UAKzB,GAJAA,EAAI,UAAY,qVAES1D,EAAK,QAAQ,qBAAuB,QAAUA,EAAK,QAAQ,qBAAuB,QAAUA,EAAK,QAAQ,qBAAuB,IAEnI,CAClB8E,EAAkB9E,CAAI,EACtB0D,EAAI,SAAW,GACfA,EAAI,UAAYmB,EAChB,MACJ,CAEA,GAAI,CACA,MAAM,QAAQ,QAAQV,EAAW,CAAC,EAClC,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASxC,EAAO,CAQZ,GAPwB,GACpBA,IACKA,EAAM,QAAUA,EAAM,OAAO,YAC7BA,EAAM,SAAW,OAAOA,EAAM,SAAY,UAAYA,EAAM,QAAQ,YAAY,EAAE,SAAS,SAAS,MAKzG,MAAM,KAAK,4CAA4C,EACnDa,GAAa,CACb,OAAO,SAAS,KAAO,aAAaA,CAAW,IAC/C,MACJ,CAGJ,MAAM,MAAMb,EAAM,SAAW,wBAAwB,CACzD,QAAE,CACE+B,EAAI,SAAW,GACfA,EAAI,UAAYmB,CACpB,CACJ,CAAC,CACL,CAAC,CACL,CAEA,SAASE,EAAoBC,EAAU,CACnC,IAAMC,EAAU,CAAC,EACjB,OAAAD,EAAS,QAAQE,GAAW,CACnBD,EAAQC,EAAQ,cAAc,IAAGD,EAAQC,EAAQ,cAAc,EAAI,CAAC,GACzED,EAAQC,EAAQ,cAAc,EAAE,KAAKA,CAAO,CAChD,CAAC,EAEM,OAAO,QAAQD,CAAO,EAAE,IAAI,CAAC,CAACE,EAAUC,CAAO,IAAM;AAAA;AAAA,mEAED,UAAU,WAAWD,CAAQ,CAAC;AAAA,oFACb,UAAU,QAAQA,CAAQ,CAAC;AAAA,sBACzFC,EAAQ,IAAI,CAACC,EAAKC,IAAU;AAAA,wIACsFA,IAAU,EAAI,oDAAsD,uCAAuC,sBAAsBD,EAAI,EAAE,iBAAiBA,EAAI,iBAAmBA,EAAI,OAAS,EAAE,iBAAiBA,EAAI,gBAAkB,CAAC;AAAA,8BAChV,UAAU,WAAWA,EAAI,KAAK,CAAC;AAAA,8BAC9BA,EAAI,iBAAmBA,EAAI,MAAS,yCAAyC,UAAU,YAAYA,EAAI,iBAAmBA,EAAI,KAAK,CAAC,WAAa,EAAE;AAAA;AAAA,qBAE7J,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,SAGtB,EAAE,KAAK,EAAE,CACd,CAEA,eAAeP,EAAkB9E,EAAM,CAEnC,IAAMuF,EAAOvF,EAAK,cAAgBA,EAAK,SAAS,aAAe,GACzDwF,EAAKxF,EAAK,SAAWA,EAAK,SAAS,WAAa,GAEtD,GAAI,CAEA,IAAIyF,EACJ,GAAI,OAAO,YAAgB,KAAe,YAAY,WAClDA,EAAM,MAAM,YAAY,WAAWF,GAAQC,CAAE,MAC1C,CACH,IAAME,EAAY,OAAO,kBAAoB,OAAO,iBAAiB,MAAS,OAC9ED,EAAM,MAAM,UAAU,IAAI,qBAAqBF,GAAQC,CAAE,IAAK,CAAE,SAAAE,CAAS,CAAC,CAC9E,CAEA,GAAI,CAACD,GAAO,CAACA,EAAI,SAAW,CAACA,EAAI,KAAM,CACnC,IAAM7D,EAAM6D,GAAOA,EAAI,QAAUA,EAAI,QAAU,mCAC/C,MAAM,MAAM7D,CAAG,EACf,MACJ,CAEA,IAAM3B,EAAUwF,EAAI,KACdT,EAAW/E,EAAQ,UAAY,CAAC,EACtC,GAAI,CAAC+E,EAAS,OAAQ,CAElB,OAAO,SAAS,KAAO,aAAa/E,EAAQ,MAAQsF,GAAQC,CAAE,IAC9D,MACJ,CAEA,IAAMG,EAAa1F,EAAQ,SAAS,CAAC,GAAG,OAASA,EAAQ,eAAiBA,EAAQ,OAAS,GAErF0E,EAAU;AAAA;AAAA;AAAA,0BAGFgB,EAAa,aAAaA,CAAU,mDAAmD,UAAU,WAAW1F,EAAQ,IAAI,CAAC,KAAO,qDAAqD;AAAA;AAAA;AAAA,4DAGnJ,UAAU,WAAWA,EAAQ,IAAI,CAAC;AAAA,0FACJ,UAAU,YAAY+E,IAAW,CAAC,GAAG,iBAAmBA,IAAW,CAAC,GAAG,OAAS/E,EAAQ,KAAK,CAAC;AAAA;AAAA,8BAE1J8E,EAAoBC,CAAQ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAUzCJ,EAAY,MAAM,MAAM,KAAK,CAC/B,MAAO,iBACP,QAAAD,EACA,YAAa,cACb,WAAY,SACZ,KAAM,KACN,UAAW,SAAY,CAGnB,IAAMjB,EADS,SAAS,cAAc,gDAAgD,GAChE,SAAS,cAAc,6BAA6B,EAC1E,GAAI,CAACA,EACD,aAAM,MAAM,0BAA0B,EAC/B,GAEX,IAAMkC,EAAYlC,EAAI,QAAQ,UACxBmC,EAAM,SAAS,SAAS,eAAe,sBAAsB,GAAG,KAAK,GAAK,EAEhF,GAAI,CACA,aAAM,QAAQ,QAAQ5F,EAAQ,GAAI4F,EAAKD,CAAS,EAChD,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,EAC/C,EACX,OAASpC,EAAK,CACV,aAAM,MAAMA,EAAI,SAAW,wBAAwB,EAC5C,EACX,CACJ,CACJ,CAAC,EAGD,WAAW,IAAM,CACb,IAAMsC,EAAc,SAAS,iBAAiB,6BAA6B,EAC3EA,EAAY,QAAQpC,GAAO,CACvBA,EAAI,iBAAiB,QAAS,IAAM,CAChCoC,EAAY,QAAQC,GAAKA,EAAE,UAAU,OAAO,qBAAsB,gBAAiB,kBAAkB,CAAC,EACtGrC,EAAI,UAAU,IAAI,qBAAsB,gBAAiB,kBAAkB,EAE3E,IAAM/C,EAAQ+C,EAAI,QAAQ,MAC1B,GAAI/C,IAAU,OAAW,CACrB,IAAMqF,EAAU,SAAS,eAAe,wBAAwB,EAC5DA,IAASA,EAAQ,YAAc,UAAU,YAAYrF,CAAK,EAClE,CACJ,CAAC,CACL,CAAC,EAED,IAAMsF,EAAQ,SAAS,cAAc,6BAA6B,EAC9DA,GAAOA,EAAM,MAAM,CAC3B,EAAG,EAAE,CAET,MAAgB,CACZ,MAAM,MAAM,0BAA0B,CAC1C,CACJ,CAEA,SAASC,GAAU,CACf3G,EAAc,CAClB,CAEA,MAAO,CACH,KAAAK,EACA,QAAAsG,CACJ,CACJ,GAAG,EAEH,OAAO,aAAe9G,GACfD,GAAQC,8wBC/4Bf,IAAA+G,GAAAC,GAAA,KAKAC,KAc8EC,KAZ9E,IAAMC,IAAO,UAAW,CACpB,aAGA,IAAMC,EAAkB,CAAC,EAErBC,EAAc,KACdC,EAAoB,KAExB,eAAeC,EAAmBC,EAAM,CACpC,GAAI,CAEA,IAAMC,EAAM,MAAsDC,GAAA,WAAWF,CAAI,OACjF,OAAOC,EAAI,SAAWA,CAC1B,OAASE,EAAG,CACR,eAAQ,KAAK,uBAAuBH,CAAI,cAAeG,CAAC,EACjD,IACX,CACJ,CAEA,SAASC,GAAO,CACZC,EAAkB,EAClBC,EAAqB,EACrBC,EAAgB,EAChBC,EAAc,EACdC,EAAkB,EAClBC,EAAyB,EACzBC,EAAe,EACfC,EAAqB,EAMrB,GAAI,CACA,IAAMC,EAAa,YAAY,iBAAmB,YAAY,iBAAiB,YAAY,EAAI,CAAC,EAC1FC,EAAOD,GAAcA,EAAW,CAAC,GAAM,KACxCC,GAAOA,EAAI,OAAS,YAAe,CAAC,OAAO,SAAS,MACrD,WAAW,IAAM,CACb,IAAMC,EAAM,SAAS,kBAAoB,SAAS,gBAClD,GAAI,CAACA,EAAK,OACV,IAAMC,EAAWD,EAAI,WAAa,OAAO,aAAe,EAClDE,EAAY,KAAK,IAAI,EAAGF,EAAI,aAAe,OAAO,WAAW,EAE/DC,EAAW,KAAK,IAAI,IAAKC,EAAY,EAAG,GACxC,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,MAAO,CAAC,CAEpD,EAAG,EAAE,CAEb,MAAY,CAEZ,CACJ,CACA,eAAeR,GAAoB,CAE/B,GAAI,CAEA,GAAI,CAAC,QAAQ,gBAAgB,EAAG,CAC5B,IAAMS,EAAM,aAAa,QAAQ,UAAU,EAC3C,GAAIA,EAAK,CACL,IAAMC,EAAS,KAAK,MAAMD,CAAG,EAC7B,YAAY,YAAYC,CAAM,EAC9B,IAAMC,EAAQD,EAAO,OAAUA,EAAO,MAAQA,EAAO,KAAK,OAAU,CAAC,EACrEE,EAAoBD,CAAK,CAC7B,MAEIC,EAAoB,CAAC,CAAC,EAE1B,MACJ,CAGA,IAAMC,GADW,MAAM,YAAY,YAAY,CAAE,SAAU,GAAI,CAAC,GACvC,MAAQ,CAAC,EAC5BF,EAAQE,EAAQ,OAASA,EAAQ,MAAQ,CAAC,EAChD,YAAY,YAAYA,CAAO,EAC/BD,EAAoBD,CAAK,CAC7B,MAAgB,CACZ,GAAI,CACA,IAAMF,EAAM,aAAa,QAAQ,UAAU,EAC3C,GAAIA,EAAK,CACL,IAAMC,EAAS,KAAK,MAAMD,CAAG,EAC7B,YAAY,YAAYC,CAAM,EAC9B,IAAMC,EAAQD,EAAO,OAAUA,EAAO,MAAQA,EAAO,KAAK,OAAU,CAAC,EACrEE,EAAoBD,CAAK,CAC7B,CACJ,MAAY,CAEZ,CACJ,CACJ,CAGA,IAAIG,EAAqB,CAAC,EAG1B,SAASF,EAAoBD,EAAO,CAChC,GAAI,CACAG,EAAqBH,GAAS,CAAC,EAE/B,IAAMI,EAAU,CAAC,EACXC,EAAY,CAAC,GAElBL,GAAS,CAAC,GAAG,QAAQM,GAAM,CAExB,IAAMC,EAAOD,EAAG,SAAWA,EAAG,YAAeA,EAAG,SAAWA,EAAG,QAAQ,IAAO,KACvEE,EAAQF,EAAG,cAAiBA,EAAG,SAAWA,EAAG,QAAQ,MAAS,KAC9DG,EAAKH,EAAG,IAAMA,EAAG,IAAMA,EAAG,MAAQA,EAAG,MAAQ,KAC/CC,IAAKH,EAAQ,OAAOG,CAAG,CAAC,EAAIE,GAAM,IAClCD,IAAOH,EAAU,OAAOG,CAAK,CAAC,EAAIC,GAAM,GAChD,CAAC,EAED,SAAS,iBAAiB,eAAe,EAAE,QAAQC,GAAO,CACtD,GAAI,CACA,IAAMC,EAAMD,EAAI,cAAc,KAAK,EAC7BE,EAAWD,GAAK,cAAc,aAAa,EAC3CE,EAAYH,EAAI,QAAQ,WAAaA,EAAI,QAAQ,mBAAmB,GAAG,QAAQ,UAC/EI,EAAcJ,EAAI,QAAQ,aAAeA,EAAI,QAAQ,qBAAqB,GAAG,QAAQ,YAEvFK,EAAS,KACTF,GAAaT,EAAQ,eAAe,OAAOS,CAAS,CAAC,EAAGE,EAASX,EAAQ,OAAOS,CAAS,CAAC,EACrFC,GAAeT,EAAU,eAAe,OAAOS,CAAW,CAAC,IAAGC,EAASV,EAAU,OAAOS,CAAW,CAAC,GAEzGC,GACAL,EAAI,QAAQ,eAAiBK,EAC7BL,EAAI,UAAU,IAAI,cAAc,EAChCA,EAAI,aAAa,eAAgB,MAAM,EACvCC,GAAK,UAAU,IAAI,cAAc,EAC7BC,IAAUA,EAAS,MAAM,QAAU,OAEvCF,EAAI,gBAAgB,uBAAuB,EAC3CA,EAAI,UAAU,OAAO,cAAc,EACnCA,EAAI,aAAa,eAAgB,OAAO,EACxCC,GAAK,UAAU,OAAO,cAAc,EAChCC,IAAUA,EAAS,MAAM,QAAU,KAE/C,MAAY,CAEZ,CACJ,CAAC,CACL,MAAY,CAEZ,CACJ,EAGC,UAAW,CACR,GAAI,OAAO,iBAAqB,IAAa,OAC7C,IAAII,EAAgB,KACH,IAAI,iBAAiB,SAASC,EAAW,CACtD,IAAIC,EAAQ,GACZ,QAAWC,KAAKF,EAAW,CACvB,GAAIE,EAAE,YAAcA,EAAE,WAAW,QAC7B,QAAWC,KAAKD,EAAE,WACd,GAAIC,EAAE,WAAa,IAAMA,EAAE,UAAU,eAAe,GAAKA,EAAE,gBAAgB,eAAe,GAAKA,EAAE,gBAAgB,eAAe,GAAI,CAChIF,EAAQ,GAAM,KAClB,EAGR,GAAIA,EAAO,KACf,CACIA,IACA,aAAaF,CAAa,EAC1BA,EAAgB,WAAW,IAAM,CAC7B,GAAI,CAAEf,EAAoBE,CAAkB,CAAG,MAAY,CAAC,CAChE,EAAG,GAAG,EAEd,CAAC,EACQ,QAAQ,SAAS,KAAM,CAAE,UAAW,GAAM,QAAS,EAAK,CAAC,CACtE,GAAG,EAwBH,SAASlB,GAAoB,CACzB,IAAMoC,EAAO,OAAO,SAAS,SACvBC,EAAO,SAAS,KAGtB,GAAIA,EAAK,QAAQ,KAAM,CACnB7C,EAAc6C,EAAK,QAAQ,KAC3B,MACJ,CAIA,IAAKD,EAAK,WAAW,YAAY,GAAKA,EAAK,WAAW,WAAW,IAAM,EAAEA,EAAK,WAAW,mBAAmB,GAAKA,EAAK,WAAW,kBAAkB,GAAI,CACnJ5C,EAAc,KACd,MACJ,CAGI4C,IAAS,KAAOA,IAAS,SACzB5C,EAAc,OACP4C,IAAS,gBAAkBA,IAAS,aAC3C5C,EAAc,SACP4C,EAAK,WAAW,cAAc,GAAKA,IAAS,eACnD5C,EAAc,WACP4C,EAAK,WAAW,YAAY,GAAKA,IAAS,aACjD5C,EAAc,UACP4C,IAAS,YAAcA,EAAK,WAAW,SAAS,EACvD5C,EAAc,SACP4C,EAAK,WAAW,OAAO,EAC9B5C,EAAc,OACP4C,EAAK,WAAW,WAAW,EAClC5C,EAAc,WACP4C,IAAS,YAAcA,EAAK,WAAW,WAAW,GAAKA,EAAK,WAAW,mBAAmB,EACjG5C,EAAc,UACP4C,EAAK,WAAW,SAAS,EAChC5C,EAAc,SACP4C,EAAK,WAAW,WAAW,EAClC5C,EAAc,WACP4C,EAAK,WAAW,UAAU,IACjC5C,EAAc,UAEtB,CAEA,SAASS,GAAuB,CAKxB,OAAO,KAAS,KAAe,SAAS,cAAc,aAAa,GACnE,KAAK,KAAK,EAIV,OAAO,SAAa,KACpB,SAAS,iBAAiB,yBAAyB,EAAE,QAAQqC,GAAW,CACpE,IAAMC,EAAWD,EAAQ,QAAQ,eAC3BE,EAAS,SAAS,eAAeD,CAAQ,EAC3CC,GACA,SAAS,OAAOF,EAAS,CAAE,QAASE,EAAO,SAAU,CAAC,CAE9D,CAAC,EAIL,GAAI,CAAEC,GAAkB,CAAG,MAAY,CAAe,CAC1D,CAEA,eAAevC,GAAkB,CAC7B,GAAI,CAACV,EAAa,OAElB,GAAI,CACIC,GAAqB,OAAOA,EAAkB,SAAY,YAC1DA,EAAkB,QAAQ,CAElC,MAAY,CAAe,CAE3B,IAAMiD,EAAa,MAAMhD,EAAmBF,CAAW,EACvD,GAAIkD,GAAc,OAAOA,EAAW,MAAS,WAAY,CACrDjD,EAAoBiD,EACpB,GAAI,CAAE,MAAMjD,EAAkB,KAAK,CAAG,OAASK,EAAG,CAAE,QAAQ,MAAM,iCAAkCA,CAAC,CAAG,CAC5G,CACJ,CAGA,GAAI,CACI,kBAAmB,WACnB,UAAU,cAAc,SAAS,kBAAkB,EAAE,MAAM,IAAM,CAAC,CAAC,CAE3E,MAAY,CAAe,CAE3B,eAAeK,GAAgB,CAE3B,GADmB,SAAS,iBAAiB,mBAAmB,EAChD,OAChB,GAAI,CAEA,IAAMwC,GADW,MAAM,QAAQ,QAAQ,GAChB,MAAM,YAAc,EAE3C,GAAI,CAAE,aAAa,QAAQ,OAAQ,KAAK,UAAU,CAAE,WAAYA,EAAO,QAAS,KAAK,IAAI,CAAE,CAAC,CAAC,CAAG,MAAW,CAAC,CAC5GC,EAAgBD,CAAK,CACzB,MAAgB,CAEZ,GAAI,CACA,IAAM9B,EAAM,aAAa,QAAQ,MAAM,EACvC,GAAIA,EAAK,CAEL,IAAM8B,EADS,KAAK,MAAM9B,CAAG,GACP,YAAc,EACpC+B,EAAgBD,CAAK,EACrB,MACJ,CACJ,OAAS7C,EAAG,CACR,QAAQ,MAAM,qCAAsCA,CAAC,CACzD,CAEJ,CACJ,CAEA,eAAe+C,EAAmBjB,EAAW,CACzC,GAAI,CAKA,SAJiB,MAAM,YAAY,YAAY,CAAE,SAAU,GAAI,CAAC,GACvC,MAAQ,CAAC,GACZ,OAAS,CAAC,GACZ,KAAKkB,GAAQ,OAAOA,EAAK,OAAO,IAAM,OAAOlB,CAAS,CAAC,GAC7D,IAAM,IACxB,MAAgB,CACZ,OAAO,IACX,CACJ,CAEA,SAASgB,EAAgBD,EAAO,CACT,SAAS,iBAAiB,mBAAmB,EACrD,QAAQI,GAAS,CACxBA,EAAM,YAAcJ,EAAQ,GAAK,MAAQA,EACzCI,EAAM,UAAU,OAAO,SAAUJ,IAAU,CAAC,CAChD,CAAC,CACL,CAEA,SAAStC,GAA2B,CAEhC,SAAS,iBAAiB,eAAgB,SAAY,CAClD,MAAMF,EAAc,CACxB,CAAC,EAGD,SAAS,iBAAiB,mBAAoB,SAAY,CACtD,MAAMC,EAAkB,CAC5B,CAAC,EAGD,SAAS,iBAAiB,aAAc,IAAM,CAC1C4C,EAAa,EAAI,CACrB,CAAC,EAED,SAAS,iBAAiB,cAAe,IAAM,CAC3CA,EAAa,EAAK,CACtB,CAAC,EAGD,SAAS,iBAAiB,eAAe,EAAE,QAAQvB,GAAO,CACtD,GAAI,CACA,IAAMC,EAAMD,EAAI,cAAc,KAAK,EAC7BE,EAAWD,GAAK,cAAc,aAAa,EAC7CD,EAAI,UAAU,SAAS,cAAc,GACrCC,GAAK,UAAU,IAAI,cAAc,EAC7BC,IAAUA,EAAS,MAAM,QAAU,MAEnCA,IAAUA,EAAS,MAAM,QAAU,IAE/C,MAAY,CAEZ,CACJ,CAAC,EAGD,SAAS,iBAAiB,QAAS,MAAO7B,GAAM,CAC5C,IAAMmD,EAAcnD,EAAE,OAAO,QAAQ,wDAAwD,EAC7F,GAAImD,EAAa,CACbnD,EAAE,eAAe,EACjB,IAAM8B,EAAYqB,EAAY,QAAQ,WAAaA,EAAY,QAAQ,UAAYA,EAAY,QAAQ,UACvG,GAAI,CAACrB,EAAW,OAEhBqB,EAAY,SAAW,GACvB,IAAMC,EAAeD,EAAY,UACjCA,EAAY,UAAY,6VAExB,GAAI,CACA,MAAM,QAAQ,QAAQrB,EAAW,CAAC,EAClC,MAAM,QAAQ,gBAAgB,EAC9B,SAAS,cAAc,IAAI,YAAY,cAAc,CAAC,CAC1D,OAASuB,EAAO,CACZ,MAAM,MAAMA,EAAM,SAAW,wBAAwB,CACzD,QAAE,CACEF,EAAY,SAAW,GACvBA,EAAY,UAAYC,CAC5B,CACJ,CACJ,CAAC,EAGD,SAAS,iBAAiB,QAAS,MAAOpD,GAAM,CAC5C,IAAMsD,EAActD,EAAE,OAAO,QAAQ,uCAAuC,EAC5E,GAAIsD,EAAa,CAGb,GAFAtD,EAAE,eAAe,EAEb,CAAC,QAAQ,gBAAgB,EAAG,CAC5B,MAAM,QAAQ,6CAA6C,EAC3D,OAAO,SAAS,KAAO,wBAA0B,mBAAmB,OAAO,SAAS,QAAQ,EAC5F,MACJ,CAEA,IAAM8B,EAAYwB,EAAY,QAAQ,gBAAkBA,EAAY,QAAQ,WAAaA,EAAY,QAAQ,mBAAmB,GAAG,QAAQ,UAK3IA,EAAY,SAAW,GACvB,IAAIC,EAAiBD,EAAY,QAAQ,gBAAkB,GAEvD,CAACC,GAAkBD,EAAY,UAAU,SAAS,cAAc,IAChEC,EAAiB,MAAMR,EAAmBjB,CAAS,GAAK,IAI5D,IAAM0B,EADWF,EAAY,UAAU,SAAS,cAAc,GAC7BC,EAEjC,GAAI,CACA,GAAIC,EAAc,CACd,IAAMC,EAAM,MAAM,YAAY,WAAWF,CAAc,EACvDD,EAAY,UAAU,OAAO,cAAc,EAC3CA,EAAY,aAAa,eAAgB,OAAO,EAChDA,EAAY,cAAc,KAAK,GAAG,UAAU,OAAO,cAAc,EACjE,IAAMzB,EAAWyB,EAAY,cAAc,KAAK,GAAG,cAAc,aAAa,EAC1EzB,IAAUA,EAAS,MAAM,QAAU,KACvCyB,EAAY,gBAAgB,uBAAuB,EACnD,MAAM,QAAQ,wBAAwB,CAC1C,KAAO,CACH,IAAMI,EAAW,MAAM,YAAY,QAAQ5B,CAAS,EAC9C6B,EAAYD,EAAS,MAAM,IAAMA,EAAS,MAAM,MAAM,IAAM,MAAMX,EAAmBjB,CAAS,EAChG6B,IACAL,EAAY,QAAQ,eAAiBK,GAEzCL,EAAY,UAAU,IAAI,cAAc,EACxCA,EAAY,aAAa,eAAgB,MAAM,EAC/CA,EAAY,cAAc,KAAK,GAAG,UAAU,IAAI,cAAc,EAC9D,IAAMzB,EAAWyB,EAAY,cAAc,KAAK,GAAG,cAAc,aAAa,EAC1EzB,IAAUA,EAAS,MAAM,QAAU,KACvC,MAAM,QAAQ6B,EAAS,SAAW,oBAAoB,CAC1D,CACJ,OAASL,EAAO,CACZ,QAAQ,MAAM,iBAAkBA,CAAK,EACrC,MAAM,MAAMA,EAAM,SAAW,4BAA4B,CAC7D,QAAE,CACEC,EAAY,SAAW,EAC3B,CACJ,CACJ,CAAC,EAGD,SAAS,iBAAiB,QAAUtD,GAAM,CACtC,IAAM4D,EAAe5D,EAAE,OAAO,QAAQ,oCAAoC,EAC1E,GAAI4D,EAAc,CACd5D,EAAE,eAAe,EACjB,IAAM8B,EAAY8B,EAAa,QAAQ,WAAaA,EAAa,QAAQ,UACnE7B,EAAc6B,EAAa,QAAQ,YAErC7B,EACA,OAAO,SAAS,KAAO,aAAaA,CAAW,IACxCD,IAEH,OAAO,MAAU,KAAe,MAAM,cACtC,MAAM,cAAcA,CAAS,EAE7B,OAAO,SAAS,KAAO,aAAaA,CAAS,IAGzD,CACJ,CAAC,EAGD,SAAS,iBAAiB,QAAS,MAAO9B,GAAM,CAE5C,GADkBA,EAAE,OAAO,QAAQ,eAAe,EACnC,CACXA,EAAE,eAAe,EAEjB,GAAI,CACA,MAAM,QAAQ,OAAO,EACrB,MAAM,QAAQ,0BAA0B,EACxC,SAAS,cAAc,IAAI,YAAY,aAAa,CAAC,EACrD,OAAO,SAAS,KAAO,GAC3B,MAAgB,CACZ,MAAM,MAAM,mBAAmB,CACnC,CACJ,CACJ,CAAC,EAGD,IAAM6D,EAAe,SAAS,eAAe,aAAa,EACtDA,IACA,OAAO,iBAAiB,SAAU,SAAS,SAAS,IAAM,CAClD,OAAO,QAAU,IACjBA,EAAa,UAAU,OAAO,YAAa,qBAAqB,EAEhEA,EAAa,UAAU,IAAI,YAAa,qBAAqB,CAErE,EAAG,GAAG,CAAC,EAEPA,EAAa,iBAAiB,QAAS,IAAM,CACzC,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAS,CAAC,CAClD,CAAC,EAET,CAEA,SAASX,EAAaY,EAAY,CACT,SAAS,iBAAiB,mBAAmB,EAErD,QAAQC,GAAM,CACvB,IAAMC,EAAQD,EAAG,QAAQ,UACrBC,IAAU,YACVD,EAAG,UAAU,OAAO,SAAU,CAACD,CAAU,EAClCE,IAAU,cACjBD,EAAG,UAAU,OAAO,SAAUD,CAAU,CAEhD,CAAC,CACL,CAEA,SAAStD,GAAiB,CACtB,IAAMyD,EAAU,SAAS,eAAe,iBAAiB,EACnDC,EAAW,SAAS,eAAe,mBAAmB,EACtDC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAU,SAAS,eAAe,qBAAqB,EAE7D,SAASC,GAAW,CAChBF,GAAY,UAAU,OAAO,kBAAkB,EAC/CC,GAAS,UAAU,OAAO,QAAQ,EAClC,SAAS,KAAK,UAAU,IAAI,iBAAiB,CACjD,CAEA,SAASE,GAAY,CACjBH,GAAY,UAAU,IAAI,kBAAkB,EAC5CC,GAAS,UAAU,IAAI,QAAQ,EAC/B,SAAS,KAAK,UAAU,OAAO,iBAAiB,CACpD,CAEAH,GAAS,iBAAiB,QAASI,CAAQ,EAC3CH,GAAU,iBAAiB,QAASI,CAAS,EAC7CF,GAAS,iBAAiB,QAASE,CAAS,CAChD,CAIA,SAAS7D,GAAuB,CAC5B,IAAM8D,EAAc,SAAS,cAAc,0BAA0B,EAC/DC,EAAmB,SAAS,eAAe,mBAAmB,EAEhED,GAAeC,IACf,SAAS,OAAOD,EAAaC,CAAgB,EAE7CA,EAAiB,iBAAiB,iBAAiB,EAAE,QAAQxB,GAAQ,CACjEA,EAAK,iBAAiB,QAAS,SAAY,CACvC,IAAMyB,EAAOzB,EAAK,QAAQ,SAE1B,GAAI,CACA,MAAM,gBAAgB,YAAYyB,CAAI,EACtC,QAAQ,IAAI,WAAYA,CAAI,EAC5B,OAAO,SAAS,OAAO,CAC3B,MAAgB,CACZ,MAAM,MAAM,4BAA4B,CAC5C,CACJ,CAAC,CACL,CAAC,EAET,CAEA,SAASC,GAAU,CACX/E,GAAqB,OAAOA,EAAkB,SAAY,YAC1DA,EAAkB,QAAQ,EAE9BD,EAAc,KACdC,EAAoB,IACxB,CAEA,MAAO,CACH,KAAAM,EACA,QAAAyE,EACA,eAAgB,IAAMhF,EACtB,gBAAAoD,CACJ,CACJ,GAAG,EAGC,SAAS,aAAe,UACxB,SAAS,iBAAiB,mBAAoBtD,GAAI,IAAI,EAEtDA,GAAI,KAAK,EAGb,OAAO,IAAMA",
  "names": ["clsx", "classes", "c", "createElement", "tag", "id", "className", "attrs", "html", "text", "el", "key", "value", "addListener", "event", "handler", "options", "createFocusTrap", "container", "focusableElements", "firstElement", "lastElement", "e", "generateId", "createBackdrop", "keyboard", "init_utils", "__esmMin", "BaseComponent", "init_BaseComponent", "__esmMin", "init_utils", "_BaseComponent", "options", "generateId", "tag", "className", "attrs", "html", "createElement", "selector", "target", "event", "handler", "cleanup", "addListener", "listener", "e", "classes", "force", "name", "value", "attributes", "key", "content", "element", "property", "styles", "Alert_exports", "__export", "Alert", "init_Alert", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "typeConfig", "config", "alertElement", "clsx", "html", "message", "msgEl", "AlertDialog_exports", "__export", "AlertDialog", "init_AlertDialog", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "backdrop", "createBackdrop", "dialogElement", "header", "title", "messageDiv", "footer", "cancelBtn", "confirmBtn", "confirmBtnClasses", "createFocusTrap", "Avatar_exports", "__export", "Avatar", "init_Avatar", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "sizeClasses", "baseClasses", "clsx", "src", "alt", "initials", "bgColor", "bgClass", "Badge_exports", "__export", "Badge", "init_Badge", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "baseClasses", "variantClasses", "sizeClasses", "badgeElement", "clsx", "label", "Button_exports", "__export", "Button", "init_Button", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "baseClasses", "variantClasses", "sizeClasses", "buttonElement", "clsx", "label", "disabled", "loading", "ButtonGroup_exports", "__export", "ButtonGroup", "init_ButtonGroup", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "orientationClass", "groupElement", "clsx", "btnConfig", "index", "btn", "label", "onClick", "Breadcrumb_exports", "__export", "Breadcrumb", "init_Breadcrumb", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "breadcrumbElement", "clsx", "item", "index", "separator", "createElement", "span", "link", "label", "href", "Card_exports", "__export", "Card", "init_Card", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "baseClasses", "hoverClass", "cardElement", "clsx", "headerElement", "createElement", "html", "contentElement", "footerElement", "content", "contentDiv", "element", "Carousel_exports", "__export", "Carousel", "init_Carousel", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "slidesElement", "createElement", "item", "index", "slide", "img", "titleElement", "prevBtn", "nextBtn", "dotsElement", "dot", "slides", "dots", "Chart_exports", "__export", "Chart", "init_Chart", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "titleElement", "createElement", "svgElement", "maxValue", "d", "width", "height", "padding", "svg", "barWidth", "i", "barHeight", "x", "y", "rect", "text", "data", "newElement", "Checkbox_exports", "__export", "Checkbox", "init_Checkbox", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "checkboxClasses", "inputElement", "labelElement", "checked", "disabled", "Collapsible_exports", "__export", "Collapsible", "init_Collapsible", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "triggerElement", "createElement", "titleSpan", "chevron", "contentElement", "innerContent", "content", "inner", "Command_exports", "__export", "Command", "init_Command", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "backdrop", "createElement", "paletteElement", "inputElement", "resultsElement", "renderResults", "query", "filtered", "cmd", "noResults", "currentCategory", "categoryHeader", "cmdElement", "label", "shortcut", "e", "Combobox_exports", "__export", "Combobox", "init_Combobox", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "inputElement", "clsx", "listElement", "createElement", "renderList", "query", "filtered", "item", "noResults", "option", "e", "value", "i", "ContextMenu_exports", "__export", "ContextMenu", "init_ContextMenu", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "menuElement", "clsx", "item", "itemElement", "createElement", "iconSpan", "labelSpan", "e", "x", "y", "label", "onClick", "icon", "DatePicker_exports", "__export", "DatePicker", "init_DatePicker", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "inputElement", "clsx", "e", "nativeInput", "date", "year", "month", "day", "value", "Dialog_exports", "__export", "Dialog", "init_Dialog", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "backdrop", "createBackdrop", "sizeClasses", "dialogElement", "header", "title", "closeBtn", "contentDiv", "e", "keyboard", "createFocusTrap", "content", "DropdownMenu_exports", "__export", "DropdownMenu", "init_DropdownMenu", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "triggerBtn", "positionClass", "alignClass", "menuElement", "clsx", "item", "divider", "itemElement", "createElement", "iconSpan", "labelSpan", "e", "label", "onClick", "icon", "Drawer_exports", "__export", "Drawer", "init_Drawer", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "backdrop", "createBackdrop", "positionClasses", "drawerElement", "header", "title", "closeBtn", "contentDiv", "e", "keyboard", "translateClass", "Empty_exports", "__export", "Empty", "init_Empty", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "iconElement", "createElement", "titleElement", "messageElement", "actionBtn", "Form_exports", "__export", "Form", "init_Form", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "formElement", "clsx", "e", "field", "fieldContainer", "createElement", "label", "input", "errorDiv", "submitBtn", "formData", "name", "values", "value", "fieldName", "message", "HoverCard_exports", "__export", "HoverCard", "init_HoverCard", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "triggerElement", "cardElement", "clsx", "positions", "content", "Input_exports", "__export", "Input", "init_Input", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "inputElement", "clsx", "value", "disabled", "placeholder", "InputGroup_exports", "__export", "InputGroup", "init_InputGroup", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "groupElement", "clsx", "prefixEl", "createElement", "inputEl", "suffixEl", "InputOTP_exports", "__export", "InputOTP", "init_InputOTP", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "clsx", "i", "input", "e", "value", "Item_exports", "__export", "Item", "init_Item", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "baseClasses", "stateClasses", "itemElement", "clsx", "html", "selected", "disabled", "Label_exports", "__export", "Label", "init_Label", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "labelElement", "clsx", "html", "text", "required", "requiredSpan", "Kbd_exports", "__export", "Kbd", "init_Kbd", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "kbdElement", "clsx", "label", "NativeSelect_exports", "__export", "NativeSelect", "init_NativeSelect", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "selectElement", "clsx", "placeholderOption", "item", "optionElement", "value", "disabled", "label", "option", "Tooltip_exports", "__export", "Tooltip", "init_Tooltip", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "containerElement", "tooltipElement", "clsx", "arrow", "positions", "arrowPositions", "content", "Toggle_exports", "__export", "Toggle", "init_Toggle", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "baseClasses", "variantClasses", "sizeClasses", "toggleElement", "clsx", "pressed", "disabled", "ToggleGroup_exports", "__export", "ToggleGroup", "init_ToggleGroup", "__esmMin", "init_BaseComponent", "init_utils", "BaseComponent", "options", "orientationClass", "groupElement", "clsx", "item", "index", "isSelected", "btnClasses", "btn", "createElement", "value", "Toast_exports", "__export", "Toast", "init_Toast", "__esmMin", "init_BaseComponent", "init_utils", "_Toast", "BaseComponent", "options", "el", "onDone", "container", "position", "key", "createElement", "clsx", "containerElement", "toastElement", "iconElement", "messageElement", "closeBtn", "pos", "positions", "types", "icons", "message", "toast", "element", "style", "initLazyHydration", "root", "selector", "threshold", "observer", "entries", "obs", "entry", "el", "spec", "modulePath", "initName", "mod", "loader", "MODULE_REGISTRY", "fn", "e", "init_lazyHydrate", "__esmMin", "account_exports", "__export", "account_default", "AccountPage", "init_account", "__esmMin", "currentUser", "init", "loadUserProfile", "setupAvatarHandlers", "initProfileTabs", "initProfileForm", "initPasswordForm", "initAddressManagement", "initEnhancedFeatures", "initLoyaltyPoints", "initQuickStats", "initRecentActivity", "initNotificationPreferences", "initQuickReorder", "initAccountSecurityCheck", "container", "points", "tier", "tierColors", "nextTier", "nextTierPoints", "progress", "stats", "orders", "order", "statusColor", "firstItem", "preferences", "prefs", "input", "key", "recentProducts", "product", "btn", "productId", "score", "checks", "emailVerified", "hasPhone", "has2FA", "strongPassword", "scoreColor", "progressColor", "check", "renderProfile", "tabs", "panels", "setActive", "target", "panel", "isActive", "initial", "name", "memberSince", "avatarImg", "initTabs", "form", "firstNameInput", "lastNameInput", "emailInput", "phoneInput", "e", "formData", "data", "submitBtn", "error", "avatarInput", "avatarBtn", "removeBtn", "file", "currentPassword", "newPassword", "confirmPassword", "loadAddresses", "showAddressModal", "addresses", "addr", "bindAddressEvents", "addressId", "response", "address", "isEdit", "destroy", "cart_exports", "__export", "cart_default", "CartPage", "init_cart", "__esmMin", "cart", "savedForLater", "abandonedCartTimer", "giftState", "ABANDONED_CART_DELAY", "BOUND_ATTR", "setActiveCurrency", "parseAmount", "value", "numeric", "formatCartPrice", "amount", "getInitialGiftState", "gift", "giftWrapEnabled", "giftWrapAmount", "isGift", "giftWrap", "giftWrapCost", "applyGiftState", "nextState", "hasValue", "getTaxRate", "rate", "getFreeShippingThreshold", "cartThreshold", "fallback", "SHIPPING_ADDRESS_MESSAGE_HTML", "shippingAddressCache", "shippingAddressPromise", "shippingQuoteCache", "getSelectedDivision", "formatDivisionLabel", "division", "isAuthenticated", "getAddressesFromResponse", "response", "getDefaultShippingAddress", "resp", "addresses", "shippingAddresses", "addr", "type", "calculateTax", "taxableAmount", "updateShippingLocationLabel", "address", "locationEl", "divisionSelect", "buildShippingPayload", "subtotalValue", "itemCount", "productIds", "fetchShippingQuote", "cartData", "items", "sum", "item", "payload", "cacheKey", "currencyCode", "res", "methods", "cheapest", "min", "method", "minRate", "cost", "quote", "updateOrderSummaryTotals", "discountValue", "shippingEl", "taxEl", "totalEl", "giftWrapRow", "giftWrapCostEl", "tax", "init", "loadCart", "initCartActionButtons", "initCouponForm", "initEnhancedFeatures", "setButtonState", "button", "isLoading", "loadingText", "resolveErrorMessage", "error", "generic", "isGeneric", "msg", "normalized", "pickFromErrors", "errObj", "values", "first", "acc", "val", "candidates", "updateCouponUI", "couponCode", "applied", "nameEl", "form", "input", "applyBtn", "formRow", "messageEl", "renderValidationResults", "validation", "container", "issuesBox", "warningsBox", "issuesList", "warningsList", "issues", "warnings", "issue", "warn", "validateBtn", "lockBtn", "shareBtn", "count", "shareUrl", "initSavedForLater", "initAbandonedCartRecovery", "initFreeShippingProgress", "initRecommendedProducts", "initGiftOptions", "renderSavedForLater", "btn", "productId", "i", "abandonedCart", "showAbandonedCartRecovery", "startAbandonedCartTracking", "resetTimer", "showAbandonedCartReminder", "event", "modal", "updateFreeShippingProgress", "threshold", "subtotal", "remaining", "progress", "statusEl", "initDeliveryEstimate", "today", "minDays", "maxDays", "minDate", "maxDate", "formatDate", "date", "initDeliveryLocation", "select", "updateTotalsForLocation", "summary", "products", "product", "giftCheckbox", "giftDetails", "giftMessage", "giftMessageCount", "giftWrapCheckbox", "updateMessageCount", "renderGiftState", "persistGiftOptions", "debounce", "data", "state", "func", "wait", "timeout", "args", "initExpressCheckout", "hydrateServerCart", "renderCart", "subtotalEl", "discountRow", "discountEl", "savingsRow", "savingsEl", "savingsValue", "row", "qtyInput", "totalCell", "unitPriceCell", "imageEl", "bindCartEvents", "taxValue", "totalValue", "taxRate", "renderCartItem", "variant", "productSlug", "productName", "productImage", "priceAtAdd", "currentPrice", "lineTotal", "showOriginal", "cartItems", "clearCartBtn", "removeCouponBtn", "e", "cartItem", "itemId", "removeItem", "saveForLater", "current", "updateQuantity", "max", "quantity", "clearCart", "removeCoupon", "cartItemElement", "savedItem", "code", "submitBtn", "appliedCode", "originalText", "destroy", "category_exports", "__export", "category_default", "CategoryPage", "init_category", "__esmMin", "currentFilters", "currentPage", "currentCategory", "abortController", "initialized", "isLoadingMore", "hasMoreProducts", "allProducts", "compareList", "MAX_COMPARE", "init", "categorySlug", "getCategorySlugFromUrl", "headerContainer", "initFilterHandlers", "initSortHandler", "initViewToggle", "initEnhancedFeatures", "getFiltersFromUrl", "loadCategory", "initInfiniteScroll", "initCompareProducts", "initQuickView", "initPriceRangeSlider", "initActiveFiltersDisplay", "initProductCountDisplay", "loadMoreTrigger", "entries", "entry", "loadMoreProducts", "loadingIndicator", "params", "response", "products", "meta", "appendProducts", "updateUrl", "error", "container", "viewMode", "product", "productHtml", "tempDiv", "productEl", "updateCompareBar", "e", "compareBtn", "productId", "toggleCompare", "index", "p", "updateCompareButtons", "compareBar", "btn", "openCompareModal", "clearCompare", "modal", "quickViewBtn", "showQuickView", "modalContent", "img", "i", "qtyInput", "qtyMinus", "qtyPlus", "addToCartBtn", "val", "max", "qty", "minInput", "maxInput", "input", "updatePriceRangeDisplay", "display", "minVal", "maxVal", "updateActiveFiltersDisplay", "filters", "orderLabels", "f", "key", "applyFilters", "updateProductCount", "total", "countEl", "match", "attributes", "slug", "productsContainer", "filtersContainer", "categoryResponse", "renderCategoryHeader", "loadBreadcrumbs", "loadFilters", "loadProducts", "loadSubcategories", "category", "breadcrumbs", "items", "item", "filterOptions", "attr", "value", "bindFilterEvents", "applyPriceBtn", "inStockCheckbox", "onSaleCheckbox", "clearBtn", "attributeCheckboxes", "minPrice", "maxPrice", "checkbox", "updateAttributeFilters", "checkboxes", "cb", "newUrl", "renderProducts", "gridClass", "paginationContainer", "pageBtn", "subcategories", "sub", "mobileFilterBtn", "filterSidebar", "closeFilterBtn", "sortSelect", "gridBtn", "listBtn", "destroy", "checkout_exports", "__export", "checkout_default", "CheckoutPage", "init_checkout", "__esmMin", "cart", "checkoutData", "currentStep", "cartLoadFailed", "cartLoadError", "toNumber", "value", "fallback", "num", "SHIPPING_STORAGE_KEY", "SHIPPING_CACHE_TTL", "readStoredShipping", "raw", "data", "cost", "getCheckedShippingInput", "resolveShippingCost", "container", "cartPayload", "checked", "stored", "shippingEl", "existingRaw", "text", "display", "formatShippingDisplay", "info", "getPaymentFeeMeta", "selected", "summary", "feeAmount", "computePaymentFee", "total", "meta", "updatePaymentFeeRow", "totalValue", "row", "amountEl", "labelEl", "totalEl", "init", "loadCart", "loadUserAddresses", "initStepNavigation", "initFormValidation", "initOrderSummaryToggle", "initStepForms", "response", "renderOrderSummary", "error", "resolveErrorMessage", "generic", "isGeneric", "msg", "normalized", "pickFromErrors", "errObj", "values", "first", "acc", "val", "candidates", "getSubmitUi", "form", "button", "textEl", "spinnerEl", "arrowEl", "defaultText", "setSubmitLoading", "ui", "loading", "loadingText", "submitCheckoutForm", "options", "validate", "redirectUrl", "items", "itemCount", "countText", "el", "safeNumber", "getTaxRate", "escape", "renderItems", "item", "idx", "productName", "productImage", "variantName", "quantity", "unitPrice", "lineTotal", "subtotal", "discount", "baseTotal", "shippingInfo", "taxRate", "existingTaxRaw", "existingTax", "taxAmount", "giftWrapRow", "giftWrapCostEl", "giftWrapLabel", "giftWrapCostRaw", "giftWrapAmount", "giftWrapSelected", "giftWrapCost", "giftWrapVisible", "hasShipping", "shippingDisplay", "shippingCurrencyAttr", "feeMeta", "paymentFee", "itemsHtml", "feeRowHtml", "giftWrapRowHtml", "totalsHtml", "itemsTarget", "totalsTarget", "addresses", "shippingContainer", "shouldRender", "addr", "bindAddressSelection", "addressRadios", "newAddressForm", "radio", "e", "steps", "stepIndicators", "nextBtns", "prevBtns", "showStep", "stepNumber", "step", "indicator", "indicatorStep", "btn", "validateCurrentStep", "loadShippingMethods", "validateShippingAddress", "validateShippingMethod", "validatePaymentMethod", "clearStepErrors", "showInlineError", "fieldEl", "message", "name", "existing", "focusFirstInvalid", "input", "savedAddressRadio", "formData", "address", "missing", "field", "selector", "l", "emailEl", "params", "methods", "method", "index", "shippingRadios", "price", "updateShippingCost", "updatePaymentContinueState", "hasGateways", "submitButton", "buttonText", "fetchAndRenderPaymentGateways", "gateways", "existingCodes", "remoteCodes", "g", "c", "i", "err", "frag", "wrapper", "label", "loadStripeJsIfNeeded", "publishableKey", "resolve", "reject", "initStripeElements", "script", "stripe", "cardEl", "mountPoint", "errContainer", "shippingCostEl", "orderTotalEl", "numericCost", "toggle", "block", "hidden", "chevron", "isHidden", "code", "nameEl", "sameAsBillingCheckbox", "billingAddressForm", "handler", "targetForm", "placeOrderBtn", "placeOrderForm", "placeOrder", "infoForm", "shippingForm", "orderNotes", "billingForm", "order", "processStripePayment", "processPayPalPayment", "client_secret", "publishable_key", "result", "approval_url", "destroy", "contact_exports", "__export", "contact_default", "ContactPage", "init_contact", "__esmMin", "init", "initContactForm", "loadContactInfo", "initEnhancedFeatures", "initInteractiveMap", "initLiveChatButton", "initQuickContactOptions", "initFAQPreview", "initOfficeHoursStatus", "mapContainer", "lat", "lng", "address", "container", "options", "faqs", "faq", "index", "trigger", "item", "answer", "icon", "isOpen", "otherItem", "officeHours", "updateStatus", "now", "day", "hour", "form", "validator", "e", "submitBtn", "originalText", "formData", "data", "showSuccessState", "error", "successContainer", "info", "destroy", "faq_exports", "__export", "faq_default", "FAQPage", "init_faq", "__esmMin", "categories", "allFAQs", "init", "existingFAQList", "bindServerRenderedContent", "loadFAQs", "initSearch", "initEnhancedFeatures", "initVoiceSearch", "initFAQRating", "initContactPromo", "initPopularQuestions", "initShareQuestion", "initKeyboardNavigation", "trackFAQAnalytics", "SpeechRecognition", "recognition", "voiceBtn", "searchInput", "isListening", "event", "transcript", "content", "questionId", "ratingHtml", "e", "rateBtn", "helpful", "container", "ratings", "popularIds", "_", "id", "popularQuestions", "item", "questionText", "q", "link", "targetId", "targetItem", "trigger", "shareHtml", "copyBtn", "originalHtml", "faqItems", "currentIndex", "observer", "entries", "entry", "views", "categoryBtns", "categoryGroups", "btn", "b", "category", "cat", "toggle", "icon", "isOpen", "otherItem", "faqs", "groupByCategory", "renderFAQs", "error", "grouped", "faq", "categorizedFaqs", "searchTerm", "categoryNames", "renderFAQItem", "bindCategoryTabs", "bindAccordion", "question", "answer", "regex", "group", "debounceTimer", "query", "filterServerRenderedFAQs", "filtered", "matchingFaqs", "hint", "noResults", "visibleCount", "questionEl", "contentEl", "visibleItems", "destroy", "CategoryCard_exports", "__export", "CategoryCard", "category", "card", "cardInner", "imgSrc", "img", "err", "fallback", "overlay", "name", "count", "init_CategoryCard", "__esmMin", "home_exports", "__export", "home_default", "HomePage", "init_home", "__esmMin", "heroSliderInterval", "liveVisitorCount", "socialProofInterval", "countdownInterval", "init", "loadHeroBanners", "loadFeaturedProducts", "loadNewArrivals", "initNewsletterForm", "initScrollAnimations", "initQuickViewModal", "loadCategoriesShowcase", "loadBestSellers", "loadTestimonials", "err", "initLiveVisitorCounter", "initSocialProofPopups", "initRecentlyViewed", "initFlashSaleCountdown", "loadPromotions", "loadCustomOrderCTA", "e", "container", "fetchAndUpdateCount", "response", "data", "error", "recentPurchases", "index", "proofCount", "maxProofs", "fetchRecentPurchases", "showProof", "proof", "popup", "content", "section", "clearBtn", "viewed", "product", "badge", "countdown", "endTime", "updateCountdown", "now", "distance", "hours", "minutes", "seconds", "animatedElements", "observer", "entries", "entry", "animation", "el", "quickViewBtn", "productId", "modal", "modalContent", "reviewsResponse", "allReviews", "review", "card", "grid", "products", "banners", "banner", "_", "initHeroSlider", "totalSlides", "currentSlide", "slides", "dots", "prevBtn", "nextBtn", "goToSlide", "resetAutoplay", "dot", "slidesContainer", "touchStartX", "dx", "categories", "CategoryCard", "category", "imgEl", "promotions", "promo", "routeMap", "wizardUrl", "landingUrl", "cat", "form", "emailInput", "submitBtn", "email", "originalText", "destroy", "orders_exports", "__export", "orders_default", "OrdersPage", "init_orders", "__esmMin", "currentPage", "currentFilter", "init", "orderId", "getOrderIdFromUrl", "loadOrderDetail", "loadOrders", "initFilters", "match", "container", "params", "response", "orders", "meta", "renderOrders", "error", "order", "renderOrderCard", "e", "pageBtn", "statusClass", "items", "displayItems", "remainingCount", "steps", "currentStepIndex", "isCancelled", "step", "i", "item", "renderOrderDetail", "event", "index", "bindOrderDetailEvents", "reorderBtn", "cancelBtn", "printBtn", "filterBtns", "btn", "b", "destroy", "require_preorders", "__commonJSMin", "PreordersPage", "routeMap", "wizardUrl", "landingUrl", "initLanding", "loadFeaturedCategories", "loadPopularTemplates", "loadStats", "container", "response", "categories", "category", "renderCategoryCard", "error", "imageUrl", "hasImage", "escapeHtml", "s", "formatPrice", "p", "statsContainer", "stats", "initCategoryDetail", "categorySlug", "optionsContainer", "options", "renderCategoryOptions", "option", "choice", "initMyPreorders", "preorders", "preorder", "renderPreorderCard", "statusColors", "statusLabels", "statusClass", "statusLabel", "initDetail", "preorderNumber", "loadPreorderStatus", "initMessageForm", "status", "form", "e", "messageInput", "submitBtn", "message", "originalText", "product_exports", "__export", "product_default", "ProductPage", "init_product", "__esmMin", "currentProduct", "selectedVariant", "gallery", "initialized", "serverRendered", "zoomEnabled", "stockAlertEmail", "init", "container", "isServerRendered", "bindExistingEvents", "initEnhancedFeatures", "productSlug", "getProductSlugFromUrl", "loadProduct", "initImageZoom", "initSizeGuideModal", "initStockAlerts", "initSocialSharing", "initQASection", "initDeliveryEstimate", "initRecentlyViewedTracking", "initStickyAddToCart", "initProductVideoPlayer", "mainImage", "lens", "result", "e", "rect", "x", "y", "lensX", "lensY", "zoomLevel", "bgX", "bgY", "sizeGuideBtn", "modal", "stockAlertBtn", "email", "btn", "platform", "url", "title", "productName", "shareUrls", "qaContainer", "mockQAs", "qa", "deliveryContainer", "today", "minDays", "maxDays", "minDate", "maxDate", "formatDate", "date", "productId", "productImage", "productPrice", "recentlyViewed", "existingIndex", "p", "product", "sticky", "mainAddBtn", "entries", "entry", "thumb", "videoUrl", "initQuantityControls", "initAddToCartFromExisting", "initWishlistFromExisting", "markWishlistButtonIfNeeded", "resp", "item", "initVariantSelectionFromExisting", "initGalleryFromExisting", "initCompareFromExisting", "initTabsFromExisting", "tabButtons", "tabContents", "tabName", "b", "content", "quantity", "hasVariants", "variantId", "originalHtml", "error", "inWishlist", "input", "price", "stock", "priceEl", "stockEl", "addBtn", "mobileStock", "mobileBtn", "match", "slug", "renderProduct", "updateMetaTags", "updateStructuredData", "loadBreadcrumbs", "loadRelatedProducts", "loadReviews", "loadRecommendations", "initLazySections", "trackProductView", "images", "inStock", "onSale", "img", "index", "renderVariants", "tag", "key", "value", "initGallery", "initAddToCart", "initWishlist", "initCompare", "initShare", "createOrUpdateMobileAtc", "el", "mobBtn", "variants", "grouped", "variant", "attrName", "options", "opt", "thumbnails", "focusedIndex", "idx", "t", "ev", "next", "prev", "currentIndex", "s", "script", "qtyInput", "decreaseBtn", "increaseBtn", "current", "max", "variantBtns", "priceContainer", "addToCartBtn", "mobileATC", "first", "performAddToCart", "triggerBtn", "variantBtn", "shareBtns", "shareUrl", "image", "err", "list", "items", "cat", "products", "reviews", "review", "showReviewForm", "i", "rating", "comment", "stars", "ratingInput", "star", "desc", "ogImage", "productScript", "data", "fbt", "similar", "liked", "html", "observer", "target", "destroy", "search_exports", "__export", "search_default", "SearchPage", "init_search", "__esmMin", "currentQuery", "currentPage", "currentFilters", "abortController", "initialized", "init", "resultsContainer", "initSearchForm", "initFilters", "initSorting", "initViewToggle", "getQueryFromUrl", "getFiltersFromUrl", "loadProducts", "gridBtn", "listBtn", "resultsCount", "params", "loadCategories", "response", "products", "meta", "renderResults", "loadFilterOptions", "error", "pageTitle", "categories", "cat", "filters", "searchForm", "searchInput", "e", "query", "updateUrl", "performSearch", "suggestionsContainer", "debounceTimer", "product", "container", "viewMode", "gridClass", "pageBtn", "categoriesContainer", "bindCategoryFilter", "radio", "applyPriceBtn", "inStockCheckbox", "clearFiltersBtn", "minPrice", "maxPrice", "r", "minInput", "maxInput", "sortSelect", "newUrl", "destroy", "wishlist_exports", "__export", "wishlist_default", "WishlistPage", "init_wishlist", "__esmMin", "currentPage", "currentSort", "currentFilter", "getCurrencySymbol", "CONFIG", "init", "loadWishlist", "bindGlobalEvents", "resolveProductImage", "item", "product", "candidates", "pick", "val", "candidate", "url", "resolvePrices", "pickNumber", "num", "priceCandidates", "price", "p", "saleCandidates", "salePrice", "s", "lowestPrice", "highestPrice", "targetPrice", "priceAtAdd", "container", "response", "items", "meta", "filteredItems", "prices", "renderWishlist", "error", "msg", "allItems", "totalItems", "onSaleCount", "priceDropCount", "atTargetCount", "renderWishlistItem", "mount", "paginator", "page", "bindEvents", "productName", "productSlug", "inStock", "imageUrl", "requiresVariants", "priceObj", "currentPrice", "hasPriceDrop", "priceChangePercent", "isAtTarget", "isOnSale", "priority", "priorityConfig", "safeEscape", "safePriceRender", "formatPrice", "aspectCss", "err", "e", "btn", "clearAllBtn", "addAllBtn", "shareBtn", "wishlistItems", "sortSelect", "filterBtns", "added", "failed", "productId", "shareUrl", "itemId", "priorities", "currentPriority", "currentIndex", "nextPriority", "config", "content", "confirmed", "originalText", "showVariantPicker", "renderModalVariants", "variants", "grouped", "variant", "attrName", "options", "opt", "index", "slug", "id", "res", "currency", "firstImage", "variantId", "qty", "variantBtns", "b", "priceEl", "first", "destroy", "require_app", "__commonJSMin", "init_lazyHydrate", "init_", "App", "pageControllers", "currentPage", "currentController", "loadPageController", "page", "mod", "globImport_pages_js", "e", "init", "detectCurrentPage", "initGlobalComponents", "initCurrentPage", "initCartBadge", "initWishlistBadge", "initGlobalEventListeners", "initMobileMenu", "initLanguageSelector", "navEntries", "nav", "doc", "scrolled", "maxScroll", "raw", "parsed", "items", "syncWishlistButtons", "payload", "_lastWishlistItems", "mapById", "mapBySlug", "it", "pid", "pslug", "id", "btn", "svg", "fillPath", "productId", "productSlug", "itemId", "debounceTimer", "mutations", "found", "m", "n", "path", "body", "trigger", "targetId", "target", "initLazyHydration", "controller", "count", "updateCartBadge", "findWishlistItemId", "item", "badge", "updateAuthUI", "quickAddBtn", "originalHtml", "error", "wishlistBtn", "wishlistItemId", "shouldRemove", "res", "response", "createdId", "quickViewBtn", "backToTopBtn", "isLoggedIn", "el", "state", "menuBtn", "closeBtn", "mobileMenu", "overlay", "openMenu", "closeMenu", "languageBtn", "languageDropdown", "lang", "destroy"]
}
